{"version":3,"file":"create-from-pdf-action-YFbsQA5I.js","sources":["../src/create-from-pdf-modal.token.ts","../src/create-from-pdf-action.ts"],"sourcesContent":["import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface UmbCreateFromPdfModalData {\r\n\tunique: string | null;\r\n}\r\n\r\nexport interface UmbCreateFromPdfModalValue {\r\n\tname: string;\r\n\tmediaUnique: string | null;\r\n}\r\n\r\nexport const UMB_CREATE_FROM_PDF_MODAL = new UmbModalToken<UmbCreateFromPdfModalData, UmbCreateFromPdfModalValue>(\r\n\t'CreateFromPdf.Modal',\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'sidebar',\r\n\t\t\tsize: 'small',\r\n\t\t},\r\n\t},\r\n);\r\n","import { UMB_CREATE_FROM_PDF_MODAL } from './create-from-pdf-modal.token.js';\r\nimport { UmbEntityActionBase } from '@umbraco-cms/backoffice/entity-action';\r\nimport { umbOpenModal } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbEntityActionArgs } from '@umbraco-cms/backoffice/entity-action';\r\nimport { UMB_NOTIFICATION_CONTEXT } from '@umbraco-cms/backoffice/notification';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\n\r\nexport class CreateFromPdfEntityAction extends UmbEntityActionBase<never> {\r\n\tconstructor(host: UmbControllerHost, args: UmbEntityActionArgs<never>) {\r\n\t\tsuper(host, args);\r\n\t}\r\n\r\n\toverride async execute() {\r\n\t\tlet value;\r\n\t\ttry {\r\n\t\t\tvalue = await umbOpenModal(this, UMB_CREATE_FROM_PDF_MODAL, {\r\n\t\t\t\tdata: { unique: this.args.unique ?? null },\r\n\t\t\t});\r\n\t\t} catch {\r\n\t\t\t// Modal was cancelled\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconsole.log('Modal returned value:', value);\r\n\t\tconst { name, mediaUnique } = value;\r\n\t\tconsole.log('Name:', name, 'MediaUnique:', mediaUnique);\r\n\t\tif (!name || !mediaUnique) {\r\n\t\t\tconsole.log('Returning early - name or mediaUnique is empty');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Get auth token for API call\r\n\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t// Call the PDF extraction API (Umbraco 17 Management API)\r\n\t\tconst response = await fetch(\r\n\t\t\t`/umbraco/management/api/v1/createfrompdf/extract?mediaKey=${mediaUnique}`,\r\n\t\t\t{\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tif (!response.ok) {\r\n\t\t\tconst error = await response.json();\r\n\t\t\tconsole.error('PDF extraction failed:', error);\r\n\r\n\t\t\t// Show notification\r\n\t\t\tconst notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n\t\t\tnotificationContext.peek('danger', {\r\n\t\t\t\tdata: { message: `PDF extraction failed: ${error.error || 'Unknown error'}` },\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst result = await response.json();\r\n\t\tconsole.log('PDF extraction result:', result);\r\n\t\tconsole.log('Extracted text:', result.text);\r\n\t\tconsole.log('Page count:', result.pageCount);\r\n\r\n\t\t// Show success notification\r\n\t\tconst notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n\t\tnotificationContext.peek('positive', {\r\n\t\t\tdata: { message: `Successfully extracted ${result.pageCount} page(s) from PDF` },\r\n\t\t});\r\n\r\n\t\t// TODO: Create document with extracted content\r\n\t\tconsole.log('Document name:', name);\r\n\t}\r\n}\r\n\r\nexport default CreateFromPdfEntityAction;\r\n"],"names":["UMB_CREATE_FROM_PDF_MODAL","UmbModalToken","CreateFromPdfEntityAction","UmbEntityActionBase","host","args","value","umbOpenModal","name","mediaUnique","token","UMB_AUTH_CONTEXT","response","error","UMB_NOTIFICATION_CONTEXT","result"],"mappings":";;;;AAWO,MAAMA,IAA4B,IAAIC;AAAA,EAC5C;AAAA,EACA;AAAA,IACC,OAAO;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,IAAA;AAAA,EACP;AAEF;ACXO,MAAMC,UAAkCC,EAA2B;AAAA,EACzE,YAAYC,GAAyBC,GAAkC;AACtE,UAAMD,GAAMC,CAAI;AAAA,EACjB;AAAA,EAEA,MAAe,UAAU;AACxB,QAAIC;AACJ,QAAI;AACH,MAAAA,IAAQ,MAAMC,EAAa,MAAMP,GAA2B;AAAA,QAC3D,MAAM,EAAE,QAAQ,KAAK,KAAK,UAAU,KAAA;AAAA,MAAK,CACzC;AAAA,IACF,QAAQ;AAEP;AAAA,IACD;AAEA,YAAQ,IAAI,yBAAyBM,CAAK;AAC1C,UAAM,EAAE,MAAAE,GAAM,aAAAC,EAAA,IAAgBH;AAE9B,QADA,QAAQ,IAAI,SAASE,GAAM,gBAAgBC,CAAW,GAClD,CAACD,KAAQ,CAACC,GAAa;AAC1B,cAAQ,IAAI,gDAAgD;AAC5D;AAAA,IACD;AAIA,UAAMC,IAAQ,OADM,MAAM,KAAK,WAAWC,CAAgB,GAC1B,eAAA,GAG1BC,IAAW,MAAM;AAAA,MACtB,6DAA6DH,CAAW;AAAA,MACxE;AAAA,QACC,QAAQ;AAAA,QACR,SAAS;AAAA,UACR,gBAAgB;AAAA,UAChB,eAAe,UAAUC,CAAK;AAAA,QAAA;AAAA,MAC/B;AAAA,IACD;AAGD,QAAI,CAACE,EAAS,IAAI;AACjB,YAAMC,IAAQ,MAAMD,EAAS,KAAA;AAC7B,cAAQ,MAAM,0BAA0BC,CAAK,IAGjB,MAAM,KAAK,WAAWC,CAAwB,GACtD,KAAK,UAAU;AAAA,QAClC,MAAM,EAAE,SAAS,0BAA0BD,EAAM,SAAS,eAAe,GAAA;AAAA,MAAG,CAC5E;AACD;AAAA,IACD;AAEA,UAAME,IAAS,MAAMH,EAAS,KAAA;AAC9B,YAAQ,IAAI,0BAA0BG,CAAM,GAC5C,QAAQ,IAAI,mBAAmBA,EAAO,IAAI,GAC1C,QAAQ,IAAI,eAAeA,EAAO,SAAS,IAGf,MAAM,KAAK,WAAWD,CAAwB,GACtD,KAAK,YAAY;AAAA,MACpC,MAAM,EAAE,SAAS,0BAA0BC,EAAO,SAAS,oBAAA;AAAA,IAAoB,CAC/E,GAGD,QAAQ,IAAI,kBAAkBP,CAAI;AAAA,EACnC;AACD;"}