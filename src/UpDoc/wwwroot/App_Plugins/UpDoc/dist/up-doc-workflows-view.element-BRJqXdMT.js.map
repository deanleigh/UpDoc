{"version":3,"file":"up-doc-workflows-view.element-BRJqXdMT.js","sources":["../src/create-workflow-modal.token.ts","../src/up-doc-workflows-view.element.ts"],"sourcesContent":["import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface CreateWorkflowModalData {}\r\n\r\nexport interface CreateWorkflowModalValue {\r\n\tname: string;\r\n\tdocumentTypeAlias: string;\r\n\tblueprintId?: string;\r\n\tblueprintName?: string;\r\n}\r\n\r\nexport const UMB_CREATE_WORKFLOW_MODAL = new UmbModalToken<CreateWorkflowModalData, CreateWorkflowModalValue>(\r\n\t'UpDoc.CreateWorkflowModal',\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'dialog',\r\n\t\t\tsize: 'small',\r\n\t\t},\r\n\t},\r\n);\r\n","import { html, css, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_CREATE_WORKFLOW_MODAL } from './create-workflow-modal.token.js';\r\n\r\ninterface WorkflowSummary {\r\n\tname: string;\r\n\tdocumentTypeAlias: string;\r\n\tblueprintId: string | null;\r\n\tblueprintName: string | null;\r\n\tsourceTypes: string[];\r\n\tmappingCount: number;\r\n\tisComplete: boolean;\r\n\tvalidationWarnings: string[];\r\n}\r\n\r\n@customElement('up-doc-workflows-view')\r\nexport class UpDocWorkflowsViewElement extends UmbLitElement {\r\n\t@state() private _workflows: WorkflowSummary[] = [];\r\n\t@state() private _loading = true;\r\n\t@state() private _error: string | null = null;\r\n\r\n\toverride async connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tawait this.#loadWorkflows();\r\n\t}\r\n\r\n\tasync #loadWorkflows() {\r\n\t\tthis._loading = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t\tconst response = await fetch('/umbraco/management/api/v1/updoc/workflows', {\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\tif (!response.ok) {\r\n\t\t\t\tthrow new Error(`Failed to load workflows: ${response.statusText}`);\r\n\t\t\t}\r\n\r\n\t\t\tthis._workflows = await response.json();\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Unknown error';\r\n\t\t\tconsole.error('Failed to load workflows:', err);\r\n\t\t} finally {\r\n\t\t\tthis._loading = false;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #handleCreateWorkflow() {\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_CREATE_WORKFLOW_MODAL, { data: {} });\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await modal.onSubmit();\r\n\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t\tconst response = await fetch('/umbraco/management/api/v1/updoc/workflows', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify(result),\r\n\t\t\t});\r\n\r\n\t\t\tif (!response.ok) {\r\n\t\t\t\tconst error = await response.json();\r\n\t\t\t\tthrow new Error(error.error || `Failed to create workflow: ${response.statusText}`);\r\n\t\t\t}\r\n\r\n\t\t\t// Refresh the list\r\n\t\t\tawait this.#loadWorkflows();\r\n\t\t} catch (err) {\r\n\t\t\t// Modal was rejected (cancelled) — do nothing\r\n\t\t\tif (err instanceof Error && err.message !== 'Modal was rejected') {\r\n\t\t\t\tthis._error = err.message;\r\n\t\t\t\tconsole.error('Failed to create workflow:', err);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<uui-loader-bar></uui-loader-bar>`;\r\n\t\t}\r\n\r\n\t\tif (this._error) {\r\n\t\t\treturn html`\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t<p style=\"color: var(--uui-color-danger);\">Error: ${this._error}</p>\r\n\t\t\t\t\t<uui-button look=\"secondary\" @click=${() => this.#loadWorkflows()}>Retry</uui-button>\r\n\t\t\t\t</uui-box>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tif (this._workflows.length === 0) {\r\n\t\t\treturn this.#renderEmptyState();\r\n\t\t}\r\n\r\n\t\treturn this.#renderWorkflowList();\r\n\t}\r\n\r\n\t#renderEmptyState() {\r\n\t\treturn html`\r\n\t\t\t<uui-box headline=\"No workflows configured\">\r\n\t\t\t\t<p>\r\n\t\t\t\t\tWorkflows define how content is extracted from external sources (PDFs, web pages, documents)\r\n\t\t\t\t\tand mapped to Umbraco document properties.\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>\r\n\t\t\t\t\tCreate a workflow to enable the <strong>\"Create from Source\"</strong> action\r\n\t\t\t\t\tfor a document type.\r\n\t\t\t\t</p>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\tlabel=\"Create Workflow\"\r\n\t\t\t\t\t@click=${this.#handleCreateWorkflow}></uui-button>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderWorkflowList() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"header\">\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\tlabel=\"Create Workflow\"\r\n\t\t\t\t\t@click=${this.#handleCreateWorkflow}></uui-button>\r\n\t\t\t</div>\r\n\t\t\t<uui-box>\r\n\t\t\t\t<uui-table>\r\n\t\t\t\t\t<uui-table-head>\r\n\t\t\t\t\t\t<uui-table-head-cell>Workflow</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Document Type</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Blueprint</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Sources</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Mappings</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Status</uui-table-head-cell>\r\n\t\t\t\t\t</uui-table-head>\r\n\t\t\t\t\t${this._workflows.map(\r\n\t\t\t\t\t\t(w) => html`\r\n\t\t\t\t\t\t\t<uui-table-row>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${w.name}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${w.documentTypeAlias}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${w.blueprintName ?? w.blueprintId ?? '—'}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${w.sourceTypes.join(', ') || '—'}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${w.mappingCount}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>\r\n\t\t\t\t\t\t\t\t\t<uui-tag\r\n\t\t\t\t\t\t\t\t\t\tlook=${w.isComplete ? 'primary' : 'secondary'}\r\n\t\t\t\t\t\t\t\t\t\tcolor=${w.isComplete ? 'positive' : 'warning'}>\r\n\t\t\t\t\t\t\t\t\t\t${w.isComplete ? 'Ready' : 'Incomplete'}\r\n\t\t\t\t\t\t\t\t\t</uui-tag>\r\n\t\t\t\t\t\t\t\t</uui-table-cell>\r\n\t\t\t\t\t\t\t</uui-table-row>\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-table>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocWorkflowsViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-workflows-view': UpDocWorkflowsViewElement;\r\n\t}\r\n}\r\n"],"names":["UMB_CREATE_WORKFLOW_MODAL","UmbModalToken","_UpDocWorkflowsViewElement_instances","loadWorkflows_fn","handleCreateWorkflow_fn","renderEmptyState_fn","renderWorkflowList_fn","UpDocWorkflowsViewElement","UmbLitElement","__privateAdd","__privateMethod","html","token","UMB_AUTH_CONTEXT","response","err","modal","UMB_MODAL_MANAGER_CONTEXT","result","error","w","UmbTextStyles","css","__decorateClass","state","customElement","UpDocWorkflowsViewElement_default"],"mappings":"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"}