{"version":3,"file":"up-doc-workflow-source-view.element-B1CF_2OB.js","sources":["../src/destination-picker-modal.token.ts","../src/pdf-zone-editor-modal.token.ts","../src/section-rules-editor-modal.token.ts","../src/up-doc-workflow-source-view.element.ts"],"sourcesContent":["import type { DestinationConfig } from './workflow.types.js';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface DestinationPickerModalData {\r\n\tdestination: DestinationConfig;\r\n}\r\n\r\nexport interface DestinationPickerModalValue {\r\n\tselectedTargets: Array<{ target: string; blockKey?: string }>;\r\n}\r\n\r\nexport const UMB_DESTINATION_PICKER_MODAL = new UmbModalToken<\r\n\tDestinationPickerModalData,\r\n\tDestinationPickerModalValue\r\n>('UpDoc.DestinationPickerModal', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n","import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\nimport type { ZoneTemplate } from './workflow.types.js';\r\n\r\nexport interface ZoneEditorModalData {\r\n\tworkflowName: string;\r\n\texistingTemplate?: ZoneTemplate | null;\r\n\tselectedPages?: number[] | null;\r\n}\r\n\r\nexport interface ZoneEditorModalValue {\r\n\ttemplate: ZoneTemplate;\r\n}\r\n\r\nexport const UMB_ZONE_EDITOR_MODAL = new UmbModalToken<ZoneEditorModalData, ZoneEditorModalValue>(\r\n\t'UpDoc.ZoneEditorModal',\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'sidebar',\r\n\t\t\tsize: 'full',\r\n\t\t},\r\n\t},\r\n);\r\n","import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\nimport type { ZoneElement, SectionRuleSet } from './workflow.types.js';\r\n\r\nexport interface SectionRulesEditorModalData {\r\n\tworkflowName: string;\r\n\tsectionId: string;\r\n\tsectionHeading: string;\r\n\t/** The elements belonging to this section (from zone detection). */\r\n\telements: ZoneElement[];\r\n\t/** Existing rules for this section, if any. */\r\n\texistingRules?: SectionRuleSet | null;\r\n}\r\n\r\nexport interface SectionRulesEditorModalValue {\r\n\trules: SectionRuleSet;\r\n}\r\n\r\nexport const UMB_SECTION_RULES_EDITOR_MODAL = new UmbModalToken<SectionRulesEditorModalData, SectionRulesEditorModalValue>(\r\n\t'UpDoc.SectionRulesEditorModal',\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'sidebar',\r\n\t\t\tsize: 'medium',\r\n\t\t},\r\n\t},\r\n);\r\n","import type { RichExtractionResult, DocumentTypeConfig, MappingDestination, ZoneDetectionResult, DetectedZone, DetectedSection, ZoneElement, TransformResult, TransformedSection, SourceConfig, ZoneTemplate, SectionRuleSet } from './workflow.types.js';\r\nimport { fetchSampleExtraction, triggerSampleExtraction, fetchWorkflowByName, fetchZoneDetection, triggerTransform, fetchTransformResult, updateSectionInclusion, saveMapConfig, savePageSelection, fetchSourceConfig, fetchZoneTemplate, saveZoneTemplate, saveSectionRules } from './workflow.service.js';\r\nimport { markdownToHtml, normalizeToKebabCase } from './transforms.js';\r\nimport { UMB_DESTINATION_PICKER_MODAL } from './destination-picker-modal.token.js';\r\nimport { UMB_ZONE_EDITOR_MODAL } from './pdf-zone-editor-modal.token.js';\r\nimport { UMB_PAGE_PICKER_MODAL } from './page-picker-modal.token.js';\r\nimport { UMB_SECTION_RULES_EDITOR_MODAL } from './section-rules-editor-modal.token.js';\r\nimport { html, css, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MEDIA_PICKER_MODAL } from '@umbraco-cms/backoffice/media';\r\n\r\n@customElement('up-doc-workflow-source-view')\r\nexport class UpDocWorkflowSourceViewElement extends UmbLitElement {\r\n\t@state() private _extraction: RichExtractionResult | null = null;\r\n\t@state() private _zoneDetection: ZoneDetectionResult | null = null;\r\n\t@state() private _config: DocumentTypeConfig | null = null;\r\n\t@state() private _workflowName: string | null = null;\r\n\t@state() private _loading = true;\r\n\t@state() private _extracting = false;\r\n\t@state() private _error: string | null = null;\r\n\t@state() private _successMessage: string | null = null;\r\n\t@state() private _collapsed = new Set<string>();\r\n\t@state() private _transformResult: TransformResult | null = null;\r\n\t@state() private _viewMode: 'elements' | 'transformed' = 'elements';\r\n\t@state() private _sourceConfig: SourceConfig | null = null;\r\n\t@state() private _pageMode: 'all' | 'custom' = 'all';\r\n\t@state() private _pageInputValue = '';\r\n\t@state() private _collapsePopoverOpen = false;\r\n\t@state() private _excludedAreas = new Set<string>();\r\n\t@state() private _zoneTemplate: ZoneTemplate | null = null;\r\n\t@state() private _sectionPickerOpen = false;\r\n\t#token = '';\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.consumeContext(UMB_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\t\t\t// Register save handler so the workspace Save button triggers re-extraction\r\n\t\t\t(context as any).setSaveHandler(() => this.#onReExtract());\r\n\t\t\tthis.observe((context as any).unique, (unique: string | null) => {\r\n\t\t\t\tif (unique) {\r\n\t\t\t\t\tthis._workflowName = decodeURIComponent(unique);\r\n\t\t\t\t\tthis.#loadData();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #loadData() {\r\n\t\tif (!this._workflowName) return;\r\n\r\n\t\tthis._loading = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tthis.#token = await authContext.getLatestToken();\r\n\t\t\tconst [extraction, zoneDetection, config, transformResult, sourceConfig, zoneTemplate] = await Promise.all([\r\n\t\t\t\tfetchSampleExtraction(this._workflowName, this.#token),\r\n\t\t\t\tfetchZoneDetection(this._workflowName, this.#token),\r\n\t\t\t\tfetchWorkflowByName(this._workflowName, this.#token),\r\n\t\t\t\tfetchTransformResult(this._workflowName, this.#token),\r\n\t\t\t\tfetchSourceConfig(this._workflowName, this.#token),\r\n\t\t\t\tfetchZoneTemplate(this._workflowName, this.#token),\r\n\t\t\t]);\r\n\t\t\tthis._extraction = extraction;\r\n\t\t\tthis._zoneDetection = zoneDetection;\r\n\t\t\tthis._config = config;\r\n\t\t\tthis._transformResult = transformResult;\r\n\t\t\tthis._sourceConfig = sourceConfig;\r\n\t\t\tthis._zoneTemplate = zoneTemplate;\r\n\r\n\t\t\t// Initialize page selection state from source config\r\n\t\t\tif (sourceConfig?.pages && Array.isArray(sourceConfig.pages) && sourceConfig.pages.length > 0) {\r\n\t\t\t\tthis._pageMode = 'custom';\r\n\t\t\t\tthis._pageInputValue = this.#pagesToRangeString(sourceConfig.pages);\r\n\t\t\t} else {\r\n\t\t\t\tthis._pageMode = 'all';\r\n\t\t\t\tthis._pageInputValue = '';\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Failed to load data';\r\n\t\t\tconsole.error('Failed to load source data:', err);\r\n\t\t} finally {\r\n\t\t\tthis._loading = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Convert \"1-3, 5, 7-9\" → [1, 2, 3, 5, 7, 8, 9] */\r\n\t#parsePageRange(input: string): number[] {\r\n\t\tconst pages = new Set<number>();\r\n\t\tfor (const part of input.split(',')) {\r\n\t\t\tconst trimmed = part.trim();\r\n\t\t\tif (!trimmed) continue;\r\n\t\t\tconst rangeParts = trimmed.split('-').map((s) => parseInt(s.trim(), 10));\r\n\t\t\tif (rangeParts.length === 1 && !isNaN(rangeParts[0])) {\r\n\t\t\t\tpages.add(rangeParts[0]);\r\n\t\t\t} else if (rangeParts.length === 2 && !isNaN(rangeParts[0]) && !isNaN(rangeParts[1])) {\r\n\t\t\t\tfor (let i = rangeParts[0]; i <= rangeParts[1]; i++) {\r\n\t\t\t\t\tpages.add(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [...pages].sort((a, b) => a - b);\r\n\t}\r\n\r\n\t/** Convert [1, 2, 3, 5, 7, 8, 9] → \"1-3, 5, 7-9\" */\r\n\t#pagesToRangeString(pages: number[]): string {\r\n\t\tif (!pages.length) return '';\r\n\t\tconst sorted = [...pages].sort((a, b) => a - b);\r\n\t\tconst ranges: string[] = [];\r\n\t\tlet start = sorted[0];\r\n\t\tlet end = sorted[0];\r\n\t\tfor (let i = 1; i < sorted.length; i++) {\r\n\t\t\tif (sorted[i] === end + 1) {\r\n\t\t\t\tend = sorted[i];\r\n\t\t\t} else {\r\n\t\t\t\tranges.push(start === end ? `${start}` : `${start}-${end}`);\r\n\t\t\t\tstart = sorted[i];\r\n\t\t\t\tend = sorted[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tranges.push(start === end ? `${start}` : `${start}-${end}`);\r\n\t\treturn ranges.join(', ');\r\n\t}\r\n\r\n\t/** Get the currently selected page numbers, or null for \"all\". */\r\n\t#getSelectedPages(): number[] | null {\r\n\t\tif (this._pageMode === 'all') return null;\r\n\t\tconst pages = this.#parsePageRange(this._pageInputValue);\r\n\t\treturn pages.length > 0 ? pages : null;\r\n\t}\r\n\r\n\t/** Check whether a specific page number is included in the current selection. */\r\n\t#isPageIncluded(pageNum: number): boolean {\r\n\t\tif (this._pageMode === 'all') return true;\r\n\t\tconst pages = this.#parsePageRange(this._pageInputValue);\r\n\t\treturn pages.length === 0 || pages.includes(pageNum);\r\n\t}\r\n\r\n\t/** Toggle a page on/off and update the text input. */\r\n\t#togglePage(pageNum: number) {\r\n\t\tconst totalPages = this._zoneDetection?.totalPages ?? this._extraction?.source.totalPages ?? 0;\r\n\t\tif (totalPages === 0) return;\r\n\r\n\t\tif (this._pageMode === 'all') {\r\n\t\t\t// Switching from \"all\" to \"custom\" by toggling one page off\r\n\t\t\tconst allPages = Array.from({ length: totalPages }, (_, i) => i + 1);\r\n\t\t\tconst remaining = allPages.filter((p) => p !== pageNum);\r\n\t\t\tthis._pageMode = 'custom';\r\n\t\t\tthis._pageInputValue = this.#pagesToRangeString(remaining);\r\n\t\t} else {\r\n\t\t\tconst current = this.#parsePageRange(this._pageInputValue);\r\n\t\t\tif (current.includes(pageNum)) {\r\n\t\t\t\tconst remaining = current.filter((p) => p !== pageNum);\r\n\t\t\t\tthis._pageInputValue = this.#pagesToRangeString(remaining);\r\n\t\t\t\t// If all removed, switch back to \"all\" mode\r\n\t\t\t\tif (remaining.length === 0) {\r\n\t\t\t\t\tthis._pageMode = 'all';\r\n\t\t\t\t\tthis._pageInputValue = '';\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst updated = [...current, pageNum].sort((a, b) => a - b);\r\n\t\t\t\tthis._pageInputValue = this.#pagesToRangeString(updated);\r\n\t\t\t}\r\n\t\t\t// If all pages are now selected, switch back to \"all\"\r\n\t\t\tif (this.#parsePageRange(this._pageInputValue).length === totalPages) {\r\n\t\t\t\tthis._pageMode = 'all';\r\n\t\t\t\tthis._pageInputValue = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.#savePageSelection();\r\n\t}\r\n\r\n\tasync #onPageModeChange(mode: 'all' | 'custom') {\r\n\t\tthis._pageMode = mode;\r\n\t\tif (mode === 'all') {\r\n\t\t\tthis._pageInputValue = '';\r\n\t\t}\r\n\t\tawait this.#savePageSelection();\r\n\t}\r\n\r\n\tasync #onPageInputChange(e: Event) {\r\n\t\tconst input = e.target as HTMLInputElement;\r\n\t\tthis._pageInputValue = input.value;\r\n\t}\r\n\r\n\tasync #onPageInputBlur() {\r\n\t\t// Normalize the input and save\r\n\t\tconst pages = this.#parsePageRange(this._pageInputValue);\r\n\t\tif (pages.length > 0) {\r\n\t\t\tthis._pageInputValue = this.#pagesToRangeString(pages);\r\n\t\t\tthis._pageMode = 'custom';\r\n\t\t} else {\r\n\t\t\tthis._pageMode = 'all';\r\n\t\t\tthis._pageInputValue = '';\r\n\t\t}\r\n\t\tawait this.#savePageSelection();\r\n\t}\r\n\r\n\tasync #savePageSelection() {\r\n\t\tif (!this._workflowName) return;\r\n\t\tconst pages = this.#getSelectedPages();\r\n\t\tawait savePageSelection(this._workflowName, pages, this.#token);\r\n\t}\r\n\r\n\t/** Get all collapse keys for a given level. */\r\n\t#getKeysForLevel(level: 'pages' | 'areas' | 'sections'): string[] {\r\n\t\tif (!this._zoneDetection) return [];\r\n\t\tconst keys: string[] = [];\r\n\t\tfor (const page of this._zoneDetection.pages) {\r\n\t\t\tconst pageNum = page.page;\r\n\t\t\tif (level === 'pages') {\r\n\t\t\t\tkeys.push(`page-${pageNum}`);\r\n\t\t\t}\r\n\t\t\tif (level === 'areas') {\r\n\t\t\t\tpage.zones.forEach((_z, aIdx) => keys.push(`area-p${pageNum}-a${aIdx}`));\r\n\t\t\t\tif (page.unzonedContent) keys.push(`area-p${pageNum}-undefined`);\r\n\t\t\t}\r\n\t\t\tif (level === 'sections') {\r\n\t\t\t\tpage.zones.forEach((_z, aIdx) => {\r\n\t\t\t\t\t_z.sections.forEach((_s, sIdx) => keys.push(`p${pageNum}-a${aIdx}-s${sIdx}`));\r\n\t\t\t\t});\r\n\t\t\t\tif (page.unzonedContent) {\r\n\t\t\t\t\tpage.unzonedContent.sections.forEach((_s, sIdx) => keys.push(`p${pageNum}-undefined-s${sIdx}`));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn keys;\r\n\t}\r\n\r\n\t/** Check if all items at a level are currently collapsed. */\r\n\t#isLevelCollapsed(level: 'pages' | 'areas' | 'sections'): boolean {\r\n\t\tconst keys = this.#getKeysForLevel(level);\r\n\t\treturn keys.length > 0 && keys.every((k) => this._collapsed.has(k));\r\n\t}\r\n\r\n\t/** Toggle all items at a given level. */\r\n\t#toggleLevel(level: 'pages' | 'areas' | 'sections') {\r\n\t\tconst keys = this.#getKeysForLevel(level);\r\n\t\tconst allCollapsed = this.#isLevelCollapsed(level);\r\n\t\tconst next = new Set(this._collapsed);\r\n\t\tfor (const key of keys) {\r\n\t\t\tif (allCollapsed) {\r\n\t\t\t\tnext.delete(key);\r\n\t\t\t} else {\r\n\t\t\t\tnext.add(key);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._collapsed = next;\r\n\t}\r\n\r\n\t/** Expand everything. */\r\n\t#expandAll() {\r\n\t\tthis._collapsed = new Set<string>();\r\n\t}\r\n\r\n\t#onCollapsePopoverToggle(event: ToggleEvent) {\r\n\t\tthis._collapsePopoverOpen = event.newState === 'open';\r\n\t}\r\n\r\n\tasync #onPickMedia() {\r\n\t\tif (!this._workflowName) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_MEDIA_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tmultiple: false,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst result = await modal.onSubmit().catch(() => null);\r\n\t\tif (!result?.selection?.length) return;\r\n\r\n\t\tconst mediaKey = result.selection[0];\r\n\t\tif (!mediaKey) return;\r\n\r\n\t\tawait this.#runExtraction(mediaKey);\r\n\t}\r\n\r\n\t/** Opens the zone editor modal to define/edit extraction areas. */\r\n\tasync #onEditAreas() {\r\n\t\tif (!this._workflowName) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_ZONE_EDITOR_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tworkflowName: this._workflowName,\r\n\t\t\t\texistingTemplate: this._zoneTemplate,\r\n\t\t\t\tselectedPages: this._sourceConfig?.pages && Array.isArray(this._sourceConfig.pages)\r\n\t\t\t\t\t? this._sourceConfig.pages\r\n\t\t\t\t\t: null,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await modal.onSubmit();\r\n\t\t\tif (result?.template) {\r\n\t\t\t\t// Save the zone template\r\n\t\t\t\tconst saved = await saveZoneTemplate(this._workflowName, result.template, this.#token);\r\n\t\t\t\tif (saved) {\r\n\t\t\t\t\tthis._zoneTemplate = saved;\r\n\t\t\t\t\t// Re-extract with the new zone template applied\r\n\t\t\t\t\tawait this.#onReExtract();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch {\r\n\t\t\t// Modal was cancelled — do nothing\r\n\t\t}\r\n\t}\r\n\r\n\t/** Builds a list of transform sections with their corresponding zone detection elements. */\r\n\t#getTransformSectionsWithElements(): Array<{ id: string; heading: string; elements: ZoneElement[] }> {\r\n\t\tif (!this._transformResult || !this._zoneDetection) return [];\r\n\r\n\t\tconst result: Array<{ id: string; heading: string; elements: ZoneElement[] }> = [];\r\n\r\n\t\tfor (const section of this._transformResult.sections) {\r\n\t\t\tif (!section.included) continue;\r\n\t\t\tconst elements = this.#findElementsForSection(section);\r\n\t\t\tresult.push({\r\n\t\t\t\tid: section.id,\r\n\t\t\t\theading: section.heading ?? 'Content',\r\n\t\t\t\telements,\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/** Find zone detection elements that belong to a given transform section. */\r\n\t#findElementsForSection(section: TransformedSection): ZoneElement[] {\r\n\t\tif (!this._zoneDetection) return [];\r\n\r\n\t\t// Walk zone detection pages looking for the matching detected section\r\n\t\tfor (const page of this._zoneDetection.pages) {\r\n\t\t\tif (page.page !== section.page) continue;\r\n\r\n\t\t\tconst allZones = [...page.zones, ...(page.unzonedContent ? [page.unzonedContent] : [])];\r\n\t\t\tfor (const zone of allZones) {\r\n\t\t\t\tfor (const detectedSection of zone.sections) {\r\n\t\t\t\t\tconst detectedId = detectedSection.heading\r\n\t\t\t\t\t\t? normalizeToKebabCase(detectedSection.heading.text)\r\n\t\t\t\t\t\t: this.#buildPreambleId(page.page, zone, page);\r\n\t\t\t\t\tif (detectedId === section.id) {\r\n\t\t\t\t\t\t// Collect heading + children as element list\r\n\t\t\t\t\t\tconst elements: ZoneElement[] = [];\r\n\t\t\t\t\t\tif (detectedSection.heading) elements.push(detectedSection.heading);\r\n\t\t\t\t\t\telements.push(...detectedSection.children);\r\n\t\t\t\t\t\treturn elements;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [];\r\n\t}\r\n\r\n\t/** Build a preamble section ID matching the transform layer's convention. */\r\n\t#buildPreambleId(pageNum: number, zone: DetectedZone, pageZones: { zones: DetectedZone[]; unzonedContent: DetectedZone | null }): string {\r\n\t\tconst zoneIdx = pageZones.zones.indexOf(zone);\r\n\t\treturn zoneIdx >= 0 ? `preamble-p${pageNum}-z${zoneIdx}` : `preamble-p${pageNum}-unzoned`;\r\n\t}\r\n\r\n\t#onSectionPickerToggle(event: ToggleEvent) {\r\n\t\tthis._sectionPickerOpen = event.newState === 'open';\r\n\t}\r\n\r\n\t/** Opens the rules editor modal for a specific transform section. */\r\n\tasync #onEditSectionRules(sectionId: string, sectionHeading: string, elements: ZoneElement[]) {\r\n\t\tif (!this._workflowName) return;\r\n\r\n\t\tconst existingRules = this._sourceConfig?.sectionRules?.[sectionId] ?? null;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_SECTION_RULES_EDITOR_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tworkflowName: this._workflowName,\r\n\t\t\t\tsectionId,\r\n\t\t\t\tsectionHeading,\r\n\t\t\t\telements,\r\n\t\t\t\texistingRules,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await modal.onSubmit();\r\n\t\t\tif (result?.rules) {\r\n\t\t\t\t// Merge into existing sectionRules and save\r\n\t\t\t\tconst allRules: Record<string, SectionRuleSet> = {\r\n\t\t\t\t\t...(this._sourceConfig?.sectionRules ?? {}),\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (result.rules.rules.length > 0) {\r\n\t\t\t\t\tallRules[sectionId] = result.rules;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// No rules left — remove the entry\r\n\t\t\t\t\tdelete allRules[sectionId];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst saved = await saveSectionRules(this._workflowName, allRules, this.#token);\r\n\t\t\t\tif (saved && this._sourceConfig) {\r\n\t\t\t\t\tthis._sourceConfig = { ...this._sourceConfig, sectionRules: saved };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch {\r\n\t\t\t// Modal cancelled\r\n\t\t}\r\n\t}\r\n\r\n\t/** Opens the page picker modal with PDF thumbnails. */\r\n\tasync #onOpenPagePicker() {\r\n\t\tconst mediaKey = this._extraction?.source.mediaKey;\r\n\t\tif (!mediaKey) return;\r\n\r\n\t\tconst totalPages = this._zoneDetection?.totalPages ?? this._extraction?.source.totalPages ?? 0;\r\n\t\tif (totalPages === 0) return;\r\n\r\n\t\tconst selectedPages = this.#getSelectedPages();\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_PAGE_PICKER_MODAL, {\r\n\t\t\tdata: { mediaKey, totalPages, selectedPages },\r\n\t\t});\r\n\r\n\t\tconst result = await modal.onSubmit().catch(() => null);\r\n\t\tif (result === null) return; // cancelled\r\n\r\n\t\t// Update local state from the modal result\r\n\t\tif (result.selectedPages === null) {\r\n\t\t\tthis._pageMode = 'all';\r\n\t\t\tthis._pageInputValue = '';\r\n\t\t} else {\r\n\t\t\tthis._pageMode = 'custom';\r\n\t\t\tthis._pageInputValue = this.#pagesToRangeString(result.selectedPages);\r\n\t\t}\r\n\t\tawait this.#savePageSelection();\r\n\t}\r\n\r\n\t/** Re-extract using the previously stored media key (after page selection change). */\r\n\tasync #onReExtract() {\r\n\t\tconst mediaKey = this._extraction?.source.mediaKey;\r\n\t\tif (!mediaKey) {\r\n\t\t\t// No prior extraction — fall back to media picker\r\n\t\t\treturn this.#onPickMedia();\r\n\t\t}\r\n\t\tawait this.#runExtraction(mediaKey);\r\n\t}\r\n\r\n\tasync #runExtraction(mediaKey: string) {\r\n\t\tif (!this._workflowName) return;\r\n\r\n\t\tthis._extracting = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t\t// Trigger sample extraction and transform (which includes zone detection) in parallel\r\n\t\t\tconst [extraction, transformResult] = await Promise.all([\r\n\t\t\t\ttriggerSampleExtraction(this._workflowName, mediaKey, token),\r\n\t\t\t\ttriggerTransform(this._workflowName, mediaKey, token),\r\n\t\t\t]);\r\n\r\n\t\t\tif (extraction) {\r\n\t\t\t\tthis._extraction = extraction;\r\n\t\t\t}\r\n\t\t\tif (transformResult) {\r\n\t\t\t\tthis._transformResult = transformResult;\r\n\t\t\t\t// Transform endpoint also saved zone detection — fetch it\r\n\t\t\t\tconst zoneDetection = await fetchZoneDetection(this._workflowName, token);\r\n\t\t\t\tthis._zoneDetection = zoneDetection;\r\n\t\t\t\tconst d = transformResult.diagnostics;\r\n\t\t\t\tthis._successMessage = `Content extracted — ${d.totalSections} sections (${d.bulletListSections} bullet, ${d.paragraphSections} paragraph, ${d.subHeadedSections} sub-headed)`;\r\n\t\t\t\tsetTimeout(() => { this._successMessage = null; }, 5000);\r\n\t\t\t} else if (extraction) {\r\n\t\t\t\tthis._successMessage = `Content extracted — ${extraction.elements.length} elements (transform unavailable)`;\r\n\t\t\t\tsetTimeout(() => { this._successMessage = null; }, 5000);\r\n\t\t\t} else {\r\n\t\t\t\tthis._error = 'Extraction failed. Check that the selected media item is a PDF.';\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Extraction failed';\r\n\t\t\tconsole.error('Extraction failed:', err);\r\n\t\t} finally {\r\n\t\t\tthis._extracting = false;\r\n\t\t}\r\n\t}\r\n\r\n\t#isCollapsed(key: string): boolean {\r\n\t\treturn this._collapsed.has(key);\r\n\t}\r\n\r\n\t#toggleCollapse(key: string) {\r\n\t\tconst next = new Set(this._collapsed);\r\n\t\tif (next.has(key)) {\r\n\t\t\tnext.delete(key);\r\n\t\t} else {\r\n\t\t\tnext.add(key);\r\n\t\t}\r\n\t\tthis._collapsed = next;\r\n\t}\r\n\r\n\t#isSectionIncluded(sectionId: string): boolean {\r\n\t\tif (!this._transformResult) return true;\r\n\t\tconst section = this._transformResult.sections.find((s) => s.id === sectionId);\r\n\t\treturn section?.included ?? true;\r\n\t}\r\n\r\n\tasync #onToggleInclusion(sectionId: string, included: boolean) {\r\n\t\tif (!this._workflowName) return;\r\n\t\tconst result = await updateSectionInclusion(this._workflowName, sectionId, included, this.#token);\r\n\t\tif (result) {\r\n\t\t\tthis._transformResult = result;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #onMapSection(sourceKey: string) {\r\n\t\tif (!this._config?.destination || !this._workflowName) return;\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_DESTINATION_PICKER_MODAL, {\r\n\t\t\tdata: { destination: this._config.destination },\r\n\t\t});\r\n\t\tconst result = await modal.onSubmit().catch(() => null);\r\n\t\tif (!result?.selectedTargets?.length) return;\r\n\r\n\t\tconst mappings = [...(this._config.map?.mappings ?? [])];\r\n\t\tconst existingIdx = mappings.findIndex((m) => m.source === sourceKey);\r\n\t\tconst newMapping = {\r\n\t\t\tsource: sourceKey,\r\n\t\t\tdestinations: result.selectedTargets.map((t: { target: string; blockKey?: string }) => ({ target: t.target, blockKey: t.blockKey })),\r\n\t\t\tenabled: true,\r\n\t\t};\r\n\t\tif (existingIdx >= 0) mappings[existingIdx] = newMapping;\r\n\t\telse mappings.push(newMapping);\r\n\r\n\t\tconst updatedMap = { ...this._config.map, version: this._config.map?.version ?? '1.0', mappings };\r\n\t\tconst saved = await saveMapConfig(this._workflowName, updatedMap, this.#token);\r\n\t\tif (saved) this._config = { ...this._config, map: updatedMap };\r\n\t}\r\n\r\n\t#getMappedTargets(elementId: string): MappingDestination[] {\r\n\t\tif (!this._config?.map?.mappings) return [];\r\n\t\tconst targets: MappingDestination[] = [];\r\n\t\tfor (const mapping of this._config.map.mappings) {\r\n\t\t\tif (mapping.source === elementId && mapping.enabled) {\r\n\t\t\t\tfor (const dest of mapping.destinations) {\r\n\t\t\t\t\ttargets.push(dest);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn targets;\r\n\t}\r\n\r\n\t#resolveTargetLabel(dest: MappingDestination): string {\r\n\t\tif (!this._config?.destination) return dest.target;\r\n\r\n\t\tif (dest.blockKey && this._config.destination.blockGrids) {\r\n\t\t\tfor (const grid of this._config.destination.blockGrids) {\r\n\t\t\t\tconst block = grid.blocks.find((b) => b.key === dest.blockKey);\r\n\t\t\t\tif (block) {\r\n\t\t\t\t\tconst prop = block.properties?.find((p) => p.alias === dest.target);\r\n\t\t\t\t\treturn `${block.label} > ${prop?.label || dest.target}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst field = this._config.destination.fields.find((f) => f.alias === dest.target);\r\n\t\tif (field) return field.label;\r\n\r\n\t\tif (this._config.destination.blockGrids) {\r\n\t\t\tfor (const grid of this._config.destination.blockGrids) {\r\n\t\t\t\tfor (const block of grid.blocks) {\r\n\t\t\t\t\tconst prop = block.properties?.find((p) => p.alias === dest.target);\r\n\t\t\t\t\tif (prop) return `${block.label} > ${prop.label || prop.alias}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn dest.target;\r\n\t}\r\n\r\n\t// --- Zone-based rendering ---\r\n\r\n\t#classifyText(text: string): 'list' | 'paragraph' {\r\n\t\tconst trimmed = text.trimStart();\r\n\t\tif (/^[•\\-\\*▪▸▶►●○◦‣⁃]/.test(trimmed)) return 'list';\r\n\t\tif (/^\\d+[\\.\\)]\\s/.test(trimmed)) return 'list';\r\n\t\treturn 'paragraph';\r\n\t}\r\n\r\n\t#renderZoneElement(element: ZoneElement) {\r\n\t\tconst textType = this.#classifyText(element.text);\r\n\t\treturn html`\r\n\t\t\t<div class=\"element-item\">\r\n\t\t\t\t<div class=\"element-content\">\r\n\t\t\t\t\t<div class=\"element-text\">${element.text}</div>\r\n\t\t\t\t\t<div class=\"element-meta\">\r\n\t\t\t\t\t\t<span class=\"meta-badge text-type ${textType}\">${textType === 'list' ? 'List' : 'Paragraph'}</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge font-size\">${element.fontSize}pt</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge font-name\">${element.fontName}</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge color\" style=\"border-left: 3px solid ${element.color};\">${element.color}</span>\r\n\t\t\t\t\t\t${element.text === element.text.toUpperCase() && element.text !== element.text.toLowerCase() ? html`<span class=\"meta-badge text-case\">UPPERCASE</span>` : nothing}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderSection(section: DetectedSection, sectionKey: string, pageNum: number, zoneIndex: number) {\r\n\t\tconst isCollapsed = this.#isCollapsed(sectionKey);\r\n\r\n\t\t// Compute the section ID matching transform.json\r\n\t\tconst sectionId = section.heading\r\n\t\t\t? normalizeToKebabCase(section.heading.text)\r\n\t\t\t: (zoneIndex >= 0 ? `preamble-p${pageNum}-z${zoneIndex}` : `preamble-p${pageNum}-unzoned`);\r\n\t\tconst isIncluded = this.#isSectionIncluded(sectionId);\r\n\r\n\t\tif (!section.heading) {\r\n\t\t\t// No-heading section — render with toggle\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"zone-section ${!isIncluded ? 'excluded' : ''}\">\r\n\t\t\t\t\t<div class=\"section-heading preamble\" @click=${() => this.#toggleCollapse(sectionKey)}>\r\n\t\t\t\t\t\t<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"heading-text preamble-label\">Content</span>\r\n\t\t\t\t\t\t<span class=\"header-spacer\"></span>\r\n\t\t\t\t\t\t<span class=\"group-count\">${section.children.length} text${section.children.length !== 1 ? 's' : ''}</span>\r\n\t\t\t\t\t\t<uui-toggle\r\n\t\t\t\t\t\t\tlabel=\"${isIncluded ? 'Included' : 'Excluded'}\"\r\n\t\t\t\t\t\t\t?checked=${isIncluded}\r\n\t\t\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t\t\t@change=${(e: Event) => this.#onToggleInclusion(sectionId, (e.target as any).checked)}>\r\n\t\t\t\t\t\t</uui-toggle>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t${isIncluded && !isCollapsed ? html`\r\n\t\t\t\t\t\t${section.children.map((el) => this.#renderZoneElement(el))}\r\n\t\t\t\t\t` : nothing}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tconst heading = section.heading;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"zone-section ${!isIncluded ? 'excluded' : ''}\">\r\n\t\t\t\t<div class=\"section-heading\" @click=${() => this.#toggleCollapse(sectionKey)}>\r\n\t\t\t\t\t<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t<div class=\"heading-content\">\r\n\t\t\t\t\t\t<div class=\"heading-text\">${heading.text}</div>\r\n\t\t\t\t\t\t<div class=\"element-meta\">\r\n\t\t\t\t\t\t\t<span class=\"meta-badge font-size\">${heading.fontSize}pt</span>\r\n\t\t\t\t\t\t\t<span class=\"meta-badge font-name\">${heading.fontName}</span>\r\n\t\t\t\t\t\t\t<span class=\"meta-badge color\" style=\"border-left: 3px solid ${heading.color};\">${heading.color}</span>\r\n\t\t\t\t\t\t\t${heading.text === heading.text.toUpperCase() && heading.text !== heading.text.toLowerCase() ? html`<span class=\"meta-badge text-case\">UPPERCASE</span>` : nothing}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<span class=\"group-count\">${section.children.length} text${section.children.length !== 1 ? 's' : ''}</span>\r\n\t\t\t\t\t<uui-toggle\r\n\t\t\t\t\t\tlabel=\"${isIncluded ? 'Included' : 'Excluded'}\"\r\n\t\t\t\t\t\t?checked=${isIncluded}\r\n\t\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t\t@change=${(e: Event) => this.#onToggleInclusion(sectionId, (e.target as any).checked)}>\r\n\t\t\t\t\t</uui-toggle>\r\n\t\t\t\t</div>\r\n\t\t\t\t${!isCollapsed && isIncluded ? html`\r\n\t\t\t\t\t<div class=\"section-children\">\r\n\t\t\t\t\t\t${section.children.map((el) => this.#renderZoneElement(el))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` : nothing}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#toggleAreaExclusion(areaKey: string) {\r\n\t\tconst next = new Set(this._excludedAreas);\r\n\t\tif (next.has(areaKey)) {\r\n\t\t\tnext.delete(areaKey);\r\n\t\t} else {\r\n\t\t\tnext.add(areaKey);\r\n\t\t}\r\n\t\tthis._excludedAreas = next;\r\n\t}\r\n\r\n\t#renderArea(zone: DetectedZone, pageNum: number, areaIndex: number) {\r\n\t\tconst areaKey = `area-p${pageNum}-a${areaIndex}`;\r\n\t\tconst isCollapsed = this.#isCollapsed(areaKey);\r\n\t\tconst isIncluded = !this._excludedAreas.has(areaKey);\r\n\t\tconst sectionCount = zone.sections.length;\r\n\t\treturn html`\r\n\t\t\t<div class=\"zone-area ${!isIncluded ? 'area-excluded' : ''}\" style=\"border-left-color: ${zone.color};\">\r\n\t\t\t\t<div class=\"area-header\" @click=${() => this.#toggleCollapse(areaKey)}>\r\n\t\t\t\t\t<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t<span class=\"area-name\">${zone.name || `Area ${areaIndex + 1}`}</span>\r\n\t\t\t\t\t<span class=\"header-spacer\"></span>\r\n\t\t\t\t\t<span class=\"group-count\">${sectionCount} section${sectionCount !== 1 ? 's' : ''}</span>\r\n\t\t\t\t\t<uui-toggle\r\n\t\t\t\t\t\tlabel=\"${isIncluded ? 'Included' : 'Excluded'}\"\r\n\t\t\t\t\t\t?checked=${isIncluded}\r\n\t\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t\t@change=${() => this.#toggleAreaExclusion(areaKey)}>\r\n\t\t\t\t\t</uui-toggle>\r\n\t\t\t\t</div>\r\n\t\t\t\t${!isCollapsed ? html`\r\n\t\t\t\t\t${zone.sections.map((section, sIdx) =>\r\n\t\t\t\t\t\tthis.#renderSection(section, `p${pageNum}-a${areaIndex}-s${sIdx}`, pageNum, areaIndex)\r\n\t\t\t\t\t)}\r\n\t\t\t\t` : nothing}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderUnzonedContent(zone: DetectedZone, pageNum: number) {\r\n\t\tif (zone.totalElements === 0) return nothing;\r\n\t\tconst areaKey = `area-p${pageNum}-undefined`;\r\n\t\tconst isCollapsed = this.#isCollapsed(areaKey);\r\n\t\tconst isIncluded = !this._excludedAreas.has(areaKey);\r\n\t\tconst sectionCount = zone.sections.length;\r\n\t\treturn html`\r\n\t\t\t<div class=\"zone-area undefined ${!isIncluded ? 'area-excluded' : ''}\" style=\"border-left-color: var(--uui-color-border-standalone);\">\r\n\t\t\t\t<div class=\"area-header\" @click=${() => this.#toggleCollapse(areaKey)}>\r\n\t\t\t\t\t<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t<span class=\"area-name undefined-name\">Undefined</span>\r\n\t\t\t\t\t<span class=\"header-spacer\"></span>\r\n\t\t\t\t\t<span class=\"group-count\">${sectionCount} section${sectionCount !== 1 ? 's' : ''}</span>\r\n\t\t\t\t\t<uui-toggle\r\n\t\t\t\t\t\tlabel=\"${isIncluded ? 'Included' : 'Excluded'}\"\r\n\t\t\t\t\t\t?checked=${isIncluded}\r\n\t\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t\t@change=${() => this.#toggleAreaExclusion(areaKey)}>\r\n\t\t\t\t\t</uui-toggle>\r\n\t\t\t\t</div>\r\n\t\t\t\t${!isCollapsed ? html`\r\n\t\t\t\t\t${zone.sections.map((section, sIdx) =>\r\n\t\t\t\t\t\tthis.#renderSection(section, `p${pageNum}-undefined-s${sIdx}`, pageNum, -1)\r\n\t\t\t\t\t)}\r\n\t\t\t\t` : nothing}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderZonePage(pageNum: number, zones: DetectedZone[], unzonedContent: DetectedZone | null) {\r\n\t\tconst pageKey = `page-${pageNum}`;\r\n\t\tconst isCollapsed = this.#isCollapsed(pageKey);\r\n\t\tconst hasUnzoned = unzonedContent && unzonedContent.totalElements > 0;\r\n\t\tconst areaCount = zones.length + (hasUnzoned ? 1 : 0);\r\n\t\tconst sectionCount = zones.reduce((sum, z) => sum + z.sections.length, 0) + (unzonedContent?.sections.length ?? 0);\r\n\t\tconst isIncluded = this.#isPageIncluded(pageNum);\r\n\t\treturn html`\r\n\t\t\t<uui-box class=\"page-box ${!isIncluded ? 'page-excluded' : ''}\">\r\n\t\t\t\t<div slot=\"header\" class=\"tree-header\" @click=${() => this.#toggleCollapse(pageKey)}>\r\n\t\t\t\t\t<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t<strong class=\"page-title\">Page ${pageNum}</strong>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div slot=\"header-actions\" class=\"page-header-actions\">\r\n\t\t\t\t\t<span class=\"group-count\">${sectionCount} section${sectionCount !== 1 ? 's' : ''}, ${areaCount} area${areaCount !== 1 ? 's' : ''}</span>\r\n\t\t\t\t\t<uui-toggle\r\n\t\t\t\t\t\tlabel=\"${isIncluded ? 'Included in extraction' : 'Excluded from extraction'}\"\r\n\t\t\t\t\t\t?checked=${isIncluded}\r\n\t\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t\t@change=${() => this.#togglePage(pageNum)}>\r\n\t\t\t\t\t</uui-toggle>\r\n\t\t\t\t</div>\r\n\t\t\t\t${!isCollapsed ? html`\r\n\t\t\t\t\t${zones.map((zone, idx) => this.#renderArea(zone, pageNum, idx))}\r\n\t\t\t\t\t${hasUnzoned ? this.#renderUnzonedContent(unzonedContent!, pageNum) : nothing}\r\n\t\t\t\t` : nothing}\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderZoneDetection() {\r\n\t\tif (!this._zoneDetection) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t${this._zoneDetection.pages.map((page) =>\r\n\t\t\t\tthis.#renderZonePage(page.page, page.zones, page.unzonedContent)\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\t#computeSectionCount(): number {\r\n\t\tif (!this._zoneDetection) return 0;\r\n\t\treturn this._zoneDetection.pages.reduce((sum, page) =>\r\n\t\t\tsum + page.zones.reduce((zSum, zone) => zSum + zone.sections.length, 0)\r\n\t\t\t+ (page.unzonedContent?.sections.length ?? 0), 0);\r\n\t}\r\n\r\n\t#renderPageSelection() {\r\n\t\tconst totalPages = this._zoneDetection?.totalPages ?? this._extraction?.source.totalPages ?? 0;\r\n\t\tif (totalPages === 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<label class=\"page-radio\">\r\n\t\t\t\t<input type=\"radio\" name=\"page-mode\" value=\"all\"\r\n\t\t\t\t\t.checked=${this._pageMode === 'all'}\r\n\t\t\t\t\t@change=${() => this.#onPageModeChange('all')} />\r\n\t\t\t\tAll\r\n\t\t\t</label>\r\n\t\t\t<label class=\"page-radio\">\r\n\t\t\t\t<input type=\"radio\" name=\"page-mode\" value=\"custom\"\r\n\t\t\t\t\t.checked=${this._pageMode === 'custom'}\r\n\t\t\t\t\t@change=${() => this.#onPageModeChange('custom')} />\r\n\t\t\t\tChoose\r\n\t\t\t</label>\r\n\t\t\t<input type=\"text\" class=\"page-input\"\r\n\t\t\t\tplaceholder=\"e.g. 1-2, 5\"\r\n\t\t\t\t.value=${this._pageInputValue}\r\n\t\t\t\t@input=${this.#onPageInputChange}\r\n\t\t\t\t@blur=${this.#onPageInputBlur}\r\n\t\t\t\t@focus=${() => { if (this._pageMode === 'all') this.#onPageModeChange('custom'); }}\r\n\t\t\t\t?disabled=${this._pageMode === 'all'} />\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderExtractionHeader() {\r\n\t\treturn html`\r\n\t\t\t<div slot=\"header\" class=\"source-header\">\r\n\t\t\t\t<uui-tab-group dropdown-content-direction=\"vertical\">\r\n\t\t\t\t\t<uui-tab label=\"Extracted\" ?active=${this._viewMode === 'elements'} @click=${() => { this._viewMode = 'elements'; }}>Extracted</uui-tab>\r\n\t\t\t\t\t<uui-tab label=\"Transformed\" ?active=${this._viewMode === 'transformed'} @click=${() => { this._viewMode = 'transformed'; }} ?disabled=${!this._transformResult}>Transformed</uui-tab>\r\n\t\t\t\t</uui-tab-group>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderInfoBoxes() {\r\n\t\tconst hasZones = this._zoneDetection !== null;\r\n\t\tconst hasExtraction = this._extraction !== null;\r\n\r\n\t\tif (!hasZones && !hasExtraction) return nothing;\r\n\r\n\t\tconst totalPages = this._zoneDetection?.totalPages ?? (hasExtraction ? this._extraction!.source.totalPages : 0);\r\n\t\tconst extractedPageCount = hasZones ? this._zoneDetection!.pages.length : totalPages;\r\n\t\tconst isFiltered = extractedPageCount < totalPages;\r\n\t\tconst pagesLabel = isFiltered ? `${extractedPageCount} of ${totalPages}` : `${totalPages}`;\r\n\t\tconst areas = hasZones ? this._zoneDetection!.diagnostics.zonesDetected : 0;\r\n\t\tconst sections = hasZones ? this.#computeSectionCount() : 0;\r\n\t\tconst fileName = hasExtraction ? this._extraction!.source.fileName : '';\r\n\t\tconst extractedDate = hasExtraction\r\n\t\t\t? new Date(this._extraction!.source.extractedDate).toLocaleString()\r\n\t\t\t: '';\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"info-boxes\">\r\n\t\t\t\t<uui-box headline=\"Source\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<h2 class=\"box-title\">${fileName}</h2>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-document\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-subtitle\">${extractedDate}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Change PDF\" @click=${this.#onPickMedia} ?disabled=${this._extracting}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-page-add\"></uui-icon>\r\n\t\t\t\t\t\t\t\tChange PDF\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Pages\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<span class=\"box-stat\">${pagesLabel}</span>\r\n\t\t\t\t\t\t<div class=\"page-selection\">\r\n\t\t\t\t\t\t\t${this.#renderPageSelection()}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Pages\" @click=${this.#onOpenPagePicker}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-thumbnails-small\"></uui-icon>\r\n\t\t\t\t\t\t\t\tChoose Pages\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Areas\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<span class=\"box-stat\">${this._zoneTemplate ? this._zoneTemplate.zones.length : areas}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t${this._zoneTemplate\r\n\t\t\t\t\t\t\t\t? html`<uui-button look=\"primary\" color=\"positive\" label=\"Edit Areas\" @click=${this.#onEditAreas}>\r\n\t\t\t\t\t\t\t\t\t<uui-icon name=\"icon-edit\"></uui-icon>\r\n\t\t\t\t\t\t\t\t\tEdit Areas\r\n\t\t\t\t\t\t\t\t</uui-button>`\r\n\t\t\t\t\t\t\t\t: html`<uui-button look=\"primary\" color=\"positive\" label=\"Define Areas\" @click=${this.#onEditAreas}>\r\n\t\t\t\t\t\t\t\t\t<uui-icon name=\"icon-grid\"></uui-icon>\r\n\t\t\t\t\t\t\t\t\tDefine Areas\r\n\t\t\t\t\t\t\t\t</uui-button>`}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Sections\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<span class=\"box-stat\">${sections}</span>\r\n\t\t\t\t\t\t${this._transformResult && this._zoneDetection ? html`\r\n\t\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t\t\t\tlabel=\"Edit Sections\"\r\n\t\t\t\t\t\t\t\t\tpopovertarget=\"section-picker-popover\">\r\n\t\t\t\t\t\t\t\t\t<uui-icon name=\"icon-settings\"></uui-icon>\r\n\t\t\t\t\t\t\t\t\tEdit Sections\r\n\t\t\t\t\t\t\t\t\t<uui-symbol-expand .open=${this._sectionPickerOpen}></uui-symbol-expand>\r\n\t\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t\t\t<uui-popover-container\r\n\t\t\t\t\t\t\t\t\tid=\"section-picker-popover\"\r\n\t\t\t\t\t\t\t\t\tplacement=\"bottom-end\"\r\n\t\t\t\t\t\t\t\t\t@toggle=${this.#onSectionPickerToggle}>\r\n\t\t\t\t\t\t\t\t\t<umb-popover-layout>\r\n\t\t\t\t\t\t\t\t\t\t${this.#getTransformSectionsWithElements().map((s) => {\r\n\t\t\t\t\t\t\t\t\t\t\tconst hasRules = !!(this._sourceConfig?.sectionRules?.[s.id]?.rules?.length);\r\n\t\t\t\t\t\t\t\t\t\t\treturn html`\r\n\t\t\t\t\t\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabel=\"${s.heading}\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t@click=${() => this.#onEditSectionRules(s.id, s.heading, s.elements)}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"${hasRules ? 'icon-check' : 'icon-thumbnail-list'}\"></uui-icon>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span slot=\"badge\" class=\"section-picker-meta\">${s.elements.length} el</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t\t\t\t\t`;\r\n\t\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t</umb-popover-layout>\r\n\t\t\t\t\t\t\t\t</uui-popover-container>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\t\t\t</div>\r\n\r\n\t\t\t${hasZones ? html`\r\n\t\t\t\t<div class=\"collapse-row\">\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tlabel=\"Collapse\"\r\n\t\t\t\t\t\tpopovertarget=\"collapse-level-popover\">\r\n\t\t\t\t\t\tCollapse\r\n\t\t\t\t\t\t<uui-symbol-expand .open=${this._collapsePopoverOpen}></uui-symbol-expand>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t<uui-popover-container\r\n\t\t\t\t\t\tid=\"collapse-level-popover\"\r\n\t\t\t\t\t\tplacement=\"bottom-start\"\r\n\t\t\t\t\t\t@toggle=${this.#onCollapsePopoverToggle}>\r\n\t\t\t\t\t\t<umb-popover-layout>\r\n\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\tlabel=\"Expand All\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#expandAll()}>\r\n\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-navigation-down\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\tlabel=\"${this.#isLevelCollapsed('pages') ? 'Expand' : 'Collapse'} Pages\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#toggleLevel('pages')}>\r\n\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-document\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\tlabel=\"${this.#isLevelCollapsed('areas') ? 'Expand' : 'Collapse'} Areas\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#toggleLevel('areas')}>\r\n\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-grid\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\tlabel=\"${this.#isLevelCollapsed('sections') ? 'Expand' : 'Collapse'} Sections\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#toggleLevel('sections')}>\r\n\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-thumbnail-list\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t</umb-popover-layout>\r\n\t\t\t\t\t</uui-popover-container>\r\n\t\t\t\t</div>\r\n\t\t\t` : nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderExtractionContent() {\r\n\t\tconst hasZones = this._zoneDetection !== null;\r\n\t\treturn this._viewMode === 'elements'\r\n\t\t\t? (hasZones ? this.#renderZoneDetection() : nothing)\r\n\t\t\t: this.#renderTransformed();\r\n\t}\r\n\r\n\t#renderMappingBadges(sourceKey: string) {\r\n\t\tconst targets = this.#getMappedTargets(sourceKey);\r\n\t\tif (targets.length === 0) {\r\n\t\t\treturn html`<uui-button look=\"secondary\" compact label=\"Map\" @click=${() => this.#onMapSection(sourceKey)}>\r\n\t\t\t\t<uui-icon name=\"icon-link\"></uui-icon> Map\r\n\t\t\t</uui-button>`;\r\n\t\t}\r\n\t\treturn html`${targets.map(\r\n\t\t\t(dest) => html`<span class=\"meta-badge mapped-target\" @click=${() => this.#onMapSection(sourceKey)} style=\"cursor:pointer;\" title=\"Click to re-map\">\r\n\t\t\t\t<uui-icon name=\"icon-check\" style=\"font-size:10px;\"></uui-icon> ${this.#resolveTargetLabel(dest)}\r\n\t\t\t</span>`,\r\n\t\t)}`;\r\n\t}\r\n\r\n\t#renderTransformedSection(section: TransformedSection) {\r\n\t\tconst patternLabels: Record<string, string> = {\r\n\t\t\tbulletList: 'Bullet List',\r\n\t\t\tparagraph: 'Paragraph',\r\n\t\t\tsubHeaded: 'Sub-Headed',\r\n\t\t\tpreamble: 'Preamble',\r\n\t\t\tmixed: 'Mixed',\r\n\t\t};\r\n\r\n\t\tconst headingKey = `${section.id}.heading`;\r\n\t\tconst contentKey = `${section.id}.content`;\r\n\t\tconst hasHeadingMapping = this.#getMappedTargets(headingKey).length > 0;\r\n\t\tconst hasContentMapping = this.#getMappedTargets(contentKey).length > 0;\r\n\t\tconst isMapped = hasHeadingMapping || hasContentMapping;\r\n\r\n\t\tconst headline = section.heading ?? 'Content';\r\n\t\treturn html`\r\n\t\t\t<uui-box headline=${headline} class=\"transformed-section ${isMapped ? 'section-mapped' : ''}\">\r\n\t\t\t\t<div slot=\"header-actions\" class=\"transformed-header-badges\">\r\n\t\t\t\t\t<span class=\"pattern-badge ${section.pattern}\">${patternLabels[section.pattern] ?? section.pattern}</span>\r\n\t\t\t\t\t<span class=\"meta-badge\">p${section.page}</span>\r\n\t\t\t\t\t${section.zoneColor ? html`<span class=\"area-color-swatch\" style=\"background: ${section.zoneColor};\"></span>` : nothing}\r\n\t\t\t\t\t<span class=\"meta-badge\">${section.childCount} item${section.childCount !== 1 ? 's' : ''}</span>\r\n\t\t\t\t\t${section.heading ? this.#renderMappingBadges(headingKey) : nothing}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"transformed-content\" .innerHTML=${markdownToHtml(section.content)}></div>\r\n\t\t\t\t<div class=\"section-mapping-actions\">\r\n\t\t\t\t\t<span class=\"mapping-label\">Content:</span>\r\n\t\t\t\t\t${this.#renderMappingBadges(contentKey)}\r\n\t\t\t\t</div>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderTransformed() {\r\n\t\tif (!this._transformResult) {\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t\t<uui-icon name=\"icon-lab\" style=\"font-size: 48px; color: var(--uui-color-text-alt);\"></uui-icon>\r\n\t\t\t\t\t<h3>No transform result</h3>\r\n\t\t\t\t\t<p>Save to extract content and generate the transformed view.</p>\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tconst includedSections = this._transformResult.sections.filter((s) => s.included);\r\n\t\tconst totalSections = this._transformResult.sections.length;\r\n\r\n\t\treturn html`\r\n\t\t\t${includedSections.map((section) => this.#renderTransformedSection(section))}\r\n\t\t\t<div class=\"diagnostics\">\r\n\t\t\t\t<span class=\"meta-badge\">${includedSections.length}/${totalSections} sections included</span>\r\n\t\t\t\t<span class=\"meta-badge\">${this._transformResult.diagnostics.bulletListSections} bullet</span>\r\n\t\t\t\t<span class=\"meta-badge\">${this._transformResult.diagnostics.paragraphSections} paragraph</span>\r\n\t\t\t\t<span class=\"meta-badge\">${this._transformResult.diagnostics.subHeadedSections} sub-headed</span>\r\n\t\t\t\t${this._transformResult.diagnostics.preambleSections > 0\r\n\t\t\t\t\t? html`<span class=\"meta-badge\">${this._transformResult.diagnostics.preambleSections} preamble</span>`\r\n\t\t\t\t\t: nothing}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderEmpty() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t<uui-icon name=\"icon-document\" style=\"font-size: 48px; color: var(--uui-color-text-alt);\"></uui-icon>\r\n\t\t\t\t<h3>No sample extraction</h3>\r\n\t\t\t\t<p>Choose a PDF from the media library to extract text elements with their metadata.</p>\r\n\t\t\t\t<uui-button look=\"primary\" label=\"Choose PDF\" @click=${this.#onPickMedia} ?disabled=${this._extracting}>\r\n\t\t\t\t\t${this._extracting ? html`<uui-loader-bar></uui-loader-bar>` : 'Choose PDF...'}\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<div class=\"loading\"><uui-loader-bar></uui-loader-bar></div>`;\r\n\t\t}\r\n\r\n\t\tif (this._error) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t\t<p style=\"color: var(--uui-color-danger); padding: var(--uui-size-layout-1);\">${this._error}</p>\r\n\t\t\t\t</umb-body-layout>`;\r\n\t\t}\r\n\r\n\t\tconst hasContent = this._zoneDetection !== null || this._extraction !== null;\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t${hasContent ? this.#renderExtractionHeader() : nothing}\r\n\t\t\t\t${hasContent && this._viewMode === 'elements' ? this.#renderInfoBoxes() : nothing}\r\n\t\t\t\t${this._successMessage ? html`<div class=\"success-banner\"><uui-icon name=\"icon-check\"></uui-icon> ${this._successMessage}</div>` : nothing}\r\n\t\t\t\t${hasContent ? this.#renderExtractionContent() : this.#renderEmpty()}\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\t--uui-tab-background: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\t.loading {\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.success-banner {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\r\n\t\t\t/* Empty state */\r\n\t\t\t.empty-state {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tpadding: var(--uui-size-layout-2);\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tmin-height: 300px;\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state h3 {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state p {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Header: tabs only */\r\n\t\t\t.source-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.source-header uui-tab-group {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t/* Info boxes row (uSync-inspired) */\r\n\t\t\t.info-boxes {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.info-box-item {\r\n\t\t\t\tflex-grow: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.box-content {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.box-icon {\r\n\t\t\t\tfont-size: 32px;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.box-title {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t\tmax-width: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.box-subtitle {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.box-buttons {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tmargin-top: auto;\r\n\t\t\t\tpadding-top: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.box-stat {\r\n\t\t\t\tfont-size: var(--uui-type-h3-size);\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\r\n\t\t\t/* Collapse row below boxes */\r\n\t\t\t.collapse-row {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\tpadding: 0 var(--uui-size-space-4) var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t/* Page selection (stacked inside box) */\r\n\t\t\t.page-selection {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-1);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tmargin-top: var(--uui-size-space-1);\r\n\t\t\t}\r\n\r\n\t\t\t.page-radio {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-1);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.page-radio input[type=\"radio\"] {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.page-input {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tpadding: 2px 8px;\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-family: inherit;\r\n\t\t\t\tbackground: var(--uui-color-surface);\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.page-input:focus {\r\n\t\t\t\toutline: none;\r\n\t\t\t\tborder-color: var(--uui-color-focus);\r\n\t\t\t}\r\n\r\n\t\t\t.page-input:disabled {\r\n\t\t\t\topacity: 0.4;\r\n\t\t\t\tcursor: not-allowed;\r\n\t\t\t}\r\n\r\n\t\t\t/* Page box include toggle */\r\n\t\t\t.page-header-actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.page-box.page-excluded {\r\n\t\t\t\topacity: 0.4;\r\n\t\t\t}\r\n\r\n\t\t\t.header-spacer {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t/* Page groups */\r\n\t\t\t.page-box {\r\n\t\t\t\tmargin: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t/* Tree-style header for page boxes */\r\n\t\t\t.tree-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.tree-header:hover .collapse-chevron {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.page-title {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t}\r\n\r\n\t\t\t/* Consistent collapse chevron across all levels */\r\n\t\t\t.collapse-chevron {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t\tfont-size: 12px;\r\n\t\t\t}\r\n\r\n\t\t\t/* Zone areas (Level 2) */\r\n\t\t\t.zone-area {\r\n\t\t\t\tborder-left: 4px solid var(--uui-color-border);\r\n\t\t\t\tmargin: var(--uui-size-space-4) 0;\r\n\t\t\t\tmargin-left: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.zone-area.undefined {\r\n\t\t\t\topacity: 0.75;\r\n\t\t\t}\r\n\r\n\t\t\t.zone-area.area-excluded {\r\n\t\t\t\topacity: 0.4;\r\n\t\t\t}\r\n\r\n\t\t\t.area-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-3);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.area-header:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.area-header:hover .collapse-chevron {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.area-color-swatch {\r\n\t\t\t\tdisplay: inline-block;\r\n\t\t\t\twidth: 12px;\r\n\t\t\t\theight: 12px;\r\n\t\t\t\tborder-radius: 2px;\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.area-color-swatch.undefined-swatch {\r\n\t\t\t\tbackground: var(--uui-color-border-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t.area-name {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.undefined-name {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t}\r\n\r\n\t\t\t/* Sections within areas (Level 3) */\r\n\t\t\t.zone-section {\r\n\t\t\t\tmargin-left: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.zone-section + .zone-section {\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading:hover .collapse-chevron {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.heading-content {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.heading-text {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-1);\r\n\t\t\t}\r\n\r\n\t\t\t.group-count {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t.section-children {\r\n\t\t\t\tpadding-left: var(--uui-size-space-5);\r\n\t\t\t\tborder-left: 2px solid var(--uui-color-border);\r\n\t\t\t\tmargin-left: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t/* Excluded sections */\r\n\t\t\t.zone-section.excluded {\r\n\t\t\t\topacity: 0.4;\r\n\t\t\t}\r\n\r\n\t\t\t.preamble-label {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t}\r\n\r\n\t\t\t/* Element items */\r\n\t\t\t.element-item {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: flex-start;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.element-item:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t.element-content {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.element-text {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-2);\r\n\t\t\t\tword-break: break-word;\r\n\t\t\t\twhite-space: pre-wrap;\r\n\t\t\t}\r\n\r\n\t\t\t.element-meta {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tpadding: 1px 6px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.text-type {\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t\ttext-transform: uppercase;\r\n\t\t\t\tfont-size: 10px;\r\n\t\t\t\tletter-spacing: 0.5px;\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.text-type.list {\r\n\t\t\t\tcolor: var(--uui-color-positive);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.font-size {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.text-case {\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t\ttext-transform: uppercase;\r\n\t\t\t\tfont-size: 10px;\r\n\t\t\t\tletter-spacing: 0.5px;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.mapped-target {\r\n\t\t\t\tbackground: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t\tdisplay: inline-flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: 3px;\r\n\t\t\t}\r\n\r\n\t\t\t.diagnostics {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t}\r\n\r\n\t\t\t/* Transformed sections */\r\n\t\t\t.transformed-section {\r\n\t\t\t\tmargin: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-section.section-mapped {\r\n\t\t\t\tborder-left: 3px solid var(--uui-color-positive);\r\n\t\t\t}\r\n\r\n\t\t\t.section-mapping-actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-4);\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.mapping-label {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-header-badges {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tpadding: 1px 8px;\r\n\t\t\t\tborder-radius: 10px;\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge.bulletList {\r\n\t\t\t\tbackground: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge.paragraph {\r\n\t\t\t\tbackground: var(--uui-color-warning-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-warning-contrast);\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge.subHeaded {\r\n\t\t\t\tbackground: var(--uui-color-default-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-default-contrast);\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge.preamble {\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-content {\r\n\t\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tline-height: 1.6;\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-content ul,\r\n\t\t\t.transformed-content ol {\r\n\t\t\t\tpadding-left: var(--uui-size-space-5);\r\n\t\t\t\tmargin: var(--uui-size-space-2) 0;\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-content p {\r\n\t\t\t\tmargin: var(--uui-size-space-2) 0;\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-content h2 {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tmargin: var(--uui-size-space-3) 0 var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t/* Section picker popover */\r\n\t\t\t.section-picker-meta {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocWorkflowSourceViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-workflow-source-view': UpDocWorkflowSourceViewElement;\r\n\t}\r\n}\r\n"],"names":["UMB_DESTINATION_PICKER_MODAL","UmbModalToken","UMB_ZONE_EDITOR_MODAL","UMB_SECTION_RULES_EDITOR_MODAL","_token","_UpDocWorkflowSourceViewElement_instances","loadData_fn","parsePageRange_fn","pagesToRangeString_fn","getSelectedPages_fn","isPageIncluded_fn","togglePage_fn","onPageModeChange_fn","onPageInputChange_fn","onPageInputBlur_fn","savePageSelection_fn","getKeysForLevel_fn","isLevelCollapsed_fn","toggleLevel_fn","expandAll_fn","onCollapsePopoverToggle_fn","onPickMedia_fn","onEditAreas_fn","getTransformSectionsWithElements_fn","findElementsForSection_fn","buildPreambleId_fn","onSectionPickerToggle_fn","onEditSectionRules_fn","onOpenPagePicker_fn","onReExtract_fn","runExtraction_fn","isCollapsed_fn","toggleCollapse_fn","isSectionIncluded_fn","onToggleInclusion_fn","onMapSection_fn","getMappedTargets_fn","resolveTargetLabel_fn","classifyText_fn","renderZoneElement_fn","renderSection_fn","toggleAreaExclusion_fn","renderArea_fn","renderUnzonedContent_fn","renderZonePage_fn","renderZoneDetection_fn","computeSectionCount_fn","renderPageSelection_fn","renderExtractionHeader_fn","renderInfoBoxes_fn","renderExtractionContent_fn","renderMappingBadges_fn","renderTransformedSection_fn","renderTransformed_fn","renderEmpty_fn","UpDocWorkflowSourceViewElement","UmbLitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","context","__privateMethod","unique","html","hasContent","nothing","authContext","UMB_AUTH_CONTEXT","__privateSet","extraction","zoneDetection","config","transformResult","sourceConfig","zoneTemplate","fetchSampleExtraction","__privateGet","fetchZoneDetection","fetchWorkflowByName","fetchTransformResult","fetchSourceConfig","fetchZoneTemplate","err","input","pages","part","trimmed","rangeParts","s","i","a","b","sorted","ranges","start","end","pageNum","totalPages","remaining","_","p","current","updated","mode","savePageSelection","level","keys","page","_z","aIdx","_s","sIdx","k","allCollapsed","next","key","event","result","UMB_MODAL_MANAGER_CONTEXT","UMB_MEDIA_PICKER_MODAL","mediaKey","modal","saved","saveZoneTemplate","section","elements","allZones","zone","detectedSection","normalizeToKebabCase","pageZones","zoneIdx","sectionId","sectionHeading","existingRules","allRules","saveSectionRules","selectedPages","UMB_PAGE_PICKER_MODAL","token","triggerSampleExtraction","triggerTransform","d","included","updateSectionInclusion","sourceKey","mappings","existingIdx","m","newMapping","t","updatedMap","saveMapConfig","elementId","targets","mapping","dest","grid","block","prop","field","f","text","element","textType","sectionKey","zoneIndex","isCollapsed","isIncluded","e","el","heading","areaKey","areaIndex","sectionCount","zones","unzonedContent","pageKey","hasUnzoned","areaCount","sum","z","idx","zSum","hasZones","hasExtraction","extractedPageCount","pagesLabel","areas","sections","fileName","extractedDate","hasRules","patternLabels","headingKey","contentKey","hasHeadingMapping","hasContentMapping","isMapped","headline","markdownToHtml","includedSections","totalSections","UmbTextStyles","css","__decorateClass","state","customElement","UpDocWorkflowSourceViewElement_default"],"mappings":"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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6dD;AAnhDiBC,EAAA;AAAA,EAAhBC,EAAA;AAAM,GADKtJ,EACK,WAAA,eAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAFKtJ,EAEK,WAAA,kBAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAHKtJ,EAGK,WAAA,WAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAJKtJ,EAIK,WAAA,iBAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GALKtJ,EAKK,WAAA,YAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GANKtJ,EAMK,WAAA,eAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAPKtJ,EAOK,WAAA,UAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GARKtJ,EAQK,WAAA,mBAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GATKtJ,EASK,WAAA,cAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAVKtJ,EAUK,WAAA,oBAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAXKtJ,EAWK,WAAA,aAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAZKtJ,EAYK,WAAA,iBAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAbKtJ,EAaK,WAAA,aAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAdKtJ,EAcK,WAAA,mBAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAfKtJ,EAeK,WAAA,wBAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAhBKtJ,EAgBK,WAAA,kBAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAjBKtJ,EAiBK,WAAA,iBAAA,CAAA;AACAqJ,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAlBKtJ,EAkBK,WAAA,sBAAA,CAAA;AAlBLA,IAANqJ,EAAA;AAAA,EADNE,GAAc,6BAA6B;AAAA,GAC/BvJ,CAAA;AAuhDb,MAAAwJ,KAAexJ;"}