{"version":3,"file":"up-doc-workflow-source-view.element-DZBzDU6F.js","sources":["../src/destination-picker-modal.token.ts","../src/up-doc-workflow-source-view.element.ts"],"sourcesContent":["import type { DestinationConfig } from './workflow.types.js';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface DestinationPickerModalData {\r\n\tdestination: DestinationConfig;\r\n}\r\n\r\nexport interface DestinationPickerModalValue {\r\n\tselectedTargets: Array<{ target: string; blockKey?: string }>;\r\n}\r\n\r\nexport const UMB_DESTINATION_PICKER_MODAL = new UmbModalToken<\r\n\tDestinationPickerModalData,\r\n\tDestinationPickerModalValue\r\n>('UpDoc.DestinationPickerModal', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n","import type { RichExtractionResult, DocumentTypeConfig, MappingDestination, ZoneDetectionResult, DetectedZone, DetectedSection, ZoneElement } from './workflow.types.js';\r\nimport { fetchSampleExtraction, triggerSampleExtraction, fetchWorkflowByName, saveMapConfig, fetchZoneDetection, triggerZoneDetection } from './workflow.service.js';\r\nimport { html, css, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MEDIA_PICKER_MODAL } from '@umbraco-cms/backoffice/media';\r\nimport { UMB_DESTINATION_PICKER_MODAL } from './destination-picker-modal.token.js';\r\n\r\n@customElement('up-doc-workflow-source-view')\r\nexport class UpDocWorkflowSourceViewElement extends UmbLitElement {\r\n\t@state() private _extraction: RichExtractionResult | null = null;\r\n\t@state() private _zoneDetection: ZoneDetectionResult | null = null;\r\n\t@state() private _config: DocumentTypeConfig | null = null;\r\n\t@state() private _workflowName: string | null = null;\r\n\t@state() private _loading = true;\r\n\t@state() private _extracting = false;\r\n\t@state() private _error: string | null = null;\r\n\t@state() private _successMessage: string | null = null;\r\n\t@state() private _selectedElements = new Set<string>();\r\n\t@state() private _collapsedSections = new Set<string>();\r\n\t#token = '';\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.consumeContext(UMB_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\t\t\tthis.observe((context as any).unique, (unique: string | null) => {\r\n\t\t\t\tif (unique) {\r\n\t\t\t\t\tthis._workflowName = decodeURIComponent(unique);\r\n\t\t\t\t\tthis.#loadData();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #loadData() {\r\n\t\tif (!this._workflowName) return;\r\n\r\n\t\tthis._loading = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tthis.#token = await authContext.getLatestToken();\r\n\t\t\tconst [extraction, zoneDetection, config] = await Promise.all([\r\n\t\t\t\tfetchSampleExtraction(this._workflowName, this.#token),\r\n\t\t\t\tfetchZoneDetection(this._workflowName, this.#token),\r\n\t\t\t\tfetchWorkflowByName(this._workflowName, this.#token),\r\n\t\t\t]);\r\n\t\t\tthis._extraction = extraction;\r\n\t\t\tthis._zoneDetection = zoneDetection;\r\n\t\t\tthis._config = config;\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Failed to load data';\r\n\t\t\tconsole.error('Failed to load source data:', err);\r\n\t\t} finally {\r\n\t\t\tthis._loading = false;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #onPickMedia() {\r\n\t\tif (!this._workflowName) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_MEDIA_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tmultiple: false,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst result = await modal.onSubmit().catch(() => null);\r\n\t\tif (!result?.selection?.length) return;\r\n\r\n\t\tconst mediaKey = result.selection[0];\r\n\t\tif (!mediaKey) return;\r\n\r\n\t\tthis._extracting = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t\t// Trigger both sample extraction and zone detection\r\n\t\t\tconst [extraction, zoneDetection] = await Promise.all([\r\n\t\t\t\ttriggerSampleExtraction(this._workflowName, mediaKey, token),\r\n\t\t\t\ttriggerZoneDetection(this._workflowName, mediaKey, token),\r\n\t\t\t]);\r\n\r\n\t\t\tif (extraction) {\r\n\t\t\t\tthis._extraction = extraction;\r\n\t\t\t}\r\n\t\t\tif (zoneDetection) {\r\n\t\t\t\tthis._zoneDetection = zoneDetection;\r\n\t\t\t\tconst totalElements = zoneDetection.diagnostics.elementsZoned + zoneDetection.diagnostics.elementsUnzoned;\r\n\t\t\t\tthis._successMessage = `Content extracted — ${zoneDetection.diagnostics.zonesDetected} areas, ${totalElements} elements`;\r\n\t\t\t\tsetTimeout(() => { this._successMessage = null; }, 5000);\r\n\t\t\t} else if (extraction) {\r\n\t\t\t\tthis._successMessage = `Content extracted — ${extraction.elements.length} elements (zone detection unavailable)`;\r\n\t\t\t\tsetTimeout(() => { this._successMessage = null; }, 5000);\r\n\t\t\t} else {\r\n\t\t\t\tthis._error = 'Extraction failed. Check that the selected media item is a PDF.';\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Extraction failed';\r\n\t\t\tconsole.error('Extraction failed:', err);\r\n\t\t} finally {\r\n\t\t\tthis._extracting = false;\r\n\t\t}\r\n\t}\r\n\r\n\t#toggleSelection(id: string) {\r\n\t\tconst next = new Set(this._selectedElements);\r\n\t\tif (next.has(id)) {\r\n\t\t\tnext.delete(id);\r\n\t\t} else {\r\n\t\t\tnext.add(id);\r\n\t\t}\r\n\t\tthis._selectedElements = next;\r\n\t}\r\n\r\n\t#clearSelection() {\r\n\t\tthis._selectedElements = new Set();\r\n\t}\r\n\r\n\t#toggleSectionCollapse(sectionKey: string) {\r\n\t\tconst next = new Set(this._collapsedSections);\r\n\t\tif (next.has(sectionKey)) {\r\n\t\t\tnext.delete(sectionKey);\r\n\t\t} else {\r\n\t\t\tnext.add(sectionKey);\r\n\t\t}\r\n\t\tthis._collapsedSections = next;\r\n\t}\r\n\r\n\tasync #onMapTo() {\r\n\t\tif (!this._config || this._selectedElements.size === 0) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_DESTINATION_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tdestination: this._config.destination,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst result = await modal.onSubmit().catch(() => null);\r\n\t\tif (!result?.selectedTargets?.length || !this._workflowName) return;\r\n\r\n\t\tconst existingMappings = this._config.map.mappings ?? [];\r\n\t\tconst newMappings = [...existingMappings];\r\n\t\tconst addedCount = this._selectedElements.size;\r\n\t\tfor (const sourceId of this._selectedElements) {\r\n\t\t\tnewMappings.push({\r\n\t\t\t\tsource: sourceId,\r\n\t\t\t\tdestinations: result.selectedTargets.map((t: { target: string; blockKey?: string }) => ({\r\n\t\t\t\t\ttarget: t.target,\r\n\t\t\t\t\t...(t.blockKey ? { blockKey: t.blockKey } : {}),\r\n\t\t\t\t})),\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst updatedMap = { ...this._config.map, mappings: newMappings };\r\n\t\tconst saved = await saveMapConfig(this._workflowName, updatedMap, this.#token);\r\n\t\tif (saved) {\r\n\t\t\tthis._config = { ...this._config, map: updatedMap };\r\n\t\t\tthis._selectedElements = new Set();\r\n\t\t\tthis._successMessage = `${addedCount} mapping${addedCount !== 1 ? 's' : ''} created`;\r\n\t\t\tsetTimeout(() => { this._successMessage = null; }, 3000);\r\n\t\t}\r\n\t}\r\n\r\n\t#renderToolbar() {\r\n\t\tconst count = this._selectedElements.size;\r\n\t\tif (count === 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"selection-toolbar\">\r\n\t\t\t\t<span class=\"selection-count\">${count} selected</span>\r\n\t\t\t\t<uui-button look=\"primary\" compact label=\"Map to...\" @click=${this.#onMapTo}>\r\n\t\t\t\t\t<uui-icon name=\"icon-nodes\"></uui-icon>\r\n\t\t\t\t\tMap to...\r\n\t\t\t\t</uui-button>\r\n\t\t\t\t<uui-button look=\"secondary\" compact label=\"Clear\" @click=${this.#clearSelection}>\r\n\t\t\t\t\tClear\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#getMappedTargets(elementId: string): MappingDestination[] {\r\n\t\tif (!this._config?.map?.mappings) return [];\r\n\t\tconst targets: MappingDestination[] = [];\r\n\t\tfor (const mapping of this._config.map.mappings) {\r\n\t\t\tif (mapping.source === elementId && mapping.enabled) {\r\n\t\t\t\tfor (const dest of mapping.destinations) {\r\n\t\t\t\t\ttargets.push(dest);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn targets;\r\n\t}\r\n\r\n\t#resolveTargetLabel(dest: MappingDestination): string {\r\n\t\tif (!this._config?.destination) return dest.target;\r\n\r\n\t\tif (dest.blockKey && this._config.destination.blockGrids) {\r\n\t\t\tfor (const grid of this._config.destination.blockGrids) {\r\n\t\t\t\tconst block = grid.blocks.find((b) => b.key === dest.blockKey);\r\n\t\t\t\tif (block) {\r\n\t\t\t\t\tconst prop = block.properties?.find((p) => p.alias === dest.target);\r\n\t\t\t\t\treturn `${block.label} > ${prop?.label || dest.target}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst field = this._config.destination.fields.find((f) => f.alias === dest.target);\r\n\t\tif (field) return field.label;\r\n\r\n\t\tif (this._config.destination.blockGrids) {\r\n\t\t\tfor (const grid of this._config.destination.blockGrids) {\r\n\t\t\t\tfor (const block of grid.blocks) {\r\n\t\t\t\t\tconst prop = block.properties?.find((p) => p.alias === dest.target);\r\n\t\t\t\t\tif (prop) return `${block.label} > ${prop.label || prop.alias}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn dest.target;\r\n\t}\r\n\r\n\t// --- Zone-based rendering ---\r\n\r\n\t#renderZoneElement(element: ZoneElement) {\r\n\t\tconst checked = this._selectedElements.has(element.id);\r\n\t\tconst mappedTargets = this.#getMappedTargets(element.id);\r\n\t\tconst isMapped = mappedTargets.length > 0;\r\n\t\treturn html`\r\n\t\t\t<div class=\"element-item ${checked ? 'element-selected' : ''} ${isMapped ? 'element-mapped' : ''}\">\r\n\t\t\t\t<uui-checkbox\r\n\t\t\t\t\tlabel=\"Select for mapping\"\r\n\t\t\t\t\t?checked=${checked}\r\n\t\t\t\t\t@change=${() => this.#toggleSelection(element.id)}\r\n\t\t\t\t\tclass=\"element-checkbox\">\r\n\t\t\t\t</uui-checkbox>\r\n\t\t\t\t<div class=\"element-content\" @click=${() => this.#toggleSelection(element.id)}>\r\n\t\t\t\t\t<div class=\"element-text\">${element.text}</div>\r\n\t\t\t\t\t<div class=\"element-meta\">\r\n\t\t\t\t\t\t<span class=\"meta-badge font-size\">${element.fontSize}pt</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge font-name\">${element.fontName}</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge color\" style=\"border-left: 3px solid ${element.color};\">${element.color}</span>\r\n\t\t\t\t\t\t${mappedTargets.map((t) => html`<span class=\"meta-badge mapped-target\"><uui-icon name=\"icon-arrow-right\" style=\"font-size: 10px;\"></uui-icon> ${this.#resolveTargetLabel(t)}</span>`)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderSection(section: DetectedSection, sectionKey: string) {\r\n\t\tconst isCollapsed = this._collapsedSections.has(sectionKey);\r\n\r\n\t\tif (!section.heading) {\r\n\t\t\t// Preamble section (no heading) — render children directly\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"zone-section\">\r\n\t\t\t\t\t${section.children.map((el) => this.#renderZoneElement(el))}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tconst heading = section.heading;\r\n\t\tconst checked = this._selectedElements.has(heading.id);\r\n\t\tconst mappedTargets = this.#getMappedTargets(heading.id);\r\n\t\tconst isMapped = mappedTargets.length > 0;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"zone-section\">\r\n\t\t\t\t<div class=\"section-heading ${checked ? 'element-selected' : ''} ${isMapped ? 'element-mapped' : ''}\">\r\n\t\t\t\t\t<uui-checkbox\r\n\t\t\t\t\t\tlabel=\"Select ${heading.text}\"\r\n\t\t\t\t\t\t?checked=${checked}\r\n\t\t\t\t\t\t@change=${() => this.#toggleSelection(heading.id)}\r\n\t\t\t\t\t\tclass=\"element-checkbox\">\r\n\t\t\t\t\t</uui-checkbox>\r\n\t\t\t\t\t<div class=\"heading-content\" @click=${() => this.#toggleSectionCollapse(sectionKey)}>\r\n\t\t\t\t\t\t<div class=\"heading-text\">${heading.text}</div>\r\n\t\t\t\t\t\t<div class=\"element-meta\">\r\n\t\t\t\t\t\t\t<span class=\"meta-badge font-size\">${heading.fontSize}pt</span>\r\n\t\t\t\t\t\t\t<span class=\"meta-badge font-name\">${heading.fontName}</span>\r\n\t\t\t\t\t\t\t${mappedTargets.map((t) => html`<span class=\"meta-badge mapped-target\"><uui-icon name=\"icon-arrow-right\" style=\"font-size: 10px;\"></uui-icon> ${this.#resolveTargetLabel(t)}</span>`)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<button class=\"collapse-toggle\" @click=${() => this.#toggleSectionCollapse(sectionKey)} title=\"${isCollapsed ? 'Expand' : 'Collapse'}\">\r\n\t\t\t\t\t\t<uui-icon name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<span class=\"group-count\">${section.children.length} item${section.children.length !== 1 ? 's' : ''}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t${!isCollapsed ? html`\r\n\t\t\t\t\t<div class=\"section-children\">\r\n\t\t\t\t\t\t${section.children.map((el) => this.#renderZoneElement(el))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` : nothing}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderArea(zone: DetectedZone, pageNum: number, areaIndex: number) {\r\n\t\tconst elementCount = zone.totalElements;\r\n\t\treturn html`\r\n\t\t\t<div class=\"zone-area\" style=\"border-left-color: ${zone.color};\">\r\n\t\t\t\t<div class=\"area-header\">\r\n\t\t\t\t\t<span class=\"area-color-swatch\" style=\"background: ${zone.color};\"></span>\r\n\t\t\t\t\t<span class=\"area-element-count\">${elementCount} element${elementCount !== 1 ? 's' : ''}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t${zone.sections.map((section, sIdx) =>\r\n\t\t\t\t\tthis.#renderSection(section, `p${pageNum}-a${areaIndex}-s${sIdx}`)\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderUnzonedContent(zone: DetectedZone, pageNum: number) {\r\n\t\tif (zone.totalElements === 0) return nothing;\r\n\t\treturn html`\r\n\t\t\t<div class=\"zone-area unzoned\" style=\"border-left-color: var(--uui-color-border-standalone);\">\r\n\t\t\t\t<div class=\"area-header\">\r\n\t\t\t\t\t<span class=\"area-color-swatch unzoned-swatch\"></span>\r\n\t\t\t\t\t<span class=\"area-element-count\">Unzoned — ${zone.totalElements} element${zone.totalElements !== 1 ? 's' : ''}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t${zone.sections.map((section, sIdx) =>\r\n\t\t\t\t\tthis.#renderSection(section, `p${pageNum}-unzoned-s${sIdx}`)\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderZonePage(pageNum: number, zones: DetectedZone[], unzonedContent: DetectedZone | null) {\r\n\t\treturn html`\r\n\t\t\t<uui-box headline=\"Page ${pageNum}\" class=\"page-box\">\r\n\t\t\t\t${zones.map((zone, idx) => this.#renderArea(zone, pageNum, idx))}\r\n\t\t\t\t${unzonedContent ? this.#renderUnzonedContent(unzonedContent, pageNum) : nothing}\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderZoneDetection() {\r\n\t\tif (!this._zoneDetection) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t${this._zoneDetection.pages.map((page) =>\r\n\t\t\t\tthis.#renderZonePage(page.page, page.zones, page.unzonedContent)\r\n\t\t\t)}\r\n\t\t\t<div class=\"diagnostics\">\r\n\t\t\t\t<span class=\"meta-badge\">${this._zoneDetection.diagnostics.zonesDetected} areas</span>\r\n\t\t\t\t<span class=\"meta-badge\">${this._zoneDetection.diagnostics.elementsZoned} zoned</span>\r\n\t\t\t\t<span class=\"meta-badge\">${this._zoneDetection.diagnostics.elementsUnzoned} unzoned</span>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderExtraction() {\r\n\t\tconst hasZones = this._zoneDetection !== null;\r\n\t\tconst hasExtraction = this._extraction !== null;\r\n\r\n\t\tif (!hasZones && !hasExtraction) return nothing;\r\n\r\n\t\t// Use extraction for header info, zone detection for content\r\n\t\tconst totalElements = hasZones\r\n\t\t\t? this._zoneDetection!.diagnostics.elementsZoned + this._zoneDetection!.diagnostics.elementsUnzoned\r\n\t\t\t: this._extraction!.elements.length;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"extraction-header\">\r\n\t\t\t\t${hasExtraction ? html`\r\n\t\t\t\t\t<div class=\"extraction-info\">\r\n\t\t\t\t\t\t<span class=\"info-label\">Source:</span>\r\n\t\t\t\t\t\t<span>${this._extraction!.source.fileName}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"extraction-info\">\r\n\t\t\t\t\t\t<span class=\"info-label\">Pages:</span>\r\n\t\t\t\t\t\t<span>${this._extraction!.source.totalPages}</span>\r\n\t\t\t\t\t\t<span class=\"info-label\" style=\"margin-left: var(--uui-size-space-4);\">Elements:</span>\r\n\t\t\t\t\t\t<span>${totalElements}</span>\r\n\t\t\t\t\t\t${hasZones ? html`\r\n\t\t\t\t\t\t\t<span class=\"info-label\" style=\"margin-left: var(--uui-size-space-4);\">Areas:</span>\r\n\t\t\t\t\t\t\t<span>${this._zoneDetection!.diagnostics.zonesDetected}</span>\r\n\t\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t\t<span class=\"info-label\" style=\"margin-left: var(--uui-size-space-4);\">Extracted:</span>\r\n\t\t\t\t\t\t<span>${new Date(this._extraction!.source.extractedDate).toLocaleString()}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` : html`\r\n\t\t\t\t\t<div class=\"extraction-info\">\r\n\t\t\t\t\t\t<span class=\"info-label\">Elements:</span>\r\n\t\t\t\t\t\t<span>${totalElements}</span>\r\n\t\t\t\t\t\t<span class=\"info-label\" style=\"margin-left: var(--uui-size-space-4);\">Areas:</span>\r\n\t\t\t\t\t\t<span>${this._zoneDetection!.diagnostics.zonesDetected}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t`}\r\n\t\t\t\t<uui-button look=\"secondary\" label=\"Re-extract\" @click=${this.#onPickMedia} ?disabled=${this._extracting}>\r\n\t\t\t\t\t<uui-icon name=\"icon-refresh\"></uui-icon>\r\n\t\t\t\t\tRe-extract\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\r\n\t\t\t${this.#renderToolbar()}\r\n\t\t\t${hasZones ? this.#renderZoneDetection() : nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderEmpty() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t<uui-icon name=\"icon-document\" style=\"font-size: 48px; color: var(--uui-color-text-alt);\"></uui-icon>\r\n\t\t\t\t<h3>No sample extraction</h3>\r\n\t\t\t\t<p>Upload a PDF to extract all text elements with their metadata.</p>\r\n\t\t\t\t<uui-button look=\"primary\" label=\"Upload PDF\" @click=${this.#onPickMedia} ?disabled=${this._extracting}>\r\n\t\t\t\t\t${this._extracting ? html`<uui-loader-bar></uui-loader-bar>` : 'Upload PDF'}\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<div class=\"loading\"><uui-loader-bar></uui-loader-bar></div>`;\r\n\t\t}\r\n\r\n\t\tif (this._error) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t\t<p style=\"color: var(--uui-color-danger); padding: var(--uui-size-layout-1);\">${this._error}</p>\r\n\t\t\t\t</umb-body-layout>`;\r\n\t\t}\r\n\r\n\t\tconst hasContent = this._zoneDetection !== null || this._extraction !== null;\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t${this._successMessage ? html`<div class=\"success-banner\"><uui-icon name=\"icon-check\"></uui-icon> ${this._successMessage}</div>` : nothing}\r\n\t\t\t\t${hasContent ? this.#renderExtraction() : this.#renderEmpty()}\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.loading {\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.success-banner {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\r\n\t\t\t/* Empty state */\r\n\t\t\t.empty-state {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tpadding: var(--uui-size-layout-2);\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tmin-height: 300px;\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state h3 {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state p {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Extraction header */\r\n\t\t\t.extraction-header {\r\n\t\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.extraction-info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\r\n\t\t\t.info-label {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Page groups */\r\n\t\t\t.page-box {\r\n\t\t\t\tmargin: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t/* Selection toolbar */\r\n\t\t\t.selection-toolbar {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-selected);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tposition: sticky;\r\n\t\t\t\ttop: 0;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.selection-count {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t/* Zone areas */\r\n\t\t\t.zone-area {\r\n\t\t\t\tborder-left: 4px solid var(--uui-color-border);\r\n\t\t\t\tmargin: var(--uui-size-space-3) 0;\r\n\t\t\t\tmargin-left: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.zone-area.unzoned {\r\n\t\t\t\topacity: 0.75;\r\n\t\t\t}\r\n\r\n\t\t\t.area-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-3);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.area-color-swatch {\r\n\t\t\t\tdisplay: inline-block;\r\n\t\t\t\twidth: 12px;\r\n\t\t\t\theight: 12px;\r\n\t\t\t\tborder-radius: 2px;\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.area-color-swatch.unzoned-swatch {\r\n\t\t\t\tbackground: var(--uui-color-border-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t.area-element-count {\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t}\r\n\r\n\t\t\t/* Sections within areas */\r\n\t\t\t.zone-section + .zone-section {\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading.element-selected {\r\n\t\t\t\tbackground: var(--uui-color-selected);\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading.element-mapped {\r\n\t\t\t\tborder-left: 3px solid var(--uui-color-positive-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t.heading-content {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.heading-text {\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-1);\r\n\t\t\t}\r\n\r\n\t\t\t.collapse-toggle {\r\n\t\t\t\tbackground: none;\r\n\t\t\t\tborder: none;\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tpadding: var(--uui-size-space-1);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t.collapse-toggle:hover {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.group-count {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t.section-children {\r\n\t\t\t\tpadding-left: var(--uui-size-space-5);\r\n\t\t\t\tborder-left: 2px solid var(--uui-color-border);\r\n\t\t\t\tmargin-left: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t/* Element items */\r\n\t\t\t.element-item {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: flex-start;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.element-item:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.element-item.element-selected {\r\n\t\t\t\tbackground: var(--uui-color-selected);\r\n\t\t\t}\r\n\r\n\t\t\t.element-item:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t.element-item.element-mapped {\r\n\t\t\t\tborder-left: 3px solid var(--uui-color-positive-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t.element-checkbox {\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t\tmargin-top: 2px;\r\n\t\t\t}\r\n\r\n\t\t\t.element-content {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.element-text {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-2);\r\n\t\t\t\tword-break: break-word;\r\n\t\t\t\twhite-space: pre-wrap;\r\n\t\t\t}\r\n\r\n\t\t\t.element-meta {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tpadding: 1px 6px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.font-size {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.mapped-target {\r\n\t\t\t\tbackground: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t\tdisplay: inline-flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: 3px;\r\n\t\t\t}\r\n\r\n\t\t\t.diagnostics {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocWorkflowSourceViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-workflow-source-view': UpDocWorkflowSourceViewElement;\r\n\t}\r\n}\r\n"],"names":["UMB_DESTINATION_PICKER_MODAL","UmbModalToken","_token","_UpDocWorkflowSourceViewElement_instances","loadData_fn","onPickMedia_fn","toggleSelection_fn","clearSelection_fn","toggleSectionCollapse_fn","onMapTo_fn","renderToolbar_fn","getMappedTargets_fn","resolveTargetLabel_fn","renderZoneElement_fn","renderSection_fn","renderArea_fn","renderUnzonedContent_fn","renderZonePage_fn","renderZoneDetection_fn","renderExtraction_fn","renderEmpty_fn","UpDocWorkflowSourceViewElement","UmbLitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","context","unique","__privateMethod","html","hasContent","nothing","authContext","UMB_AUTH_CONTEXT","__privateSet","extraction","zoneDetection","config","fetchSampleExtraction","__privateGet","fetchZoneDetection","fetchWorkflowByName","err","result","UMB_MODAL_MANAGER_CONTEXT","UMB_MEDIA_PICKER_MODAL","_a","mediaKey","token","triggerSampleExtraction","triggerZoneDetection","totalElements","id","next","sectionKey","newMappings","addedCount","sourceId","t","updatedMap","saveMapConfig","count","elementId","_b","targets","mapping","dest","grid","block","b","prop","field","f","_c","element","checked","mappedTargets","isMapped","section","isCollapsed","el","heading","zone","pageNum","areaIndex","elementCount","sIdx","zones","unzonedContent","idx","page","hasZones","hasExtraction","UmbTextStyles","css","__decorateClass","state","customElement","UpDocWorkflowSourceViewElement_default"],"mappings":";;;;;;;;AAWO,MAAMA,KAA+B,IAAIC,EAG9C,gCAAgC;AAAA,EACjC,OAAO;AAAA,IACN,MAAM;AAAA,IACN,MAAM;AAAA,EAAA;AAER,CAAC;;;;;;;yYCnBDC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAaO,IAAMC,IAAN,cAA6CC,EAAc;AAAA,EAA3D,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,EAAA,MAAApB,CAAA,GACG,KAAQ,cAA2C,MACnD,KAAQ,iBAA6C,MACrD,KAAQ,UAAqC,MAC7C,KAAQ,gBAA+B,MACvC,KAAQ,WAAW,IACnB,KAAQ,cAAc,IACtB,KAAQ,SAAwB,MAChC,KAAQ,kBAAiC,MACzC,KAAQ,wCAAwB,IAAA,GAChC,KAAQ,yCAAyB,IAAA,GAC1CoB,EAAA,MAAArB,GAAS,EAAA;AAAA,EAAA;AAAA,EAEA,oBAAoB;AAC5B,UAAM,kBAAA,GACN,KAAK,eAAesB,GAAuB,CAACC,MAAY;AACvD,MAAKA,KACL,KAAK,QAASA,EAAgB,QAAQ,CAACC,MAA0B;AAChE,QAAIA,MACH,KAAK,gBAAgB,mBAAmBA,CAAM,GAC9CC,EAAA,MAAKxB,GAAAC,CAAA,EAAL,KAAA,IAAA;AAAA,MAEF,CAAC;AAAA,IACF,CAAC;AAAA,EACF;AAAA,EAqYS,SAAS;AACjB,QAAI,KAAK;AACR,aAAOwB;AAGR,QAAI,KAAK;AACR,aAAOA;AAAA;AAAA,qFAE2E,KAAK,MAAM;AAAA;AAI9F,UAAMC,IAAa,KAAK,mBAAmB,QAAQ,KAAK,gBAAgB;AAExE,WAAOD;AAAA;AAAA,MAEH,KAAK,kBAAkBA,wEAA2E,KAAK,eAAe,WAAWE,CAAO;AAAA,MACxID,IAAaF,EAAA,MAAKxB,GAAAgB,CAAA,EAAL,KAAA,IAAA,IAA2BQ,EAAA,MAAKxB,MAAL,KAAA,IAAA,CAAmB;AAAA;AAAA;AAAA,EAGhE;AA8QD;AAprBCD,IAAA,oBAAA,QAAA;AAXMC,IAAA,oBAAA,QAAA;AA0BAC,IAAS,iBAAG;AACjB,MAAK,KAAK,eAEV;AAAA,SAAK,WAAW,IAChB,KAAK,SAAS;AAEd,QAAI;AACH,YAAM2B,IAAc,MAAM,KAAK,WAAWC,CAAgB;AAC1D,MAAAC,GAAA,MAAK/B,GAAS,MAAM6B,EAAY,eAAA,CAAe;AAC/C,YAAM,CAACG,GAAYC,GAAeC,CAAM,IAAI,MAAM,QAAQ,IAAI;AAAA,QAC7DC,EAAsB,KAAK,eAAeC,EAAA,MAAKpC,CAAA,CAAM;AAAA,QACrDqC,EAAmB,KAAK,eAAeD,EAAA,MAAKpC,CAAA,CAAM;AAAA,QAClDsC,EAAoB,KAAK,eAAeF,EAAA,MAAKpC,CAAA,CAAM;AAAA,MAAA,CACnD;AACD,WAAK,cAAcgC,GACnB,KAAK,iBAAiBC,GACtB,KAAK,UAAUC;AAAA,IAChB,SAASK,GAAK;AACb,WAAK,SAASA,aAAe,QAAQA,EAAI,UAAU,uBACnD,QAAQ,MAAM,+BAA+BA,CAAG;AAAA,IACjD,UAAA;AACC,WAAK,WAAW;AAAA,IACjB;AAAA;AACD;AAEMpC,IAAY,iBAAG;;AACpB,MAAI,CAAC,KAAK,cAAe;AASzB,QAAMqC,IAAS,OAPM,MAAM,KAAK,WAAWC,CAAyB,GACzC,KAAK,MAAMC,IAAwB;AAAA,IAC7D,MAAM;AAAA,MACL,UAAU;AAAA,IAAA;AAAA,EACX,CACA,EAE0B,WAAW,MAAM,MAAM,IAAI;AACtD,MAAI,GAACC,IAAAH,KAAA,gBAAAA,EAAQ,cAAR,QAAAG,EAAmB,QAAQ;AAEhC,QAAMC,IAAWJ,EAAO,UAAU,CAAC;AACnC,MAAKI,GAEL;AAAA,SAAK,cAAc,IACnB,KAAK,SAAS;AAEd,QAAI;AAEH,YAAMC,IAAQ,OADM,MAAM,KAAK,WAAWf,CAAgB,GAC1B,eAAA,GAG1B,CAACE,GAAYC,CAAa,IAAI,MAAM,QAAQ,IAAI;AAAA,QACrDa,EAAwB,KAAK,eAAeF,GAAUC,CAAK;AAAA,QAC3DE,EAAqB,KAAK,eAAeH,GAAUC,CAAK;AAAA,MAAA,CACxD;AAKD,UAHIb,MACH,KAAK,cAAcA,IAEhBC,GAAe;AAClB,aAAK,iBAAiBA;AACtB,cAAMe,IAAgBf,EAAc,YAAY,gBAAgBA,EAAc,YAAY;AAC1F,aAAK,kBAAkB,uBAAuBA,EAAc,YAAY,aAAa,WAAWe,CAAa,aAC7G,WAAW,MAAM;AAAE,eAAK,kBAAkB;AAAA,QAAM,GAAG,GAAI;AAAA,MACxD,OAAWhB,KACV,KAAK,kBAAkB,uBAAuBA,EAAW,SAAS,MAAM,0CACxE,WAAW,MAAM;AAAE,aAAK,kBAAkB;AAAA,MAAM,GAAG,GAAI,KAEvD,KAAK,SAAS;AAAA,IAEhB,SAASO,GAAK;AACb,WAAK,SAASA,aAAe,QAAQA,EAAI,UAAU,qBACnD,QAAQ,MAAM,sBAAsBA,CAAG;AAAA,IACxC,UAAA;AACC,WAAK,cAAc;AAAA,IACpB;AAAA;AACD;AAEAnC,IAAgB,SAAC6C,GAAY;AAC5B,QAAMC,IAAO,IAAI,IAAI,KAAK,iBAAiB;AAC3C,EAAIA,EAAK,IAAID,CAAE,IACdC,EAAK,OAAOD,CAAE,IAEdC,EAAK,IAAID,CAAE,GAEZ,KAAK,oBAAoBC;AAC1B;AAEA7C,IAAe,WAAG;AACjB,OAAK,wCAAwB,IAAA;AAC9B;AAEAC,IAAsB,SAAC6C,GAAoB;AAC1C,QAAMD,IAAO,IAAI,IAAI,KAAK,kBAAkB;AAC5C,EAAIA,EAAK,IAAIC,CAAU,IACtBD,EAAK,OAAOC,CAAU,IAEtBD,EAAK,IAAIC,CAAU,GAEpB,KAAK,qBAAqBD;AAC3B;AAEM3C,IAAQ,iBAAG;;AAChB,MAAI,CAAC,KAAK,WAAW,KAAK,kBAAkB,SAAS,EAAG;AASxD,QAAMiC,IAAS,OAPM,MAAM,KAAK,WAAWC,CAAyB,GACzC,KAAK,MAAM3C,IAA8B;AAAA,IACnE,MAAM;AAAA,MACL,aAAa,KAAK,QAAQ;AAAA,IAAA;AAAA,EAC3B,CACA,EAE0B,WAAW,MAAM,MAAM,IAAI;AACtD,MAAI,GAAC6C,IAAAH,KAAA,gBAAAA,EAAQ,oBAAR,QAAAG,EAAyB,WAAU,CAAC,KAAK,cAAe;AAG7D,QAAMS,IAAc,CAAC,GADI,KAAK,QAAQ,IAAI,YAAY,CAAA,CACd,GAClCC,IAAa,KAAK,kBAAkB;AAC1C,aAAWC,KAAY,KAAK;AAC3B,IAAAF,EAAY,KAAK;AAAA,MAChB,QAAQE;AAAA,MACR,cAAcd,EAAO,gBAAgB,IAAI,CAACe,OAA8C;AAAA,QACvF,QAAQA,EAAE;AAAA,QACV,GAAIA,EAAE,WAAW,EAAE,UAAUA,EAAE,SAAA,IAAa,CAAA;AAAA,MAAC,EAC5C;AAAA,MACF,SAAS;AAAA,IAAA,CACT;AAGF,QAAMC,IAAa,EAAE,GAAG,KAAK,QAAQ,KAAK,UAAUJ,EAAA;AAEpD,EADc,MAAMK,EAAc,KAAK,eAAeD,GAAYpB,QAAKpC,CAAA,CAAM,MAE5E,KAAK,UAAU,EAAE,GAAG,KAAK,SAAS,KAAKwD,EAAA,GACvC,KAAK,wCAAwB,IAAA,GAC7B,KAAK,kBAAkB,GAAGH,CAAU,WAAWA,MAAe,IAAI,MAAM,EAAE,YAC1E,WAAW,MAAM;AAAE,SAAK,kBAAkB;AAAA,EAAM,GAAG,GAAI;AAEzD;AAEA7C,IAAc,WAAG;AAChB,QAAMkD,IAAQ,KAAK,kBAAkB;AACrC,SAAIA,MAAU,IAAU9B,IAEjBF;AAAA;AAAA,oCAE2BgC,CAAK;AAAA,kEACyBjC,QAAKxB,GAAAM,CAAA,CAAQ;AAAA;AAAA;AAAA;AAAA,gEAIfkB,QAAKxB,GAAAI,CAAA,CAAe;AAAA;AAAA;AAAA;AAAA;AAKnF;AAEAI,IAAiB,SAACkD,GAAyC;;AAC1D,MAAI,GAACC,KAAAjB,IAAA,KAAK,YAAL,gBAAAA,EAAc,QAAd,QAAAiB,EAAmB,kBAAiB,CAAA;AACzC,QAAMC,IAAgC,CAAA;AACtC,aAAWC,KAAW,KAAK,QAAQ,IAAI;AACtC,QAAIA,EAAQ,WAAWH,KAAaG,EAAQ;AAC3C,iBAAWC,KAAQD,EAAQ;AAC1B,QAAAD,EAAQ,KAAKE,CAAI;AAIpB,SAAOF;AACR;AAEAnD,IAAmB,SAACqD,GAAkC;;AACrD,MAAI,GAACpB,IAAA,KAAK,YAAL,QAAAA,EAAc,qBAAoBoB,EAAK;AAE5C,MAAIA,EAAK,YAAY,KAAK,QAAQ,YAAY;AAC7C,eAAWC,KAAQ,KAAK,QAAQ,YAAY,YAAY;AACvD,YAAMC,IAAQD,EAAK,OAAO,KAAK,CAACE,MAAMA,EAAE,QAAQH,EAAK,QAAQ;AAC7D,UAAIE,GAAO;AACV,cAAME,KAAOP,IAAAK,EAAM,eAAN,gBAAAL,EAAkB,KAAK,CAAC,MAAM,EAAE,UAAUG,EAAK;AAC5D,eAAO,GAAGE,EAAM,KAAK,OAAME,KAAA,gBAAAA,EAAM,UAASJ,EAAK,MAAM;AAAA,MACtD;AAAA,IACD;AAGD,QAAMK,IAAQ,KAAK,QAAQ,YAAY,OAAO,KAAK,CAACC,MAAMA,EAAE,UAAUN,EAAK,MAAM;AACjF,MAAIK,UAAcA,EAAM;AAExB,MAAI,KAAK,QAAQ,YAAY;AAC5B,eAAWJ,KAAQ,KAAK,QAAQ,YAAY;AAC3C,iBAAWC,KAASD,EAAK,QAAQ;AAChC,cAAMG,KAAOG,IAAAL,EAAM,eAAN,gBAAAK,EAAkB,KAAK,CAAC,MAAM,EAAE,UAAUP,EAAK;AAC5D,YAAII,UAAa,GAAGF,EAAM,KAAK,MAAME,EAAK,SAASA,EAAK,KAAK;AAAA,MAC9D;AAIF,SAAOJ,EAAK;AACb;AAIApD,IAAkB,SAAC4D,GAAsB;AACxC,QAAMC,IAAU,KAAK,kBAAkB,IAAID,EAAQ,EAAE,GAC/CE,IAAgBhD,EAAA,MAAKxB,GAAAQ,CAAA,EAAL,KAAA,MAAuB8D,EAAQ,EAAA,GAC/CG,IAAWD,EAAc,SAAS;AACxC,SAAO/C;AAAA,8BACqB8C,IAAU,qBAAqB,EAAE,IAAIE,IAAW,mBAAmB,EAAE;AAAA;AAAA;AAAA,gBAGnFF,CAAO;AAAA,eACR,MAAM/C,EAAA,MAAKxB,GAAAG,CAAA,EAAL,KAAA,MAAsBmE,EAAQ,EAAA,CAAG;AAAA;AAAA;AAAA,0CAGZ,MAAM9C,EAAA,MAAKxB,GAAAG,CAAA,EAAL,KAAA,MAAsBmE,EAAQ,EAAA,CAAG;AAAA,iCAChDA,EAAQ,IAAI;AAAA;AAAA,2CAEFA,EAAQ,QAAQ;AAAA,2CAChBA,EAAQ,QAAQ;AAAA,qEACUA,EAAQ,KAAK,MAAMA,EAAQ,KAAK;AAAA,QAC7FE,EAAc,IAAI,CAAClB,MAAM7B,kHAAqHD,QAAKxB,GAAAS,CAAA,EAAL,KAAA,MAAyB6C,CAAA,CAAE,SAAS,CAAC;AAAA;AAAA;AAAA;AAAA;AAK1L;AAEA3C,IAAc,SAAC+D,GAA0BxB,GAAoB;AAC5D,QAAMyB,IAAc,KAAK,mBAAmB,IAAIzB,CAAU;AAE1D,MAAI,CAACwB,EAAQ;AAEZ,WAAOjD;AAAA;AAAA,OAEHiD,EAAQ,SAAS,IAAI,CAACE,MAAOpD,EAAA,MAAKxB,GAAAU,CAAA,EAAL,KAAA,MAAwBkE,CAAA,CAAG,CAAC;AAAA;AAAA;AAK9D,QAAMC,IAAUH,EAAQ,SAClBH,IAAU,KAAK,kBAAkB,IAAIM,EAAQ,EAAE,GAC/CL,IAAgBhD,EAAA,MAAKxB,GAAAQ,CAAA,EAAL,KAAA,MAAuBqE,EAAQ,EAAA,GAC/CJ,IAAWD,EAAc,SAAS;AAExC,SAAO/C;AAAA;AAAA,kCAEyB8C,IAAU,qBAAqB,EAAE,IAAIE,IAAW,mBAAmB,EAAE;AAAA;AAAA,sBAEjFI,EAAQ,IAAI;AAAA,iBACjBN,CAAO;AAAA,gBACR,MAAM/C,EAAA,MAAKxB,GAAAG,CAAA,EAAL,KAAA,MAAsB0E,EAAQ,EAAA,CAAG;AAAA;AAAA;AAAA,2CAGZ,MAAMrD,EAAA,MAAKxB,GAAAK,CAAA,EAAL,KAAA,MAA4B6C,CAAA,CAAW;AAAA,kCACtD2B,EAAQ,IAAI;AAAA;AAAA,4CAEFA,EAAQ,QAAQ;AAAA,4CAChBA,EAAQ,QAAQ;AAAA,SACnDL,EAAc,IAAI,CAAClB,MAAM7B,kHAAqHD,QAAKxB,GAAAS,CAAA,EAAL,KAAA,MAAyB6C,CAAA,CAAE,SAAS,CAAC;AAAA;AAAA;AAAA,8CAG9I,MAAM9B,QAAKxB,GAAAK,CAAA,EAAL,KAAA,MAA4B6C,EAAW,WAAWyB,IAAc,WAAW,UAAU;AAAA,wBACjHA,IAAc,0BAA0B,sBAAsB;AAAA;AAAA,iCAErDD,EAAQ,SAAS,MAAM,QAAQA,EAAQ,SAAS,WAAW,IAAI,MAAM,EAAE;AAAA;AAAA,MAEjGC,IAIChD,IAJaF;AAAA;AAAA,QAEbiD,EAAQ,SAAS,IAAI,CAACE,MAAOpD,EAAA,MAAKxB,GAAAU,CAAA,EAAL,KAAA,MAAwBkE,CAAA,CAAG,CAAC;AAAA;AAAA,KAElD;AAAA;AAAA;AAGd;AAEAhE,IAAW,SAACkE,GAAoBC,GAAiBC,GAAmB;AACnE,QAAMC,IAAeH,EAAK;AAC1B,SAAOrD;AAAA,sDAC6CqD,EAAK,KAAK;AAAA;AAAA,0DAENA,EAAK,KAAK;AAAA,wCAC5BG,CAAY,WAAWA,MAAiB,IAAI,MAAM,EAAE;AAAA;AAAA,MAEtFH,EAAK,SAAS;AAAA,IAAI,CAACJ,GAASQ,MAC7B1D,EAAA,MAAKxB,GAAAW,CAAA,EAAL,KAAA,MAAoB+D,GAAS,IAAIK,CAAO,KAAKC,CAAS,KAAKE,CAAI,EAAA;AAAA,EAAA,CAC/D;AAAA;AAAA;AAGJ;AAEArE,IAAqB,SAACiE,GAAoBC,GAAiB;AAC1D,SAAID,EAAK,kBAAkB,IAAUnD,IAC9BF;AAAA;AAAA;AAAA;AAAA,kDAIyCqD,EAAK,aAAa,WAAWA,EAAK,kBAAkB,IAAI,MAAM,EAAE;AAAA;AAAA,MAE5GA,EAAK,SAAS;AAAA,IAAI,CAACJ,GAASQ,MAC7B1D,EAAA,MAAKxB,GAAAW,CAAA,EAAL,WAAoB+D,GAAS,IAAIK,CAAO,aAAaG,CAAI,EAAA;AAAA,EAAA,CACzD;AAAA;AAAA;AAGJ;AAEApE,IAAe,SAACiE,GAAiBI,GAAuBC,GAAqC;AAC5F,SAAO3D;AAAA,6BACoBsD,CAAO;AAAA,MAC9BI,EAAM,IAAI,CAACL,GAAMO,MAAQ7D,EAAA,MAAKxB,GAAAY,CAAA,EAAL,KAAA,MAAiBkE,GAAMC,GAASM,CAAA,CAAI,CAAC;AAAA,MAC9DD,IAAiB5D,EAAA,MAAKxB,GAAAa,CAAA,EAAL,KAAA,MAA2BuE,GAAgBL,KAAWpD,CAAO;AAAA;AAAA;AAGnF;AAEAZ,IAAoB,WAAG;AACtB,SAAK,KAAK,iBAEHU;AAAA,KACJ,KAAK,eAAe,MAAM;AAAA,IAAI,CAAC6D,MAChC9D,EAAA,MAAKxB,GAAAc,CAAA,EAAL,WAAqBwE,EAAK,MAAMA,EAAK,OAAOA,EAAK,cAAA;AAAA,EAAA,CACjD;AAAA;AAAA,+BAE2B,KAAK,eAAe,YAAY,aAAa;AAAA,+BAC7C,KAAK,eAAe,YAAY,aAAa;AAAA,+BAC7C,KAAK,eAAe,YAAY,eAAe;AAAA;AAAA,MAT3C3D;AAYlC;AAEAX,IAAiB,WAAG;AACnB,QAAMuE,IAAW,KAAK,mBAAmB,MACnCC,IAAgB,KAAK,gBAAgB;AAE3C,MAAI,CAACD,KAAY,CAACC,EAAe,QAAO7D;AAGxC,QAAMoB,IAAgBwC,IACnB,KAAK,eAAgB,YAAY,gBAAgB,KAAK,eAAgB,YAAY,kBAClF,KAAK,YAAa,SAAS;AAE9B,SAAO9D;AAAA;AAAA,MAEH+D,IAAgB/D;AAAA;AAAA;AAAA,cAGR,KAAK,YAAa,OAAO,QAAQ;AAAA;AAAA;AAAA;AAAA,cAIjC,KAAK,YAAa,OAAO,UAAU;AAAA;AAAA,cAEnCsB,CAAa;AAAA,QACnBwC,IAAW9D;AAAA;AAAA,eAEJ,KAAK,eAAgB,YAAY,aAAa;AAAA,UACnDE,CAAO;AAAA;AAAA,cAEH,IAAI,KAAK,KAAK,YAAa,OAAO,aAAa,EAAE,gBAAgB;AAAA;AAAA,QAEvEF;AAAA;AAAA;AAAA,cAGMsB,CAAa;AAAA;AAAA,cAEb,KAAK,eAAgB,YAAY,aAAa;AAAA;AAAA,KAEvD;AAAA,6DACwDvB,EAAA,MAAKxB,GAAAE,CAAA,CAAY,cAAc,KAAK,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMvGsB,EAAA,MAAKxB,MAAL,KAAA,IAAA,CAAqB;AAAA,KACrBuF,IAAW/D,EAAA,MAAKxB,GAAAe,CAAA,EAAL,KAAA,IAAA,IAA8BY,CAAO;AAAA;AAEpD;AAEAV,IAAY,WAAG;AACd,SAAOQ;AAAA;AAAA;AAAA;AAAA;AAAA,2DAKkDD,EAAA,MAAKxB,GAAAE,CAAA,CAAY,cAAc,KAAK,WAAW;AAAA,OACnG,KAAK,cAAcuB,uCAA0C,YAAY;AAAA;AAAA;AAAA;AAI/E;AA3ZYP,EAmbI,SAAS;AAAA,EACxBuE;AAAA,EACAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyQD;AA7rBiBC,EAAA;AAAA,EAAhBC,EAAA;AAAM,GADK1E,EACK,WAAA,eAAA,CAAA;AACAyE,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAFK1E,EAEK,WAAA,kBAAA,CAAA;AACAyE,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAHK1E,EAGK,WAAA,WAAA,CAAA;AACAyE,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAJK1E,EAIK,WAAA,iBAAA,CAAA;AACAyE,EAAA;AAAA,EAAhBC,EAAA;AAAM,GALK1E,EAKK,WAAA,YAAA,CAAA;AACAyE,EAAA;AAAA,EAAhBC,EAAA;AAAM,GANK1E,EAMK,WAAA,eAAA,CAAA;AACAyE,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAPK1E,EAOK,WAAA,UAAA,CAAA;AACAyE,EAAA;AAAA,EAAhBC,EAAA;AAAM,GARK1E,EAQK,WAAA,mBAAA,CAAA;AACAyE,EAAA;AAAA,EAAhBC,EAAA;AAAM,GATK1E,EASK,WAAA,qBAAA,CAAA;AACAyE,EAAA;AAAA,EAAhBC,EAAA;AAAM,GAVK1E,EAUK,WAAA,sBAAA,CAAA;AAVLA,IAANyE,EAAA;AAAA,EADNE,EAAc,6BAA6B;AAAA,GAC/B3E,CAAA;AAisBb,MAAA4E,KAAe5E;"}