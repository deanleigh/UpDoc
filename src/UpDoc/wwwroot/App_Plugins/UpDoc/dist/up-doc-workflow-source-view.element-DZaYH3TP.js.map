{"version":3,"file":"up-doc-workflow-source-view.element-DZaYH3TP.js","sources":["../src/destination-picker-modal.token.ts","../src/up-doc-workflow-source-view.element.ts"],"sourcesContent":["import type { DestinationConfig } from './workflow.types.js';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface DestinationPickerModalData {\r\n\tdestination: DestinationConfig;\r\n}\r\n\r\nexport interface DestinationPickerModalValue {\r\n\tselectedTargets: string[];\r\n}\r\n\r\nexport const UMB_DESTINATION_PICKER_MODAL = new UmbModalToken<\r\n\tDestinationPickerModalData,\r\n\tDestinationPickerModalValue\r\n>('UpDoc.DestinationPickerModal', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n","import type { ExtractionElement, RichExtractionResult, DocumentTypeConfig } from './workflow.types.js';\r\nimport { fetchSampleExtraction, triggerSampleExtraction, fetchWorkflowByName, saveMapConfig } from './workflow.service.js';\r\nimport { html, css, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MEDIA_PICKER_MODAL } from '@umbraco-cms/backoffice/media';\r\nimport { UMB_DESTINATION_PICKER_MODAL } from './destination-picker-modal.token.js';\r\n\r\n@customElement('up-doc-workflow-source-view')\r\nexport class UpDocWorkflowSourceViewElement extends UmbLitElement {\r\n\t@state() private _extraction: RichExtractionResult | null = null;\r\n\t@state() private _config: DocumentTypeConfig | null = null;\r\n\t@state() private _workflowName: string | null = null;\r\n\t@state() private _loading = true;\r\n\t@state() private _extracting = false;\r\n\t@state() private _error: string | null = null;\r\n\t@state() private _successMessage: string | null = null;\r\n\t@state() private _selectedElements = new Set<string>();\r\n\t#token = '';\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.consumeContext(UMB_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\t\t\tthis.observe((context as any).unique, (unique: string | null) => {\r\n\t\t\t\tif (unique) {\r\n\t\t\t\t\tthis._workflowName = decodeURIComponent(unique);\r\n\t\t\t\t\tthis.#loadData();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #loadData() {\r\n\t\tif (!this._workflowName) return;\r\n\r\n\t\tthis._loading = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tthis.#token = await authContext.getLatestToken();\r\n\t\t\tconst [extraction, config] = await Promise.all([\r\n\t\t\t\tfetchSampleExtraction(this._workflowName, this.#token),\r\n\t\t\t\tfetchWorkflowByName(this._workflowName, this.#token),\r\n\t\t\t]);\r\n\t\t\tthis._extraction = extraction;\r\n\t\t\tthis._config = config;\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Failed to load sample extraction';\r\n\t\t\tconsole.error('Failed to load sample extraction:', err);\r\n\t\t} finally {\r\n\t\t\tthis._loading = false;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #onPickMedia() {\r\n\t\tif (!this._workflowName) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_MEDIA_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tmultiple: false,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst result = await modal.onSubmit().catch(() => null);\r\n\t\tif (!result?.selection?.length) return;\r\n\r\n\t\tconst mediaKey = result.selection[0];\r\n\t\tif (!mediaKey) return;\r\n\r\n\t\tthis._extracting = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\t\t\tconst extraction = await triggerSampleExtraction(this._workflowName, mediaKey, token);\r\n\r\n\t\t\tif (extraction) {\r\n\t\t\t\tthis._extraction = extraction;\r\n\t\t\t\tthis._successMessage = `Content extracted successfully â€” ${extraction.elements.length} elements from ${extraction.source.totalPages} pages`;\r\n\t\t\t\tsetTimeout(() => { this._successMessage = null; }, 5000);\r\n\t\t\t} else {\r\n\t\t\t\tthis._error = 'Extraction failed. Check that the selected media item is a PDF.';\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Extraction failed';\r\n\t\t\tconsole.error('Sample extraction failed:', err);\r\n\t\t} finally {\r\n\t\t\tthis._extracting = false;\r\n\t\t}\r\n\t}\r\n\r\n\t#groupByPage(elements: ExtractionElement[]): Map<number, ExtractionElement[]> {\r\n\t\tconst groups = new Map<number, ExtractionElement[]>();\r\n\t\tfor (const el of elements) {\r\n\t\t\tconst existing = groups.get(el.page);\r\n\t\t\tif (existing) {\r\n\t\t\t\texisting.push(el);\r\n\t\t\t} else {\r\n\t\t\t\tgroups.set(el.page, [el]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn groups;\r\n\t}\r\n\r\n\t#toggleSelection(id: string) {\r\n\t\tconst next = new Set(this._selectedElements);\r\n\t\tif (next.has(id)) {\r\n\t\t\tnext.delete(id);\r\n\t\t} else {\r\n\t\t\tnext.add(id);\r\n\t\t}\r\n\t\tthis._selectedElements = next;\r\n\t}\r\n\r\n\t#clearSelection() {\r\n\t\tthis._selectedElements = new Set();\r\n\t}\r\n\r\n\tasync #onMapTo() {\r\n\t\tif (!this._config || this._selectedElements.size === 0) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_DESTINATION_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tdestination: this._config.destination,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst result = await modal.onSubmit().catch(() => null);\r\n\t\tif (!result?.selectedTargets?.length || !this._workflowName) return;\r\n\r\n\t\t// Create a mapping for each selected source element\r\n\t\tconst existingMappings = this._config.map.mappings ?? [];\r\n\t\tconst newMappings = [...existingMappings];\r\n\t\tconst addedCount = this._selectedElements.size;\r\n\t\tfor (const sourceId of this._selectedElements) {\r\n\t\t\tnewMappings.push({\r\n\t\t\t\tsource: sourceId,\r\n\t\t\t\tdestinations: result.selectedTargets.map((target: string) => ({ target })),\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst updatedMap = { ...this._config.map, mappings: newMappings };\r\n\t\tconst saved = await saveMapConfig(this._workflowName, updatedMap, this.#token);\r\n\t\tif (saved) {\r\n\t\t\tthis._config = { ...this._config, map: updatedMap };\r\n\t\t\tthis._selectedElements = new Set();\r\n\t\t\tthis._successMessage = `${addedCount} mapping${addedCount !== 1 ? 's' : ''} created`;\r\n\t\t\tsetTimeout(() => { this._successMessage = null; }, 3000);\r\n\t\t}\r\n\t}\r\n\r\n\t#renderToolbar() {\r\n\t\tconst count = this._selectedElements.size;\r\n\t\tif (count === 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"selection-toolbar\">\r\n\t\t\t\t<span class=\"selection-count\">${count} selected</span>\r\n\t\t\t\t<uui-button look=\"primary\" compact label=\"Map to...\" @click=${this.#onMapTo}>\r\n\t\t\t\t\t<uui-icon name=\"icon-nodes\"></uui-icon>\r\n\t\t\t\t\tMap to...\r\n\t\t\t\t</uui-button>\r\n\t\t\t\t<uui-button look=\"secondary\" compact label=\"Clear\" @click=${this.#clearSelection}>\r\n\t\t\t\t\tClear\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#getMappedTargets(elementId: string): string[] {\r\n\t\tif (!this._config?.map?.mappings) return [];\r\n\t\tconst targets: string[] = [];\r\n\t\tfor (const mapping of this._config.map.mappings) {\r\n\t\t\tif (mapping.source === elementId && mapping.enabled) {\r\n\t\t\t\tfor (const dest of mapping.destinations) {\r\n\t\t\t\t\ttargets.push(dest.target);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn targets;\r\n\t}\r\n\r\n\t#resolveTargetLabel(alias: string): string {\r\n\t\tif (!this._config?.destination) return alias;\r\n\t\tconst field = this._config.destination.fields.find((f: any) => f.alias === alias);\r\n\t\tif (field) return field.label;\r\n\t\tif (this._config.destination.blockGrids) {\r\n\t\t\tfor (const grid of this._config.destination.blockGrids) {\r\n\t\t\t\tfor (const block of grid.blocks) {\r\n\t\t\t\t\tconst prop = block.properties?.find((p: any) => p.alias === alias);\r\n\t\t\t\t\tif (prop) return `${block.label} > ${prop.label || prop.alias}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn alias;\r\n\t}\r\n\r\n\t#renderElement(element: ExtractionElement) {\r\n\t\tconst meta = element.metadata;\r\n\t\tconst checked = this._selectedElements.has(element.id);\r\n\t\tconst mappedTargets = this.#getMappedTargets(element.id);\r\n\t\tconst isMapped = mappedTargets.length > 0;\r\n\t\treturn html`\r\n\t\t\t<div class=\"element-item ${checked ? 'element-selected' : ''} ${isMapped ? 'element-mapped' : ''}\">\r\n\t\t\t\t<uui-checkbox\r\n\t\t\t\t\tlabel=\"Select for mapping\"\r\n\t\t\t\t\t?checked=${checked}\r\n\t\t\t\t\t@change=${() => this.#toggleSelection(element.id)}\r\n\t\t\t\t\tclass=\"element-checkbox\">\r\n\t\t\t\t</uui-checkbox>\r\n\t\t\t\t<div class=\"element-content\" @click=${() => this.#toggleSelection(element.id)}>\r\n\t\t\t\t\t<div class=\"element-text\">${element.text}</div>\r\n\t\t\t\t\t<div class=\"element-meta\">\r\n\t\t\t\t\t\t<span class=\"meta-badge font-size\">${meta.fontSize}pt</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge font-name\">${meta.fontName}</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge color\" style=\"border-left: 3px solid ${meta.color};\">${meta.color}</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge position\">x:${meta.position.x} y:${meta.position.y}</span>\r\n\t\t\t\t\t\t${mappedTargets.map((t) => html`<span class=\"meta-badge mapped-target\"><uui-icon name=\"icon-arrow-right\" style=\"font-size: 10px;\"></uui-icon> ${this.#resolveTargetLabel(t)}</span>`)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderPageGroup(pageNum: number, elements: ExtractionElement[]) {\r\n\t\treturn html`\r\n\t\t\t<uui-box headline=\"Page ${pageNum}\" class=\"page-box\">\r\n\t\t\t\t<div class=\"element-list\">\r\n\t\t\t\t\t${elements.map((el) => this.#renderElement(el))}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"page-summary\">${elements.length} element${elements.length !== 1 ? 's' : ''}</div>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderExtraction() {\r\n\t\tif (!this._extraction) return nothing;\r\n\r\n\t\tconst grouped = this.#groupByPage(this._extraction.elements);\r\n\t\tconst pages = Array.from(grouped.entries()).sort(([a], [b]) => a - b);\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"extraction-header\">\r\n\t\t\t\t<div class=\"extraction-info\">\r\n\t\t\t\t\t<span class=\"info-label\">Source:</span>\r\n\t\t\t\t\t<span>${this._extraction.source.fileName}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"extraction-info\">\r\n\t\t\t\t\t<span class=\"info-label\">Pages:</span>\r\n\t\t\t\t\t<span>${this._extraction.source.totalPages}</span>\r\n\t\t\t\t\t<span class=\"info-label\" style=\"margin-left: var(--uui-size-space-4);\">Elements:</span>\r\n\t\t\t\t\t<span>${this._extraction.elements.length}</span>\r\n\t\t\t\t\t<span class=\"info-label\" style=\"margin-left: var(--uui-size-space-4);\">Extracted:</span>\r\n\t\t\t\t\t<span>${new Date(this._extraction.source.extractedDate).toLocaleString()}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<uui-button look=\"secondary\" label=\"Re-extract\" @click=${this.#onPickMedia} ?disabled=${this._extracting}>\r\n\t\t\t\t\t<uui-icon name=\"icon-refresh\"></uui-icon>\r\n\t\t\t\t\tRe-extract\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\r\n\t\t\t${this.#renderToolbar()}\r\n\t\t\t${pages.map(([pageNum, elements]) => this.#renderPageGroup(pageNum, elements))}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderEmpty() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t<uui-icon name=\"icon-document\" style=\"font-size: 48px; color: var(--uui-color-text-alt);\"></uui-icon>\r\n\t\t\t\t<h3>No sample extraction</h3>\r\n\t\t\t\t<p>Upload a PDF to extract all text elements with their metadata.</p>\r\n\t\t\t\t<uui-button look=\"primary\" label=\"Upload PDF\" @click=${this.#onPickMedia} ?disabled=${this._extracting}>\r\n\t\t\t\t\t${this._extracting ? html`<uui-loader-bar></uui-loader-bar>` : 'Upload PDF'}\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<div class=\"loading\"><uui-loader-bar></uui-loader-bar></div>`;\r\n\t\t}\r\n\r\n\t\tif (this._error) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t\t<p style=\"color: var(--uui-color-danger); padding: var(--uui-size-layout-1);\">${this._error}</p>\r\n\t\t\t\t</umb-body-layout>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t${this._successMessage ? html`<div class=\"success-banner\"><uui-icon name=\"icon-check\"></uui-icon> ${this._successMessage}</div>` : nothing}\r\n\t\t\t\t${this._extraction ? this.#renderExtraction() : this.#renderEmpty()}\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.loading {\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.success-banner {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\r\n\t\t\t/* Empty state */\r\n\t\t\t.empty-state {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tpadding: var(--uui-size-layout-2);\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tmin-height: 300px;\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state h3 {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state p {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Extraction header */\r\n\t\t\t.extraction-header {\r\n\t\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.extraction-info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\r\n\t\t\t.info-label {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Page groups */\r\n\t\t\t.page-box {\r\n\t\t\t\tmargin: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.element-list {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t/* Selection toolbar */\r\n\t\t\t.selection-toolbar {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-selected);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tposition: sticky;\r\n\t\t\t\ttop: 0;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.selection-count {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.element-item {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: flex-start;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.element-item:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.element-item.element-selected {\r\n\t\t\t\tbackground: var(--uui-color-selected);\r\n\t\t\t}\r\n\r\n\t\t\t.element-item:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t.element-checkbox {\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t\tmargin-top: 2px;\r\n\t\t\t}\r\n\r\n\t\t\t.element-content {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.element-text {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-2);\r\n\t\t\t\tword-break: break-word;\r\n\t\t\t\twhite-space: pre-wrap;\r\n\t\t\t}\r\n\r\n\t\t\t.element-meta {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tpadding: 1px 6px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.font-size {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.mapped-target {\r\n\t\t\t\tbackground: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t\tdisplay: inline-flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: 3px;\r\n\t\t\t}\r\n\r\n\t\t\t.element-item.element-mapped {\r\n\t\t\t\tborder-left: 3px solid var(--uui-color-positive-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t.page-summary {\r\n\t\t\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-4);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\ttext-align: right;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocWorkflowSourceViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-workflow-source-view': UpDocWorkflowSourceViewElement;\r\n\t}\r\n}\r\n"],"names":["UMB_DESTINATION_PICKER_MODAL","UmbModalToken","_token","_UpDocWorkflowSourceViewElement_instances","loadData_fn","onPickMedia_fn","groupByPage_fn","toggleSelection_fn","clearSelection_fn","onMapTo_fn","renderToolbar_fn","getMappedTargets_fn","resolveTargetLabel_fn","renderElement_fn","renderPageGroup_fn","renderExtraction_fn","renderEmpty_fn","UpDocWorkflowSourceViewElement","UmbLitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","context","unique","__privateMethod","html","nothing","authContext","UMB_AUTH_CONTEXT","__privateSet","extraction","config","fetchSampleExtraction","__privateGet","fetchWorkflowByName","err","result","UMB_MODAL_MANAGER_CONTEXT","UMB_MEDIA_PICKER_MODAL","_a","mediaKey","token","triggerSampleExtraction","elements","groups","el","existing","id","next","newMappings","addedCount","sourceId","target","updatedMap","saveMapConfig","count","elementId","_b","targets","mapping","dest","alias","field","f","grid","block","prop","p","element","meta","checked","mappedTargets","isMapped","t","pageNum","grouped","pages","a","b","UmbTextStyles","css","__decorateClass","state","customElement","UpDocWorkflowSourceViewElement_default"],"mappings":"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"}