{"version":3,"file":"page-picker-modal.element-Frt23MRc.js","sources":["../src/page-picker-modal.element.ts"],"sourcesContent":["import type { PagePickerModalData, PagePickerModalValue } from './page-picker-modal.token.js';\r\nimport './up-doc-pdf-thumbnail.element.js';\r\nimport { html, css, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\n\r\n@customElement('up-doc-page-picker-modal')\r\nexport class UpDocPagePickerModalElement extends UmbModalBaseElement<PagePickerModalData, PagePickerModalValue> {\r\n\t@state() private _selected = new Set<number>();\r\n\t@state() private _token = '';\r\n\r\n\toverride async firstUpdated() {\r\n\t\t// Get auth token for PDF thumbnail rendering\r\n\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\tthis._token = await authContext.getLatestToken();\r\n\r\n\t\t// Initialize selection: if selectedPages is null, all pages are selected\r\n\t\tconst totalPages = this.data?.totalPages ?? 0;\r\n\t\tconst selectedPages = this.data?.selectedPages;\r\n\r\n\t\tif (selectedPages && selectedPages.length > 0) {\r\n\t\t\tthis._selected = new Set(selectedPages);\r\n\t\t} else {\r\n\t\t\t// All pages selected\r\n\t\t\tthis._selected = new Set(Array.from({ length: totalPages }, (_, i) => i + 1));\r\n\t\t}\r\n\t}\r\n\r\n\tget #totalPages(): number {\r\n\t\treturn this.data?.totalPages ?? 0;\r\n\t}\r\n\r\n\tget #allSelected(): boolean {\r\n\t\treturn this._selected.size === this.#totalPages;\r\n\t}\r\n\r\n\tget #noneSelected(): boolean {\r\n\t\treturn this._selected.size === 0;\r\n\t}\r\n\r\n\t#onSelected(page: number) {\r\n\t\tconst next = new Set(this._selected);\r\n\t\tnext.add(page);\r\n\t\tthis._selected = next;\r\n\t}\r\n\r\n\t#onDeselected(page: number) {\r\n\t\tconst next = new Set(this._selected);\r\n\t\tnext.delete(page);\r\n\t\tthis._selected = next;\r\n\t}\r\n\r\n\t#selectAll() {\r\n\t\tthis._selected = new Set(Array.from({ length: this.#totalPages }, (_, i) => i + 1));\r\n\t}\r\n\r\n\t#deselectAll() {\r\n\t\tthis._selected = new Set();\r\n\t}\r\n\r\n\t#onConfirm() {\r\n\t\t// If all pages selected, return null (meaning \"all\")\r\n\t\tconst selectedArray = [...this._selected].sort((a, b) => a - b);\r\n\t\tthis.value = {\r\n\t\t\tselectedPages: selectedArray.length === this.#totalPages ? null : selectedArray,\r\n\t\t};\r\n\t\tthis.modalContext?.submit();\r\n\t}\r\n\r\n\t#onCancel() {\r\n\t\tthis.modalContext?.reject();\r\n\t}\r\n\r\n\t#renderPageCard(page: number) {\r\n\t\tconst isSelected = this._selected.has(page);\r\n\t\treturn html`\r\n\t\t\t<uui-card-media\r\n\t\t\t\tname=\"Page ${page}\"\r\n\t\t\t\tselectable\r\n\t\t\t\tselect-only\r\n\t\t\t\t?selected=${isSelected}\r\n\t\t\t\t@selected=${() => this.#onSelected(page)}\r\n\t\t\t\t@deselected=${() => this.#onDeselected(page)}>\r\n\t\t\t\t<up-doc-pdf-thumbnail\r\n\t\t\t\t\tmediaKey=${this.data?.mediaKey ?? ''}\r\n\t\t\t\t\tpage=${page}\r\n\t\t\t\t\twidth=${200}\r\n\t\t\t\t\ttoken=${this._token}>\r\n\t\t\t\t</up-doc-pdf-thumbnail>\r\n\t\t\t</uui-card-media>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tconst pages = Array.from({ length: this.#totalPages }, (_, i) => i + 1);\r\n\t\tconst selectedCount = this._selected.size;\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=\"Select pages to include\">\r\n\t\t\t\t<div slot=\"header\" class=\"toolbar\">\r\n\t\t\t\t\t<span class=\"selection-count\">${selectedCount} of ${this.#totalPages} pages selected</span>\r\n\t\t\t\t\t<span class=\"toolbar-spacer\"></span>\r\n\t\t\t\t\t${this.#allSelected\r\n\t\t\t\t\t\t? html`<uui-button look=\"outline\" compact label=\"Deselect all\" @click=${this.#deselectAll}>Deselect all</uui-button>`\r\n\t\t\t\t\t\t: html`<uui-button look=\"outline\" compact label=\"Select all\" @click=${this.#selectAll}>Select all</uui-button>`}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"page-grid\">\r\n\t\t\t\t\t${pages.map((page) => this.#renderPageCard(page))}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=\"Cancel\" @click=${this.#onCancel}>Cancel</uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\tlabel=\"Confirm\"\r\n\t\t\t\t\t\t@click=${this.#onConfirm}\r\n\t\t\t\t\t\t?disabled=${this.#noneSelected}>\r\n\t\t\t\t\t\t${this.#allSelected\r\n\t\t\t\t\t\t\t? 'Include all pages'\r\n\t\t\t\t\t\t\t: `Include ${selectedCount} page${selectedCount !== 1 ? 's' : ''}`}\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.toolbar {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-5);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.toolbar-spacer {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.selection-count {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.page-grid {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgrid-template-columns: repeat(4, 1fr);\r\n\t\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\t\tpadding: var(--uui-size-space-5);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocPagePickerModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-page-picker-modal': UpDocPagePickerModalElement;\r\n\t}\r\n}\r\n"],"names":["_UpDocPagePickerModalElement_instances","totalPages_get","allSelected_get","noneSelected_get","onSelected_fn","onDeselected_fn","selectAll_fn","deselectAll_fn","onConfirm_fn","onCancel_fn","renderPageCard_fn","UpDocPagePickerModalElement","UmbModalBaseElement","__privateAdd","authContext","UMB_AUTH_CONTEXT","totalPages","selectedPages","_","i","pages","__privateGet","selectedCount","html","__privateMethod","page","next","selectedArray","a","b","isSelected","UmbTextStyles","css","__decorateClass","state","customElement","UpDocPagePickerModalElement_default"],"mappings":"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"}