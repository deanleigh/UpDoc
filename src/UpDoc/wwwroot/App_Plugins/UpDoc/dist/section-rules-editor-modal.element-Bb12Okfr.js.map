{"version":3,"file":"section-rules-editor-modal.element-Bb12Okfr.js","sources":["../src/workflow.types.ts","../src/rule-card-styles.ts","../src/sortable-rules-container.element.ts","../src/section-rules-editor-modal.element.ts"],"sourcesContent":["// ============================================================================\r\n// Source Config Types (source.json)\r\n// ============================================================================\r\n\r\nexport interface SourceConfig {\r\n\tversion: string;\r\n\tsourceTypes: string[];\r\n\tglobals?: SourceGlobals;\r\n\t/** Top-level page selection: \"all\" or array of page numbers. */\r\n\tpages?: number[] | 'all';\r\n\tsections: SourceSection[];\r\n\t/** Legacy: rules keyed by section ID. Superseded by areaRules. */\r\n\tsectionRules?: Record<string, SectionRuleSet>;\r\n\t/** Rules for breaking area elements into individually-mappable sections, keyed by area name in kebab-case.\r\n\t * Supports both old flat format { rules: [...] } and new grouped format { groups: [...], rules: [...] }. */\r\n\tareaRules?: Record<string, AreaRules>;\r\n}\r\n\r\n// ============================================================================\r\n// Section Rules Types (stored in source.json under sectionRules)\r\n// ============================================================================\r\n\r\n/** Legacy flat rule set — kept for backward-compatible deserialization of sectionRules. */\r\nexport interface SectionRuleSet {\r\n\trules: SectionRule[];\r\n}\r\n\r\n// ============================================================================\r\n// v3 Area Rules Types (groups + ungrouped)\r\n// ============================================================================\r\n\r\n/** Which slot a rule fills within a group. Title triggers section boundaries. */\r\nexport type RulePart = 'title' | 'content' | 'description' | 'summary';\r\n\r\n/** Top-level container for an area's rules. Groups contain multi-part sections; ungrouped rules are single properties. */\r\nexport interface AreaRules {\r\n\tgroups: RuleGroup[];\r\n\trules: SectionRule[];  // Ungrouped\r\n}\r\n\r\n/** A named group of rules representing a multi-part section (e.g., \"Tour Detail\" with title + content). */\r\nexport interface RuleGroup {\r\n\tname: string;\r\n\trules: SectionRule[];\r\n}\r\n\r\n/** Legacy action names — kept for backward compat deserialization */\r\nexport type RuleAction = 'singleProperty' | 'sectionTitle' | 'sectionContent' | 'sectionDescription' | 'sectionSummary' | 'exclude';\r\nexport type LegacyRuleAction = 'createSection' | 'setAsHeading' | 'addAsContent' | 'addAsList';\r\n\r\n/**\r\n * Block-level Markdown format.\r\n * Determines what Markdown syntax the matched content produces.\r\n */\r\nexport type BlockFormat =\r\n\t| 'auto'\r\n\t| 'paragraph'\r\n\t| 'heading1' | 'heading2' | 'heading3'\r\n\t| 'heading4' | 'heading5' | 'heading6'\r\n\t| 'bulletListItem' | 'numberedListItem'\r\n\t| 'quote';\r\n\r\n/** Legacy alias — kept for backward compat */\r\nexport type RuleContentFormat = BlockFormat;\r\n\r\n/** Format entry types — Block (block-level Markdown) or Style (inline Markdown) */\r\nexport type FormatEntryType = 'block' | 'style';\r\n\r\n/** Block-level format values — each maps to a Markdown block element */\r\nexport type BlockFormatValue =\r\n\t| 'auto'\r\n\t| 'paragraph'\r\n\t| 'heading1' | 'heading2' | 'heading3'\r\n\t| 'heading4' | 'heading5' | 'heading6'\r\n\t| 'bulletListItem' | 'numberedListItem'\r\n\t| 'quote';\r\n\r\n/** Inline style format values — each wraps text in Markdown inline syntax */\r\nexport type StyleFormatValue = 'bold' | 'italic' | 'strikethrough' | 'code' | 'highlight';\r\n\r\n/** A single format entry — either a block format or an inline style */\r\nexport interface FormatEntry {\r\n\ttype: FormatEntryType;\r\n\tvalue: BlockFormatValue | StyleFormatValue;\r\n}\r\n\r\nexport interface SectionRule {\r\n\trole: string;\r\n\t/** v3: which slot this rule fills. */\r\n\tpart?: RulePart;\r\n\t/** Legacy: action name. When part is set, action is ignored. */\r\n\taction?: RuleAction | LegacyRuleAction;\r\n\t/** Block format: auto, paragraph, heading1-6, etc. */\r\n\tformat?: BlockFormat;\r\n\t/** Array of format entries (Block + Style rows). */\r\n\tformats?: FormatEntry[];\r\n\t/** When true, matched elements are skipped entirely. */\r\n\texclude?: boolean;\r\n\tconditions: RuleCondition[];\r\n\t/** UNLESS conditions — if any single exception matches, the rule does not apply. */\r\n\texceptions?: RuleCondition[];\r\n\t/** Transient: unique ID for drag-and-drop tracking. Not persisted. */\r\n\t_id?: string;\r\n}\r\n\r\n/** Get the effective part for a rule, normalizing from legacy action if needed. */\r\nexport function getEffectivePart(rule: SectionRule): RulePart | 'exclude' {\r\n\tif (rule.exclude) return 'exclude';\r\n\tif (rule.part) return rule.part;\r\n\r\n\t// Normalize from legacy action\r\n\tswitch (rule.action) {\r\n\t\tcase 'singleProperty':\r\n\t\tcase 'sectionProperty':\r\n\t\tcase 'sectionContent':\r\n\t\tcase 'addAsContent':\r\n\t\tcase 'addAsList':\r\n\t\t\treturn 'content';\r\n\t\tcase 'sectionTitle':\r\n\t\tcase 'createSection':\r\n\t\tcase 'setAsHeading':\r\n\t\t\treturn 'title';\r\n\t\tcase 'sectionDescription':\r\n\t\t\treturn 'description';\r\n\t\tcase 'sectionSummary':\r\n\t\t\treturn 'summary';\r\n\t\tcase 'exclude':\r\n\t\t\treturn 'exclude';\r\n\t\tdefault:\r\n\t\t\treturn 'content';\r\n\t}\r\n}\r\n\r\n/** Get the effective block format for a rule. */\r\nexport function getEffectiveFormat(rule: SectionRule): BlockFormat {\r\n\tif (rule.format) return rule.format;\r\n\tif (rule.action === 'addAsList') return 'bulletListItem';\r\n\treturn 'auto';\r\n}\r\n\r\n/** Legacy normalize helper — kept for backward compat. Prefer getEffectivePart/getEffectiveFormat. */\r\nexport function normalizeAction(action: string, format?: RuleContentFormat): [RuleAction, RuleContentFormat | undefined] {\r\n\tswitch (action) {\r\n\t\tcase 'createSection':\r\n\t\tcase 'setAsHeading':\r\n\t\t\treturn ['sectionTitle', undefined];\r\n\t\tcase 'addAsContent':\r\n\t\t\treturn ['sectionContent', format ?? 'paragraph'];\r\n\t\tcase 'addAsList':\r\n\t\t\treturn ['sectionContent', format ?? 'bulletListItem'];\r\n\t\tcase 'singleProperty':\r\n\t\tcase 'sectionProperty':\r\n\t\t\treturn ['singleProperty', format ?? 'paragraph'];\r\n\t\tcase 'sectionTitle':\r\n\t\t\treturn ['sectionTitle', undefined];\r\n\t\tcase 'sectionContent':\r\n\t\t\treturn ['sectionContent', format ?? 'paragraph'];\r\n\t\tcase 'exclude':\r\n\t\t\treturn ['exclude', undefined];\r\n\t\tdefault:\r\n\t\t\treturn ['sectionContent', format ?? 'paragraph'];\r\n\t}\r\n}\r\n\r\n/**\r\n * Convert a legacy SectionRuleSet (flat rules) to AreaRules.\r\n * All rules go into the ungrouped array; groups is empty.\r\n */\r\nexport function toAreaRules(ruleSet: SectionRuleSet | AreaRules): AreaRules {\r\n\t// Already an AreaRules (has groups property)\r\n\tif ('groups' in ruleSet && Array.isArray(ruleSet.groups)) {\r\n\t\treturn ruleSet as AreaRules;\r\n\t}\r\n\t// Legacy SectionRuleSet — wrap\r\n\treturn { groups: [], rules: (ruleSet as SectionRuleSet).rules };\r\n}\r\n\r\n/** Get all rules from an AreaRules in order: grouped first, then ungrouped. */\r\nexport function allRules(areaRules: AreaRules): SectionRule[] {\r\n\tconst result: SectionRule[] = [];\r\n\tfor (const group of areaRules.groups) {\r\n\t\tresult.push(...group.rules);\r\n\t}\r\n\tresult.push(...areaRules.rules);\r\n\treturn result;\r\n}\r\n\r\nexport interface RuleCondition {\r\n\ttype: RuleConditionType;\r\n\tvalue?: string | number;\r\n}\r\n\r\nexport type RuleConditionType =\r\n\t| 'textBeginsWith'\r\n\t| 'textEndsWith'\r\n\t| 'textContains'\r\n\t| 'textEquals'\r\n\t| 'textMatchesPattern'\r\n\t| 'fontSizeEquals'\r\n\t| 'fontSizeAbove'\r\n\t| 'fontSizeBelow'\r\n\t| 'fontNameContains'\r\n\t| 'fontNameEquals'\r\n\t| 'colorEquals'\r\n\t| 'positionFirst'\r\n\t| 'positionLast';\r\n\r\n/**\r\n * Pattern for identifying section heading elements within an area.\r\n * Null/undefined = auto-detect (bodySize * 1.15).\r\n * Empty conditions = flat section (no grouping).\r\n * Populated conditions = user-defined from teach-by-example.\r\n */\r\nexport interface SectionPattern {\r\n\tconditions: RuleCondition[];\r\n}\r\n\r\nexport interface SourceGlobals {\r\n\tcolumnDetection?: ColumnDetectionConfig;\r\n\tpageRange?: PageRangeConfig;\r\n}\r\n\r\nexport interface ColumnDetectionConfig {\r\n\tenabled: boolean;\r\n\tthresholdPercent: number;\r\n}\r\n\r\nexport interface PageRangeConfig {\r\n\tstart: number;\r\n\tend: number | 'last';\r\n}\r\n\r\nexport interface SourceSection {\r\n\tkey: string;\r\n\tlabel: string;\r\n\tdescription?: string;\r\n\tstrategy: ExtractionStrategy;\r\n\toutputFormat: 'text' | 'markdown' | 'html';\r\n\trequired?: boolean;\r\n\tpages?: number[] | 'all';\r\n\tcolumnFilter?: boolean;\r\n\toccurrence?: 'first' | 'last' | 'all';\r\n\tstrategyParams?: StrategyParams;\r\n}\r\n\r\nexport type ExtractionStrategy =\r\n\t| 'largestFont'\r\n\t| 'regex'\r\n\t| 'betweenPatterns'\r\n\t| 'region'\r\n\t| 'afterLabel'\r\n\t| 'firstHeading'\r\n\t| 'firstParagraph'\r\n\t| 'cssSelector'\r\n\t| 'xpath';\r\n\r\nexport interface StrategyParams {\r\n\t// largestFont\r\n\tfontSizeThreshold?: number;\r\n\r\n\t// regex\r\n\tpattern?: string;\r\n\tflags?: string;\r\n\tcaptureGroup?: number;\r\n\r\n\t// betweenPatterns\r\n\tstartPattern?: string;\r\n\tstopPatterns?: string[];\r\n\tincludeStartLine?: boolean;\r\n\theadingLevel?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6';\r\n\r\n\t// region\r\n\tregion?: RegionConfig;\r\n\r\n\t// firstHeading (markdown)\r\n\tlevel?: number;\r\n\r\n\t// afterLabel\r\n\tlabel?: string;\r\n\tlabelPattern?: string;\r\n\textractMode?: 'sameLine' | 'nextLine' | 'untilBlank';\r\n\r\n\t// cssSelector (web)\r\n\tselector?: string;\r\n\tattribute?: string;\r\n\r\n\t// xpath (web/Word)\r\n\txpath?: string;\r\n}\r\n\r\nexport interface RegionConfig {\r\n\tx?: { min?: number; max?: number };\r\n\ty?: { min?: number; max?: number };\r\n\tunit?: 'percent' | 'points';\r\n}\r\n\r\n// ============================================================================\r\n// Destination Config Types (destination.json)\r\n// ============================================================================\r\n\r\nexport interface DestinationConfig {\r\n\tversion: string;\r\n\tdocumentTypeAlias: string;\r\n\tdocumentTypeName?: string;\r\n\tblueprintId?: string;\r\n\tblueprintName?: string;\r\n\tfields: DestinationField[];\r\n\tblockGrids?: DestinationBlockGrid[];\r\n}\r\n\r\nexport interface DestinationField {\r\n\tkey: string;\r\n\talias: string;\r\n\tlabel: string;\r\n\tdescription?: string;\r\n\ttype: FieldType;\r\n\ttab?: string;\r\n\tmandatory?: boolean;\r\n\tacceptsFormats?: ContentFormat[];\r\n}\r\n\r\nexport type FieldType =\r\n\t| 'text'\r\n\t| 'textArea'\r\n\t| 'richText'\r\n\t| 'number'\r\n\t| 'date'\r\n\t| 'boolean'\r\n\t| 'mediaPicker'\r\n\t| 'contentPicker'\r\n\t| 'blockGrid'\r\n\t| 'blockList';\r\n\r\nexport type ContentFormat = 'text' | 'markdown' | 'html';\r\n\r\nexport interface DestinationBlockGrid {\r\n\tkey: string;\r\n\talias: string;\r\n\tlabel: string;\r\n\tdescription?: string;\r\n\tblocks: DestinationBlock[];\r\n}\r\n\r\nexport interface DestinationBlock {\r\n\tkey: string;\r\n\tcontentTypeAlias: string;\r\n\tcontentTypeKey?: string;\r\n\tlabel: string;\r\n\tdescription?: string;\r\n\tidentifyBy?: BlockIdentifier;\r\n\tproperties?: BlockProperty[];\r\n}\r\n\r\nexport interface BlockIdentifier {\r\n\tproperty: string;\r\n\tvalue: string;\r\n}\r\n\r\nexport interface BlockProperty {\r\n\tkey: string;\r\n\talias: string;\r\n\tlabel?: string;\r\n\ttype: FieldType;\r\n\tacceptsFormats?: ContentFormat[];\r\n}\r\n\r\n// ============================================================================\r\n// Map Config Types (map.json)\r\n// ============================================================================\r\n\r\nexport interface MapConfig {\r\n\tversion: string;\r\n\tname?: string;\r\n\tdescription?: string;\r\n\tmappings: SectionMapping[];\r\n}\r\n\r\nexport interface SectionMapping {\r\n\tsource: string;\r\n\tdestinations: MappingDestination[];\r\n\tenabled?: boolean;\r\n\tcomment?: string;\r\n}\r\n\r\nexport interface MappingDestination {\r\n\ttarget: string;\r\n\tblockKey?: string;\r\n\ttransforms?: MappingTransform[];\r\n}\r\n\r\nexport interface MappingTransform {\r\n\ttype: TransformType;\r\n\tparams?: TransformParams;\r\n}\r\n\r\nexport type TransformType =\r\n\t| 'convertMarkdownToHtml'\r\n\t| 'convertHtmlToMarkdown'\r\n\t| 'truncate'\r\n\t| 'template'\r\n\t| 'regex'\r\n\t| 'trim'\r\n\t| 'uppercase'\r\n\t| 'lowercase'\r\n\t| 'stripHtml';\r\n\r\nexport interface TransformParams {\r\n\tmaxLength?: number;\r\n\tsuffix?: string;\r\n\ttemplate?: string;\r\n\tpattern?: string;\r\n\treplacement?: string;\r\n}\r\n\r\n// ============================================================================\r\n// Combined Document Type Config\r\n// ============================================================================\r\n\r\nexport interface DocumentTypeConfig {\r\n\tfolderPath: string;\r\n\tdocumentTypeAlias: string;\r\n\tsources: Record<string, SourceConfig>;\r\n\tdestination: DestinationConfig;\r\n\tmap: MapConfig;\r\n}\r\n\r\n// ============================================================================\r\n// Rich Extraction Types (sample-extraction.json)\r\n// ============================================================================\r\n\r\nexport interface RichExtractionResult {\r\n\tversion: string;\r\n\tsourceType: string;\r\n\tsource: ExtractionSource;\r\n\telements: ExtractionElement[];\r\n}\r\n\r\nexport interface ExtractionSource {\r\n\tfileName: string;\r\n\tmediaKey: string;\r\n\textractedDate: string;\r\n\ttotalPages: number;\r\n\t/** Which pages were extracted. Null/undefined = all pages. */\r\n\textractedPages?: number[] | null;\r\n}\r\n\r\nexport interface ExtractionElement {\r\n\tid: string;\r\n\tpage: number;\r\n\ttext: string;\r\n\tmetadata: ElementMetadata;\r\n}\r\n\r\nexport interface ElementMetadata {\r\n\tfontSize: number;\r\n\tfontName: string;\r\n\tposition: { x: number; y: number };\r\n\tboundingBox: { left: number; top: number; width: number; height: number };\r\n\tcolor: string;\r\n}\r\n\r\n// ============================================================================\r\n// Visual Grouping Types (frontend-only, computed from extraction metadata)\r\n// ============================================================================\r\n\r\nexport interface VisualGroup {\r\n\theading: ExtractionElement | null;\r\n\tchildren: ExtractionElement[];\r\n}\r\n\r\n// ============================================================================\r\n// Area Detection Types (area-detection.json — area-based hierarchical extraction)\r\n// ============================================================================\r\n\r\nexport interface AreaDetectionResult {\r\n\ttotalPages: number;\r\n\tpages: PageAreas[];\r\n\tdiagnostics: AreaDiagnosticInfo;\r\n}\r\n\r\nexport interface PageAreas {\r\n\tpage: number;\r\n\tareas: DetectedArea[];\r\n}\r\n\r\nexport interface DetectedArea {\r\n\tname?: string;\r\n\tcolor: string;\r\n\tboundingBox: { left: number; top: number; width: number; height: number };\r\n\tpage: number;\r\n\tsections: DetectedSection[];\r\n\ttotalElements: number;\r\n\tsectionPattern?: SectionPattern;\r\n}\r\n\r\nexport interface DetectedSection {\r\n\theading: AreaElement | null;\r\n\tchildren: AreaElement[];\r\n}\r\n\r\nexport interface AreaElement {\r\n\tid: string;\r\n\ttext: string;\r\n\tfontSize: number;\r\n\tfontName: string;\r\n\tcolor: string;\r\n\tboundingBox: { left: number; top: number; width: number; height: number };\r\n}\r\n\r\nexport interface AreaDiagnosticInfo {\r\n\ttotalPathsFound: number;\r\n\tpathsAfterFiltering: number;\r\n\tareasDetected: number;\r\n\telementsInAreas: number;\r\n}\r\n\r\n// ============================================================================\r\n// Transform Result Types (transform.json — assembled Markdown per section)\r\n// ============================================================================\r\n\r\nexport interface TransformResult {\r\n\tversion: string;\r\n\tsections: TransformedSection[];\r\n\tdiagnostics: TransformDiagnostics;\r\n}\r\n\r\nexport interface TransformedSection {\r\n\tid: string;\r\n\toriginalHeading: string | null;\r\n\theading: string | null;\r\n\tcontent: string;\r\n\t/** Assembled Markdown from sectionDescription elements. Null if none. */\r\n\tdescription?: string | null;\r\n\t/** Assembled Markdown from sectionSummary elements. Null if none. */\r\n\tsummary?: string | null;\r\n\tpattern: 'bulletList' | 'paragraph' | 'subHeaded' | 'preamble' | 'mixed' | 'role';\r\n\tpage: number;\r\n\tareaColor: string | null;\r\n\tareaName: string | null;\r\n\t/** Rule group name for grouped sections (e.g., \"Tour Details - Section\"). Null for ungrouped. */\r\n\tgroupName?: string | null;\r\n\tchildCount: number;\r\n\tincluded: boolean;\r\n}\r\n\r\nexport interface TransformDiagnostics {\r\n\ttotalSections: number;\r\n\tbulletListSections: number;\r\n\tparagraphSections: number;\r\n\tsubHeadedSections: number;\r\n\tpreambleSections: number;\r\n\troleSections: number;\r\n}\r\n\r\n// ============================================================================\r\n// Area Template Types (area-template.json — user-defined extraction areas)\r\n// ============================================================================\r\n\r\nexport interface AreaTemplate {\r\n\ttemplateName: string;\r\n\tsourceFile: string;\r\n\tpageSize: { width: number; height: number };\r\n\tcreatedAt: string;\r\n\tareas: AreaDefinition[];\r\n}\r\n\r\nexport interface AreaDefinition {\r\n\tname: string;\r\n\tproperty: string;\r\n\tpage: number;\r\n\ttype: string;\r\n\tbounds: AreaBounds;\r\n\tcolor: string;\r\n\tsectionPattern?: SectionPattern;\r\n\texpectedSections: string[];\r\n\tnotes: string;\r\n}\r\n\r\nexport interface AreaBounds {\r\n\tx: number;\r\n\ty: number;\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\n// ============================================================================\r\n// API Response Types\r\n// ============================================================================\r\n\r\nexport interface ExtractSectionsResponse {\r\n\tsections: Record<string, string>;\r\n\tconfig: DocumentTypeConfig;\r\n}\r\n\r\nexport interface InferSectionPatternResponse {\r\n\tpattern: SectionPattern;\r\n\tmatchingElementIds: string[];\r\n\tclickedElementId: string;\r\n\ttotalElements: number;\r\n}\r\n","import { css } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n/**\r\n * Shared styles for rule cards (collapsed rows + expanded cards).\r\n * Imported by both the section-rules-editor modal and the sortable-rules container\r\n * so styles apply across shadow DOM boundaries.\r\n */\r\nexport const ruleCardStyles = css`\r\n\t/* Collapsed rule row */\r\n\t.rule-row {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tgap: var(--uui-size-space-3);\r\n\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-4);\r\n\t\tborder: 1px solid var(--uui-color-border);\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\tcursor: pointer;\r\n\t\tuser-select: none;\r\n\t\tbackground: var(--uui-color-surface);\r\n\t\ttransition: background 120ms ease;\r\n\t}\r\n\r\n\t.rule-row:hover {\r\n\t\tbackground: var(--uui-color-surface-alt);\r\n\t}\r\n\r\n\t.rule-row-name {\r\n\t\tflex: 1;\r\n\t\tfont-size: var(--uui-type-default-size);\r\n\t\tfont-weight: 600;\r\n\t\tmin-width: 0;\r\n\t\toverflow: hidden;\r\n\t\ttext-overflow: ellipsis;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\r\n\t.rule-row-part {\r\n\t\tfont-size: 11px;\r\n\t\tfont-weight: 600;\r\n\t\tpadding: 1px 8px;\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\tbackground: var(--uui-color-surface-alt);\r\n\t\tcolor: var(--uui-color-text-alt);\r\n\t\tflex-shrink: 0;\r\n\t}\r\n\r\n\t.rule-row-part.excluded {\r\n\t\tbackground: color-mix(in srgb, var(--uui-color-danger) 15%, transparent);\r\n\t\tcolor: var(--uui-color-danger-standalone);\r\n\t}\r\n\r\n\t.rule-row-match {\r\n\t\tfont-size: 11px;\r\n\t\tfont-weight: 700;\r\n\t\tpadding: 1px 6px;\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\tflex-shrink: 0;\r\n\t}\r\n\r\n\t.rule-row-match.matched {\r\n\t\tbackground: color-mix(in srgb, var(--uui-color-positive) 15%, transparent);\r\n\t\tcolor: var(--uui-color-positive-standalone);\r\n\t}\r\n\r\n\t.rule-row-match.excluded {\r\n\t\tbackground: color-mix(in srgb, var(--uui-color-danger) 15%, transparent);\r\n\t\tcolor: var(--uui-color-danger-standalone);\r\n\t}\r\n\r\n\t.rule-row-match.no-match {\r\n\t\tbackground: color-mix(in srgb, var(--uui-color-warning) 15%, transparent);\r\n\t\tcolor: var(--uui-color-warning-standalone);\r\n\t}\r\n\r\n\t.rule-row-chevron {\r\n\t\tfont-size: 12px;\r\n\t\tcolor: var(--uui-color-text-alt);\r\n\t\tflex-shrink: 0;\r\n\t\ttransition: transform 120ms ease;\r\n\t}\r\n\r\n\t/* Action bar: hidden by default, appears on hover */\r\n\t.rule-row-actions {\r\n\t\tflex-shrink: 0;\r\n\t\topacity: 0;\r\n\t\ttransition: opacity 120ms ease;\r\n\t}\r\n\r\n\t.rule-row:hover .rule-row-actions {\r\n\t\topacity: 1;\r\n\t}\r\n\r\n\t/* Rule cards (expanded) */\r\n\t.rule-card {\r\n\t\tborder: 1px solid var(--uui-color-border);\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.rule-header {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tgap: var(--uui-size-space-3);\r\n\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\tbackground: var(--uui-color-surface-alt);\r\n\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t}\r\n\r\n\t.rule-grip {\r\n\t\tcursor: grab;\r\n\t\tcolor: var(--uui-color-text-alt);\r\n\t\tfont-size: 14px;\r\n\t\tuser-select: none;\r\n\t\tflex-shrink: 0;\r\n\t}\r\n\r\n\t.rule-grip:active {\r\n\t\tcursor: grabbing;\r\n\t}\r\n\r\n\t.role-name-input {\r\n\t\tflex: 1;\r\n\t\tpadding: var(--uui-size-space-1) var(--uui-size-space-2);\r\n\t\tborder: 1px solid var(--uui-color-border);\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\tfont-size: var(--uui-type-default-size);\r\n\t\tfont-family: monospace;\r\n\t\tbackground: var(--uui-color-surface);\r\n\t\tcolor: var(--uui-color-text);\r\n\t}\r\n\r\n\t.role-name-input:focus {\r\n\t\toutline: none;\r\n\t\tborder-color: var(--uui-color-focus);\r\n\t}\r\n\r\n\t/* Section headers within rule cards */\r\n\t.section-header {\r\n\t\tfont-size: 11px;\r\n\t\tfont-weight: 700;\r\n\t\ttext-transform: uppercase;\r\n\t\tletter-spacing: 0.5px;\r\n\t\tcolor: var(--uui-color-text-alt);\r\n\t\tmargin-bottom: var(--uui-size-space-1);\r\n\t}\r\n\r\n\t.section-header.collapsible {\r\n\t\tcursor: pointer;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tgap: var(--uui-size-space-1);\r\n\t\tuser-select: none;\r\n\t}\r\n\r\n\t.section-header.collapsible:hover {\r\n\t\tcolor: var(--uui-color-text);\r\n\t}\r\n\r\n\t.section-header.collapsible uui-icon {\r\n\t\tfont-size: 10px;\r\n\t}\r\n\r\n\t/* Conditions */\r\n\t.conditions-area {\r\n\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: var(--uui-size-space-2);\r\n\t}\r\n\r\n\t/* Exceptions */\r\n\t.exceptions-area {\r\n\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: var(--uui-size-space-2);\r\n\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t}\r\n\r\n\t.condition-row {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tgap: var(--uui-size-space-2);\r\n\t}\r\n\r\n\t.condition-type-select {\r\n\t\tmin-width: 180px;\r\n\t\tpadding: var(--uui-size-space-1) var(--uui-size-space-2);\r\n\t\tborder: 1px solid var(--uui-color-border);\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\tfont-size: var(--uui-type-small-size);\r\n\t\tbackground: var(--uui-color-surface);\r\n\t\tcolor: var(--uui-color-text);\r\n\t}\r\n\r\n\t.condition-type-select:focus {\r\n\t\toutline: none;\r\n\t\tborder-color: var(--uui-color-focus);\r\n\t}\r\n\r\n\t.condition-value-input {\r\n\t\tflex: 1;\r\n\t\tpadding: var(--uui-size-space-1) var(--uui-size-space-2);\r\n\t\tborder: 1px solid var(--uui-color-border);\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\tfont-size: var(--uui-type-small-size);\r\n\t\tfont-family: monospace;\r\n\t\tbackground: var(--uui-color-surface);\r\n\t\tcolor: var(--uui-color-text);\r\n\t}\r\n\r\n\t.condition-value-input:focus {\r\n\t\toutline: none;\r\n\t\tborder-color: var(--uui-color-focus);\r\n\t}\r\n\r\n\t/* Format row selects */\r\n\t.format-type-select {\r\n\t\tmin-width: 100px;\r\n\t\tpadding: var(--uui-size-space-1) var(--uui-size-space-2);\r\n\t\tborder: 1px solid var(--uui-color-border);\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\tfont-size: var(--uui-type-small-size);\r\n\t\tbackground: var(--uui-color-surface);\r\n\t\tcolor: var(--uui-color-text);\r\n\t}\r\n\r\n\t.format-type-select:focus {\r\n\t\toutline: none;\r\n\t\tborder-color: var(--uui-color-focus);\r\n\t}\r\n\r\n\t.format-value-select {\r\n\t\tflex: 1;\r\n\t\tpadding: var(--uui-size-space-1) var(--uui-size-space-2);\r\n\t\tborder: 1px solid var(--uui-color-border);\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\tfont-size: var(--uui-type-small-size);\r\n\t\tbackground: var(--uui-color-surface);\r\n\t\tcolor: var(--uui-color-text);\r\n\t}\r\n\r\n\t.format-value-select:focus {\r\n\t\toutline: none;\r\n\t\tborder-color: var(--uui-color-focus);\r\n\t}\r\n\r\n\t/* Part area */\r\n\t.part-area {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: var(--uui-size-space-2);\r\n\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t}\r\n\r\n\t.part-controls {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tgap: var(--uui-size-space-3);\r\n\t}\r\n\r\n\t.part-select {\r\n\t\tpadding: var(--uui-size-space-1) var(--uui-size-space-2);\r\n\t\tborder: 1px solid var(--uui-color-border);\r\n\t\tborder-radius: var(--uui-border-radius);\r\n\t\tfont-size: var(--uui-type-small-size);\r\n\t\tbackground: var(--uui-color-surface);\r\n\t\tcolor: var(--uui-color-text);\r\n\t}\r\n\r\n\t.part-select:focus {\r\n\t\toutline: none;\r\n\t\tborder-color: var(--uui-color-focus);\r\n\t}\r\n\r\n\t.part-select:disabled {\r\n\t\topacity: 0.5;\r\n\t}\r\n\r\n\t.exclude-label {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tgap: var(--uui-size-space-1);\r\n\t\tfont-size: var(--uui-type-small-size);\r\n\t\tcolor: var(--uui-color-text-alt);\r\n\t\tcursor: pointer;\r\n\t\tuser-select: none;\r\n\t}\r\n\r\n\t/* Format area */\r\n\t.format-area {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: var(--uui-size-space-2);\r\n\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t}\r\n\r\n\t/* Match preview */\r\n\t.match-preview {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tgap: var(--uui-size-space-2);\r\n\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-4);\r\n\t\tfont-size: var(--uui-type-small-size);\r\n\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t}\r\n\r\n\t.match-preview.matched {\r\n\t\tbackground: color-mix(in srgb, var(--uui-color-positive) 10%, transparent);\r\n\t\tcolor: var(--uui-color-positive-standalone);\r\n\t}\r\n\r\n\t.match-preview.excluded {\r\n\t\tbackground: color-mix(in srgb, var(--uui-color-danger) 10%, transparent);\r\n\t\tcolor: var(--uui-color-danger-standalone);\r\n\t}\r\n\r\n\t.match-preview.no-match {\r\n\t\tbackground: color-mix(in srgb, var(--uui-color-warning) 10%, transparent);\r\n\t\tcolor: var(--uui-color-warning-standalone);\r\n\t}\r\n\r\n\t.match-preview strong {\r\n\t\tfont-weight: 600;\r\n\t}\r\n`;\r\n","import { UmbSorterController } from '@umbraco-cms/backoffice/sorter';\r\nimport { html, css, nothing, repeat } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { ruleCardStyles } from './rule-card-styles.js';\r\n\r\n/**\r\n * Minimal interface for sortable rules — must have _id for unique identification.\r\n */\r\nexport interface SortableRule {\r\n\t_id: string;\r\n\t[key: string]: unknown;\r\n}\r\n\r\n/**\r\n * Event detail emitted on sort-change.\r\n */\r\nexport interface SortChangeDetail {\r\n\trules: SortableRule[];\r\n}\r\n\r\n/**\r\n * Lightweight container for sortable rules. One instance per group (+ one for ungrouped).\r\n * All instances share the same `identifier` so rules can be dragged between groups.\r\n *\r\n * Uses shadow DOM (required by UmbSorterController) with shared ruleCardStyles\r\n * so rendered rule cards are styled correctly.\r\n *\r\n * Uses `handleSelector` to restrict drag initiation to the grip element.\r\n * Uses `disabledItemSelector` to prevent expanded rules from being dragged.\r\n */\r\n@customElement('updoc-sortable-rules')\r\nexport class UpdocSortableRulesElement extends UmbLitElement {\r\n\t#sorter = new UmbSorterController<SortableRule, HTMLElement>(this, {\r\n\t\tgetUniqueOfElement: (el) => el.dataset.sortId ?? '',\r\n\t\tgetUniqueOfModel: (rule) => rule._id,\r\n\t\tidentifier: 'updoc-rules-sorter',\r\n\t\titemSelector: '.sortable-rule',\r\n\t\tcontainerSelector: '.rules-container',\r\n\t\thandleSelector: '.rule-grip',\r\n\t\tdisabledItemSelector: '[data-expanded]',\r\n\t\tplaceholderAttr: 'drag-placeholder',\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis._rules = model;\r\n\t\t\tthis.dispatchEvent(new CustomEvent<SortChangeDetail>('sort-change', {\r\n\t\t\t\tdetail: { rules: model },\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcomposed: true,\r\n\t\t\t}));\r\n\t\t},\r\n\t});\r\n\r\n\t@property({ attribute: false })\r\n\tset rules(val: SortableRule[]) {\r\n\t\tthis._rules = val;\r\n\t\tthis.#sorter.setModel(val);\r\n\t}\r\n\tget rules(): SortableRule[] { return this._rules; }\r\n\t@state() private _rules: SortableRule[] = [];\r\n\r\n\t/** Set of rule _ids that are currently expanded (and thus not draggable). */\r\n\t@property({ attribute: false })\r\n\texpandedIds: Set<string> = new Set();\r\n\r\n\t/** Render callback provided by the parent modal. */\r\n\t@property({ attribute: false })\r\n\trenderItem?: (rule: SortableRule) => unknown;\r\n\r\n\toverride render() {\r\n\t\tif (this._rules.length === 0 && !this.renderItem) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"rules-container\">\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._rules,\r\n\t\t\t\t\t(rule) => rule._id,\r\n\t\t\t\t\t(rule) => html`\r\n\t\t\t\t\t\t<div class=\"sortable-rule\"\r\n\t\t\t\t\t\t\tdata-sort-id=${rule._id}\r\n\t\t\t\t\t\t\t?data-expanded=${this.expandedIds.has(rule._id)}>\r\n\t\t\t\t\t\t\t${this.renderItem?.(rule) ?? html`<span>${rule._id}</span>`}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t`,\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\truleCardStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t}\r\n\r\n\t\t\t.rules-container {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-3, 12px);\r\n\t\t\t\tmin-height: 8px;\r\n\t\t\t}\r\n\r\n\t\t\t.sortable-rule[drag-placeholder] {\r\n\t\t\t\topacity: 0.2;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'updoc-sortable-rules': UpdocSortableRulesElement;\r\n\t}\r\n}\r\n","import type { SectionRulesEditorModalData, SectionRulesEditorModalValue } from './section-rules-editor-modal.token.js';\r\nimport type { SectionRule, RuleCondition, RuleConditionType, RulePart, BlockFormat, FormatEntry, FormatEntryType, AreaElement, AreaRules, RuleGroup } from './workflow.types.js';\r\nimport type { SortChangeDetail, SortableRule } from './sortable-rules-container.element.js';\r\nimport { getEffectivePart, getEffectiveFormat } from './workflow.types.js';\r\nimport './sortable-rules-container.element.js';\r\nimport { ruleCardStyles } from './rule-card-styles.js';\r\nimport { html, css, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\n/**\r\n * Editable rule: SectionRule + transient tracking fields for the modal.\r\n * _id is used for drag-and-drop tracking. _groupName tracks which group the rule belongs to.\r\n */\r\ninterface EditableRule extends SectionRule {\r\n\t_id: string;\r\n\t_groupName: string | null;\r\n}\r\n\r\nlet _nextRuleId = 0;\r\nfunction generateRuleId(): string {\r\n\treturn `r-${++_nextRuleId}`;\r\n}\r\n\r\n/** Friendly labels for condition types */\r\nconst CONDITION_LABELS: Record<RuleConditionType, string> = {\r\n\ttextBeginsWith: 'Text begins with',\r\n\ttextEndsWith: 'Text ends with',\r\n\ttextContains: 'Text contains',\r\n\ttextEquals: 'Text equals',\r\n\ttextMatchesPattern: 'Text matches pattern',\r\n\tfontSizeEquals: 'Font size equals',\r\n\tfontSizeAbove: 'Font size above',\r\n\tfontSizeBelow: 'Font size below',\r\n\tfontNameContains: 'Font name contains',\r\n\tfontNameEquals: 'Font name equals',\r\n\tcolorEquals: 'Color equals',\r\n\tpositionFirst: 'Position: first',\r\n\tpositionLast: 'Position: last',\r\n};\r\n\r\n/** Condition types that don't need a value input */\r\nconst VALUELESS_CONDITIONS: RuleConditionType[] = ['positionFirst', 'positionLast'];\r\n\r\n/** All available condition types */\r\nconst ALL_CONDITION_TYPES: RuleConditionType[] = [\r\n\t'textBeginsWith', 'textEndsWith', 'textContains', 'textEquals', 'textMatchesPattern',\r\n\t'fontSizeEquals', 'fontSizeAbove', 'fontSizeBelow',\r\n\t'fontNameContains', 'fontNameEquals', 'colorEquals',\r\n\t'positionFirst', 'positionLast',\r\n];\r\n\r\n/** Friendly labels for rule parts */\r\nconst PART_LABELS: Record<RulePart, string> = {\r\n\ttitle: 'Title',\r\n\tcontent: 'Content',\r\n\tdescription: 'Description',\r\n\tsummary: 'Summary',\r\n};\r\n\r\n/** All available rule parts */\r\nconst ALL_PARTS: RulePart[] = ['title', 'content', 'description', 'summary'];\r\n\r\n/** Format entry type labels */\r\nconst FORMAT_ENTRY_TYPE_LABELS: Record<FormatEntryType, string> = {\r\n\tblock: 'Block',\r\n\tstyle: 'Style',\r\n};\r\n\r\nconst ALL_FORMAT_ENTRY_TYPES: FormatEntryType[] = ['block', 'style'];\r\n\r\n/** Block format value labels (block-level Markdown elements) */\r\nconst BLOCK_FORMAT_LABELS: Record<string, string> = {\r\n\tauto: 'Auto',\r\n\tparagraph: 'Paragraph',\r\n\theading1: 'Heading 1',\r\n\theading2: 'Heading 2',\r\n\theading3: 'Heading 3',\r\n\theading4: 'Heading 4',\r\n\theading5: 'Heading 5',\r\n\theading6: 'Heading 6',\r\n\tbulletListItem: 'Bullet List',\r\n\tnumberedListItem: 'Numbered List',\r\n\tquote: 'Quote',\r\n};\r\n\r\nconst ALL_BLOCK_FORMATS: string[] = [\r\n\t'auto', 'paragraph', 'heading1', 'heading2', 'heading3', 'heading4', 'heading5', 'heading6',\r\n\t'bulletListItem', 'numberedListItem', 'quote',\r\n];\r\n\r\n/** Style format value labels (inline Markdown decorations) */\r\nconst STYLE_FORMAT_LABELS: Record<string, string> = {\r\n\tbold: 'Bold',\r\n\titalic: 'Italic',\r\n\tstrikethrough: 'Strikethrough',\r\n\tcode: 'Code',\r\n\thighlight: 'Highlight',\r\n};\r\n\r\nconst ALL_STYLE_FORMATS: string[] = ['bold', 'italic', 'strikethrough', 'code', 'highlight'];\r\n\r\n@customElement('up-doc-section-rules-editor-modal')\r\nexport class UpDocSectionRulesEditorModalElement extends UmbModalBaseElement<SectionRulesEditorModalData, SectionRulesEditorModalValue> {\r\n\t/** Flat array of all rules (grouped + ungrouped). Each carries _groupName for grouping. */\r\n\t@state() private _rules: EditableRule[] = [];\r\n\t/** Ordered list of group names. */\r\n\t@state() private _groupOrder: string[] = [];\r\n\t/** Track collapsed state per rule section: \"conditions-0\", \"exceptions-1\", etc. */\r\n\t@state() private _collapsed: Set<string> = new Set();\r\n\t/** Track which rules are expanded (by _id). All collapsed by default. */\r\n\t@state() private _expandedRules: Set<string> = new Set();\r\n\t/** Group currently being renamed (null = none). */\r\n\t@state() private _renamingGroup: string | null = null;\r\n\t@state() private _renameValue = '';\r\n\r\n\t#isCollapsed(section: string, ruleId: string): boolean {\r\n\t\treturn this._collapsed.has(`${section}-${ruleId}`);\r\n\t}\r\n\r\n\t#toggleCollapsed(section: string, ruleId: string) {\r\n\t\tconst key = `${section}-${ruleId}`;\r\n\t\tconst next = new Set(this._collapsed);\r\n\t\tif (next.has(key)) {\r\n\t\t\tnext.delete(key);\r\n\t\t} else {\r\n\t\t\tnext.add(key);\r\n\t\t}\r\n\t\tthis._collapsed = next;\r\n\t}\r\n\r\n\t#isRuleExpanded(ruleId: string): boolean {\r\n\t\treturn this._expandedRules.has(ruleId);\r\n\t}\r\n\r\n\t#toggleRuleExpanded(ruleId: string) {\r\n\t\tconst next = new Set(this._expandedRules);\r\n\t\tif (next.has(ruleId)) {\r\n\t\t\tnext.delete(ruleId);\r\n\t\t} else {\r\n\t\t\tnext.add(ruleId);\r\n\t\t}\r\n\t\tthis._expandedRules = next;\r\n\t}\r\n\r\n\t#expandRule(ruleId: string) {\r\n\t\tif (!this._expandedRules.has(ruleId)) {\r\n\t\t\tconst next = new Set(this._expandedRules);\r\n\t\t\tnext.add(ruleId);\r\n\t\t\tthis._expandedRules = next;\r\n\t\t}\r\n\t}\r\n\r\n\toverride firstUpdated() {\r\n\t\tconst areaRules = this.data?.existingRules;\r\n\t\tif (!areaRules) return;\r\n\r\n\t\tconst editableRules: EditableRule[] = [];\r\n\t\tconst groupOrder: string[] = [];\r\n\r\n\t\t// Grouped rules first\r\n\t\tfor (const group of (areaRules.groups ?? [])) {\r\n\t\t\tgroupOrder.push(group.name);\r\n\t\t\tfor (const rule of group.rules) {\r\n\t\t\t\teditableRules.push(this.#normalizeRule(rule, group.name));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Ungrouped rules\r\n\t\tfor (const rule of (areaRules.rules ?? [])) {\r\n\t\t\teditableRules.push(this.#normalizeRule(rule, null));\r\n\t\t}\r\n\r\n\t\tthis._rules = editableRules;\r\n\t\tthis._groupOrder = groupOrder;\r\n\t}\r\n\r\n\t/** Normalize a rule on load: derive part from legacy action, migrate formats. */\r\n\t#normalizeRule(rule: SectionRule, groupName: string | null): EditableRule {\r\n\t\tlet part = rule.part as RulePart | undefined;\r\n\t\tlet exclude = rule.exclude ?? false;\r\n\r\n\t\t// Normalize from legacy action field\r\n\t\tif (!part && !exclude) {\r\n\t\t\tconst derived = getEffectivePart(rule);\r\n\t\t\tif (derived === 'exclude') {\r\n\t\t\t\texclude = true;\r\n\t\t\t} else {\r\n\t\t\t\tpart = derived as RulePart;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Migrate old single format to formats array\r\n\t\tlet formats = rule.formats;\r\n\t\tif (!formats || formats.length === 0) {\r\n\t\t\tconst blockValue = rule.format ?? getEffectiveFormat(rule);\r\n\t\t\tformats = [{ type: 'block' as FormatEntryType, value: blockValue }];\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t...rule,\r\n\t\t\tpart,\r\n\t\t\texclude,\r\n\t\t\tformats,\r\n\t\t\t_id: generateRuleId(),\r\n\t\t\t_groupName: groupName,\r\n\t\t};\r\n\t}\r\n\r\n\tget #elements(): AreaElement[] {\r\n\t\treturn this.data?.elements ?? [];\r\n\t}\r\n\r\n\tget #sectionHeading(): string {\r\n\t\treturn this.data?.sectionHeading ?? 'Section';\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a grouped view for rendering: groups in order, then ungrouped.\r\n\t */\r\n\tget #groupedView(): Array<{ group: string | null; rules: EditableRule[] }> {\r\n\t\tconst result: Array<{ group: string | null; rules: EditableRule[] }> = [];\r\n\r\n\t\t// Groups in order\r\n\t\tfor (const name of this._groupOrder) {\r\n\t\t\tresult.push({\r\n\t\t\t\tgroup: name,\r\n\t\t\t\trules: this._rules.filter((r) => r._groupName === name),\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Ungrouped\r\n\t\tresult.push({\r\n\t\t\tgroup: null,\r\n\t\t\trules: this._rules.filter((r) => r._groupName === null),\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// ===== Rule evaluation (first-match-wins) =====\r\n\r\n\t/** Evaluate all rules against elements. Returns a map of elementId -> rule _id */\r\n\t#evaluateRules(): Map<string, string> {\r\n\t\tconst claimed = new Map<string, string>();\r\n\t\tconst elements = this.#elements;\r\n\r\n\t\tfor (const rule of this._rules) {\r\n\t\t\tif (rule.conditions.length === 0) continue;\r\n\r\n\t\t\tfor (let elIdx = 0; elIdx < elements.length; elIdx++) {\r\n\t\t\t\tconst el = elements[elIdx];\r\n\t\t\t\tif (claimed.has(el.id)) continue; // already claimed by an earlier rule\r\n\r\n\t\t\t\tif (this.#elementMatchesAllConditions(el, rule.conditions, elIdx, elements.length)) {\r\n\t\t\t\t\t// Check exceptions — if any exception matches, skip this element for this rule\r\n\t\t\t\t\tif (rule.exceptions?.length) {\r\n\t\t\t\t\t\tconst anyExceptionMatches = rule.exceptions.some((exc) =>\r\n\t\t\t\t\t\t\tthis.#elementMatchesCondition(el, exc, elIdx, elements.length),\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tif (anyExceptionMatches) continue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tclaimed.set(el.id, rule._id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn claimed;\r\n\t}\r\n\r\n\t#elementMatchesAllConditions(el: AreaElement, conditions: RuleCondition[], index: number, total: number): boolean {\r\n\t\treturn conditions.every((c) => this.#elementMatchesCondition(el, c, index, total));\r\n\t}\r\n\r\n\t#elementMatchesCondition(el: AreaElement, condition: RuleCondition, index: number, total: number): boolean {\r\n\t\tconst val = String(condition.value ?? '');\r\n\t\tconst numVal = Number(condition.value);\r\n\r\n\t\tswitch (condition.type) {\r\n\t\t\tcase 'textBeginsWith':\r\n\t\t\t\treturn el.text.toLowerCase().startsWith(val.toLowerCase());\r\n\t\t\tcase 'textEndsWith':\r\n\t\t\t\treturn el.text.toLowerCase().endsWith(val.toLowerCase());\r\n\t\t\tcase 'textContains':\r\n\t\t\t\treturn el.text.toLowerCase().includes(val.toLowerCase());\r\n\t\t\tcase 'textMatchesPattern':\r\n\t\t\t\ttry { return new RegExp(val, 'i').test(el.text); } catch { return false; }\r\n\t\t\tcase 'fontSizeEquals':\r\n\t\t\t\treturn !isNaN(numVal) && Math.abs(el.fontSize - numVal) < 0.5;\r\n\t\t\tcase 'fontSizeAbove':\r\n\t\t\t\treturn !isNaN(numVal) && el.fontSize > numVal;\r\n\t\t\tcase 'fontSizeBelow':\r\n\t\t\t\treturn !isNaN(numVal) && el.fontSize < numVal;\r\n\t\t\tcase 'fontNameContains':\r\n\t\t\t\treturn el.fontName.toLowerCase().includes(val.toLowerCase());\r\n\t\t\tcase 'colorEquals':\r\n\t\t\t\treturn el.color.toLowerCase() === val.toLowerCase();\r\n\t\t\tcase 'positionFirst':\r\n\t\t\t\treturn index === 0;\r\n\t\t\tcase 'positionLast':\r\n\t\t\t\treturn index === total - 1;\r\n\t\t\tdefault:\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t// ===== Auto-populate conditions from an element =====\r\n\r\n\t#autoPopulateConditions(el: AreaElement, elIndex: number, total: number): RuleCondition[] {\r\n\t\tconst conditions: RuleCondition[] = [];\r\n\r\n\t\t// Font size\r\n\t\tconditions.push({ type: 'fontSizeEquals', value: el.fontSize });\r\n\r\n\t\t// Font name\r\n\t\tif (el.fontName) {\r\n\t\t\tconditions.push({ type: 'fontNameContains', value: el.fontName });\r\n\t\t}\r\n\r\n\t\t// Color (skip black/very dark as it's the default)\r\n\t\tif (el.color && el.color.toLowerCase() !== '#000000' && el.color.toLowerCase() !== '#000') {\r\n\t\t\tconditions.push({ type: 'colorEquals', value: el.color });\r\n\t\t}\r\n\r\n\t\t// Text prefix — if text contains a colon, use \"begins with\" up to the colon\r\n\t\tconst colonIdx = el.text.indexOf(':');\r\n\t\tif (colonIdx > 0 && colonIdx < 30) {\r\n\t\t\tconditions.push({ type: 'textBeginsWith', value: el.text.substring(0, colonIdx + 1) });\r\n\t\t}\r\n\r\n\t\t// Position\r\n\t\tif (elIndex === 0) {\r\n\t\t\tconditions.push({ type: 'positionFirst' });\r\n\t\t} else if (elIndex === total - 1) {\r\n\t\t\tconditions.push({ type: 'positionLast' });\r\n\t\t}\r\n\r\n\t\treturn conditions;\r\n\t}\r\n\r\n\t// ===== Rule CRUD =====\r\n\r\n\t/** Generic helper: update a single rule by _id. */\r\n\t#updateRuleById(id: string, updater: (rule: EditableRule) => EditableRule) {\r\n\t\tthis._rules = this._rules.map((r) => r._id === id ? updater(r) : r);\r\n\t}\r\n\r\n\t#addRule(groupName: string | null = null) {\r\n\t\tconst id = generateRuleId();\r\n\t\tthis._rules = [...this._rules, {\r\n\t\t\trole: '',\r\n\t\t\tpart: 'content' as RulePart,\r\n\t\t\tconditions: [],\r\n\t\t\tformats: [{ type: 'block' as FormatEntryType, value: 'auto' }],\r\n\t\t\t_id: id,\r\n\t\t\t_groupName: groupName,\r\n\t\t}];\r\n\t\t// Auto-expand new rules so user can fill in details\r\n\t\tthis.#expandRule(id);\r\n\t}\r\n\r\n\t#removeRuleById(id: string) {\r\n\t\tthis._rules = this._rules.filter((r) => r._id !== id);\r\n\t}\r\n\r\n\t#createRuleFromElement(el: AreaElement, elIndex: number) {\r\n\t\tconst conditions = this.#autoPopulateConditions(el, elIndex, this.#elements.length);\r\n\t\t// Derive a role name suggestion from text (kebab-case first few words)\r\n\t\tconst roleSuggestion = el.text\r\n\t\t\t.split(/[\\s:,]+/)\r\n\t\t\t.slice(0, 3)\r\n\t\t\t.join('-')\r\n\t\t\t.toLowerCase()\r\n\t\t\t.replace(/[^a-z0-9-]/g, '');\r\n\t\tconst id = generateRuleId();\r\n\t\tthis._rules = [...this._rules, {\r\n\t\t\trole: roleSuggestion,\r\n\t\t\tpart: 'content' as RulePart,\r\n\t\t\tconditions,\r\n\t\t\tformats: [{ type: 'block' as FormatEntryType, value: 'auto' }],\r\n\t\t\t_id: id,\r\n\t\t\t_groupName: null,\r\n\t\t}];\r\n\t\t// Auto-expand so user can review auto-populated conditions\r\n\t\tthis.#expandRule(id);\r\n\t}\r\n\r\n\t#updateRoleName(id: string, value: string) {\r\n\t\tthis.#updateRuleById(id, (r) => ({ ...r, role: value }));\r\n\t}\r\n\r\n\t#updatePart(id: string, value: RulePart) {\r\n\t\tthis.#updateRuleById(id, (r) => ({ ...r, part: value }));\r\n\t}\r\n\r\n\t#updateExclude(id: string, value: boolean) {\r\n\t\tthis.#updateRuleById(id, (r) => ({ ...r, exclude: value }));\r\n\t}\r\n\r\n\t// ===== Group CRUD =====\r\n\r\n\t#addGroup() {\r\n\t\tlet name = 'New Group';\r\n\t\tlet counter = 1;\r\n\t\twhile (this._groupOrder.includes(name)) {\r\n\t\t\tname = `New Group ${++counter}`;\r\n\t\t}\r\n\t\tthis._groupOrder = [...this._groupOrder, name];\r\n\t\t// Immediately enter rename mode\r\n\t\tthis._renamingGroup = name;\r\n\t\tthis._renameValue = name;\r\n\t}\r\n\r\n\t#startRenameGroup(name: string) {\r\n\t\tthis._renamingGroup = name;\r\n\t\tthis._renameValue = name;\r\n\t}\r\n\r\n\t#confirmRenameGroup() {\r\n\t\tif (!this._renamingGroup || !this._renameValue.trim()) return;\r\n\t\tconst oldName = this._renamingGroup;\r\n\t\tconst newName = this._renameValue.trim();\r\n\r\n\t\tif (oldName !== newName) {\r\n\t\t\t// Update group order\r\n\t\t\tthis._groupOrder = this._groupOrder.map((n) => n === oldName ? newName : n);\r\n\t\t\t// Update all rules in this group\r\n\t\t\tthis._rules = this._rules.map((r) =>\r\n\t\t\t\tr._groupName === oldName ? { ...r, _groupName: newName } : r,\r\n\t\t\t);\r\n\t\t}\r\n\t\tthis._renamingGroup = null;\r\n\t\tthis._renameValue = '';\r\n\t}\r\n\r\n\t#cancelRenameGroup() {\r\n\t\tthis._renamingGroup = null;\r\n\t\tthis._renameValue = '';\r\n\t}\r\n\r\n\t#deleteGroup(name: string) {\r\n\t\t// Move all rules from this group to ungrouped\r\n\t\tthis._rules = this._rules.map((r) =>\r\n\t\t\tr._groupName === name ? { ...r, _groupName: null } : r,\r\n\t\t);\r\n\t\tthis._groupOrder = this._groupOrder.filter((n) => n !== name);\r\n\t}\r\n\r\n\t// ===== Drag-and-drop sort handling =====\r\n\r\n\t/**\r\n\t * Handles sort-change from an <updoc-sortable-rules> container.\r\n\t * Rebuilds the flat _rules array: rules arriving in this container get\r\n\t * their _groupName set; rules no longer in this container but still in\r\n\t * _rules keep their existing _groupName.\r\n\t */\r\n\t#onSortChange(groupName: string | null, e: CustomEvent<SortChangeDetail>) {\r\n\t\tconst newRules = e.detail.rules as EditableRule[];\r\n\t\tconst newRuleIds = new Set(newRules.map((r) => r._id));\r\n\r\n\t\t// Rebuild flat array: groups in order, then ungrouped\r\n\t\tconst allRules: EditableRule[] = [];\r\n\r\n\t\tfor (const gName of this._groupOrder) {\r\n\t\t\tif (gName === groupName) {\r\n\t\t\t\t// Use the new order for this group, set _groupName\r\n\t\t\t\tallRules.push(...newRules.map((r) => ({ ...r, _groupName: gName })));\r\n\t\t\t} else {\r\n\t\t\t\t// Keep existing rules for other groups, exclude any that moved into the changed container\r\n\t\t\t\tallRules.push(...this._rules.filter((r) => r._groupName === gName && !newRuleIds.has(r._id)));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Ungrouped\r\n\t\tif (groupName === null) {\r\n\t\t\tallRules.push(...newRules.map((r) => ({ ...r, _groupName: null })));\r\n\t\t} else {\r\n\t\t\tallRules.push(...this._rules.filter((r) => r._groupName === null && !newRuleIds.has(r._id)));\r\n\t\t}\r\n\r\n\t\tthis._rules = allRules;\r\n\t}\r\n\r\n\t// ===== Format entry CRUD =====\r\n\r\n\t#addFormatEntry(id: string) {\r\n\t\tthis.#updateRuleById(id, (r) => ({\r\n\t\t\t...r,\r\n\t\t\tformats: [...(r.formats ?? []), { type: 'block' as FormatEntryType, value: 'auto' }],\r\n\t\t}));\r\n\t}\r\n\r\n\t#removeFormatEntry(id: string, fmtIdx: number) {\r\n\t\tthis.#updateRuleById(id, (r) => ({\r\n\t\t\t...r,\r\n\t\t\tformats: (r.formats ?? []).filter((_, i) => i !== fmtIdx),\r\n\t\t}));\r\n\t}\r\n\r\n\t#updateFormatEntryType(id: string, fmtIdx: number, type: FormatEntryType) {\r\n\t\tconst defaultValue = type === 'block' ? 'auto' : 'bold';\r\n\t\tthis.#updateRuleById(id, (r) => {\r\n\t\t\tconst formats = [...(r.formats ?? [])];\r\n\t\t\tformats[fmtIdx] = { type, value: defaultValue };\r\n\t\t\treturn { ...r, formats };\r\n\t\t});\r\n\t}\r\n\r\n\t#updateFormatEntryValue(id: string, fmtIdx: number, value: string) {\r\n\t\tthis.#updateRuleById(id, (r) => {\r\n\t\t\tconst formats = [...(r.formats ?? [])];\r\n\t\t\tformats[fmtIdx] = { ...formats[fmtIdx], value: value as FormatEntry['value'] };\r\n\t\t\treturn { ...r, formats };\r\n\t\t});\r\n\t}\r\n\r\n\t#addCondition(id: string) {\r\n\t\tthis.#updateRuleById(id, (r) => ({\r\n\t\t\t...r,\r\n\t\t\tconditions: [...r.conditions, { type: 'textBeginsWith' as RuleConditionType, value: '' }],\r\n\t\t}));\r\n\t}\r\n\r\n\t#removeCondition(id: string, condIdx: number) {\r\n\t\tthis.#updateRuleById(id, (r) => ({\r\n\t\t\t...r,\r\n\t\t\tconditions: r.conditions.filter((_, i) => i !== condIdx),\r\n\t\t}));\r\n\t}\r\n\r\n\t#updateConditionType(id: string, condIdx: number, type: RuleConditionType) {\r\n\t\tthis.#updateRuleById(id, (r) => {\r\n\t\t\tconst conditions = [...r.conditions];\r\n\t\t\tconditions[condIdx] = {\r\n\t\t\t\ttype,\r\n\t\t\t\tvalue: VALUELESS_CONDITIONS.includes(type) ? undefined : conditions[condIdx].value,\r\n\t\t\t};\r\n\t\t\treturn { ...r, conditions };\r\n\t\t});\r\n\t}\r\n\r\n\t#updateConditionValue(id: string, condIdx: number, value: string) {\r\n\t\tthis.#updateRuleById(id, (r) => {\r\n\t\t\tconst conditions = [...r.conditions];\r\n\t\t\tconst cond = conditions[condIdx];\r\n\t\t\tconst isNumeric = cond.type === 'fontSizeEquals' || cond.type === 'fontSizeAbove' || cond.type === 'fontSizeBelow';\r\n\t\t\tconditions[condIdx] = { ...cond, value: isNumeric && !isNaN(Number(value)) ? Number(value) : value };\r\n\t\t\treturn { ...r, conditions };\r\n\t\t});\r\n\t}\r\n\r\n\t// ===== Exception CRUD =====\r\n\r\n\t#addException(id: string) {\r\n\t\tthis.#updateRuleById(id, (r) => ({\r\n\t\t\t...r,\r\n\t\t\texceptions: [...(r.exceptions ?? []), { type: 'textContains' as RuleConditionType, value: '' }],\r\n\t\t}));\r\n\t}\r\n\r\n\t#removeException(id: string, excIdx: number) {\r\n\t\tthis.#updateRuleById(id, (r) => ({\r\n\t\t\t...r,\r\n\t\t\texceptions: (r.exceptions ?? []).filter((_, i) => i !== excIdx),\r\n\t\t}));\r\n\t}\r\n\r\n\t#updateExceptionType(id: string, excIdx: number, type: RuleConditionType) {\r\n\t\tthis.#updateRuleById(id, (r) => {\r\n\t\t\tconst exceptions = [...(r.exceptions ?? [])];\r\n\t\t\texceptions[excIdx] = {\r\n\t\t\t\ttype,\r\n\t\t\t\tvalue: VALUELESS_CONDITIONS.includes(type) ? undefined : exceptions[excIdx].value,\r\n\t\t\t};\r\n\t\t\treturn { ...r, exceptions };\r\n\t\t});\r\n\t}\r\n\r\n\t#updateExceptionValue(id: string, excIdx: number, value: string) {\r\n\t\tthis.#updateRuleById(id, (r) => {\r\n\t\t\tconst exceptions = [...(r.exceptions ?? [])];\r\n\t\t\tconst exc = exceptions[excIdx];\r\n\t\t\tconst isNumeric = exc.type === 'fontSizeEquals' || exc.type === 'fontSizeAbove' || exc.type === 'fontSizeBelow';\r\n\t\t\texceptions[excIdx] = { ...exc, value: isNumeric && !isNaN(Number(value)) ? Number(value) : value };\r\n\t\t\treturn { ...r, exceptions };\r\n\t\t});\r\n\t}\r\n\r\n\t// ===== Submit =====\r\n\r\n\t/** Strip transient fields and sync format for C# compatibility. */\r\n\t#cleanRule(rule: EditableRule): SectionRule {\r\n\t\tconst blockEntry = (rule.formats ?? []).find((f) => f.type === 'block');\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tconst { _id, _groupName, action, ...clean } = rule;\r\n\t\treturn {\r\n\t\t\t...clean,\r\n\t\t\tformat: (blockEntry?.value ?? 'auto') as BlockFormat,\r\n\t\t};\r\n\t}\r\n\r\n\t#buildRulesValue(): AreaRules {\r\n\t\t// Auto-confirm any pending group rename before building value\r\n\t\tif (this._renamingGroup) {\r\n\t\t\tthis.#confirmRenameGroup();\r\n\t\t}\r\n\r\n\t\tconst groups: RuleGroup[] = [];\r\n\t\tfor (const name of this._groupOrder) {\r\n\t\t\tconst groupRules = this._rules\r\n\t\t\t\t.filter((r) => r._groupName === name)\r\n\t\t\t\t.map((r) => this.#cleanRule(r));\r\n\t\t\tgroups.push({ name, rules: groupRules });\r\n\t\t}\r\n\t\tconst ungroupedRules = this._rules\r\n\t\t\t.filter((r) => r._groupName === null)\r\n\t\t\t.map((r) => this.#cleanRule(r));\r\n\r\n\t\treturn { groups, rules: ungroupedRules };\r\n\t}\r\n\r\n\tasync #onSave() {\r\n\t\tconst rules = this.#buildRulesValue();\r\n\t\tif (this.data?.onSave) {\r\n\t\t\tawait this.data.onSave(rules);\r\n\t\t}\r\n\t}\r\n\r\n\t#onSaveAndClose() {\r\n\t\tconst rules = this.#buildRulesValue();\r\n\t\tthis.value = { rules };\r\n\t\tthis.modalContext?.submit();\r\n\t}\r\n\r\n\t#onClose() {\r\n\t\tthis.modalContext?.reject();\r\n\t}\r\n\r\n\t// ===== Rendering =====\r\n\r\n\t#renderConditionRow(ruleId: string, condIdx: number, condition: RuleCondition) {\r\n\t\tconst isValueless = VALUELESS_CONDITIONS.includes(condition.type);\r\n\t\treturn html`\r\n\t\t\t<div class=\"condition-row\">\r\n\t\t\t\t<select\r\n\t\t\t\t\tclass=\"condition-type-select\"\r\n\t\t\t\t\t.value=${condition.type}\r\n\t\t\t\t\t@change=${(e: Event) => this.#updateConditionType(ruleId, condIdx, (e.target as HTMLSelectElement).value as RuleConditionType)}>\r\n\t\t\t\t\t${ALL_CONDITION_TYPES.map((t) => html`\r\n\t\t\t\t\t\t<option value=${t} ?selected=${t === condition.type}>${CONDITION_LABELS[t]}</option>\r\n\t\t\t\t\t`)}\r\n\t\t\t\t</select>\r\n\t\t\t\t${isValueless ? nothing : html`\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tclass=\"condition-value-input\"\r\n\t\t\t\t\t\tplaceholder=\"Value...\"\r\n\t\t\t\t\t\t.value=${String(condition.value ?? '')}\r\n\t\t\t\t\t\t@input=${(e: Event) => this.#updateConditionValue(ruleId, condIdx, (e.target as HTMLInputElement).value)} />\r\n\t\t\t\t`}\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tcompact\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\tlabel=\"Remove condition\"\r\n\t\t\t\t\t@click=${() => this.#removeCondition(ruleId, condIdx)}>\r\n\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderExceptionRow(ruleId: string, excIdx: number, exception: RuleCondition) {\r\n\t\tconst isValueless = VALUELESS_CONDITIONS.includes(exception.type);\r\n\t\treturn html`\r\n\t\t\t<div class=\"condition-row\">\r\n\t\t\t\t<select\r\n\t\t\t\t\tclass=\"condition-type-select\"\r\n\t\t\t\t\t.value=${exception.type}\r\n\t\t\t\t\t@change=${(e: Event) => this.#updateExceptionType(ruleId, excIdx, (e.target as HTMLSelectElement).value as RuleConditionType)}>\r\n\t\t\t\t\t${ALL_CONDITION_TYPES.map((t) => html`\r\n\t\t\t\t\t\t<option value=${t} ?selected=${t === exception.type}>${CONDITION_LABELS[t]}</option>\r\n\t\t\t\t\t`)}\r\n\t\t\t\t</select>\r\n\t\t\t\t${isValueless ? nothing : html`\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tclass=\"condition-value-input\"\r\n\t\t\t\t\t\tplaceholder=\"Value...\"\r\n\t\t\t\t\t\t.value=${String(exception.value ?? '')}\r\n\t\t\t\t\t\t@input=${(e: Event) => this.#updateExceptionValue(ruleId, excIdx, (e.target as HTMLInputElement).value)} />\r\n\t\t\t\t`}\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tcompact\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\tlabel=\"Remove exception\"\r\n\t\t\t\t\t@click=${() => this.#removeException(ruleId, excIdx)}>\r\n\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderFormatRow(ruleId: string, fmtIdx: number, entry: FormatEntry) {\r\n\t\tconst valueOptions = entry.type === 'block' ? ALL_BLOCK_FORMATS : ALL_STYLE_FORMATS;\r\n\t\tconst valueLabels = entry.type === 'block' ? BLOCK_FORMAT_LABELS : STYLE_FORMAT_LABELS;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"condition-row\">\r\n\t\t\t\t<select\r\n\t\t\t\t\tclass=\"format-type-select\"\r\n\t\t\t\t\t.value=${entry.type}\r\n\t\t\t\t\t@change=${(e: Event) => this.#updateFormatEntryType(ruleId, fmtIdx, (e.target as HTMLSelectElement).value as FormatEntryType)}>\r\n\t\t\t\t\t${ALL_FORMAT_ENTRY_TYPES.map((t) => html`\r\n\t\t\t\t\t\t<option value=${t} ?selected=${t === entry.type}>${FORMAT_ENTRY_TYPE_LABELS[t]}</option>\r\n\t\t\t\t\t`)}\r\n\t\t\t\t</select>\r\n\t\t\t\t<select\r\n\t\t\t\t\tclass=\"format-value-select\"\r\n\t\t\t\t\t.value=${entry.value}\r\n\t\t\t\t\t@change=${(e: Event) => this.#updateFormatEntryValue(ruleId, fmtIdx, (e.target as HTMLSelectElement).value)}>\r\n\t\t\t\t\t${valueOptions.map((v) => html`\r\n\t\t\t\t\t\t<option value=${v} ?selected=${v === entry.value}>${valueLabels[v]}</option>\r\n\t\t\t\t\t`)}\r\n\t\t\t\t</select>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tcompact\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\tlabel=\"Remove format\"\r\n\t\t\t\t\t@click=${() => this.#removeFormatEntry(ruleId, fmtIdx)}>\r\n\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderRuleCard(rule: EditableRule, matchedElements: AreaElement[]) {\r\n\t\tconst isExpanded = this.#isRuleExpanded(rule._id);\r\n\r\n\t\tif (!isExpanded) {\r\n\t\t\treturn this.#renderCollapsedRule(rule, matchedElements);\r\n\t\t}\r\n\r\n\t\treturn this.#renderExpandedRule(rule, matchedElements);\r\n\t}\r\n\r\n\t#renderCollapsedRule(rule: EditableRule, matchedElements: AreaElement[]) {\r\n\t\tconst isExcluded = rule.exclude;\r\n\t\tconst currentPart = rule.part ?? 'content';\r\n\t\tconst partLabel = isExcluded ? 'Exclude' : PART_LABELS[currentPart] ?? currentPart;\r\n\t\tconst matchCount = matchedElements.length;\r\n\t\tconst roleName = rule.role || '(unnamed rule)';\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"rule-row\" @click=${() => this.#toggleRuleExpanded(rule._id)}>\r\n\t\t\t\t<span class=\"rule-grip\" title=\"Drag to reorder\" @click=${(e: Event) => e.stopPropagation()}>⠿</span>\r\n\t\t\t\t<span class=\"rule-row-name\">${roleName}</span>\r\n\t\t\t\t<span class=\"rule-row-part ${isExcluded ? 'excluded' : ''}\">${partLabel}</span>\r\n\t\t\t\t${matchCount > 0\r\n\t\t\t\t\t? html`<span class=\"rule-row-match ${isExcluded ? 'excluded' : 'matched'}\">${matchCount}&times;</span>`\r\n\t\t\t\t\t: html`<span class=\"rule-row-match no-match\">0</span>`}\r\n\t\t\t\t<uui-action-bar class=\"rule-row-actions\"\r\n\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}>\r\n\t\t\t\t\t<uui-button pristine look=\"primary\" label=\"Edit rule\"\r\n\t\t\t\t\t\t@click=${() => this.#toggleRuleExpanded(rule._id)}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-edit\"></uui-icon>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t<uui-button pristine look=\"primary\" label=\"Delete rule\"\r\n\t\t\t\t\t\t@click=${() => this.#removeRuleById(rule._id)}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</uui-action-bar>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderExpandedRule(rule: EditableRule, matchedElements: AreaElement[]) {\r\n\t\tconst isExcluded = rule.exclude;\r\n\t\tconst currentPart = rule.part ?? 'content';\r\n\t\tconst id = rule._id;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"rule-card\">\r\n\t\t\t\t<div class=\"rule-header\">\r\n\t\t\t\t\t<uui-icon class=\"rule-row-chevron expanded\" name=\"icon-navigation-down\"\r\n\t\t\t\t\t\t@click=${() => this.#toggleRuleExpanded(id)}\r\n\t\t\t\t\t\tstyle=\"cursor:pointer\"></uui-icon>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tclass=\"role-name-input\"\r\n\t\t\t\t\t\tplaceholder=\"Section name (e.g. tour-title)\"\r\n\t\t\t\t\t\t.value=${rule.role}\r\n\t\t\t\t\t\t@input=${(e: Event) => this.#updateRoleName(id, (e.target as HTMLInputElement).value)} />\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\tcolor=\"danger\"\r\n\t\t\t\t\t\tlabel=\"Remove rule\"\r\n\t\t\t\t\t\t@click=${() => this.#removeRuleById(id)}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"conditions-area\">\r\n\t\t\t\t\t<div class=\"section-header collapsible\" @click=${() => this.#toggleCollapsed('conditions', id)}>\r\n\t\t\t\t\t\t<uui-icon name=${this.#isCollapsed('conditions', id) ? 'icon-navigation-right' : 'icon-navigation-down'}></uui-icon>\r\n\t\t\t\t\t\tConditions${rule.conditions.length > 0 ? ` (${rule.conditions.length})` : ''}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t${this.#isCollapsed('conditions', id) ? nothing : html`\r\n\t\t\t\t\t\t${rule.conditions.map((cond, cIdx) => this.#renderConditionRow(id, cIdx, cond))}\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\t\t\tlabel=\"Add condition\"\r\n\t\t\t\t\t\t\t@click=${() => this.#addCondition(id)}>\r\n\t\t\t\t\t\t\t+ Add condition\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t`}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"exceptions-area\">\r\n\t\t\t\t\t<div class=\"section-header collapsible\" @click=${() => this.#toggleCollapsed('exceptions', id)}>\r\n\t\t\t\t\t\t<uui-icon name=${this.#isCollapsed('exceptions', id) ? 'icon-navigation-right' : 'icon-navigation-down'}></uui-icon>\r\n\t\t\t\t\t\tExceptions${(rule.exceptions ?? []).length > 0 ? ` (${(rule.exceptions ?? []).length})` : ''}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t${this.#isCollapsed('exceptions', id) ? nothing : html`\r\n\t\t\t\t\t\t${(rule.exceptions ?? []).map((exc, eIdx) => this.#renderExceptionRow(id, eIdx, exc))}\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\t\t\tlabel=\"Add exception\"\r\n\t\t\t\t\t\t\t@click=${() => this.#addException(id)}>\r\n\t\t\t\t\t\t\t+ Add exception\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t`}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"part-area\">\r\n\t\t\t\t\t<div class=\"section-header collapsible\" @click=${() => this.#toggleCollapsed('part', id)}>\r\n\t\t\t\t\t\t<uui-icon name=${this.#isCollapsed('part', id) ? 'icon-navigation-right' : 'icon-navigation-down'}></uui-icon>\r\n\t\t\t\t\t\tPart\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t${this.#isCollapsed('part', id) ? nothing : html`\r\n\t\t\t\t\t\t<div class=\"part-controls\">\r\n\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\tclass=\"part-select\"\r\n\t\t\t\t\t\t\t\t.value=${currentPart}\r\n\t\t\t\t\t\t\t\t?disabled=${isExcluded}\r\n\t\t\t\t\t\t\t\t@change=${(e: Event) => this.#updatePart(id, (e.target as HTMLSelectElement).value as RulePart)}>\r\n\t\t\t\t\t\t\t\t${ALL_PARTS.map((p) => html`\r\n\t\t\t\t\t\t\t\t\t<option value=${p} ?selected=${p === currentPart}>${PART_LABELS[p]}</option>\r\n\t\t\t\t\t\t\t\t`)}\r\n\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t<label class=\"exclude-label\">\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\t\t\t\t\t\t.checked=${isExcluded}\r\n\t\t\t\t\t\t\t\t\t@change=${(e: Event) => this.#updateExclude(id, (e.target as HTMLInputElement).checked)} />\r\n\t\t\t\t\t\t\t\tExclude\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t`}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t${!isExcluded ? html`\r\n\t\t\t\t<div class=\"format-area\">\r\n\t\t\t\t\t<div class=\"section-header collapsible\" @click=${() => this.#toggleCollapsed('format', id)}>\r\n\t\t\t\t\t\t<uui-icon name=${this.#isCollapsed('format', id) ? 'icon-navigation-right' : 'icon-navigation-down'}></uui-icon>\r\n\t\t\t\t\t\tFormat${(rule.formats ?? []).length > 0 ? ` (${(rule.formats ?? []).length})` : ''}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t${this.#isCollapsed('format', id) ? nothing : html`\r\n\t\t\t\t\t\t${(rule.formats ?? []).map((fmt, fIdx) => this.#renderFormatRow(id, fIdx, fmt))}\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\t\t\tlabel=\"Add format\"\r\n\t\t\t\t\t\t\t@click=${() => this.#addFormatEntry(id)}>\r\n\t\t\t\t\t\t\t+ Add format\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t`}\r\n\t\t\t\t</div>\r\n\t\t\t\t` : nothing}\r\n\r\n\t\t\t\t<div class=\"match-preview ${matchedElements.length > 0 ? (isExcluded ? 'excluded' : 'matched') : 'no-match'}\">\r\n\t\t\t\t\t${matchedElements.length > 0\r\n\t\t\t\t\t\t? html`<uui-icon name=${isExcluded ? 'icon-block' : 'icon-check'}></uui-icon> ${isExcluded ? 'Excluded' : 'Matched'} <strong>${matchedElements.length}&times;</strong>${matchedElements.length <= 5 ? html`: ${matchedElements.map((el, i) => html`${i > 0 ? html`, ` : nothing}<strong>${this.#truncate(el.text, 40)}</strong>`)}` : nothing}`\r\n\t\t\t\t\t\t: html`<uui-icon name=\"icon-alert\"></uui-icon> ${rule.conditions.length === 0 ? 'Add conditions to match elements' : 'No match'}`}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#truncate(text: string, max: number): string {\r\n\t\treturn text.length > max ? text.substring(0, max) + '...' : text;\r\n\t}\r\n\r\n\t#renderGroupHeader(name: string) {\r\n\t\tif (this._renamingGroup === name) {\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"group-header\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tclass=\"group-rename-input\"\r\n\t\t\t\t\t\t.value=${this._renameValue}\r\n\t\t\t\t\t\t@input=${(e: Event) => { this._renameValue = (e.target as HTMLInputElement).value; }}\r\n\t\t\t\t\t\t@keydown=${(e: KeyboardEvent) => {\r\n\t\t\t\t\t\t\tif (e.key === 'Enter') this.#confirmRenameGroup();\r\n\t\t\t\t\t\t\tif (e.key === 'Escape') this.#cancelRenameGroup();\r\n\t\t\t\t\t\t}} />\r\n\t\t\t\t\t<uui-button compact look=\"primary\" label=\"Confirm\" @click=${() => this.#confirmRenameGroup()}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-check\"></uui-icon>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t<uui-button compact look=\"secondary\" label=\"Cancel\" @click=${() => this.#cancelRenameGroup()}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-wrong\"></uui-icon>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"group-header\">\r\n\t\t\t\t<strong class=\"group-name\">${name}</strong>\r\n\t\t\t\t<span class=\"header-spacer\"></span>\r\n\t\t\t\t<uui-action-bar class=\"group-header-actions\">\r\n\t\t\t\t\t<uui-button pristine look=\"primary\" label=\"Rename\" @click=${() => this.#startRenameGroup(name)}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-edit\"></uui-icon>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t<uui-button pristine look=\"primary\" label=\"Delete group\"\r\n\t\t\t\t\t\ttitle=\"Delete group (rules move to ungrouped)\"\r\n\t\t\t\t\t\t@click=${() => this.#deleteGroup(name)}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</uui-action-bar>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderUnmatchedElements(claimed: Map<string, number>) {\r\n\t\tconst elements = this.#elements;\r\n\t\tconst unmatched = elements.filter((el) => !claimed.has(el.id));\r\n\t\tif (unmatched.length === 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"unmatched-section\">\r\n\t\t\t\t<h4>Unmatched elements (${unmatched.length})</h4>\r\n\t\t\t\t${unmatched.map((el) => {\r\n\t\t\t\t\tconst elIndex = elements.indexOf(el);\r\n\t\t\t\t\treturn html`\r\n\t\t\t\t\t\t<div class=\"unmatched-element\">\r\n\t\t\t\t\t\t\t<div class=\"unmatched-text\">${this.#truncate(el.text, 80)}</div>\r\n\t\t\t\t\t\t\t<div class=\"unmatched-meta\">\r\n\t\t\t\t\t\t\t\t<span class=\"meta-badge\">${el.fontSize}pt</span>\r\n\t\t\t\t\t\t\t\t<span class=\"meta-badge\">${el.fontName}</span>\r\n\t\t\t\t\t\t\t\t${el.color !== '#000000' ? html`<span class=\"meta-badge\" style=\"border-left: 3px solid ${el.color};\">${el.color}</span>` : nothing}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\t\t\t\tlabel=\"Define rule from this\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#createRuleFromElement(el, elIndex)}>\r\n\t\t\t\t\t\t\t\tDefine rule\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t`;\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tconst claimed = this.#evaluateRules();\r\n\r\n\t\t// Build rule _id -> all matched elements lookup\r\n\t\tconst ruleMatches = new Map<string, AreaElement[]>();\r\n\t\tfor (const [elId, ruleId] of claimed) {\r\n\t\t\tconst el = this.#elements.find((e) => e.id === elId);\r\n\t\t\tif (el) {\r\n\t\t\t\tconst existing = ruleMatches.get(ruleId) ?? [];\r\n\t\t\t\texisting.push(el);\r\n\t\t\t\truleMatches.set(ruleId, existing);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst groupedView = this.#groupedView;\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=\"Edit Sections: ${this.#sectionHeading}\">\r\n\t\t\t\t<div id=\"main\">\r\n\t\t\t\t\t<div class=\"section-info\">\r\n\t\t\t\t\t\t<span class=\"meta-badge\">${this.#elements.length} elements</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge\">${this._rules.length} rules</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge\">${claimed.size} matched</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge\">${this.#elements.length - claimed.size} unmatched</span>\r\n\t\t\t\t\t\t${this._groupOrder.length > 0\r\n\t\t\t\t\t\t\t? html`<span class=\"meta-badge\">${this._groupOrder.length} group${this._groupOrder.length !== 1 ? 's' : ''}</span>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t${groupedView.map((entry) => {\r\n\t\t\t\t\t\tconst renderItemCb = (rule: SortableRule) =>\r\n\t\t\t\t\t\t\tthis.#renderRuleCard(rule as EditableRule, ruleMatches.get(rule._id) ?? []);\r\n\r\n\t\t\t\t\t\tif (entry.group !== null) {\r\n\t\t\t\t\t\t\t// Render a named group\r\n\t\t\t\t\t\t\treturn html`\r\n\t\t\t\t\t\t\t\t<div class=\"group-container\">\r\n\t\t\t\t\t\t\t\t\t${this.#renderGroupHeader(entry.group)}\r\n\t\t\t\t\t\t\t\t\t<div class=\"group-rules\">\r\n\t\t\t\t\t\t\t\t\t\t<updoc-sortable-rules\r\n\t\t\t\t\t\t\t\t\t\t\t.rules=${entry.rules}\r\n\t\t\t\t\t\t\t\t\t\t\t.expandedIds=${this._expandedRules}\r\n\t\t\t\t\t\t\t\t\t\t\t.renderItem=${renderItemCb}\r\n\t\t\t\t\t\t\t\t\t\t\t@sort-change=${(e: CustomEvent<SortChangeDetail>) => this.#onSortChange(entry.group, e)}\r\n\t\t\t\t\t\t\t\t\t\t></updoc-sortable-rules>\r\n\t\t\t\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\t\t\t\t\t\t\tlabel=\"Add rule to ${entry.group}\"\r\n\t\t\t\t\t\t\t\t\t\t\t@click=${() => this.#addRule(entry.group)}>\r\n\t\t\t\t\t\t\t\t\t\t\t+ Add rule\r\n\t\t\t\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t`;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Render ungrouped rules\r\n\t\t\t\t\t\treturn html`\r\n\t\t\t\t\t\t\t${this._groupOrder.length > 0 ? html`\r\n\t\t\t\t\t\t\t\t<div class=\"ungrouped-label\">Ungrouped</div>\r\n\t\t\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t\t\t<updoc-sortable-rules\r\n\t\t\t\t\t\t\t\t.rules=${entry.rules}\r\n\t\t\t\t\t\t\t\t.expandedIds=${this._expandedRules}\r\n\t\t\t\t\t\t\t\t.renderItem=${renderItemCb}\r\n\t\t\t\t\t\t\t\t@sort-change=${(e: CustomEvent<SortChangeDetail>) => this.#onSortChange(null, e)}\r\n\t\t\t\t\t\t\t></updoc-sortable-rules>\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\t\t\t\tlabel=\"Add rule\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#addRule(null)}>\r\n\t\t\t\t\t\t\t\t+ Add rule\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t`;\r\n\t\t\t\t\t})}\r\n\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\t\tlabel=\"Add group\"\r\n\t\t\t\t\t\t@click=${() => this.#addGroup()}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-add\"></uui-icon>\r\n\t\t\t\t\t\tAdd group\r\n\t\t\t\t\t</uui-button>\r\n\r\n\t\t\t\t\t${this.#renderUnmatchedElements(claimed)}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=\"Close\" @click=${this.#onClose}>Close</uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=\"Save\"\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t@click=${this.#onSave}>\r\n\t\t\t\t\t\tSave\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=\"Save and Close\"\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t@click=${this.#onSaveAndClose}>\r\n\t\t\t\t\t\tSave and Close\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\truleCardStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#main {\r\n\t\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.section-info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tpadding: 1px 6px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Group containers */\r\n\t\t\t.group-container {\r\n\t\t\t\tborder: 2px solid var(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t}\r\n\r\n\t\t\t.group-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.group-name {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.group-header-actions {\r\n\t\t\t\topacity: 0;\r\n\t\t\t\ttransition: opacity 120ms ease;\r\n\t\t\t}\r\n\r\n\t\t\t.group-header:hover .group-header-actions {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.group-rename-input {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tpadding: var(--uui-size-space-1) var(--uui-size-space-2);\r\n\t\t\t\tborder: 1px solid var(--uui-color-focus);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tbackground: var(--uui-color-surface);\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.group-rename-input:focus {\r\n\t\t\t\toutline: none;\r\n\t\t\t}\r\n\r\n\t\t\t.header-spacer {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.group-rules {\r\n\t\t\t\tpadding: var(--uui-size-space-3);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.ungrouped-label {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t\ttext-transform: uppercase;\r\n\t\t\t\tletter-spacing: 0.5px;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tpadding-top: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t/* Unmatched elements */\r\n\t\t\t.unmatched-section {\r\n\t\t\t\tborder: 1px dashed var(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.unmatched-section h4 {\r\n\t\t\t\tmargin: 0 0 var(--uui-size-space-3);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\ttext-transform: uppercase;\r\n\t\t\t\tletter-spacing: 0.5px;\r\n\t\t\t}\r\n\r\n\t\t\t.unmatched-element {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-2) 0;\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.unmatched-element:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t.unmatched-text {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t.unmatched-meta {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-1);\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocSectionRulesEditorModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-section-rules-editor-modal': UpDocSectionRulesEditorModalElement;\r\n\t}\r\n}\r\n"],"names":["getEffectivePart","rule","getEffectiveFormat","ruleCardStyles","css","_sorter","UpdocSortableRulesElement","UmbLitElement","__privateAdd","UmbSorterController","el","model","val","__privateGet","nothing","html","repeat","__decorateClass","property","state","customElement","_UpDocSectionRulesEditorModalElement_instances","isCollapsed_fn","toggleCollapsed_fn","isRuleExpanded_fn","toggleRuleExpanded_fn","expandRule_fn","normalizeRule_fn","elements_get","sectionHeading_get","groupedView_get","evaluateRules_fn","elementMatchesAllConditions_fn","elementMatchesCondition_fn","autoPopulateConditions_fn","updateRuleById_fn","addRule_fn","removeRuleById_fn","createRuleFromElement_fn","updateRoleName_fn","updatePart_fn","updateExclude_fn","addGroup_fn","startRenameGroup_fn","confirmRenameGroup_fn","cancelRenameGroup_fn","deleteGroup_fn","onSortChange_fn","addFormatEntry_fn","removeFormatEntry_fn","updateFormatEntryType_fn","updateFormatEntryValue_fn","addCondition_fn","removeCondition_fn","updateConditionType_fn","updateConditionValue_fn","addException_fn","removeException_fn","updateExceptionType_fn","updateExceptionValue_fn","cleanRule_fn","buildRulesValue_fn","onSave_fn","onSaveAndClose_fn","onClose_fn","renderConditionRow_fn","renderExceptionRow_fn","renderFormatRow_fn","renderRuleCard_fn","renderCollapsedRule_fn","renderExpandedRule_fn","truncate_fn","renderGroupHeader_fn","renderUnmatchedElements_fn","_nextRuleId","generateRuleId","CONDITION_LABELS","VALUELESS_CONDITIONS","ALL_CONDITION_TYPES","PART_LABELS","ALL_PARTS","FORMAT_ENTRY_TYPE_LABELS","ALL_FORMAT_ENTRY_TYPES","BLOCK_FORMAT_LABELS","ALL_BLOCK_FORMATS","STYLE_FORMAT_LABELS","ALL_STYLE_FORMATS","UpDocSectionRulesEditorModalElement","UmbModalBaseElement","areaRules","editableRules","groupOrder","group","__privateMethod","claimed","ruleMatches","elId","ruleId","e","existing","groupedView","entry","renderItemCb","section","key","next","groupName","part","exclude","derived","formats","result","name","r","elements","elIdx","exc","conditions","index","total","c","condition","numVal","elIndex","colonIdx","id","updater","roleSuggestion","value","counter","oldName","newName","n","newRules","newRuleIds","allRules","gName","fmtIdx","_","i","type","defaultValue","condIdx","cond","isNumeric","excIdx","exceptions","blockEntry","f","_id","_groupName","action","clean","groups","groupRules","ungroupedRules","rules","isValueless","t","exception","valueOptions","valueLabels","v","matchedElements","isExcluded","currentPart","partLabel","matchCount","roleName","cIdx","eIdx","p","fmt","fIdx","text","max","unmatched","UmbTextStyles","UpDocSectionRulesEditorModalElement_default"],"mappings":"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"}