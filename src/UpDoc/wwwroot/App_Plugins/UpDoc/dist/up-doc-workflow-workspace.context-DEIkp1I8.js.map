{"version":3,"file":"up-doc-workflow-workspace.context-DEIkp1I8.js","sources":["../src/up-doc-workflow-workspace.context.ts"],"sourcesContent":["import { UmbWorkspaceRouteManager, UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { html, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('up-doc-workflow-workspace-editor')\r\nclass UpDocWorkflowWorkspaceEditorElement extends UmbLitElement {\r\n\t@state() private _name = '';\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.consumeContext(UMB_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\t\t\tthis.observe((context as any).name, (name: string) => {\r\n\t\t\t\tthis._name = name || 'Workflow';\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`<umb-workspace-editor headline=${this._name}></umb-workspace-editor>`;\r\n\t}\r\n}\r\n\r\ninterface UpDocWorkflowData {\r\n\tunique: string;\r\n\tname?: string;\r\n}\r\n\r\nexport class UpDocWorkflowWorkspaceContext extends UmbContextBase {\r\n\tpublic readonly workspaceAlias = 'UpDoc.WorkflowWorkspace';\r\n\r\n\t#data = new UmbObjectState<UpDocWorkflowData | undefined>(undefined);\r\n\treadonly data = this.#data.asObservable();\r\n\treadonly unique = this.#data.asObservablePart((data) => data?.unique);\r\n\treadonly name = this.#data.asObservablePart((data) => data?.name);\r\n\r\n\t/** Callback registered by the active workspace view to handle save. */\r\n\t#saveHandler: (() => Promise<void>) | null = null;\r\n\r\n\t/** Callback registered by the active workspace view to handle refresh/re-extract. */\r\n\t#refreshHandler: (() => Promise<void>) | null = null;\r\n\r\n\t/** Register a save handler (called by workspace views like Source). */\r\n\tsetSaveHandler(handler: (() => Promise<void>) | null) {\r\n\t\tthis.#saveHandler = handler;\r\n\t}\r\n\r\n\t/** Register a refresh handler for re-extraction (called by workspace views like Source). */\r\n\tsetRefreshHandler(handler: (() => Promise<void>) | null) {\r\n\t\tthis.#refreshHandler = handler;\r\n\t}\r\n\r\n\t/** Called by the workspace action (Save button). Delegates to the registered handler. */\r\n\tasync save(): Promise<void> {\r\n\t\tif (this.#saveHandler) {\r\n\t\t\tawait this.#saveHandler();\r\n\t\t}\r\n\t}\r\n\r\n\t/** Called by the Refresh workspace action. Triggers re-extraction. */\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.#refreshHandler) {\r\n\t\t\tawait this.#refreshHandler();\r\n\t\t}\r\n\t}\r\n\r\n\treadonly routes = new UmbWorkspaceRouteManager(this);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_WORKSPACE_CONTEXT);\r\n\r\n\t\tthis.routes.setRoutes([\r\n\t\t\t{\r\n\t\t\t\tpath: 'edit/:unique',\r\n\t\t\t\tcomponent: UpDocWorkflowWorkspaceEditorElement,\r\n\t\t\t\tsetup: (_component: HTMLElement, info: any) => {\r\n\t\t\t\t\tconst unique = info.match.params.unique;\r\n\t\t\t\t\tthis.load(unique);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n\r\n\tasync load(unique: string) {\r\n\t\tconst workflowName = decodeURIComponent(unique);\r\n\t\t// Format \"group-tour\" â†’ \"Group Tour\" for display\r\n\t\tconst displayName = workflowName\r\n\t\t\t.split('-')\r\n\t\t\t.map((word) => word.charAt(0).toUpperCase() + word.slice(1))\r\n\t\t\t.join(' ');\r\n\t\tthis.#data.setValue({ unique, name: displayName });\r\n\t}\r\n\r\n\tgetUnique() {\r\n\t\treturn this.#data.getValue()?.unique;\r\n\t}\r\n\r\n\tgetEntityType() {\r\n\t\treturn 'updoc-workflow';\r\n\t}\r\n\r\n\tpublic override destroy(): void {\r\n\t\tthis.#data.destroy();\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nexport { UpDocWorkflowWorkspaceContext as api };\r\n"],"names":["UpDocWorkflowWorkspaceEditorElement","UmbLitElement","UMB_WORKSPACE_CONTEXT","context","name","html","__decorateClass","state","customElement","UpDocWorkflowWorkspaceContext","UmbContextBase","host","#data","UmbObjectState","data","#saveHandler","#refreshHandler","UmbWorkspaceRouteManager","_component","info","unique","handler","displayName","word"],"mappings":";;;;;;;;;;AASA,IAAMA,IAAN,cAAkDC,EAAc;AAAA,EAAhE,cAAA;AAAA,UAAA,GAAA,SAAA,GACU,KAAQ,QAAQ;AAAA,EAAA;AAAA,EAEhB,oBAAoB;AAC5B,UAAM,kBAAA,GACN,KAAK,eAAeC,GAAuB,CAACC,MAAY;AACvD,MAAKA,KACL,KAAK,QAASA,EAAgB,MAAM,CAACC,MAAiB;AACrD,aAAK,QAAQA,KAAQ;AAAA,MACtB,CAAC;AAAA,IACF,CAAC;AAAA,EACF;AAAA,EAES,SAAS;AACjB,WAAOC,mCAAsC,KAAK,KAAK;AAAA,EACxD;AACD;AAfkBC,EAAA;AAAA,EAAhBC,EAAA;AAAM,GADFP,EACY,WAAA,SAAA,CAAA;AADZA,IAANM,EAAA;AAAA,EADCE,EAAc,kCAAkC;AAAA,GAC3CR,CAAA;AAuBC,MAAMS,UAAsCC,EAAe;AAAA,EAwCjE,YAAYC,GAAyB;AACpC,UAAMA,GAAMT,CAAqB,GAxClC,KAAgB,iBAAiB,2BAEjC,KAAAU,KAAQ,IAAIC,EAA8C,MAAS,GACnE,KAAS,OAAO,KAAKD,GAAM,aAAA,GAC3B,KAAS,SAAS,KAAKA,GAAM,iBAAiB,CAACE,MAASA,GAAM,MAAM,GACpE,KAAS,OAAO,KAAKF,GAAM,iBAAiB,CAACE,MAASA,GAAM,IAAI,GAGhE,KAAAC,KAA6C,MAG7C,KAAAC,KAAgD,MA0BhD,KAAS,SAAS,IAAIC,EAAyB,IAAI,GAKlD,KAAK,OAAO,UAAU;AAAA,MACrB;AAAA,QACC,MAAM;AAAA,QACN,WAAWjB;AAAA,QACX,OAAO,CAACkB,GAAyBC,MAAc;AAC9C,gBAAMC,IAASD,EAAK,MAAM,OAAO;AACjC,eAAK,KAAKC,CAAM;AAAA,QACjB;AAAA,MAAA;AAAA,IACD,CACA;AAAA,EACF;AAAA,EAlDAR;AAAA,EAMAG;AAAA,EAGAC;AAAA;AAAA,EAGA,eAAeK,GAAuC;AACrD,SAAKN,KAAeM;AAAA,EACrB;AAAA;AAAA,EAGA,kBAAkBA,GAAuC;AACxD,SAAKL,KAAkBK;AAAA,EACxB;AAAA;AAAA,EAGA,MAAM,OAAsB;AAC3B,IAAI,KAAKN,MACR,MAAM,KAAKA,GAAA;AAAA,EAEb;AAAA;AAAA,EAGA,MAAM,UAAyB;AAC9B,IAAI,KAAKC,MACR,MAAM,KAAKA,GAAA;AAAA,EAEb;AAAA,EAmBA,MAAM,KAAKI,GAAgB;AAG1B,UAAME,IAFe,mBAAmBF,CAAM,EAG5C,MAAM,GAAG,EACT,IAAI,CAACG,MAASA,EAAK,OAAO,CAAC,EAAE,YAAA,IAAgBA,EAAK,MAAM,CAAC,CAAC,EAC1D,KAAK,GAAG;AACV,SAAKX,GAAM,SAAS,EAAE,QAAAQ,GAAQ,MAAME,GAAa;AAAA,EAClD;AAAA,EAEA,YAAY;AACX,WAAO,KAAKV,GAAM,SAAA,GAAY;AAAA,EAC/B;AAAA,EAEA,gBAAgB;AACf,WAAO;AAAA,EACR;AAAA,EAEgB,UAAgB;AAC/B,SAAKA,GAAM,QAAA,GACX,MAAM,QAAA;AAAA,EACP;AACD;"}