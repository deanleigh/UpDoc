{"version":3,"file":"destination-picker-modal.element-BuD7esN7.js","sources":["../src/destination-picker-modal.element.ts"],"sourcesContent":["import type { DestinationConfig, DestinationField, DestinationBlockGrid } from './workflow.types.js';\r\nimport { getAllBlockContainers } from './destination-utils.js';\r\nimport type { DestinationPickerModalData, DestinationPickerModalValue } from './destination-picker-modal.token.js';\r\nimport { html, css, state, nothing, customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\n@customElement('up-doc-destination-picker-modal')\r\nexport class UpDocDestinationPickerModalElement extends UmbModalBaseElement<\r\n\tDestinationPickerModalData,\r\n\tDestinationPickerModalValue\r\n> {\r\n\t@state() private _activeTab = '';\r\n\t@state() private _selectedTargets = new Map<string, { target: string; blockKey?: string; contentTypeKey?: string }>();\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tconst tabs = this.#getTabs();\r\n\t\tif (tabs.length > 0) {\r\n\t\t\tthis._activeTab = tabs[0].id;\r\n\t\t}\r\n\t}\r\n\r\n\tget #destination(): DestinationConfig | undefined {\r\n\t\treturn this.data?.destination;\r\n\t}\r\n\r\n\t/** Build a Map of compound keys (blockKey:alias or alias) → source section ID for already-mapped fields */\r\n\tget #alreadyMapped(): Map<string, string> {\r\n\t\tconst mapped = new Map<string, string>();\r\n\t\tfor (const mapping of this.data?.existingMappings ?? []) {\r\n\t\t\tif (mapping.enabled === false) continue;\r\n\t\t\tfor (const dest of mapping.destinations) {\r\n\t\t\t\tmapped.set(this.#makeKey(dest.target, dest.blockKey), mapping.source);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn mapped;\r\n\t}\r\n\r\n\t/** Convert source key to readable label: \"tour-title.content\" → \"Tour Title\" */\r\n\t#formatSourceLabel(sourceKey: string): string {\r\n\t\t// Strip .content / .heading suffix — these are internal conventions, not user-facing\r\n\t\tconst sectionId = sourceKey.replace(/\\.(content|heading)$/, '');\r\n\t\treturn sectionId\r\n\t\t\t.split('-')\r\n\t\t\t.map((word) => word.charAt(0).toUpperCase() + word.slice(1))\r\n\t\t\t.join(' ');\r\n\t}\r\n\r\n\t#getTabs(): Array<{ id: string; label: string }> {\r\n\t\tif (!this.#destination) return [];\r\n\r\n\t\tconst tabs: Array<{ id: string; label: string }> = [];\r\n\t\tconst tabNames = new Set(this.#destination.fields.map((f) => f.tab).filter(Boolean));\r\n\r\n\t\tfor (const tabName of tabNames) {\r\n\t\t\ttabs.push({\r\n\t\t\t\tid: tabName!.toLowerCase().replace(/\\s+/g, '-'),\r\n\t\t\t\tlabel: tabName!,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (const container of getAllBlockContainers(this.#destination)) {\r\n\t\t\tconst containerTab = container.tab ?? 'Page Content';\r\n\t\t\tif (!tabNames.has(containerTab)) {\r\n\t\t\t\ttabNames.add(containerTab);\r\n\t\t\t\ttabs.push({\r\n\t\t\t\t\tid: containerTab.toLowerCase().replace(/\\s+/g, '-'),\r\n\t\t\t\t\tlabel: containerTab,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn tabs;\r\n\t}\r\n\r\n\t#makeKey(alias: string, blockKey?: string): string {\r\n\t\treturn blockKey ? `${blockKey}:${alias}` : alias;\r\n\t}\r\n\r\n\t#toggleTarget(alias: string, blockKey?: string, contentTypeKey?: string) {\r\n\t\tconst key = this.#makeKey(alias, blockKey);\r\n\t\tconst next = new Map(this._selectedTargets);\r\n\t\tif (next.has(key)) {\r\n\t\t\tnext.delete(key);\r\n\t\t} else {\r\n\t\t\tnext.set(key, { target: alias, blockKey, contentTypeKey });\r\n\t\t}\r\n\t\tthis._selectedTargets = next;\r\n\t}\r\n\r\n\t#onConfirm() {\r\n\t\tthis.value = { selectedTargets: Array.from(this._selectedTargets.values()) };\r\n\t\tthis.modalContext?.submit();\r\n\t}\r\n\r\n\t#onCancel() {\r\n\t\tthis.modalContext?.reject();\r\n\t}\r\n\r\n\t#renderField(field: DestinationField) {\r\n\t\tconst checked = this._selectedTargets.has(field.alias);\r\n\t\tconst mappedSource = this.#alreadyMapped.get(field.alias);\r\n\t\treturn html`\r\n\t\t\t<div class=\"field-item ${checked ? 'field-selected' : ''}\" @click=${() => this.#toggleTarget(field.alias)}>\r\n\t\t\t\t<uui-checkbox\r\n\t\t\t\t\tlabel=\"Select ${field.label}\"\r\n\t\t\t\t\t?checked=${checked}\r\n\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t@change=${() => this.#toggleTarget(field.alias)}>\r\n\t\t\t\t</uui-checkbox>\r\n\t\t\t\t<div class=\"field-info\">\r\n\t\t\t\t\t<span class=\"field-label\">${field.label}</span>\r\n\t\t\t\t\t${mappedSource ? html`<span class=\"field-mapped\" title=\"Mapped from: ${this.#formatSourceLabel(mappedSource)}\">${this.#formatSourceLabel(mappedSource)}</span>` : nothing}\r\n\t\t\t\t\t<span class=\"field-type\">${field.type}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderFieldsForTab(tabName: string) {\r\n\t\tif (!this.#destination) return nothing;\r\n\r\n\t\tconst fields = this.#destination.fields.filter((f) => f.tab === tabName);\r\n\t\tif (fields.length === 0) return html`<p class=\"empty-message\">No fields in this tab.</p>`;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"field-list\">\r\n\t\t\t\t${fields.map((field) => this.#renderField(field))}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBlockContainersForTab(tabId: string) {\r\n\t\tif (!this.#destination) return nothing;\r\n\r\n\t\tconst containers = getAllBlockContainers(this.#destination).filter((c) => {\r\n\t\t\tconst cTab = c.tab ?? 'Page Content';\r\n\t\t\treturn cTab.toLowerCase().replace(/\\s+/g, '-') === tabId;\r\n\t\t});\r\n\r\n\t\tif (!containers.length) {\r\n\t\t\treturn html`<p class=\"empty-message\">No blocks configured.</p>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t${containers.map((container) => this.#renderBlockGrid(container))}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBlockGrid(grid: DestinationBlockGrid) {\r\n\t\treturn html`\r\n\t\t\t<div class=\"block-grid\">\r\n\t\t\t\t<div class=\"block-grid-header\">\r\n\t\t\t\t\t<span class=\"block-grid-label\">${grid.label}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"block-list\">\r\n\t\t\t\t\t${grid.blocks.map(\r\n\t\t\t\t\t\t(block) => html`\r\n\t\t\t\t\t\t\t<div class=\"block-item\">\r\n\t\t\t\t\t\t\t\t<div class=\"block-header\">\r\n\t\t\t\t\t\t\t\t\t<umb-icon name=\"icon-box\"></umb-icon>\r\n\t\t\t\t\t\t\t\t\t<span class=\"block-label\">${block.label}</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t${block.properties?.length\r\n\t\t\t\t\t\t\t\t\t? html`\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"block-properties\">\r\n\t\t\t\t\t\t\t\t\t\t\t${block.properties.map((prop) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst compoundKey = this.#makeKey(prop.alias, block.key);\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst checked = this._selectedTargets.has(compoundKey);\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst mappedSource = this.#alreadyMapped.get(compoundKey);\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn html`\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"block-property ${checked ? 'field-selected' : ''}\" @click=${() => this.#toggleTarget(prop.alias, block.key, block.contentTypeKey)}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<uui-checkbox\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel=\"Select ${prop.label || prop.alias}\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?checked=${checked}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t@change=${() => this.#toggleTarget(prop.alias, block.key, block.contentTypeKey)}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</uui-checkbox>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"block-property-label\">${prop.label || prop.alias}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${mappedSource ? html`<span class=\"field-mapped\" title=\"Mapped from: ${this.#formatSourceLabel(mappedSource)}\">${this.#formatSourceLabel(mappedSource)}</span>` : nothing}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"field-type\">${prop.type}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t`;\r\n\t\t\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t`\r\n\t\t\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderTabContent() {\r\n\t\tif (!this.#destination) return nothing;\r\n\r\n\t\t// Check if this tab has fields\r\n\t\tconst tabName = this.#destination.fields.find(\r\n\t\t\t(f) => f.tab && f.tab.toLowerCase().replace(/\\s+/g, '-') === this._activeTab\r\n\t\t)?.tab;\r\n\r\n\t\t// Check if this tab has block containers\r\n\t\tconst hasContainers = getAllBlockContainers(this.#destination).some((c) => {\r\n\t\t\tconst cTab = c.tab ?? 'Page Content';\r\n\t\t\treturn cTab.toLowerCase().replace(/\\s+/g, '-') === this._activeTab;\r\n\t\t});\r\n\r\n\t\treturn html`\r\n\t\t\t${tabName ? this.#renderFieldsForTab(tabName) : nothing}\r\n\t\t\t${hasContainers ? this.#renderBlockContainersForTab(this._activeTab) : nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tconst tabs = this.#getTabs();\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=\"Pick destination field(s)\">\r\n\t\t\t\t<div class=\"tab-content\">\r\n\t\t\t\t\t<uui-tab-group class=\"content-inner-tabs\" dropdown-content-direction=\"vertical\">\r\n\t\t\t\t\t\t${tabs.map(\r\n\t\t\t\t\t\t\t(tab) => html`\r\n\t\t\t\t\t\t\t\t<uui-tab\r\n\t\t\t\t\t\t\t\t\tlabel=${tab.label}\r\n\t\t\t\t\t\t\t\t\t?active=${this._activeTab === tab.id}\r\n\t\t\t\t\t\t\t\t\t@click=${() => { this._activeTab = tab.id; }}>\r\n\t\t\t\t\t\t\t\t\t${tab.label}\r\n\t\t\t\t\t\t\t\t</uui-tab>\r\n\t\t\t\t\t\t\t`\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</uui-tab-group>\r\n\r\n\t\t\t\t\t${this.#renderTabContent()}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=\"Cancel\" @click=${this.#onCancel}>Cancel</uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\tlabel=\"Confirm\"\r\n\t\t\t\t\t\t?disabled=${this._selectedTargets.size === 0}\r\n\t\t\t\t\t\t@click=${this.#onConfirm}>\r\n\t\t\t\t\t\tMap to ${this._selectedTargets.size} field${this._selectedTargets.size !== 1 ? 's' : ''}\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\t--uui-tab-background: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\t.tab-content {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t/* Inner tabs — bleed edge-to-edge past body layout padding */\r\n\t\t\t.content-inner-tabs {\r\n\t\t\t\tmargin: calc(var(--uui-size-layout-1) * -1);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-surface);\r\n\t\t\t\t--uui-tab-background: var(--uui-color-surface);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-message {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.field-list {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t.field-item {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.field-item:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.field-item.field-selected {\r\n\t\t\t\tbackground: var(--uui-color-selected);\r\n\t\t\t}\r\n\r\n\t\t\t.field-item:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t.field-info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.field-label {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.field-type {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tpadding: 2px 8px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t.field-mapped {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tbackground: var(--uui-color-positive-standalone);\r\n\t\t\t\tpadding: 2px 8px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t.block-grid {\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.block-grid-header {\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.block-grid-label {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.block-list {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t.block-item {\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tpadding-left: var(--uui-size-space-6);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.block-item:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t.block-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.block-label {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.block-properties {\r\n\t\t\t\tpadding-left: var(--uui-size-space-5);\r\n\t\t\t}\r\n\r\n\t\t\t.block-property {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-3);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t.block-property:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.block-property.field-selected {\r\n\t\t\t\tbackground: var(--uui-color-selected);\r\n\t\t\t}\r\n\r\n\t\t\t.block-property-label {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocDestinationPickerModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-destination-picker-modal': UpDocDestinationPickerModalElement;\r\n\t}\r\n}\r\n"],"names":["_UpDocDestinationPickerModalElement_instances","destination_get","alreadyMapped_get","formatSourceLabel_fn","getTabs_fn","makeKey_fn","toggleTarget_fn","onConfirm_fn","onCancel_fn","renderField_fn","renderFieldsForTab_fn","renderBlockContainersForTab_fn","renderBlockGrid_fn","renderTabContent_fn","UpDocDestinationPickerModalElement","UmbModalBaseElement","__privateAdd","tabs","__privateMethod","html","tab","mapped","mapping","dest","sourceKey","word","__privateGet","tabNames","f","tabName","container","getAllBlockContainers","containerTab","alias","blockKey","contentTypeKey","key","next","field","checked","mappedSource","e","nothing","fields","tabId","containers","c","grid","block","prop","compoundKey","hasContainers","UmbTextStyles","css","__decorateClass","state","customElement","UpDocDestinationPickerModalElement_default"],"mappings":"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"}