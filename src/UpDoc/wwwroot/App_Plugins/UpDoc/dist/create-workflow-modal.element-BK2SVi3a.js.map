{"version":3,"file":"create-workflow-modal.element-BK2SVi3a.js","sources":["../src/create-workflow-modal.element.ts"],"sourcesContent":["import type { CreateWorkflowModalData, CreateWorkflowModalValue } from './create-workflow-modal.token.js';\r\nimport { html, customElement, css, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\n\r\ninterface DocumentTypeOption {\r\n\talias: string;\r\n\tname: string;\r\n\ticon: string;\r\n\tid: string;\r\n}\r\n\r\ninterface BlueprintOption {\r\n\tid: string;\r\n\tname: string;\r\n}\r\n\r\n@customElement('create-workflow-modal')\r\nexport class CreateWorkflowModalElement extends UmbModalBaseElement<\r\n\tCreateWorkflowModalData,\r\n\tCreateWorkflowModalValue\r\n> {\r\n\t@state() private _name = '';\r\n\t@state() private _documentTypeAlias = '';\r\n\t@state() private _blueprintId = '';\r\n\t@state() private _blueprintName = '';\r\n\r\n\t@state() private _documentTypes: DocumentTypeOption[] = [];\r\n\t@state() private _blueprints: BlueprintOption[] = [];\r\n\t@state() private _loadingDocTypes = true;\r\n\t@state() private _loadingBlueprints = false;\r\n\r\n\tprivate _nameManuallyEdited = false;\r\n\r\n\toverride async connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tawait this.#loadDocumentTypes();\r\n\t}\r\n\r\n\tasync #getToken(): Promise<string> {\r\n\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\treturn await authContext.getLatestToken();\r\n\t}\r\n\r\n\tasync #loadDocumentTypes() {\r\n\t\tthis._loadingDocTypes = true;\r\n\t\ttry {\r\n\t\t\tconst token = await this.#getToken();\r\n\t\t\tconst response = await fetch('/umbraco/management/api/v1/updoc/document-types', {\r\n\t\t\t\theaders: { Authorization: `Bearer ${token}` },\r\n\t\t\t});\r\n\t\t\tif (response.ok) {\r\n\t\t\t\tthis._documentTypes = await response.json();\r\n\t\t\t}\r\n\t\t} catch {\r\n\t\t\t// Leave empty â€” user sees \"No document types found\"\r\n\t\t}\r\n\t\tthis._loadingDocTypes = false;\r\n\t}\r\n\r\n\tasync #loadBlueprints(alias: string) {\r\n\t\tthis._loadingBlueprints = true;\r\n\t\tthis._blueprints = [];\r\n\t\tthis._blueprintId = '';\r\n\t\tthis._blueprintName = '';\r\n\t\ttry {\r\n\t\t\tconst token = await this.#getToken();\r\n\t\t\tconst response = await fetch(\r\n\t\t\t\t`/umbraco/management/api/v1/updoc/document-types/${encodeURIComponent(alias)}/blueprints`,\r\n\t\t\t\t{ headers: { Authorization: `Bearer ${token}` } },\r\n\t\t\t);\r\n\t\t\tif (response.ok) {\r\n\t\t\t\tthis._blueprints = await response.json();\r\n\t\t\t}\r\n\t\t} catch {\r\n\t\t\t// Leave empty\r\n\t\t}\r\n\t\tthis._loadingBlueprints = false;\r\n\t}\r\n\r\n\t#toKebabCase(value: string): string {\r\n\t\treturn value\r\n\t\t\t.replace(/([a-z])([A-Z])/g, '$1-$2')\r\n\t\t\t.replace(/[\\s_]+/g, '-')\r\n\t\t\t.toLowerCase();\r\n\t}\r\n\r\n\t#handleDocTypeChange(e: Event) {\r\n\t\tconst alias = (e.target as HTMLSelectElement).value;\r\n\t\tthis._documentTypeAlias = alias;\r\n\t\tthis._blueprintId = '';\r\n\t\tthis._blueprintName = '';\r\n\t\tif (!this._nameManuallyEdited) {\r\n\t\t\tthis._name = '';\r\n\t\t}\r\n\r\n\t\tif (alias) {\r\n\t\t\tthis.#loadBlueprints(alias);\r\n\t\t} else {\r\n\t\t\tthis._blueprints = [];\r\n\t\t}\r\n\r\n\t\tthis.requestUpdate();\r\n\t}\r\n\r\n\t#handleBlueprintChange(e: Event) {\r\n\t\tconst blueprintId = (e.target as HTMLSelectElement).value;\r\n\t\tthis._blueprintId = blueprintId;\r\n\r\n\t\tconst blueprint = this._blueprints.find((b) => b.id === blueprintId);\r\n\t\tthis._blueprintName = blueprint?.name ?? '';\r\n\r\n\t\tif (!this._nameManuallyEdited && blueprint?.name) {\r\n\t\t\tthis._name = this.#toKebabCase(blueprint.name);\r\n\t\t}\r\n\r\n\t\tthis.requestUpdate();\r\n\t}\r\n\r\n\t#handleNameInput(e: InputEvent) {\r\n\t\tconst target = e.target as HTMLInputElement;\r\n\t\tthis._name = target.value;\r\n\t\tthis._nameManuallyEdited = true;\r\n\t}\r\n\r\n\tget #isValid(): boolean {\r\n\t\treturn (\r\n\t\t\tthis._name.trim().length > 0 &&\r\n\t\t\tthis._documentTypeAlias.trim().length > 0 &&\r\n\t\t\tthis._blueprintId.trim().length > 0\r\n\t\t);\r\n\t}\r\n\r\n\t#handleSubmit() {\r\n\t\tif (!this.#isValid) return;\r\n\r\n\t\tthis.value = {\r\n\t\t\tname: this._name.trim(),\r\n\t\t\tdocumentTypeAlias: this._documentTypeAlias.trim(),\r\n\t\t\tblueprintId: this._blueprintId.trim(),\r\n\t\t\tblueprintName: this._blueprintName.trim() || undefined,\r\n\t\t};\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\t#handleClose() {\r\n\t\tthis._rejectModal();\r\n\t}\r\n\r\n\t#renderDocTypeSelect() {\r\n\t\tif (this._loadingDocTypes) {\r\n\t\t\treturn html`<uui-loader-bar></uui-loader-bar>`;\r\n\t\t}\r\n\r\n\t\tif (this._documentTypes.length === 0) {\r\n\t\t\treturn html`<small class=\"hint\" style=\"color: var(--uui-color-danger);\">No document types found.</small>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-select\r\n\t\t\t\tlabel=\"Select document type\"\r\n\t\t\t\t.options=${[\r\n\t\t\t\t\t{ name: 'Choose a document type...', value: '', selected: this._documentTypeAlias === '' },\r\n\t\t\t\t\t...this._documentTypes.map((dt) => ({\r\n\t\t\t\t\t\tname: dt.name ?? dt.alias,\r\n\t\t\t\t\t\tvalue: dt.alias,\r\n\t\t\t\t\t\tselected: this._documentTypeAlias === dt.alias,\r\n\t\t\t\t\t})),\r\n\t\t\t\t]}\r\n\t\t\t\t@change=${this.#handleDocTypeChange}>\r\n\t\t\t</uui-select>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBlueprintSelect() {\r\n\t\tif (!this._documentTypeAlias) {\r\n\t\t\treturn html`<uui-select label=\"Select blueprint\" disabled\r\n\t\t\t\t.options=${[{ name: 'Select a document type first...', value: '', selected: true }]}>\r\n\t\t\t</uui-select>`;\r\n\t\t}\r\n\r\n\t\tif (this._loadingBlueprints) {\r\n\t\t\treturn html`<uui-loader-bar></uui-loader-bar>`;\r\n\t\t}\r\n\r\n\t\tif (this._blueprints.length === 0) {\r\n\t\t\treturn html`\r\n\t\t\t\t<uui-select label=\"No blueprints\" disabled\r\n\t\t\t\t\t.options=${[{ name: 'No blueprints available', value: '', selected: true }]}>\r\n\t\t\t\t</uui-select>\r\n\t\t\t\t<small class=\"hint\" style=\"color: var(--uui-color-warning-standalone);\">\r\n\t\t\t\t\tNo blueprints exist for this document type. Create a Document Blueprint first.\r\n\t\t\t\t</small>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-select\r\n\t\t\t\tlabel=\"Select blueprint\"\r\n\t\t\t\t.options=${[\r\n\t\t\t\t\t{ name: 'Choose a blueprint...', value: '', selected: this._blueprintId === '' },\r\n\t\t\t\t\t...this._blueprints.map((bp) => ({\r\n\t\t\t\t\t\tname: bp.name,\r\n\t\t\t\t\t\tvalue: bp.id,\r\n\t\t\t\t\t\tselected: this._blueprintId === bp.id,\r\n\t\t\t\t\t})),\r\n\t\t\t\t]}\r\n\t\t\t\t@change=${this.#handleBlueprintChange}>\r\n\t\t\t</uui-select>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<uui-dialog-layout headline=\"Create Workflow\">\r\n\t\t\t\t<div class=\"form\">\r\n\t\t\t\t\t<uui-label for=\"workflowName\" required>Workflow Name</uui-label>\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\tid=\"workflowName\"\r\n\t\t\t\t\t\tplaceholder=\"e.g. group-tour\"\r\n\t\t\t\t\t\t.value=${this._name}\r\n\t\t\t\t\t\t@input=${this.#handleNameInput}>\r\n\t\t\t\t\t</uui-input>\r\n\t\t\t\t\t<small class=\"hint\">Used as the folder name. Enter your own or leave blank to auto-generate from the blueprint.</small>\r\n\r\n\t\t\t\t\t<uui-label required>Document Type</uui-label>\r\n\t\t\t\t\t${this.#renderDocTypeSelect()}\r\n\r\n\t\t\t\t\t<uui-label required>Blueprint</uui-label>\r\n\t\t\t\t\t${this.#renderBlueprintSelect()}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\tlabel=\"Cancel\"\r\n\t\t\t\t\t@click=${this.#handleClose}></uui-button>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\tlabel=\"Create\"\r\n\t\t\t\t\t?disabled=${!this.#isValid}\r\n\t\t\t\t\t@click=${this.#handleSubmit}></uui-button>\r\n\t\t\t</uui-dialog-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t.form {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.hint {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tmargin-top: calc(var(--uui-size-space-1) * -1);\r\n\t\t\t}\r\n\r\n\t\t\tuui-input, uui-select {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default CreateWorkflowModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'create-workflow-modal': CreateWorkflowModalElement;\r\n\t}\r\n}\r\n"],"names":["_CreateWorkflowModalElement_instances","getToken_fn","loadDocumentTypes_fn","loadBlueprints_fn","toKebabCase_fn","handleDocTypeChange_fn","handleBlueprintChange_fn","handleNameInput_fn","isValid_get","handleSubmit_fn","handleClose_fn","renderDocTypeSelect_fn","renderBlueprintSelect_fn","CreateWorkflowModalElement","UmbModalBaseElement","__privateAdd","__privateMethod","html","__privateGet","UMB_AUTH_CONTEXT","token","response","alias","value","blueprintId","blueprint","b","target","dt","bp","UmbTextStyles","css","__decorateClass","state","customElement","CreateWorkflowModalElement_default"],"mappings":"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"}