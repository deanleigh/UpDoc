{"version":3,"file":"up-doc-workflow-source-view.element-CyIgD9fF.js","sources":["../src/pdf-area-editor-modal.token.ts","../src/section-rules-editor-modal.token.ts","../src/destination-picker-modal.token.ts","../src/up-doc-workflow-source-view.element.ts"],"sourcesContent":["import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\nimport type { AreaTemplate } from './workflow.types.js';\r\n\r\nexport interface AreaEditorModalData {\r\n\tworkflowAlias: string;\r\n\texistingTemplate?: AreaTemplate | null;\r\n\tselectedPages?: number[] | null;\r\n}\r\n\r\nexport interface AreaEditorModalValue {\r\n\ttemplate: AreaTemplate;\r\n}\r\n\r\nexport const UMB_AREA_EDITOR_MODAL = new UmbModalToken<AreaEditorModalData, AreaEditorModalValue>(\r\n\t'UpDoc.AreaEditorModal',\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'sidebar',\r\n\t\t\tsize: 'large',\r\n\t\t},\r\n\t},\r\n);\r\n","import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\nimport type { AreaElement, AreaRules } from './workflow.types.js';\r\n\r\nexport interface SectionRulesEditorModalData {\r\n\tworkflowAlias: string;\r\n\tsectionId: string;\r\n\tsectionHeading: string;\r\n\t/** The elements belonging to this section (from area detection). */\r\n\telements: AreaElement[];\r\n\t/** Existing rules for this section, if any. */\r\n\texistingRules?: AreaRules | null;\r\n\t/** Callback for \"Save\" (persist without closing). Called with the current rules value. */\r\n\tonSave?: (rules: AreaRules) => Promise<void>;\r\n}\r\n\r\nexport interface SectionRulesEditorModalValue {\r\n\trules: AreaRules;\r\n}\r\n\r\nexport const UMB_SECTION_RULES_EDITOR_MODAL = new UmbModalToken<SectionRulesEditorModalData, SectionRulesEditorModalValue>(\r\n\t'UpDoc.SectionRulesEditorModal',\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'sidebar',\r\n\t\t\tsize: 'medium',\r\n\t\t},\r\n\t},\r\n);\r\n","import type { DestinationConfig, SectionMapping } from './workflow.types.js';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface DestinationPickerModalData {\r\n\tdestination: DestinationConfig;\r\n\t/** Existing mappings so the picker can show which fields are already mapped */\r\n\texistingMappings?: SectionMapping[];\r\n}\r\n\r\nexport interface DestinationPickerModalValue {\r\n\tselectedTargets: Array<{ target: string; blockKey?: string; contentTypeKey?: string }>;\r\n}\r\n\r\nexport const UMB_DESTINATION_PICKER_MODAL = new UmbModalToken<\r\n\tDestinationPickerModalData,\r\n\tDestinationPickerModalValue\r\n>('UpDoc.DestinationPickerModal', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'medium',\r\n\t},\r\n});\r\n","import type { RichExtractionResult, DocumentTypeConfig, MappingDestination, AreaDetectionResult, DetectedArea, DetectedSection, AreaElement, TransformResult, TransformedSection, SourceConfig, AreaTemplate, AreaRules, InferSectionPatternResponse, MapConfig, SectionMapping } from './workflow.types.js';\r\nimport { allTransformSections } from './workflow.types.js';\r\nimport { fetchSampleExtraction, triggerSampleExtraction, fetchWorkflowByAlias, fetchAreaDetection, triggerTransform, fetchTransformResult, updateSectionInclusion, savePageSelection, fetchSourceConfig, fetchAreaTemplate, saveAreaTemplate, saveAreaRules, inferSectionPattern, saveMapConfig } from './workflow.service.js';\r\nimport { normalizeToKebabCase, markdownToHtml } from './transforms.js';\r\nimport { getAllBlockContainers } from './destination-utils.js';\r\nimport { UMB_AREA_EDITOR_MODAL } from './pdf-area-editor-modal.token.js';\r\nimport { UMB_PAGE_PICKER_MODAL } from './page-picker-modal.token.js';\r\nimport { UMB_SECTION_RULES_EDITOR_MODAL } from './section-rules-editor-modal.token.js';\r\nimport { html, css, state, nothing, unsafeHTML } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MEDIA_PICKER_MODAL } from '@umbraco-cms/backoffice/media';\r\nimport { UMB_DESTINATION_PICKER_MODAL } from './destination-picker-modal.token.js';\r\n\r\n@customElement('up-doc-workflow-source-view')\r\nexport class UpDocWorkflowSourceViewElement extends UmbLitElement {\r\n\t@state() private _extraction: RichExtractionResult | null = null;\r\n\t@state() private _areaDetection: AreaDetectionResult | null = null;\r\n\t@state() private _config: DocumentTypeConfig | null = null;\r\n\t@state() private _workflowAlias: string | null = null;\r\n\t@state() private _loading = true;\r\n\t@state() private _extracting = false;\r\n\t@state() private _error: string | null = null;\r\n\t@state() private _successMessage: string | null = null;\r\n\t@state() private _collapsed = new Set<string>();\r\n\t@state() private _transformResult: TransformResult | null = null;\r\n\t@state() private _viewMode: 'elements' | 'transformed' = 'elements';\r\n\t@state() private _sourceConfig: SourceConfig | null = null;\r\n\t@state() private _pageMode: 'all' | 'custom' = 'all';\r\n\t@state() private _pageInputValue = '';\r\n\t@state() private _collapsePopoverOpen = false;\r\n\t@state() private _excludedAreas = new Set<string>();\r\n\t@state() private _areaTemplate: AreaTemplate | null = null;\r\n\t@state() private _sectionPickerOpen = false;\r\n\t/** Area index currently in teach mode (null = not teaching). */\r\n\t@state() private _teachingAreaIndex: number | null = null;\r\n\t/** Inference result from clicking an element in teach mode. */\r\n\t@state() private _inferenceResult: InferSectionPatternResponse | null = null;\r\n\t/** Whether an inference API call is in progress. */\r\n\t@state() private _inferring = false;\r\n\t@state() private _sampleUrl = '';\r\n\t#token = '';\r\n\t#orphanedKeys = new Set<string>();\r\n\r\n\t/** Get the source type for this workflow (pdf, markdown, web, etc.) */\r\n\tget #sourceType(): string {\r\n\t\treturn this._sourceConfig?.sourceTypes?.[0] ?? 'pdf';\r\n\t}\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.consumeContext(UMB_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\t\t\t// Register refresh handler so the workspace Refresh button triggers re-extraction\r\n\t\t\t(context as any).setRefreshHandler(() => this.#onReExtract());\r\n\t\t\tthis.observe((context as any).unique, (unique: string | null) => {\r\n\t\t\t\tif (unique) {\r\n\t\t\t\t\tthis._workflowAlias = decodeURIComponent(unique);\r\n\t\t\t\t\tthis.#loadData();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #loadData() {\r\n\t\tif (!this._workflowAlias) return;\r\n\r\n\t\tthis._loading = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tthis.#token = await authContext.getLatestToken();\r\n\r\n\t\t\t// Always load source config first to determine source type\r\n\t\t\tconst [extraction, config, sourceConfig] = await Promise.all([\r\n\t\t\t\tfetchSampleExtraction(this._workflowAlias, this.#token),\r\n\t\t\t\tfetchWorkflowByAlias(this._workflowAlias, this.#token),\r\n\t\t\t\tfetchSourceConfig(this._workflowAlias, this.#token),\r\n\t\t\t]);\r\n\t\t\tthis._extraction = extraction;\r\n\t\t\tthis._config = config;\r\n\t\t\tthis._sourceConfig = sourceConfig;\r\n\t\t\t// Build set of orphaned destinations from validation warnings\r\n\t\t\tthis.#orphanedKeys = new Set<string>();\r\n\t\t\tfor (const w of config?.validationWarnings ?? []) {\r\n\t\t\t\tconst m = w.match(/blockKey '([^']+)' for target '([^']+)'/);\r\n\t\t\t\tif (m) this.#orphanedKeys.add(`${m[1]}:${m[2]}`);\r\n\t\t\t}\r\n\r\n\t\t\tconst isPdf = (sourceConfig?.sourceTypes?.[0] ?? 'pdf') === 'pdf';\r\n\t\t\tconst isWeb = (sourceConfig?.sourceTypes?.[0]) === 'web';\r\n\r\n\t\t\tif (isPdf) {\r\n\t\t\t\t// PDF-specific: load area detection, transform, area template\r\n\t\t\t\tconst [areaDetection, transformResult, areaTemplate] = await Promise.all([\r\n\t\t\t\t\tfetchAreaDetection(this._workflowAlias, this.#token),\r\n\t\t\t\t\tfetchTransformResult(this._workflowAlias, this.#token),\r\n\t\t\t\t\tfetchAreaTemplate(this._workflowAlias, this.#token),\r\n\t\t\t\t]);\r\n\t\t\t\tthis._areaDetection = areaDetection;\r\n\t\t\t\tthis._transformResult = transformResult;\r\n\t\t\t\tthis._areaTemplate = areaTemplate;\r\n\r\n\t\t\t\t// Always re-trigger transform on load to ensure fresh data\r\n\t\t\t\tconst mediaKey = extraction?.source.mediaKey;\r\n\t\t\t\tif (mediaKey && areaDetection) {\r\n\t\t\t\t\tconst freshTransform = await triggerTransform(this._workflowAlias, mediaKey, this.#token);\r\n\t\t\t\t\tif (freshTransform) {\r\n\t\t\t\t\t\tthis._transformResult = freshTransform;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Initialize page selection state from source config\r\n\t\t\t\tif (sourceConfig?.pages && Array.isArray(sourceConfig.pages) && sourceConfig.pages.length > 0) {\r\n\t\t\t\t\tthis._pageMode = 'custom';\r\n\t\t\t\t\tthis._pageInputValue = this.#pagesToRangeString(sourceConfig.pages);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._pageMode = 'all';\r\n\t\t\t\t\tthis._pageInputValue = '';\r\n\t\t\t\t}\r\n\t\t\t} else if (isWeb) {\r\n\t\t\t\t// Web: load area detection (auto-generated from extraction) + transform\r\n\t\t\t\tconst [areaDetection, transformResult] = await Promise.all([\r\n\t\t\t\t\tfetchAreaDetection(this._workflowAlias, this.#token),\r\n\t\t\t\t\tfetchTransformResult(this._workflowAlias, this.#token),\r\n\t\t\t\t]);\r\n\t\t\t\tthis._areaDetection = areaDetection;\r\n\t\t\t\tthis._transformResult = transformResult;\r\n\t\t\t} else {\r\n\t\t\t\t// Markdown: load area detection + transform (both auto-generated from extraction)\r\n\t\t\t\tconst [areaDetection, transformResult] = await Promise.all([\r\n\t\t\t\t\tfetchAreaDetection(this._workflowAlias, this.#token),\r\n\t\t\t\t\tfetchTransformResult(this._workflowAlias, this.#token),\r\n\t\t\t\t]);\r\n\t\t\t\tthis._areaDetection = areaDetection;\r\n\t\t\t\tthis._transformResult = transformResult;\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Failed to load data';\r\n\t\t\tconsole.error('Failed to load source data:', err);\r\n\t\t} finally {\r\n\t\t\tthis._loading = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Convert \"1-3, 5, 7-9\" → [1, 2, 3, 5, 7, 8, 9] */\r\n\t#parsePageRange(input: string): number[] {\r\n\t\tconst pages = new Set<number>();\r\n\t\tfor (const part of input.split(',')) {\r\n\t\t\tconst trimmed = part.trim();\r\n\t\t\tif (!trimmed) continue;\r\n\t\t\tconst rangeParts = trimmed.split('-').map((s) => parseInt(s.trim(), 10));\r\n\t\t\tif (rangeParts.length === 1 && !isNaN(rangeParts[0])) {\r\n\t\t\t\tpages.add(rangeParts[0]);\r\n\t\t\t} else if (rangeParts.length === 2 && !isNaN(rangeParts[0]) && !isNaN(rangeParts[1])) {\r\n\t\t\t\tfor (let i = rangeParts[0]; i <= rangeParts[1]; i++) {\r\n\t\t\t\t\tpages.add(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [...pages].sort((a, b) => a - b);\r\n\t}\r\n\r\n\t/** Convert [1, 2, 3, 5, 7, 8, 9] → \"1-3, 5, 7-9\" */\r\n\t#pagesToRangeString(pages: number[]): string {\r\n\t\tif (!pages.length) return '';\r\n\t\tconst sorted = [...pages].sort((a, b) => a - b);\r\n\t\tconst ranges: string[] = [];\r\n\t\tlet start = sorted[0];\r\n\t\tlet end = sorted[0];\r\n\t\tfor (let i = 1; i < sorted.length; i++) {\r\n\t\t\tif (sorted[i] === end + 1) {\r\n\t\t\t\tend = sorted[i];\r\n\t\t\t} else {\r\n\t\t\t\tranges.push(start === end ? `${start}` : `${start}-${end}`);\r\n\t\t\t\tstart = sorted[i];\r\n\t\t\t\tend = sorted[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tranges.push(start === end ? `${start}` : `${start}-${end}`);\r\n\t\treturn ranges.join(', ');\r\n\t}\r\n\r\n\t/** Get the currently selected page numbers, or null for \"all\". */\r\n\t#getSelectedPages(): number[] | null {\r\n\t\tif (this._pageMode === 'all') return null;\r\n\t\tconst pages = this.#parsePageRange(this._pageInputValue);\r\n\t\treturn pages.length > 0 ? pages : null;\r\n\t}\r\n\r\n\t/** Check whether a specific page number is included in the current selection. */\r\n\t#isPageIncluded(pageNum: number): boolean {\r\n\t\tif (this._pageMode === 'all') return true;\r\n\t\tconst pages = this.#parsePageRange(this._pageInputValue);\r\n\t\treturn pages.length === 0 || pages.includes(pageNum);\r\n\t}\r\n\r\n\r\n\r\n\tasync #savePageSelection() {\r\n\t\tif (!this._workflowAlias) return;\r\n\t\tconst pages = this.#getSelectedPages();\r\n\t\tawait savePageSelection(this._workflowAlias, pages, this.#token);\r\n\t}\r\n\r\n\t/** Get all collapse keys for a given level. */\r\n\t#getKeysForLevel(level: 'pages' | 'areas' | 'sections'): string[] {\r\n\t\tif (!this._areaDetection) return [];\r\n\t\tconst keys: string[] = [];\r\n\t\tfor (const page of this._areaDetection.pages) {\r\n\t\t\tconst pageNum = page.page;\r\n\t\t\tif (level === 'pages') {\r\n\t\t\t\tkeys.push(`page-${pageNum}`);\r\n\t\t\t}\r\n\t\t\tif (level === 'areas') {\r\n\t\t\t\tpage.areas.forEach((_z, aIdx) => keys.push(`area-p${pageNum}-a${aIdx}`));\r\n\t\t\t}\r\n\t\t\tif (level === 'sections') {\r\n\t\t\t\t// Raw section keys\r\n\t\t\t\tpage.areas.forEach((_z, aIdx) => {\r\n\t\t\t\t\t_z.sections.forEach((_s, sIdx) => keys.push(`p${pageNum}-a${aIdx}-s${sIdx}`));\r\n\t\t\t\t});\r\n\t\t\t\t// Composed section keys (from transform rules)\r\n\t\t\t\tpage.areas.forEach((area) => {\r\n\t\t\t\t\tconst composed = this.#getTransformSectionsForArea(area, pageNum);\r\n\t\t\t\t\tcomposed.forEach((s) => keys.push(`composed-${s.id}`));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn keys;\r\n\t}\r\n\r\n\t/** Check if all items at a level are currently collapsed. */\r\n\t#isLevelCollapsed(level: 'pages' | 'areas' | 'sections'): boolean {\r\n\t\tconst keys = this.#getKeysForLevel(level);\r\n\t\treturn keys.length > 0 && keys.every((k) => this._collapsed.has(k));\r\n\t}\r\n\r\n\t/** Toggle all items at a given level. */\r\n\t#toggleLevel(level: 'pages' | 'areas' | 'sections') {\r\n\t\tconst keys = this.#getKeysForLevel(level);\r\n\t\tconst allCollapsed = this.#isLevelCollapsed(level);\r\n\t\tconst next = new Set(this._collapsed);\r\n\t\tfor (const key of keys) {\r\n\t\t\tif (allCollapsed) {\r\n\t\t\t\tnext.delete(key);\r\n\t\t\t} else {\r\n\t\t\t\tnext.add(key);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._collapsed = next;\r\n\t}\r\n\r\n\t/** Expand everything. */\r\n\t#expandAll() {\r\n\t\tthis._collapsed = new Set<string>();\r\n\t}\r\n\r\n\t#onCollapsePopoverToggle(event: ToggleEvent) {\r\n\t\tthis._collapsePopoverOpen = event.newState === 'open';\r\n\t}\r\n\r\n\t/** Shared collapse/expand button with popover for all source types. */\r\n\t#renderCollapseRow() {\r\n\t\tif (!this._areaDetection || this._viewMode !== 'elements') return nothing;\r\n\t\treturn html`\r\n\t\t\t<div class=\"collapse-row\">\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\tcompact\r\n\t\t\t\t\tlabel=\"Collapse\"\r\n\t\t\t\t\tpopovertarget=\"collapse-level-popover\">\r\n\t\t\t\t\tCollapse\r\n\t\t\t\t\t<uui-symbol-expand .open=${this._collapsePopoverOpen}></uui-symbol-expand>\r\n\t\t\t\t</uui-button>\r\n\t\t\t\t<uui-popover-container\r\n\t\t\t\t\tid=\"collapse-level-popover\"\r\n\t\t\t\t\tplacement=\"bottom-start\"\r\n\t\t\t\t\t@toggle=${this.#onCollapsePopoverToggle}>\r\n\t\t\t\t\t<umb-popover-layout>\r\n\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\tlabel=\"Expand All\"\r\n\t\t\t\t\t\t\t@click=${() => this.#expandAll()}>\r\n\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-navigation-down\"></uui-icon>\r\n\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\tlabel=\"${this.#isLevelCollapsed('areas') ? 'Expand' : 'Collapse'} Areas\"\r\n\t\t\t\t\t\t\t@click=${() => this.#toggleLevel('areas')}>\r\n\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-grid\"></uui-icon>\r\n\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\tlabel=\"${this.#isLevelCollapsed('sections') ? 'Expand' : 'Collapse'} Sections\"\r\n\t\t\t\t\t\t\t@click=${() => this.#toggleLevel('sections')}>\r\n\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-thumbnail-list\"></uui-icon>\r\n\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t</umb-popover-layout>\r\n\t\t\t\t</uui-popover-container>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tasync #onPickMedia() {\r\n\t\tif (!this._workflowAlias) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_MEDIA_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tmultiple: false,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst result = await modal.onSubmit().catch(() => null);\r\n\t\tif (!result?.selection?.length) return;\r\n\r\n\t\tconst mediaKey = result.selection[0];\r\n\t\tif (!mediaKey) return;\r\n\r\n\t\tawait this.#runExtraction(mediaKey);\r\n\t}\r\n\r\n\t/** Opens the area editor modal to define/edit extraction areas. */\r\n\tasync #onEditAreas() {\r\n\t\tif (!this._workflowAlias) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_AREA_EDITOR_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tworkflowAlias: this._workflowAlias,\r\n\t\t\t\texistingTemplate: this._areaTemplate,\r\n\t\t\t\tselectedPages: this._sourceConfig?.pages && Array.isArray(this._sourceConfig.pages)\r\n\t\t\t\t\t? this._sourceConfig.pages\r\n\t\t\t\t\t: null,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await modal.onSubmit();\r\n\t\t\tif (result?.template) {\r\n\t\t\t\t// Save the area template\r\n\t\t\t\tconst saved = await saveAreaTemplate(this._workflowAlias, result.template, this.#token);\r\n\t\t\t\tif (saved) {\r\n\t\t\t\t\tthis._areaTemplate = saved;\r\n\t\t\t\t\t// Re-extract with the new area template applied\r\n\t\t\t\t\tawait this.#onReExtract();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch {\r\n\t\t\t// Modal was cancelled — do nothing\r\n\t\t}\r\n\t}\r\n\r\n\t/** Builds a list of areas for the rules editor dropdown. */\r\n\t#getAreasForRulesEditor(): Array<{ areaKey: string; areaName: string; elements: AreaElement[]; hasRules: boolean }> {\r\n\t\tif (!this._areaDetection) return [];\r\n\r\n\t\tconst result: Array<{ areaKey: string; areaName: string; elements: AreaElement[]; hasRules: boolean }> = [];\r\n\t\tconst seenKeys = new Set<string>();\r\n\r\n\t\tfor (const page of this._areaDetection.pages) {\r\n\t\t\tfor (const area of page.areas) {\r\n\t\t\t\tconst areaName = area.name || `Area`;\r\n\t\t\t\tconst areaKey = normalizeToKebabCase(areaName);\r\n\t\t\t\tif (seenKeys.has(areaKey)) continue; // Deduplicate (same area on multiple pages)\r\n\t\t\t\tseenKeys.add(areaKey);\r\n\r\n\t\t\t\tconst elements = this.#getAreaElements(area);\r\n\t\t\t\tconst ar = this._sourceConfig?.areaRules?.[areaKey];\r\n\t\t\t\tconst hasRules = !!ar && ((ar.groups?.length ?? 0) > 0 || (ar.rules?.length ?? 0) > 0);\r\n\t\t\t\tresult.push({ areaKey, areaName, elements, hasRules });\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t#onSectionPickerToggle(event: ToggleEvent) {\r\n\t\tthis._sectionPickerOpen = event.newState === 'open';\r\n\t}\r\n\r\n\t/** Saves area rules for a specific area key and re-triggers transform. */\r\n\tasync #saveAreaRulesForKey(areaKey: string, rules: AreaRules) {\r\n\t\tif (!this._workflowAlias) return;\r\n\r\n\t\tconst allRules: Record<string, AreaRules> = {\r\n\t\t\t...(this._sourceConfig?.areaRules ?? {}),\r\n\t\t};\r\n\r\n\t\tconst hasAnyRules = rules.groups.length > 0 || rules.rules.length > 0;\r\n\t\tif (hasAnyRules) {\r\n\t\t\tallRules[areaKey] = rules;\r\n\t\t} else {\r\n\t\t\tdelete allRules[areaKey];\r\n\t\t}\r\n\r\n\t\tconst saved = await saveAreaRules(this._workflowAlias, allRules, this.#token);\r\n\t\tif (saved && this._sourceConfig) {\r\n\t\t\tthis._sourceConfig = { ...this._sourceConfig, areaRules: saved };\r\n\t\t}\r\n\r\n\t\t// Re-trigger transform so the Extracted view reflects composed sections\r\n\t\tconst mediaKey = this._extraction?.source.mediaKey;\r\n\t\tif (mediaKey) {\r\n\t\t\tconst updatedTransform = await triggerTransform(this._workflowAlias, mediaKey, this.#token);\r\n\t\t\tif (updatedTransform) {\r\n\t\t\t\tthis._transformResult = updatedTransform;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Opens the rules editor modal for a specific area. */\r\n\tasync #onEditAreaRules(areaKey: string, areaName: string, elements: AreaElement[]) {\r\n\t\tif (!this._workflowAlias) return;\r\n\r\n\t\tconst existingRules = this._sourceConfig?.areaRules?.[areaKey] ?? null;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_SECTION_RULES_EDITOR_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tworkflowAlias: this._workflowAlias,\r\n\t\t\t\tsectionId: areaKey,\r\n\t\t\t\tsectionHeading: areaName,\r\n\t\t\t\telements,\r\n\t\t\t\texistingRules,\r\n\t\t\t\tonSave: async (rules: AreaRules) => {\r\n\t\t\t\t\tawait this.#saveAreaRulesForKey(areaKey, rules);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await modal.onSubmit();\r\n\t\t\tif (result?.rules) {\r\n\t\t\t\tawait this.#saveAreaRulesForKey(areaKey, result.rules);\r\n\t\t\t}\r\n\t\t} catch {\r\n\t\t\t// Modal cancelled\r\n\t\t}\r\n\t}\r\n\r\n\t/** Opens the page picker modal with PDF thumbnails. */\r\n\tasync #onOpenPagePicker() {\r\n\t\tconst mediaKey = this._extraction?.source.mediaKey;\r\n\t\tif (!mediaKey) return;\r\n\r\n\t\tconst totalPages = this._areaDetection?.totalPages ?? this._extraction?.source.totalPages ?? 0;\r\n\t\tif (totalPages === 0) return;\r\n\r\n\t\tconst selectedPages = this.#getSelectedPages();\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_PAGE_PICKER_MODAL, {\r\n\t\t\tdata: { mediaKey, totalPages, selectedPages },\r\n\t\t});\r\n\r\n\t\tconst result = await modal.onSubmit().catch(() => null);\r\n\t\tif (result === null) return; // cancelled\r\n\r\n\t\t// Update local state from the modal result\r\n\t\tif (result.selectedPages === null) {\r\n\t\t\tthis._pageMode = 'all';\r\n\t\t\tthis._pageInputValue = '';\r\n\t\t} else {\r\n\t\t\tthis._pageMode = 'custom';\r\n\t\t\tthis._pageInputValue = this.#pagesToRangeString(result.selectedPages);\r\n\t\t}\r\n\t\tawait this.#savePageSelection();\r\n\t}\r\n\r\n\t/** Re-extract using the previously stored source (media key for PDF, URL for web). */\r\n\tasync #onReExtract() {\r\n\t\t// Web sources use URL, not media key\r\n\t\tif (this.#sourceType === 'web') {\r\n\t\t\tconst url = this._extraction?.source.fileName;\r\n\t\t\tif (url) {\r\n\t\t\t\treturn this.#runUrlExtraction(url);\r\n\t\t\t}\r\n\t\t\treturn; // No URL to re-extract from\r\n\t\t}\r\n\r\n\t\tconst mediaKey = this._extraction?.source.mediaKey;\r\n\t\tif (!mediaKey) {\r\n\t\t\t// No prior extraction — fall back to media picker\r\n\t\t\treturn this.#onPickMedia();\r\n\t\t}\r\n\t\tawait this.#runExtraction(mediaKey);\r\n\t}\r\n\r\n\tasync #runExtraction(mediaKey: string) {\r\n\t\tif (!this._workflowAlias) return;\r\n\r\n\t\tthis._extracting = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t\tconst isPdf = this.#sourceType === 'pdf';\r\n\r\n\t\t\tif (isPdf) {\r\n\t\t\t\t// PDF: trigger sample extraction and transform (which includes area detection) in parallel\r\n\t\t\t\tconst [extraction, transformResult] = await Promise.all([\r\n\t\t\t\t\ttriggerSampleExtraction(this._workflowAlias, mediaKey, token),\r\n\t\t\t\t\ttriggerTransform(this._workflowAlias, mediaKey, token),\r\n\t\t\t\t]);\r\n\r\n\t\t\t\tif (extraction) {\r\n\t\t\t\t\tthis._extraction = extraction;\r\n\t\t\t\t}\r\n\t\t\t\tif (transformResult) {\r\n\t\t\t\t\tthis._transformResult = transformResult;\r\n\t\t\t\t\t// Transform endpoint also saved area detection — fetch it\r\n\t\t\t\t\tconst areaDetection = await fetchAreaDetection(this._workflowAlias, token);\r\n\t\t\t\t\tthis._areaDetection = areaDetection;\r\n\t\t\t\t\tconst d = transformResult.diagnostics;\r\n\t\t\t\t\tconst rolePart = d.roleSections > 0 ? `, ${d.roleSections} role` : '';\r\n\t\t\t\t\tthis._successMessage = `Content extracted — ${d.totalSections} sections (${d.bulletListSections} bullet, ${d.paragraphSections} paragraph, ${d.subHeadedSections} sub-headed${rolePart})`;\r\n\t\t\t\t\tsetTimeout(() => { this._successMessage = null; }, 5000);\r\n\t\t\t\t} else if (extraction) {\r\n\t\t\t\t\tthis._successMessage = `Content extracted — ${extraction.elements.length} elements (transform unavailable)`;\r\n\t\t\t\t\tsetTimeout(() => { this._successMessage = null; }, 5000);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._error = 'Extraction failed. Check that the selected media item is a PDF.';\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Non-PDF (markdown, web, etc.): trigger sample extraction, then fetch auto-generated transform\r\n\t\t\t\tconst extraction = await triggerSampleExtraction(this._workflowAlias, mediaKey, token);\r\n\r\n\t\t\t\tif (extraction) {\r\n\t\t\t\t\tthis._extraction = extraction;\r\n\t\t\t\t\t// Backend auto-generated transform.json — fetch it\r\n\t\t\t\t\tconst transformResult = await fetchTransformResult(this._workflowAlias!, token);\r\n\t\t\t\t\tthis._transformResult = transformResult;\r\n\t\t\t\t\tthis._successMessage = `Content extracted — ${extraction.elements.length} elements`;\r\n\t\t\t\t\tsetTimeout(() => { this._successMessage = null; }, 5000);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._error = `Extraction failed. Check that the selected media item is a valid ${this.#sourceType} file.`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Extraction failed';\r\n\t\t\tconsole.error('Extraction failed:', err);\r\n\t\t} finally {\r\n\t\t\tthis._extracting = false;\r\n\t\t}\r\n\t}\r\n\r\n\t#isCollapsed(key: string): boolean {\r\n\t\treturn this._collapsed.has(key);\r\n\t}\r\n\r\n\t#toggleCollapse(key: string) {\r\n\t\tconst next = new Set(this._collapsed);\r\n\t\tif (next.has(key)) {\r\n\t\t\tnext.delete(key);\r\n\t\t} else {\r\n\t\t\tnext.add(key);\r\n\t\t}\r\n\t\tthis._collapsed = next;\r\n\t}\r\n\r\n\t#isSectionIncluded(sectionId: string): boolean {\r\n\t\tif (!this._transformResult) return true;\r\n\t\tconst section = allTransformSections(this._transformResult).find((s) => s.id === sectionId);\r\n\t\treturn section?.included ?? true;\r\n\t}\r\n\r\n\tasync #onToggleInclusion(sectionId: string, included: boolean) {\r\n\t\tif (!this._workflowAlias) return;\r\n\t\tconst result = await updateSectionInclusion(this._workflowAlias, sectionId, included, this.#token);\r\n\t\tif (result) {\r\n\t\t\tthis._transformResult = result;\r\n\t\t}\r\n\t}\r\n\r\n\t#getMappedTargets(elementId: string): MappingDestination[] {\r\n\t\tif (!this._config?.map?.mappings) return [];\r\n\t\tconst targets: MappingDestination[] = [];\r\n\t\tfor (const mapping of this._config.map.mappings) {\r\n\t\t\tif (mapping.source === elementId && mapping.enabled) {\r\n\t\t\t\tfor (const dest of mapping.destinations) {\r\n\t\t\t\t\ttargets.push(dest);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn targets;\r\n\t}\r\n\r\n\t#resolveTargetLabel(dest: MappingDestination): string {\r\n\t\tif (!this._config?.destination) return dest.target;\r\n\r\n\t\tif (dest.blockKey) {\r\n\t\t\tfor (const container of getAllBlockContainers(this._config.destination)) {\r\n\t\t\t\tconst block = container.blocks.find((b) => b.key === dest.blockKey);\r\n\t\t\t\tif (block) {\r\n\t\t\t\t\tconst prop = block.properties?.find((p) => p.alias === dest.target);\r\n\t\t\t\t\treturn `${block.label} > ${prop?.label || dest.target}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst field = this._config.destination.fields.find((f) => f.alias === dest.target);\r\n\t\tif (field) return field.label;\r\n\r\n\t\tfor (const container of getAllBlockContainers(this._config.destination)) {\r\n\t\t\tfor (const block of container.blocks) {\r\n\t\t\t\tconst prop = block.properties?.find((p) => p.alias === dest.target);\r\n\t\t\t\tif (prop) return `${block.label} > ${prop.label || prop.alias}`;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn dest.target;\r\n\t}\r\n\r\n\t// --- Teach-by-example helpers ---\r\n\r\n\t/** Compute a flat global area index from page number and local area index. */\r\n\t#getGlobalAreaIndex(pageNum: number, localAreaIndex: number): number {\r\n\t\tif (!this._areaDetection) return localAreaIndex;\r\n\t\tlet globalIdx = 0;\r\n\t\tfor (const page of this._areaDetection.pages) {\r\n\t\t\tif (page.page === pageNum) return globalIdx + localAreaIndex;\r\n\t\t\tglobalIdx += page.areas.length;\r\n\t\t}\r\n\t\treturn globalIdx + localAreaIndex;\r\n\t}\r\n\r\n\t/** Get all elements from an area, flattened from sections. */\r\n\t#getAreaElements(area: DetectedArea): AreaElement[] {\r\n\t\tconst elements: AreaElement[] = [];\r\n\t\tfor (const section of area.sections) {\r\n\t\t\tif (section.heading) elements.push(section.heading);\r\n\t\t\telements.push(...section.children);\r\n\t\t}\r\n\t\treturn elements;\r\n\t}\r\n\r\n\t/** Enter teach mode for a specific area. */\r\n\t#onDefineStructure(globalAreaIdx: number, areaKey: string) {\r\n\t\tthis._teachingAreaIndex = globalAreaIdx;\r\n\t\tthis._inferenceResult = null;\r\n\t\tthis._inferring = false;\r\n\t\t// Ensure the area is expanded\r\n\t\tif (this._collapsed.has(areaKey)) {\r\n\t\t\tconst next = new Set(this._collapsed);\r\n\t\t\tnext.delete(areaKey);\r\n\t\t\tthis._collapsed = next;\r\n\t\t}\r\n\t}\r\n\r\n\t/** User clicked an element in teach mode. Call the inference API. */\r\n\tasync #onTeachElementClick(elementId: string) {\r\n\t\tif (this._teachingAreaIndex === null || !this._workflowAlias || this._inferring) return;\r\n\r\n\t\tthis._inferring = true;\r\n\t\tthis._inferenceResult = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await inferSectionPattern(\r\n\t\t\t\tthis._workflowAlias,\r\n\t\t\t\tthis._teachingAreaIndex,\r\n\t\t\t\telementId,\r\n\t\t\t\tthis.#token,\r\n\t\t\t);\r\n\t\t\tthis._inferenceResult = result;\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('Inference failed:', err);\r\n\t\t\tthis._error = 'Failed to infer section pattern';\r\n\t\t} finally {\r\n\t\t\tthis._inferring = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Confirm the inferred pattern — save to area template and re-extract. */\r\n\tasync #onConfirmPattern() {\r\n\t\tif (this._teachingAreaIndex === null || !this._inferenceResult || !this._workflowAlias || !this._areaTemplate) return;\r\n\r\n\t\tconst idx = this._teachingAreaIndex;\r\n\t\tif (idx < 0 || idx >= this._areaTemplate.areas.length) return;\r\n\r\n\t\t// Update the area template with the new section pattern\r\n\t\tconst updatedAreas = [...this._areaTemplate.areas];\r\n\t\tupdatedAreas[idx] = { ...updatedAreas[idx], sectionPattern: this._inferenceResult.pattern };\r\n\t\tconst updatedTemplate: AreaTemplate = { ...this._areaTemplate, areas: updatedAreas };\r\n\r\n\t\tconst saved = await saveAreaTemplate(this._workflowAlias, updatedTemplate, this.#token);\r\n\t\tif (saved) {\r\n\t\t\tthis._areaTemplate = saved;\r\n\t\t\t// Exit teach mode\r\n\t\t\tthis._teachingAreaIndex = null;\r\n\t\t\tthis._inferenceResult = null;\r\n\t\t\t// Re-extract with the updated area template\r\n\t\t\tawait this.#onReExtract();\r\n\t\t}\r\n\t}\r\n\r\n\t/** Save empty conditions (no section headings) for the current teach area. */\r\n\tasync #onNoSections() {\r\n\t\tif (this._teachingAreaIndex === null || !this._workflowAlias || !this._areaTemplate) return;\r\n\r\n\t\tconst idx = this._teachingAreaIndex;\r\n\t\tif (idx < 0 || idx >= this._areaTemplate.areas.length) return;\r\n\r\n\t\t// Save empty conditions = one flat section\r\n\t\tconst updatedAreas = [...this._areaTemplate.areas];\r\n\t\tupdatedAreas[idx] = { ...updatedAreas[idx], sectionPattern: { conditions: [] } };\r\n\t\tconst updatedTemplate: AreaTemplate = { ...this._areaTemplate, areas: updatedAreas };\r\n\r\n\t\tconst saved = await saveAreaTemplate(this._workflowAlias, updatedTemplate, this.#token);\r\n\t\tif (saved) {\r\n\t\t\tthis._areaTemplate = saved;\r\n\t\t\tthis._teachingAreaIndex = null;\r\n\t\t\tthis._inferenceResult = null;\r\n\t\t\tawait this.#onReExtract();\r\n\t\t}\r\n\t}\r\n\r\n\t/** Cancel teach mode without saving. */\r\n\t#onCancelTeach() {\r\n\t\tthis._teachingAreaIndex = null;\r\n\t\tthis._inferenceResult = null;\r\n\t\tthis._inferring = false;\r\n\t}\r\n\r\n\t// --- Composed section helpers (Phase 1b) ---\r\n\r\n\t/** Check if an area has rules defined in source config. */\r\n\t#getAreaRulesKey(area: DetectedArea): string {\r\n\t\treturn normalizeToKebabCase(area.name || '');\r\n\t}\r\n\r\n\t#hasAreaRules(area: DetectedArea): boolean {\r\n\t\tconst key = this.#getAreaRulesKey(area);\r\n\t\tconst areaRules = this._sourceConfig?.areaRules?.[key];\r\n\t\tif (!areaRules) return false;\r\n\t\treturn (areaRules.groups?.length ?? 0) > 0 || (areaRules.rules?.length ?? 0) > 0;\r\n\t}\r\n\r\n\t/** Get transform sections that belong to a specific area (matched by color + page). */\r\n\t#getTransformSectionsForArea(area: DetectedArea, pageNum: number): TransformedSection[] {\r\n\t\tif (!this._transformResult) return [];\r\n\t\t// Find matching area in the hierarchical tree\r\n\t\tconst matchingArea = this._transformResult.areas.find(\r\n\t\t\t(a) => a.color === area.color && a.page === pageNum,\r\n\t\t);\r\n\t\tif (!matchingArea) return [];\r\n\t\t// Return all sections (grouped + ungrouped) from this area\r\n\t\tconst sections: TransformedSection[] = [];\r\n\t\tfor (const group of matchingArea.groups) {\r\n\t\t\tsections.push(...group.sections);\r\n\t\t}\r\n\t\tsections.push(...matchingArea.sections);\r\n\t\treturn sections;\r\n\t}\r\n\r\n\tasync #onMapSection(section: TransformedSection, partSuffix: string = 'content') {\r\n\t\tif (!this._workflowAlias || !this._config?.destination) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_DESTINATION_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tdestination: this._config.destination,\r\n\t\t\t\texistingMappings: this._config.map?.mappings ?? [],\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tlet result;\r\n\t\ttry {\r\n\t\t\tresult = await modal.onSubmit();\r\n\t\t} catch {\r\n\t\t\treturn; // cancelled\r\n\t\t}\r\n\r\n\t\tif (!result?.selectedTargets?.length) return;\r\n\r\n\t\tconst sourceKey = `${section.id}.${partSuffix}`;\r\n\t\tconst existingMappings = this._config.map?.mappings ?? [];\r\n\r\n\t\tconst newMapping: SectionMapping = {\r\n\t\t\tsource: sourceKey,\r\n\t\t\tdestinations: result.selectedTargets.map((t) => ({ target: t.target, blockKey: t.blockKey, contentTypeKey: t.contentTypeKey })),\r\n\t\t\tenabled: true,\r\n\t\t};\r\n\r\n\t\tconst existingIndex = existingMappings.findIndex((m) => m.source === sourceKey);\r\n\t\tconst updatedMappings = existingIndex >= 0\r\n\t\t\t? existingMappings.map((m, i) => i === existingIndex ? newMapping : m)\r\n\t\t\t: [...existingMappings, newMapping];\r\n\r\n\t\tconst updatedMap: MapConfig = {\r\n\t\t\t...(this._config.map ?? { version: '1.0', mappings: [] }),\r\n\t\t\tmappings: updatedMappings,\r\n\t\t};\r\n\r\n\t\tconst saved = await saveMapConfig(this._workflowAlias, updatedMap, this.#token);\r\n\t\tif (saved) {\r\n\t\t\tthis._config = { ...this._config, map: saved };\r\n\t\t}\r\n\t}\r\n\r\n\t/** Remove a specific mapping destination from a source key. */\r\n\tasync #onUnmap(sourceKey: string, dest: MappingDestination) {\r\n\t\tif (!this._workflowAlias || !this._config?.map) return;\r\n\r\n\t\tconst existingMappings = this._config.map.mappings;\r\n\t\tconst mappingIndex = existingMappings.findIndex((m) => m.source === sourceKey);\r\n\t\tif (mappingIndex < 0) return;\r\n\r\n\t\tconst mapping = existingMappings[mappingIndex];\r\n\t\tconst remainingDests = mapping.destinations.filter(\r\n\t\t\t(d) => !(d.target === dest.target && d.blockKey === dest.blockKey),\r\n\t\t);\r\n\r\n\t\tlet updatedMappings: SectionMapping[];\r\n\t\tif (remainingDests.length === 0) {\r\n\t\t\t// No destinations left — remove the entire mapping\r\n\t\t\tupdatedMappings = existingMappings.filter((_, i) => i !== mappingIndex);\r\n\t\t} else {\r\n\t\t\tupdatedMappings = existingMappings.map((m, i) =>\r\n\t\t\t\ti === mappingIndex ? { ...m, destinations: remainingDests } : m,\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst updatedMap: MapConfig = { ...this._config.map, mappings: updatedMappings };\r\n\t\tconst saved = await saveMapConfig(this._workflowAlias, updatedMap, this.#token);\r\n\t\tif (saved) {\r\n\t\t\tthis._config = { ...this._config, map: saved };\r\n\t\t}\r\n\t}\r\n\r\n\t#renderComposedSectionRow(section: TransformedSection) {\r\n\t\t// Check all possible source key suffixes for mapping status\r\n\t\tconst suffixes = ['content', 'heading', 'title', 'description', 'summary'];\r\n\t\tconst hasMappings = suffixes.some((s) => this.#getMappedTargets(`${section.id}.${s}`).length > 0);\r\n\r\n\t\tconst collapseKey = `composed-${section.id}`;\r\n\t\tconst isCollapsed = this.#isCollapsed(collapseKey);\r\n\t\tconst sectionLabel = section.groupName ?? section.ruleName ?? (section.areaName ? `${section.areaName} - Section` : 'Section');\r\n\r\n\t\tconst isGrouped = !!section.groupName;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"section-box\">\r\n\t\t\t\t<div class=\"section-box-header\" @click=${() => this.#toggleCollapse(collapseKey)}>\r\n\t\t\t\t\t<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t<uui-icon class=\"level-icon\" name=\"icon-thumbnail-list\"></uui-icon>\r\n\t\t\t\t\t<span class=\"section-box-label\">${sectionLabel}</span>\r\n\t\t\t\t\t<span class=\"header-spacer\"></span>\r\n\t\t\t\t\t${hasMappings && isCollapsed\r\n\t\t\t\t\t\t? suffixes.map((s) => this.#renderPartBadges(`${section.id}.${s}`))\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t</div>\r\n\t\t\t\t${!isCollapsed ? html`\r\n\t\t\t\t\t<div class=\"section-box-content\">\r\n\t\t\t\t\t\t${isGrouped ? html`\r\n\t\t\t\t\t\t\t${section.heading ? html`\r\n\t\t\t\t\t\t\t\t<div class=\"part-box\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"part-box-row\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"part-box-label\">Title</span>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"part-box-content\">${unsafeHTML(markdownToHtml(section.heading))}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"part-box-actions\">\r\n\t\t\t\t\t\t\t\t\t\t\t${this.#renderPartBadges(`${section.id}.title`)}\r\n\t\t\t\t\t\t\t\t\t\t\t${this.#renderPartBadges(`${section.id}.heading`)}\r\n\t\t\t\t\t\t\t\t\t\t\t<uui-button class=\"md-map-btn\" look=\"outline\" compact label=\"Map\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t@click=${(e: Event) => { e.stopPropagation(); this.#onMapSection(section, 'title'); }}><uui-icon name=\"icon-nodes\"></uui-icon> Map</uui-button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t\t\t${section.content ? html`\r\n\t\t\t\t\t\t\t\t<div class=\"part-box\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"part-box-row\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"part-box-label\">Content</span>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"part-box-content\">${unsafeHTML(markdownToHtml(section.content))}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"part-box-actions\">\r\n\t\t\t\t\t\t\t\t\t\t\t${this.#renderPartBadges(`${section.id}.content`)}\r\n\t\t\t\t\t\t\t\t\t\t\t<uui-button class=\"md-map-btn\" look=\"outline\" compact label=\"Map\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t@click=${(e: Event) => { e.stopPropagation(); this.#onMapSection(section, 'content'); }}><uui-icon name=\"icon-nodes\"></uui-icon> Map</uui-button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t\t\t${section.description ? html`\r\n\t\t\t\t\t\t\t\t<div class=\"part-box\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"part-box-row\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"part-box-label\">Description</span>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"part-box-content\">${unsafeHTML(markdownToHtml(section.description))}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"part-box-actions\">\r\n\t\t\t\t\t\t\t\t\t\t\t${this.#renderPartBadges(`${section.id}.description`)}\r\n\t\t\t\t\t\t\t\t\t\t\t<uui-button class=\"md-map-btn\" look=\"outline\" compact label=\"Map\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t@click=${(e: Event) => { e.stopPropagation(); this.#onMapSection(section, 'description'); }}><uui-icon name=\"icon-nodes\"></uui-icon> Map</uui-button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t\t\t${section.summary ? html`\r\n\t\t\t\t\t\t\t\t<div class=\"part-box\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"part-box-row\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"part-box-label\">Summary</span>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"part-box-content\">${unsafeHTML(markdownToHtml(section.summary))}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"part-box-actions\">\r\n\t\t\t\t\t\t\t\t\t\t\t${this.#renderPartBadges(`${section.id}.summary`)}\r\n\t\t\t\t\t\t\t\t\t\t\t<uui-button class=\"md-map-btn\" look=\"outline\" compact label=\"Map\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t@click=${(e: Event) => { e.stopPropagation(); this.#onMapSection(section, 'summary'); }}><uui-icon name=\"icon-nodes\"></uui-icon> Map</uui-button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t\t` : html`\r\n\t\t\t\t\t\t\t${section.content ? html`\r\n\t\t\t\t\t\t\t\t<div class=\"part-box-row\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"part-box-content\">${unsafeHTML(markdownToHtml(section.content))}</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"part-box-actions\">\r\n\t\t\t\t\t\t\t\t\t\t${suffixes.map((s) => this.#renderPartBadges(`${section.id}.${s}`))}\r\n\t\t\t\t\t\t\t\t\t\t<uui-button class=\"md-map-btn\" look=\"outline\" compact label=\"Map\"\r\n\t\t\t\t\t\t\t\t\t\t\t@click=${(e: Event) => { e.stopPropagation(); this.#onMapSection(section, 'content'); }}><uui-icon name=\"icon-nodes\"></uui-icon> Map</uui-button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t\t`}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` : nothing}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t// --- Area-based rendering ---\r\n\r\n\t#classifyText(text: string): 'list' | 'paragraph' {\r\n\t\tconst trimmed = text.trimStart();\r\n\t\tif (/^[•\\-\\*▪▸▶►●○◦‣⁃]/.test(trimmed)) return 'list';\r\n\t\tif (/^\\d+[\\.\\)]\\s/.test(trimmed)) return 'list';\r\n\t\treturn 'paragraph';\r\n\t}\r\n\r\n\t#renderAreaElement(element: AreaElement, role?: 'heading') {\r\n\t\tconst textType = role === 'heading' ? 'heading' : this.#classifyText(element.text);\r\n\t\tconst badgeLabel = textType === 'heading' ? 'Heading' : textType === 'list' ? 'List Item' : 'Paragraph';\r\n\t\treturn html`\r\n\t\t\t<div class=\"element-item\">\r\n\t\t\t\t<div class=\"element-content\">\r\n\t\t\t\t\t<div class=\"element-text\">${element.text}</div>\r\n\t\t\t\t\t<div class=\"element-meta\">\r\n\t\t\t\t\t\t<span class=\"meta-badge text-type ${textType}\">${badgeLabel}</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge font-size\">${element.fontSize}pt</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge font-name\">${element.fontName}</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge color\" style=\"border-left: 3px solid ${element.color};\">${element.color}</span>\r\n\t\t\t\t\t\t${element.text === element.text.toUpperCase() && element.text !== element.text.toLowerCase() ? html`<span class=\"meta-badge text-case\">UPPERCASE</span>` : nothing}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderSection(section: DetectedSection, sectionKey: string, pageNum: number, areaIndex: number) {\r\n\t\tconst isCollapsed = this.#isCollapsed(sectionKey);\r\n\r\n\t\t// Compute the section ID matching transform.json\r\n\t\tconst sectionId = section.heading\r\n\t\t\t? normalizeToKebabCase(section.heading.text)\r\n\t\t\t: `preamble-p${pageNum}-a${areaIndex}`;\r\n\t\tconst isIncluded = this.#isSectionIncluded(sectionId);\r\n\r\n\t\tif (!section.heading) {\r\n\t\t\t// No-heading section — render with toggle\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"area-section ${!isIncluded ? 'excluded' : ''}\">\r\n\t\t\t\t\t<div class=\"section-heading preamble\" @click=${() => this.#toggleCollapse(sectionKey)}>\r\n\t\t\t\t\t\t<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"heading-text preamble-label\">Content</span>\r\n\t\t\t\t\t\t<span class=\"group-count\">${section.children.length} element${section.children.length !== 1 ? 's' : ''}</span>\r\n\t\t\t\t\t\t<uui-toggle\r\n\t\t\t\t\t\t\tlabel=\"${isIncluded ? 'Included' : 'Excluded'}\"\r\n\t\t\t\t\t\t\t?checked=${isIncluded}\r\n\t\t\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t\t\t@change=${(e: Event) => this.#onToggleInclusion(sectionId, (e.target as any).checked)}>\r\n\t\t\t\t\t\t</uui-toggle>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t${isIncluded && !isCollapsed ? html`\r\n\t\t\t\t\t\t${section.children.map((el) => this.#renderAreaElement(el))}\r\n\t\t\t\t\t` : nothing}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tconst heading = section.heading;\r\n\t\tconst elementCount = section.children.length;\r\n\t\tconst hasChildren = elementCount > 0;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"area-section ${!isIncluded ? 'excluded' : ''}\">\r\n\t\t\t\t<div class=\"section-heading\" @click=${hasChildren ? () => this.#toggleCollapse(sectionKey) : nothing}>\r\n\t\t\t\t\t${hasChildren\r\n\t\t\t\t\t\t? html`<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>`\r\n\t\t\t\t\t\t: html`<uui-icon class=\"collapse-chevron placeholder\"></uui-icon>`}\r\n\t\t\t\t\t<uui-icon class=\"level-icon\" name=\"icon-thumbnail-list\"></uui-icon>\r\n\t\t\t\t\t<span class=\"heading-text\" title=\"${heading.text}\">${heading.text}</span>\r\n\t\t\t\t\t${hasChildren ? html`<span class=\"group-count\">${elementCount} element${elementCount !== 1 ? 's' : ''}</span>` : nothing}\r\n\t\t\t\t\t<uui-toggle\r\n\t\t\t\t\t\tlabel=\"${isIncluded ? 'Included' : 'Excluded'}\"\r\n\t\t\t\t\t\t?checked=${isIncluded}\r\n\t\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t\t@change=${(e: Event) => this.#onToggleInclusion(sectionId, (e.target as any).checked)}>\r\n\t\t\t\t\t</uui-toggle>\r\n\t\t\t\t</div>\r\n\t\t\t\t${hasChildren && !isCollapsed && isIncluded ? html`\r\n\t\t\t\t\t<div class=\"section-children\">\r\n\t\t\t\t\t\t${section.children.map((el) => this.#renderAreaElement(el))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` : nothing}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#toggleAreaExclusion(areaKey: string) {\r\n\t\tconst next = new Set(this._excludedAreas);\r\n\t\tif (next.has(areaKey)) {\r\n\t\t\tnext.delete(areaKey);\r\n\t\t} else {\r\n\t\t\tnext.add(areaKey);\r\n\t\t\t// Auto-collapse excluded areas to reduce noise\r\n\t\t\tconst collapsed = new Set(this._collapsed);\r\n\t\t\tcollapsed.add(areaKey);\r\n\t\t\tthis._collapsed = collapsed;\r\n\t\t}\r\n\t\tthis._excludedAreas = next;\r\n\t}\r\n\r\n\t#renderTeachElement(element: AreaElement) {\r\n\t\tconst isClicked = this._inferenceResult?.clickedElementId === element.id;\r\n\t\tconst isMatching = this._inferenceResult?.matchingElementIds?.includes(element.id) ?? false;\r\n\t\tconst textType = this.#classifyText(element.text);\r\n\t\tconst badgeLabel = textType === 'list' ? 'List Item' : 'Paragraph';\r\n\t\treturn html`\r\n\t\t\t<div class=\"element-item teach-element ${isClicked ? 'teach-clicked' : ''} ${isMatching ? 'teach-matched' : ''}\"\r\n\t\t\t\t@click=${() => this.#onTeachElementClick(element.id)}>\r\n\t\t\t\t<div class=\"element-content\">\r\n\t\t\t\t\t<div class=\"element-text\">${element.text}</div>\r\n\t\t\t\t\t<div class=\"element-meta\">\r\n\t\t\t\t\t\t<span class=\"meta-badge text-type ${textType}\">${badgeLabel}</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge font-size\">${element.fontSize}pt</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge font-name\">${element.fontName}</span>\r\n\t\t\t\t\t\t<span class=\"meta-badge color\" style=\"border-left: 3px solid ${element.color};\">${element.color}</span>\r\n\t\t\t\t\t\t${element.text === element.text.toUpperCase() && element.text !== element.text.toLowerCase() ? html`<span class=\"meta-badge text-case\">UPPERCASE</span>` : nothing}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderTeachToolbar() {\r\n\t\tif (this._inferenceResult) {\r\n\t\t\tconst matchCount = this._inferenceResult.matchingElementIds.length;\r\n\t\t\tconst conditionSummary = this._inferenceResult.pattern.conditions\r\n\t\t\t\t.map((c) => `${c.type}: ${c.value}`)\r\n\t\t\t\t.join(', ');\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"teach-confirmation\">\r\n\t\t\t\t\t<div class=\"teach-confirmation-info\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-check\" style=\"color: var(--uui-color-positive);\"></uui-icon>\r\n\t\t\t\t\t\t<span>Found <strong>${matchCount}</strong> matching element${matchCount !== 1 ? 's' : ''}</span>\r\n\t\t\t\t\t\t<span class=\"teach-condition-summary\">${conditionSummary}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"teach-confirmation-actions\">\r\n\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Confirm\" @click=${() => this.#onConfirmPattern()}>\r\n\t\t\t\t\t\t\t<uui-icon name=\"icon-check\"></uui-icon> Confirm\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t<uui-button look=\"secondary\" label=\"Cancel\" @click=${() => this.#onCancelTeach()}>Cancel</uui-button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"teach-toolbar\">\r\n\t\t\t\t<span class=\"teach-instruction\">\r\n\t\t\t\t\t${this._inferring\r\n\t\t\t\t\t\t? html`<uui-loader-bar></uui-loader-bar> Analysing...`\r\n\t\t\t\t\t\t: html`Click a section heading, or <strong>No Sections</strong> if this area has no repeating structure`}\r\n\t\t\t\t</span>\r\n\t\t\t\t<div class=\"teach-toolbar-actions\">\r\n\t\t\t\t\t<uui-button look=\"secondary\" compact label=\"No Sections\" @click=${() => this.#onNoSections()}\r\n\t\t\t\t\t\ttitle=\"This area has no repeating section structure\">\r\n\t\t\t\t\t\tNo Sections\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t<uui-button look=\"default\" compact label=\"Cancel\" @click=${() => this.#onCancelTeach()}>Cancel</uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderArea(area: DetectedArea, pageNum: number, areaIndex: number) {\r\n\t\tconst areaKey = `area-p${pageNum}-a${areaIndex}`;\r\n\t\tconst globalIdx = this.#getGlobalAreaIndex(pageNum, areaIndex);\r\n\t\tconst isTeaching = this._teachingAreaIndex === globalIdx;\r\n\t\tconst isCollapsed = isTeaching ? false : this.#isCollapsed(areaKey);\r\n\t\tconst isIncluded = !this._excludedAreas.has(areaKey);\r\n\r\n\t\t// Check if area has rules defined (from section rules editor)\r\n\t\tconst rulesAreaKey = this.#getAreaRulesKey(area);\r\n\t\tconst hasRules = this.#hasAreaRules(area);\r\n\r\n\t\t// When rules exist and transform is available, use composed sections from transform\r\n\t\tconst composedSections = hasRules && this._transformResult\r\n\t\t\t? this.#getTransformSectionsForArea(area, pageNum)\r\n\t\t\t: [];\r\n\t\tconst useComposed = hasRules && composedSections.length > 0;\r\n\r\n\t\tconst sectionCount = useComposed ? composedSections.length : area.sections.length;\r\n\r\n\t\t// Check if area has a configured section pattern\r\n\t\tconst hasPattern = area.sectionPattern != null;\r\n\t\tconst patternLabel = hasPattern\r\n\t\t\t? (area.sectionPattern!.conditions.length > 0 ? 'Configured' : 'Flat')\r\n\t\t\t: null;\r\n\r\n\t\tconst areaRulesObj = this._sourceConfig?.areaRules?.[rulesAreaKey];\r\n\t\tconst ruleCount = (areaRulesObj?.rules?.length ?? 0) + (areaRulesObj?.groups?.reduce((sum, g) => sum + g.rules.length, 0) ?? 0);\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"detected-area ${!isIncluded ? 'area-excluded' : ''} ${isTeaching ? 'area-teaching' : ''}\" style=\"border-left-color: ${area.color};\">\r\n\t\t\t\t<div class=\"area-header\" @click=${() => !isTeaching && this.#toggleCollapse(areaKey)}>\r\n\t\t\t\t\t<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t<uui-icon class=\"level-icon\" name=\"icon-grid\"></uui-icon>\r\n\t\t\t\t\t<span class=\"area-name\">${area.name || `${areaIndex + 1}`}</span>\r\n\t\t\t\t\t${hasRules ? html`<span class=\"meta-badge rules-info\">${ruleCount} rule${ruleCount !== 1 ? 's' : ''}</span>` : nothing}\r\n\t\t\t\t\t${!hasRules && patternLabel ? html`<span class=\"meta-badge structure-badge\">${patternLabel}</span>` : nothing}\r\n\t\t\t\t\t<span class=\"header-spacer\"></span>\r\n\t\t\t\t\t${!isTeaching ? html`\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\t\tlabel=\"Sections\"\r\n\t\t\t\t\t\t\t@click=${(e: Event) => { e.stopPropagation(); this.#onEditAreaRules(rulesAreaKey, area.name || '', this.#getAreaElements(area)); }}\r\n\t\t\t\t\t\t\t?disabled=${this._teachingAreaIndex !== null}>\r\n\t\t\t\t\t\t\t<uui-icon name=\"icon-thumbnail-list\"></uui-icon>\r\n\t\t\t\t\t\t\tSections\r\n\t\t\t\t\t\t\t<uui-badge color=\"danger\" look=\"primary\">${sectionCount}</uui-badge>\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t${!hasRules ? html`\r\n\t\t\t\t\t\t<uui-toggle\r\n\t\t\t\t\t\t\tlabel=\"${isIncluded ? 'Included' : 'Excluded'}\"\r\n\t\t\t\t\t\t\t?checked=${isIncluded}\r\n\t\t\t\t\t\t\t@click=${(e: Event) => e.stopPropagation()}\r\n\t\t\t\t\t\t\t@change=${() => this.#toggleAreaExclusion(areaKey)}>\r\n\t\t\t\t\t\t</uui-toggle>\r\n\t\t\t\t\t` : nothing}\r\n\t\t\t\t</div>\r\n\t\t\t\t${!isCollapsed ? html`\r\n\t\t\t\t\t${isTeaching ? html`\r\n\t\t\t\t\t\t${this.#renderTeachToolbar()}\r\n\t\t\t\t\t\t<div class=\"teach-elements\">\r\n\t\t\t\t\t\t\t${this.#getAreaElements(area).map((el) => this.#renderTeachElement(el))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t` : useComposed ? html`\r\n\t\t\t\t\t\t<div class=\"composed-sections\">\r\n\t\t\t\t\t\t\t${composedSections.map((section) => this.#renderComposedSectionRow(section))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t` : html`\r\n\t\t\t\t\t\t${area.sections.map((section, sIdx) =>\r\n\t\t\t\t\t\t\tthis.#renderSection(section, `p${pageNum}-a${areaIndex}-s${sIdx}`, pageNum, areaIndex)\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t`}\r\n\t\t\t\t` : nothing}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAreaPage(pageNum: number, areas: DetectedArea[]) {\r\n\t\tconst pageKey = `page-${pageNum}`;\r\n\t\tconst isCollapsed = this.#isCollapsed(pageKey);\r\n\t\tconst areaCount = areas.length;\r\n\t\tconst sectionCount = areas.reduce((sum, a) => sum + a.sections.length, 0);\r\n\t\tconst isIncluded = this.#isPageIncluded(pageNum);\r\n\t\treturn html`\r\n\t\t\t<uui-box class=\"page-box ${!isIncluded ? 'page-excluded' : ''}\">\r\n\t\t\t\t<div slot=\"header\" class=\"tree-header\" @click=${() => this.#toggleCollapse(pageKey)}>\r\n\t\t\t\t\t<uui-icon class=\"collapse-chevron\" name=\"${isCollapsed ? 'icon-navigation-right' : 'icon-navigation-down'}\"></uui-icon>\r\n\t\t\t\t\t<uui-icon class=\"level-icon\" name=\"icon-document\"></uui-icon>\r\n\t\t\t\t\t<strong class=\"page-title\">Page ${pageNum}</strong>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div slot=\"header-actions\" class=\"page-header-actions\">\r\n\t\t\t\t\t<span class=\"group-count\">${sectionCount} section${sectionCount !== 1 ? 's' : ''}, ${areaCount} area${areaCount !== 1 ? 's' : ''}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t${!isCollapsed ? html`\r\n\t\t\t\t\t${areas.map((area, idx) => this.#renderArea(area, pageNum, idx))}\r\n\t\t\t\t` : nothing}\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAreaDetection() {\r\n\t\tif (!this._areaDetection) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t${this._areaDetection.pages.map((page) =>\r\n\t\t\t\tthis.#renderAreaPage(page.page, page.areas)\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\t#computeSectionCount(): number {\r\n\t\tif (!this._areaDetection) return 0;\r\n\t\treturn this._areaDetection.pages.reduce((sum, page) =>\r\n\t\t\tsum + page.areas.reduce((aSum, area) => aSum + area.sections.length, 0), 0);\r\n\t}\r\n\r\n\r\n\t#renderExtractionHeader() {\r\n\t\treturn html`\r\n\t\t\t<div slot=\"header\" class=\"source-header\">\r\n\t\t\t\t<uui-tab-group dropdown-content-direction=\"vertical\">\r\n\t\t\t\t\t<uui-tab label=\"Extracted\" ?active=${this._viewMode === 'elements'} @click=${() => { this._viewMode = 'elements'; }}>Extracted</uui-tab>\r\n\t\t\t\t\t<uui-tab label=\"Transformed\" ?active=${this._viewMode === 'transformed'} @click=${() => { this._viewMode = 'transformed'; }} ?disabled=${!this._transformResult}>Transformed</uui-tab>\r\n\t\t\t\t</uui-tab-group>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderInfoBoxes() {\r\n\t\tconst hasAreas = this._areaDetection !== null;\r\n\t\tconst hasExtraction = this._extraction !== null;\r\n\r\n\t\tif (!hasAreas && !hasExtraction) return nothing;\r\n\r\n\t\tconst totalPages = this._areaDetection?.totalPages ?? (hasExtraction ? this._extraction!.source.totalPages : 0);\r\n\t\tconst savedPages = this._sourceConfig?.pages;\r\n\t\tconst hasSavedPageSelection = Array.isArray(savedPages) && savedPages.length > 0;\r\n\t\tconst selectedCount = hasSavedPageSelection ? savedPages.length : totalPages;\r\n\t\tconst pagesLabel = hasSavedPageSelection && totalPages > 0\r\n\t\t\t? `${selectedCount} of ${totalPages}`\r\n\t\t\t: `${totalPages}`;\r\n\t\tconst areas = hasAreas ? this._areaDetection!.diagnostics.areasDetected : 0;\r\n\t\tconst sections = hasAreas ? this.#computeSectionCount() : 0;\r\n\t\tconst fileName = hasExtraction ? this._extraction!.source.fileName : '';\r\n\t\tconst extractedDate = hasExtraction\r\n\t\t\t? new Date(this._extraction!.source.extractedDate).toLocaleString()\r\n\t\t\t: '';\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"info-boxes\">\r\n\t\t\t\t<uui-box class=\"info-box-item\">\r\n\t\t\t\t\t<div slot=\"headline\" class=\"box-headline-row\">\r\n\t\t\t\t\t\t<span>Source</span>\r\n\t\t\t\t\t\t<span class=\"box-headline-meta\">${extractedDate}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-page-add\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-stat box-filename\" title=\"${fileName}\">${fileName}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Source\" @click=${this.#onPickMedia} ?disabled=${this._extracting}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-page-add\"></uui-icon>\r\n\t\t\t\t\t\t\t\tChoose Source\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Pages\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-document\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-stat\">${pagesLabel}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Pages\" @click=${this.#onOpenPagePicker}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-document\"></uui-icon>\r\n\t\t\t\t\t\t\t\tChoose Pages\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Areas\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-grid\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-stat\">${this._areaTemplate ? this._areaTemplate.areas.length : areas}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Areas\" @click=${this.#onEditAreas}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-grid\"></uui-icon>\r\n\t\t\t\t\t\t\t\tChoose Areas\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Sections\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-thumbnail-list\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-stat\">${sections}</span>\r\n\t\t\t\t\t\t${this._transformResult && this._areaDetection ? html`\r\n\t\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\t\t\t\tlabel=\"Choose Sections\"\r\n\t\t\t\t\t\t\t\t\tpopovertarget=\"section-picker-popover\">\r\n\t\t\t\t\t\t\t\t\t<uui-icon name=\"icon-thumbnail-list\"></uui-icon>\r\n\t\t\t\t\t\t\t\t\tChoose Sections\r\n\t\t\t\t\t\t\t\t\t<uui-symbol-expand .open=${this._sectionPickerOpen}></uui-symbol-expand>\r\n\t\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t\t\t<uui-popover-container\r\n\t\t\t\t\t\t\t\t\tid=\"section-picker-popover\"\r\n\t\t\t\t\t\t\t\t\tplacement=\"bottom-end\"\r\n\t\t\t\t\t\t\t\t\t@toggle=${this.#onSectionPickerToggle}>\r\n\t\t\t\t\t\t\t\t\t<umb-popover-layout>\r\n\t\t\t\t\t\t\t\t\t\t${this.#getAreasForRulesEditor().map((a) => html`\r\n\t\t\t\t\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\t\t\t\t\tlabel=\"${a.areaName}\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t@click=${() => this.#onEditAreaRules(a.areaKey, a.areaName, a.elements)}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"${a.hasRules ? 'icon-check' : 'icon-thumbnail-list'}\"></uui-icon>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span slot=\"badge\" class=\"section-picker-meta\">${a.elements.length} el</span>\r\n\t\t\t\t\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t\t\t\t`)}\r\n\t\t\t\t\t\t\t\t\t</umb-popover-layout>\r\n\t\t\t\t\t\t\t\t</uui-popover-container>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t` : nothing}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\t\t\t</div>\r\n\r\n\t\t\t${hasAreas ? html`\r\n\t\t\t\t<div class=\"collapse-row\">\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tlabel=\"Collapse\"\r\n\t\t\t\t\t\tpopovertarget=\"collapse-level-popover\">\r\n\t\t\t\t\t\tCollapse\r\n\t\t\t\t\t\t<uui-symbol-expand .open=${this._collapsePopoverOpen}></uui-symbol-expand>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t<uui-popover-container\r\n\t\t\t\t\t\tid=\"collapse-level-popover\"\r\n\t\t\t\t\t\tplacement=\"bottom-start\"\r\n\t\t\t\t\t\t@toggle=${this.#onCollapsePopoverToggle}>\r\n\t\t\t\t\t\t<umb-popover-layout>\r\n\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\tlabel=\"Expand All\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#expandAll()}>\r\n\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-navigation-down\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\tlabel=\"${this.#isLevelCollapsed('pages') ? 'Expand' : 'Collapse'} Pages\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#toggleLevel('pages')}>\r\n\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-document\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\tlabel=\"${this.#isLevelCollapsed('areas') ? 'Expand' : 'Collapse'} Areas\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#toggleLevel('areas')}>\r\n\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-grid\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\t\tlabel=\"${this.#isLevelCollapsed('sections') ? 'Expand' : 'Collapse'} Sections\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#toggleLevel('sections')}>\r\n\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-thumbnail-list\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t</umb-popover-layout>\r\n\t\t\t\t\t</uui-popover-container>\r\n\t\t\t\t</div>\r\n\t\t\t` : nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderExtractionContent() {\r\n\t\tconst hasAreas = this._areaDetection !== null;\r\n\t\treturn this._viewMode === 'elements'\r\n\t\t\t? (hasAreas ? this.#renderAreaDetection() : nothing)\r\n\t\t\t: this.#renderTransformed();\r\n\t}\r\n\r\n\t/** Build concatenated markdown for all included sections.\r\n\t *  Non-role sections include their heading as an h2 (actual content headings from the PDF).\r\n\t *  Role sections (pattern=\"role\") skip the heading (it's a structural rule label). */\r\n\t#buildFullMarkdown(): string {\r\n\t\tif (!this._transformResult) return '';\r\n\r\n\t\tconst includedSections = allTransformSections(this._transformResult).filter((s) => s.included);\r\n\t\tconst parts: string[] = [];\r\n\r\n\t\tfor (const section of includedSections) {\r\n\t\t\t// Include heading for non-role sections — these are real content headings from the PDF\r\n\t\t\tif (section.heading && section.pattern !== 'role') {\r\n\t\t\t\tparts.push(`## ${section.heading}`);\r\n\t\t\t\tparts.push('');\r\n\t\t\t}\r\n\t\t\tif (section.content) {\r\n\t\t\t\tparts.push(section.content);\r\n\t\t\t}\r\n\t\t\tif (section.description) {\r\n\t\t\t\tparts.push(section.description);\r\n\t\t\t}\r\n\t\t\tif (section.summary) {\r\n\t\t\t\tparts.push(section.summary);\r\n\t\t\t}\r\n\t\t\t// Blank line between sections\r\n\t\t\tif (parts.length > 0) parts.push('');\r\n\t\t}\r\n\r\n\t\treturn parts.join('\\n');\r\n\t}\r\n\r\n\t#renderTransformed() {\r\n\t\tif (!this._transformResult) {\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t\t<uui-icon name=\"icon-lab\" style=\"font-size: 48px; color: var(--uui-color-text-alt);\"></uui-icon>\r\n\t\t\t\t\t<h3>No transform result</h3>\r\n\t\t\t\t\t<p>Save to extract content and generate the transformed view.</p>\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tconst fullMarkdown = this.#buildFullMarkdown();\r\n\t\tif (!fullMarkdown.trim()) {\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t\t<uui-icon name=\"icon-lab\" style=\"font-size: 48px; color: var(--uui-color-text-alt);\"></uui-icon>\r\n\t\t\t\t\t<h3>No content</h3>\r\n\t\t\t\t\t<p>All sections are excluded. Include at least one section to see the preview.</p>\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tconst renderedHtml = markdownToHtml(fullMarkdown);\r\n\t\treturn html`\r\n\t\t\t<div class=\"transformed-preview\">\r\n\t\t\t\t<div class=\"md-section-content\">${unsafeHTML(renderedHtml)}</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t/** Render mapping badges for a given source key, with an \"x\" to unmap. */\r\n\t#renderPartBadges(sourceKey: string) {\r\n\t\tconst targets = this.#getMappedTargets(sourceKey);\r\n\t\tif (targets.length === 0) return nothing;\r\n\t\treturn targets.map((dest) => {\r\n\t\t\tconst orphaned = dest.blockKey && this.#orphanedKeys.has(`${dest.blockKey}:${dest.target}`);\r\n\t\t\tconst color = orphaned ? 'warning' : 'positive';\r\n\t\t\treturn html`<uui-tag color=\"${color}\" look=\"primary\" class=\"mapped-tag\" title=\"${this.#resolveTargetLabel(dest)}\">\r\n\t\t\t\t${this.#resolveTargetLabel(dest)}\r\n\t\t\t\t<button class=\"unmap-x\" title=\"Remove mapping\" @click=${(e: Event) => { e.stopPropagation(); this.#onUnmap(sourceKey, dest); }}>&times;</button>\r\n\t\t\t</uui-tag>`;\r\n\t\t});\r\n\t}\r\n\r\n\t/** Info boxes for markdown sources — Source, Areas, Sections. */\r\n\t#renderNonPdfInfoBoxes() {\r\n\t\tif (!this._extraction) return nothing;\r\n\r\n\t\tconst fileName = this._extraction.source.fileName ?? '';\r\n\t\tconst extractedDate = new Date(this._extraction.source.extractedDate).toLocaleString();\r\n\t\tconst hasAreas = this._areaDetection !== null;\r\n\t\tconst areaCount = hasAreas ? this._areaDetection!.diagnostics.areasDetected : 0;\r\n\t\tconst sectionCount = hasAreas ? this.#computeSectionCount() : 0;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"info-boxes\">\r\n\t\t\t\t<uui-box class=\"info-box-item\">\r\n\t\t\t\t\t<div slot=\"headline\" class=\"box-headline-row\">\r\n\t\t\t\t\t\t<span>Source</span>\r\n\t\t\t\t\t\t<span class=\"box-headline-meta\">${extractedDate}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-document\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-stat box-filename\" title=\"${fileName}\">${fileName}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Source\"\r\n\t\t\t\t\t\t\t\t@click=${this.#onPickMedia} ?disabled=${this._extracting}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-document\"></uui-icon> Choose Source\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Areas\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-grid\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-stat\">${areaCount}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Areas\" disabled>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-grid\"></uui-icon> Choose Areas\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Sections\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-thumbnail-list\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-stat\">${sectionCount}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Sections\" disabled>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-thumbnail-list\"></uui-icon> Choose Sections\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t/** Routes between Extracted and Transformed views for non-PDF sources (markdown). */\r\n\t#renderNonPdfContent() {\r\n\t\tif (this._viewMode === 'transformed') {\r\n\t\t\treturn this.#renderTransformed();\r\n\t\t}\r\n\t\t// Extracted tab: use area hierarchy if available, otherwise flat list\r\n\t\tif (this._areaDetection) {\r\n\t\t\treturn this.#renderAreaDetection();\r\n\t\t}\r\n\t\treturn this.#renderSimpleElements();\r\n\t}\r\n\r\n\t/** Info boxes for web sources — Source, Areas, Sections (3 functional boxes). */\r\n\t#renderWebInfoBoxes() {\r\n\t\tif (!this._extraction) return nothing;\r\n\r\n\t\tconst url = this._extraction.source.fileName ?? '';\r\n\t\tconst extractedDate = new Date(this._extraction.source.extractedDate).toLocaleString();\r\n\t\tconst hasAreas = this._areaDetection !== null;\r\n\t\tconst areaCount = hasAreas ? this._areaDetection!.diagnostics.areasDetected : 0;\r\n\t\tconst sectionCount = hasAreas ? this.#computeSectionCount() : 0;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"info-boxes\">\r\n\t\t\t\t<uui-box class=\"info-box-item\">\r\n\t\t\t\t\t<div slot=\"headline\" class=\"box-headline-row\">\r\n\t\t\t\t\t\t<span>Source</span>\r\n\t\t\t\t\t\t<span class=\"box-headline-meta\">${extractedDate}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-globe\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\t\tlabel=\"URL\"\r\n\t\t\t\t\t\t\tplaceholder=\"https://example.com/page\"\r\n\t\t\t\t\t\t\tclass=\"box-url-input\"\r\n\t\t\t\t\t\t\t.value=${this._sampleUrl || url}\r\n\t\t\t\t\t\t\t@input=${(e: Event) => { this._sampleUrl = (e.target as HTMLInputElement).value; }}\r\n\t\t\t\t\t\t\t@keydown=${(e: KeyboardEvent) => {\r\n\t\t\t\t\t\t\t\tif (e.key === 'Enter' && this._sampleUrl) this.#runUrlExtraction(this._sampleUrl);\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t</uui-input>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Source\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#runUrlExtraction(this._sampleUrl || url)}\r\n\t\t\t\t\t\t\t\t?disabled=${this._extracting}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-globe\"></uui-icon> Choose Source\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Areas\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-grid\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-stat\">${areaCount}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Areas\" disabled>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-grid\"></uui-icon> Choose Areas\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box headline=\"Sections\" class=\"info-box-item\">\r\n\t\t\t\t\t<div class=\"box-content\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-thumbnail-list\" class=\"box-icon\"></uui-icon>\r\n\t\t\t\t\t\t<span class=\"box-stat\">${sectionCount}</span>\r\n\t\t\t\t\t\t<div class=\"box-buttons\">\r\n\t\t\t\t\t\t\t<uui-button look=\"primary\" color=\"default\" label=\"Choose Sections\" disabled>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-thumbnail-list\"></uui-icon> Choose Sections\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t/** Routes between Extracted (area hierarchy) and Transformed views for web sources. */\r\n\t#renderWebContent() {\r\n\t\tif (this._viewMode === 'transformed') {\r\n\t\t\treturn this.#renderTransformed();\r\n\t\t}\r\n\t\t// Extracted tab: use area hierarchy if available, otherwise flat list\r\n\t\tif (this._areaDetection) {\r\n\t\t\treturn this.#renderAreaDetection();\r\n\t\t}\r\n\t\treturn this.#renderSimpleElements();\r\n\t}\r\n\r\n\t/** Simple header for non-PDF sources — just shows file name and a change button. */\r\n\t#renderSimpleHeader() {\r\n\t\tif (this.#sourceType === 'web') {\r\n\t\t\treturn this.#renderWebHeader();\r\n\t\t}\r\n\t\tconst fileName = this._extraction?.source?.fileName ?? 'Unknown file';\r\n\t\treturn html`\r\n\t\t\t<div class=\"simple-header\">\r\n\t\t\t\t<div class=\"simple-header-info\">\r\n\t\t\t\t\t<uui-icon name=\"icon-document\"></uui-icon>\r\n\t\t\t\t\t<strong>${fileName}</strong>\r\n\t\t\t\t\t<span style=\"color: var(--uui-color-text-alt);\">${this._extraction?.elements?.length ?? 0} elements</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<uui-button look=\"secondary\" label=\"Choose Source\" @click=${this.#onPickMedia} ?disabled=${this._extracting} compact>\r\n\t\t\t\t\t${this._extracting ? html`<uui-loader-bar></uui-loader-bar>` : 'Choose Source'}\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderWebHeader() {\r\n\t\tconst url = this._extraction?.source?.fileName ?? '';\r\n\t\treturn html`\r\n\t\t\t<div class=\"simple-header\">\r\n\t\t\t\t<div class=\"simple-header-info\">\r\n\t\t\t\t\t<uui-icon name=\"icon-globe\"></uui-icon>\r\n\t\t\t\t\t<strong>${url}</strong>\r\n\t\t\t\t\t<span style=\"color: var(--uui-color-text-alt);\">${this._extraction?.elements?.length ?? 0} elements</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<uui-button look=\"secondary\" label=\"Choose Source\" @click=${() => this.#runUrlExtraction(url)} ?disabled=${this._extracting} compact>\r\n\t\t\t\t\t${this._extracting ? html`<uui-loader-bar></uui-loader-bar>` : 'Choose Source'}\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t/** Simple element list for non-PDF sources — headings rendered larger, body as paragraphs. */\r\n\t#renderSimpleElements() {\r\n\t\tif (!this._extraction?.elements?.length) {\r\n\t\t\treturn html`<p style=\"padding: var(--uui-size-layout-1); color: var(--uui-color-text-alt);\">No elements extracted.</p>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"simple-elements\">\r\n\t\t\t\t${this._extraction.elements.map((el) => {\r\n\t\t\t\t\tconst isHeading = el.metadata?.fontName?.startsWith('heading-');\r\n\t\t\t\t\tconst headingLevel = isHeading ? parseInt(el.metadata.fontName.replace('heading-', ''), 10) : 0;\r\n\t\t\t\t\treturn html`\r\n\t\t\t\t\t\t<div class=\"simple-element ${isHeading ? 'simple-element-heading' : ''}\">\r\n\t\t\t\t\t\t\t<div class=\"simple-element-text\" style=\"${isHeading ? `font-size: ${24 - (headingLevel - 1) * 2}px; font-weight: bold;` : ''}\">\r\n\t\t\t\t\t\t\t\t${el.text}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"simple-element-actions\">\r\n\t\t\t\t\t\t\t\t${this.#renderPartBadges(el.id)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t`;\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderEmpty() {\r\n\t\tif (this.#sourceType === 'web') {\r\n\t\t\treturn this.#renderWebEmpty();\r\n\t\t}\r\n\r\n\t\tconst isPdf = this.#sourceType === 'pdf';\r\n\t\tconst label = 'Choose Source...';\r\n\t\tconst description = isPdf\r\n\t\t\t? 'Choose a PDF from the media library to extract text elements with their metadata.'\r\n\t\t\t: `Choose a ${this.#sourceType} file from the media library to extract content.`;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t<uui-icon name=\"icon-document\" style=\"font-size: 48px; color: var(--uui-color-text-alt);\"></uui-icon>\r\n\t\t\t\t<h3>No sample extraction</h3>\r\n\t\t\t\t<p>${description}</p>\r\n\t\t\t\t<uui-button look=\"primary\" label=\"${label}\" @click=${this.#onPickMedia} ?disabled=${this._extracting}>\r\n\t\t\t\t\t${this._extracting ? html`<uui-loader-bar></uui-loader-bar>` : label}\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderWebEmpty() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t<uui-icon name=\"icon-globe\" style=\"font-size: 48px; color: var(--uui-color-text-alt);\"></uui-icon>\r\n\t\t\t\t<h3>No sample extraction</h3>\r\n\t\t\t\t<p>Enter a web page URL to extract content.</p>\r\n\t\t\t\t<div style=\"display: flex; gap: 8px; align-items: center; width: 100%; max-width: 500px;\">\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\tlabel=\"URL\"\r\n\t\t\t\t\t\tplaceholder=\"https://example.com/page\"\r\n\t\t\t\t\t\tstyle=\"flex: 1;\"\r\n\t\t\t\t\t\t.value=${this._sampleUrl}\r\n\t\t\t\t\t\t@input=${(e: Event) => { this._sampleUrl = (e.target as HTMLInputElement).value; }}\r\n\t\t\t\t\t\t@keydown=${(e: KeyboardEvent) => {\r\n\t\t\t\t\t\t\tif (e.key === 'Enter' && this._sampleUrl) this.#runUrlExtraction(this._sampleUrl);\r\n\t\t\t\t\t\t}}>\r\n\t\t\t\t\t</uui-input>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tlabel=\"Extract\"\r\n\t\t\t\t\t\t?disabled=${!this._sampleUrl || this._extracting}\r\n\t\t\t\t\t\t@click=${() => this.#runUrlExtraction(this._sampleUrl)}>\r\n\t\t\t\t\t\t${this._extracting ? html`<uui-loader-bar></uui-loader-bar>` : 'Extract'}\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tasync #runUrlExtraction(url: string) {\r\n\t\tif (!this._workflowAlias || !url) return;\r\n\r\n\t\tthis._extracting = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t\tconst extraction = await triggerSampleExtraction(this._workflowAlias, '', token, url);\r\n\r\n\t\t\tif (extraction) {\r\n\t\t\t\tthis._extraction = extraction;\r\n\t\t\t\t// Backend auto-generated area-detection.json and transform.json — fetch both\r\n\t\t\t\tconst [areaDetection, transformResult] = await Promise.all([\r\n\t\t\t\t\tfetchAreaDetection(this._workflowAlias!, token),\r\n\t\t\t\t\tfetchTransformResult(this._workflowAlias!, token),\r\n\t\t\t\t]);\r\n\t\t\t\tthis._areaDetection = areaDetection;\r\n\t\t\t\tthis._transformResult = transformResult;\r\n\r\n\t\t\t\tconst areaCount = areaDetection?.diagnostics?.areasDetected ?? 0;\r\n\t\t\t\tthis._successMessage = `Content extracted — ${extraction.elements.length} elements in ${areaCount} areas`;\r\n\t\t\t\tsetTimeout(() => { this._successMessage = null; }, 5000);\r\n\t\t\t} else {\r\n\t\t\t\tthis._error = 'Extraction failed. Check that the URL is accessible.';\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Failed to extract from URL';\r\n\t\t\tconsole.error('URL extraction failed:', err);\r\n\t\t} finally {\r\n\t\t\tthis._extracting = false;\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<div class=\"loading\"><uui-loader-bar></uui-loader-bar></div>`;\r\n\t\t}\r\n\r\n\t\tif (this._error) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t\t<p style=\"color: var(--uui-color-danger); padding: var(--uui-size-layout-1);\">${this._error}</p>\r\n\t\t\t\t</umb-body-layout>`;\r\n\t\t}\r\n\r\n\t\tconst isPdf = this.#sourceType === 'pdf';\r\n\t\tconst isWeb = this.#sourceType === 'web';\r\n\t\tconst isMarkdown = this.#sourceType === 'markdown';\r\n\t\tconst hasContent = this._areaDetection !== null || this._extraction !== null;\r\n\r\n\t\tif (isMarkdown) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t\t${hasContent ? this.#renderExtractionHeader() : nothing}\r\n\t\t\t\t\t${hasContent && this._viewMode === 'elements' ? this.#renderNonPdfInfoBoxes() : nothing}\r\n\t\t\t\t\t${this.#renderCollapseRow()}\r\n\t\t\t\t\t${this._successMessage ? html`<div class=\"success-banner\"><uui-icon name=\"icon-check\"></uui-icon> ${this._successMessage}</div>` : nothing}\r\n\t\t\t\t\t${hasContent ? this.#renderNonPdfContent() : this.#renderEmpty()}\r\n\t\t\t\t</umb-body-layout>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tif (isWeb) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t\t${hasContent ? this.#renderExtractionHeader() : nothing}\r\n\t\t\t\t\t${hasContent && this._viewMode === 'elements' ? this.#renderWebInfoBoxes() : nothing}\r\n\t\t\t\t\t${this.#renderCollapseRow()}\r\n\t\t\t\t\t${this._successMessage ? html`<div class=\"success-banner\"><uui-icon name=\"icon-check\"></uui-icon> ${this._successMessage}</div>` : nothing}\r\n\t\t\t\t\t${hasContent ? this.#renderWebContent() : this.#renderEmpty()}\r\n\t\t\t\t</umb-body-layout>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\t// PDF: full area detection with page selection, area templates, etc.\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t${hasContent ? this.#renderExtractionHeader() : nothing}\r\n\t\t\t\t${hasContent && this._viewMode === 'elements' ? this.#renderInfoBoxes() : nothing}\r\n\t\t\t\t${this._successMessage ? html`<div class=\"success-banner\"><uui-icon name=\"icon-check\"></uui-icon> ${this._successMessage}</div>` : nothing}\r\n\t\t\t\t${hasContent ? this.#renderExtractionContent() : this.#renderEmpty()}\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\toverflow-x: hidden;\r\n\t\t\t\t--uui-tab-background: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\t.loading {\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.success-banner {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\r\n\t\t\t/* Empty state */\r\n\t\t\t.empty-state {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tpadding: var(--uui-size-layout-2);\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tmin-height: 300px;\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state h3 {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state p {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Simple view (non-PDF) */\r\n\t\t\t.simple-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tpadding: var(--uui-size-space-4) var(--uui-size-layout-1);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.simple-header-info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.simple-elements {\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.simple-element {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: flex-start;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\t.simple-element-heading {\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.simple-element-text {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\twhite-space: pre-wrap;\r\n\t\t\t\tword-break: break-word;\r\n\t\t\t\tmax-width: 75ch;\r\n\t\t\t}\r\n\r\n\t\t\t.simple-element-actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tgap: var(--uui-size-space-1);\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t}\r\n\r\n\t\t\t/* Header: tabs only */\r\n\t\t\t.source-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.source-header uui-tab-group {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t/* Info boxes row (uSync-inspired) */\r\n\t\t\t.info-boxes {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.info-box-item {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.box-content {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tmin-height: 180px;\r\n\t\t\t}\r\n\r\n\t\t\t.box-buttons {\r\n\t\t\t\tmargin-top: auto;\r\n\t\t\t\tpadding-top: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.box-icon {\r\n\t\t\t\tfont-size: 48px;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tmargin-top: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.box-headline-row {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.box-headline-meta {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-weight: 400;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.box-filename {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tfont-size: var(--uui-type-default-size) !important;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t\tmax-width: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.box-url-input {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\t--uui-input-border-color: transparent;\r\n\t\t\t\t--uui-input-border-color-hover: var(--uui-color-border-emphasis);\r\n\t\t\t\t--uui-input-border-color-focus: var(--uui-color-focus);\r\n\t\t\t}\r\n\r\n\t\t\t.box-buttons {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tmargin-top: auto;\r\n\t\t\t\tpadding-top: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.box-stat {\r\n\t\t\t\tfont-size: var(--uui-type-h4-size);\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t}\r\n\r\n\r\n\t\t\t/* Collapse row below boxes */\r\n\t\t\t.collapse-row {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\tpadding: 0 var(--uui-size-space-4) var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t/* Page box include toggle */\r\n\t\t\t.page-header-actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.page-box.page-excluded {\r\n\t\t\t\topacity: 0.4;\r\n\t\t\t}\r\n\r\n\t\t\t.header-spacer {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t/* Page groups */\r\n\t\t\t.page-box {\r\n\t\t\t\tmargin: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t/* Tree-style header for page boxes */\r\n\t\t\t.tree-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.tree-header:hover .collapse-chevron {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.page-title {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t}\r\n\r\n\t\t\t/* Consistent collapse chevron across all levels */\r\n\t\t\t.collapse-chevron {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t\tfont-size: 12px;\r\n\t\t\t}\r\n\r\n\t\t\t.level-icon {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t\tfont-size: 12px;\r\n\t\t\t}\r\n\r\n\t\t\t/* Detected areas (Level 2) */\r\n\t\t\t.detected-area {\r\n\t\t\t\tborder-left: 4px solid var(--uui-color-border);\r\n\t\t\t\tmargin: var(--uui-size-space-4) 0;\r\n\t\t\t\tmargin-left: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.detected-area.area-excluded {\r\n\t\t\t\topacity: 0.4;\r\n\t\t\t}\r\n\r\n\t\t\t.area-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-3);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.area-header:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.area-header:hover .collapse-chevron {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.area-color-swatch {\r\n\t\t\t\tdisplay: inline-block;\r\n\t\t\t\twidth: 12px;\r\n\t\t\t\theight: 12px;\r\n\t\t\t\tborder-radius: 2px;\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.area-name {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t/* Sections within detected areas (Level 3) */\r\n\t\t\t.area-section {\r\n\t\t\t\tmargin-left: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.area-section + .area-section {\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.section-heading:hover .collapse-chevron {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.heading-text {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t.collapse-chevron.placeholder {\r\n\t\t\t\topacity: 0;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t}\r\n\r\n\t\t\t.group-count {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t.section-children {\r\n\t\t\t\tpadding-left: var(--uui-size-space-5);\r\n\t\t\t\tborder-left: 2px solid var(--uui-color-border);\r\n\t\t\t\tmargin-left: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t/* Excluded sections */\r\n\t\t\t.area-section.excluded {\r\n\t\t\t\topacity: 0.4;\r\n\t\t\t}\r\n\r\n\t\t\t.preamble-label {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t}\r\n\r\n\t\t\t/* Element items */\r\n\t\t\t.element-item {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: flex-start;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.element-item:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t.element-content {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.element-text {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-2);\r\n\t\t\t\toverflow-wrap: break-word;\r\n\t\t\t}\r\n\r\n\t\t\t.element-meta {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tpadding: 1px 6px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.text-type {\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t\ttext-transform: uppercase;\r\n\t\t\t\tfont-size: 10px;\r\n\t\t\t\tletter-spacing: 0.5px;\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.text-type.heading {\r\n\t\t\t\tcolor: var(--uui-color-current);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.text-type.list {\r\n\t\t\t\tcolor: var(--uui-color-positive);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.font-size {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.meta-badge.text-case {\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t\ttext-transform: uppercase;\r\n\t\t\t\tfont-size: 10px;\r\n\t\t\t\tletter-spacing: 0.5px;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.mapped-tag {\r\n\t\t\t\tfont-size: 12px;\r\n\t\t\t}\r\n\r\n\t\t\t.unmap-x {\r\n\t\t\t\tall: unset;\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tfont-size: 14px;\r\n\t\t\t\tline-height: 1;\r\n\t\t\t\tpadding: 0 2px;\r\n\t\t\t\tmargin-left: 4px;\r\n\t\t\t\topacity: 0.7;\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t}\r\n\r\n\t\t\t.unmap-x:hover {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.diagnostics {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t}\r\n\r\n\t\t\t/* Transformed sections */\r\n\t\t\t.transformed-section {\r\n\t\t\t\tmargin: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-section.section-mapped {\r\n\t\t\t\tborder-left: 3px solid var(--uui-color-positive);\r\n\t\t\t}\r\n\r\n\t\t\t.section-mapping-actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-4);\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.mapping-label {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-header-badges {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tpadding: 1px 8px;\r\n\t\t\t\tborder-radius: 10px;\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge.bulletList {\r\n\t\t\t\tbackground: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge.paragraph {\r\n\t\t\t\tbackground: var(--uui-color-warning-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-warning-contrast);\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge.subHeaded {\r\n\t\t\t\tbackground: var(--uui-color-default-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-default-contrast);\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge.preamble {\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.pattern-badge.role {\r\n\t\t\t\tbackground: var(--uui-color-current-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-current-contrast);\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-content {\r\n\t\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tline-height: 1.6;\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-content ul,\r\n\t\t\t.transformed-content ol {\r\n\t\t\t\tpadding-left: var(--uui-size-space-5);\r\n\t\t\t\tmargin: var(--uui-size-space-2) 0;\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-content p {\r\n\t\t\t\tmargin: var(--uui-size-space-2) 0;\r\n\t\t\t}\r\n\r\n\t\t\t.transformed-content h2 {\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tmargin: var(--uui-size-space-3) 0 var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t/* Section picker popover */\r\n\t\t\t.section-picker-meta {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Structure badge on area header */\r\n\t\t\t.structure-badge {\r\n\t\t\t\tbackground: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t}\r\n\r\n\t\t\t/* Rules info text on area header */\r\n\t\t\t.rules-info {\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-weight: 400;\r\n\t\t\t}\r\n\r\n\t\t\t/* Section boxes — bordered containers for each section */\r\n\t\t\t.composed-sections {\r\n\t\t\t\tmargin-left: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.section-box {\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tmargin: var(--uui-size-space-3) 0;\r\n\t\t\t}\r\n\r\n\t\t\t.section-box:first-child {\r\n\t\t\t\tmargin-top: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.section-box-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.section-box-header:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t.section-box-header:hover .collapse-chevron {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.section-box-label {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.section-box-content {\r\n\t\t\t\tpadding: 0 var(--uui-size-space-4) var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t/* Part boxes — nested bordered containers for grouped parts */\r\n\t\t\t.part-box {\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.part-box:last-child {\r\n\t\t\t\tmargin-bottom: 0;\r\n\t\t\t}\r\n\r\n\t\t\t/* Part row — flex layout for label + content + actions */\r\n\t\t\t.part-box-row {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: flex-start;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.part-box-label {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tmin-width: 80px;\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t\tpadding-top: 2px;\r\n\t\t\t}\r\n\r\n\t\t\t.part-box-content {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tfont-size: var(--uui-type-default-size);\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t/* Headings inside part content render as plain bold text */\r\n\t\t\t.part-box-content h1,\r\n\t\t\t.part-box-content h2,\r\n\t\t\t.part-box-content h3,\r\n\t\t\t.part-box-content h4,\r\n\t\t\t.part-box-content h5,\r\n\t\t\t.part-box-content h6 {\r\n\t\t\t\tfont-size: inherit;\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin: 0.75em 0 0.25em;\r\n\t\t\t\tline-height: 1.4;\r\n\t\t\t}\r\n\r\n\t\t\t.part-box-content h1:first-child,\r\n\t\t\t.part-box-content h2:first-child,\r\n\t\t\t.part-box-content h3:first-child,\r\n\t\t\t.part-box-content h4:first-child,\r\n\t\t\t.part-box-content h5:first-child,\r\n\t\t\t.part-box-content h6:first-child {\r\n\t\t\t\tmargin-top: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.part-box-actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tflex-shrink: 0;\r\n\t\t\t\tpadding-top: 2px;\r\n\t\t\t}\r\n\r\n\t\t\t.composed-unmapped {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t/* Teach-by-example mode */\r\n\t\t\t.area-teaching {\r\n\t\t\t\tborder-left-width: 4px;\r\n\t\t\t\tborder-left-style: solid;\r\n\t\t\t\tbox-shadow: 0 0 0 1px var(--uui-color-focus);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-toolbar {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-instruction {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-toolbar-actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-confirmation {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-positive-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-confirmation-info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-condition-summary {\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\topacity: 0.8;\r\n\t\t\t}\r\n\r\n\t\t\t.teach-confirmation-actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-elements {\r\n\t\t\t\tpadding-left: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-element {\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\ttransition: background-color 0.15s;\r\n\t\t\t}\r\n\r\n\t\t\t.teach-element:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-element.teach-clicked {\r\n\t\t\t\tbackground: color-mix(in srgb, var(--uui-color-focus) 15%, transparent);\r\n\t\t\t\tborder-left: 3px solid var(--uui-color-focus);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-element.teach-matched {\r\n\t\t\t\tbackground: color-mix(in srgb, var(--uui-color-positive) 10%, transparent);\r\n\t\t\t\tborder-left: 3px solid var(--uui-color-positive);\r\n\t\t\t}\r\n\r\n\t\t\t.teach-element.teach-clicked.teach-matched {\r\n\t\t\t\tbackground: color-mix(in srgb, var(--uui-color-focus) 15%, transparent);\r\n\t\t\t\tborder-left: 3px solid var(--uui-color-focus);\r\n\t\t\t}\r\n\r\n\t\t\t/* Transformed tab — read-only markdown preview */\r\n\t\t\t.transformed-preview {\r\n\t\t\t\tpadding: var(--uui-size-space-5);\r\n\t\t\t\tmax-width: 75ch;\r\n\t\t\t}\r\n\r\n\t\t\t/* Map button — hidden by default, shown on box hover */\r\n\t\t\t.md-map-btn {\r\n\t\t\t\topacity: 0;\r\n\t\t\t\ttransition: opacity 0.15s;\r\n\t\t\t}\r\n\r\n\t\t\t.part-box:hover .md-map-btn,\r\n\t\t\t.part-box-row:hover .md-map-btn {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content {\r\n\t\t\t\tline-height: 1.75;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t\tfont-size: 15px;\r\n\t\t\t}\r\n\r\n\t\t\t/* Headings */\r\n\t\t\t.md-section-content h1 {\r\n\t\t\t\tfont-size: 2em;\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t\tmargin: 0.67em 0 0.4em;\r\n\t\t\t\tline-height: 1.25;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content h2 {\r\n\t\t\t\tfont-size: 1.5em;\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin: 1em 0 0.4em;\r\n\t\t\t\tpadding-bottom: 0.3em;\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tline-height: 1.3;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content h3 {\r\n\t\t\t\tfont-size: 1.25em;\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin: 0.8em 0 0.3em;\r\n\t\t\t\tline-height: 1.35;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content h4 {\r\n\t\t\t\tfont-size: 1.1em;\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin: 0.6em 0 0.25em;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content h5,\r\n\t\t\t.md-section-content h6 {\r\n\t\t\t\tfont-size: 1em;\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin: 0.5em 0 0.2em;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Paragraphs */\r\n\t\t\t.md-section-content p {\r\n\t\t\t\tmargin: 0.5em 0;\r\n\t\t\t}\r\n\r\n\t\t\t/* Lists */\r\n\t\t\t.md-section-content ul,\r\n\t\t\t.md-section-content ol {\r\n\t\t\t\tpadding-left: 1.75em;\r\n\t\t\t\tmargin: 0.5em 0;\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content li {\r\n\t\t\t\tmargin: 0.2em 0;\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content ul li::marker {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t/* Blockquotes */\r\n\t\t\t.md-section-content blockquote {\r\n\t\t\t\tmargin: 0.5em 0;\r\n\t\t\t\tpadding: 0.25em 1em;\r\n\t\t\t\tborder-left: 3px solid var(--uui-color-current);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tbackground: color-mix(in srgb, var(--uui-color-current) 5%, transparent);\r\n\t\t\t\tborder-radius: 0 var(--uui-border-radius) var(--uui-border-radius) 0;\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content blockquote p {\r\n\t\t\t\tmargin: 0.25em 0;\r\n\t\t\t}\r\n\r\n\t\t\t/* Inline styles */\r\n\t\t\t.md-section-content strong {\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content em {\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content code {\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tfont-size: 0.9em;\r\n\t\t\t\tpadding: 0.1em 0.35em;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tcolor: var(--uui-color-danger);\r\n\t\t\t}\r\n\r\n\t\t\t.md-section-content mark {\r\n\t\t\t\tbackground: color-mix(in srgb, var(--uui-color-warning) 30%, transparent);\r\n\t\t\t\tpadding: 0.1em 0.2em;\r\n\t\t\t\tborder-radius: 2px;\r\n\t\t\t}\r\n\r\n\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocWorkflowSourceViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-workflow-source-view': UpDocWorkflowSourceViewElement;\r\n\t}\r\n}\r\n"],"names":["UMB_AREA_EDITOR_MODAL","UmbModalToken","UMB_SECTION_RULES_EDITOR_MODAL","UMB_DESTINATION_PICKER_MODAL","_token","_orphanedKeys","_UpDocWorkflowSourceViewElement_instances","sourceType_get","loadData_fn","parsePageRange_fn","pagesToRangeString_fn","getSelectedPages_fn","isPageIncluded_fn","savePageSelection_fn","getKeysForLevel_fn","isLevelCollapsed_fn","toggleLevel_fn","expandAll_fn","onCollapsePopoverToggle_fn","renderCollapseRow_fn","onPickMedia_fn","onEditAreas_fn","getAreasForRulesEditor_fn","onSectionPickerToggle_fn","saveAreaRulesForKey_fn","onEditAreaRules_fn","onOpenPagePicker_fn","onReExtract_fn","runExtraction_fn","isCollapsed_fn","toggleCollapse_fn","isSectionIncluded_fn","onToggleInclusion_fn","getMappedTargets_fn","resolveTargetLabel_fn","getGlobalAreaIndex_fn","getAreaElements_fn","onTeachElementClick_fn","onConfirmPattern_fn","onNoSections_fn","onCancelTeach_fn","getAreaRulesKey_fn","hasAreaRules_fn","getTransformSectionsForArea_fn","onMapSection_fn","onUnmap_fn","renderComposedSectionRow_fn","classifyText_fn","renderAreaElement_fn","renderSection_fn","toggleAreaExclusion_fn","renderTeachElement_fn","renderTeachToolbar_fn","renderArea_fn","renderAreaPage_fn","renderAreaDetection_fn","computeSectionCount_fn","renderExtractionHeader_fn","renderInfoBoxes_fn","renderExtractionContent_fn","buildFullMarkdown_fn","renderTransformed_fn","renderPartBadges_fn","renderNonPdfInfoBoxes_fn","renderNonPdfContent_fn","renderWebInfoBoxes_fn","renderWebContent_fn","renderSimpleElements_fn","renderEmpty_fn","renderWebEmpty_fn","runUrlExtraction_fn","UpDocWorkflowSourceViewElement","UmbLitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","context","__privateMethod","unique","html","__privateGet","isWeb","isMarkdown","hasContent","nothing","authContext","UMB_AUTH_CONTEXT","__privateSet","extraction","config","sourceConfig","fetchSampleExtraction","fetchWorkflowByAlias","fetchSourceConfig","w","m","isPdf","areaDetection","transformResult","areaTemplate","fetchAreaDetection","fetchTransformResult","fetchAreaTemplate","mediaKey","freshTransform","triggerTransform","err","input","pages","part","trimmed","rangeParts","s","i","a","b","sorted","ranges","start","end","pageNum","savePageSelection","level","keys","page","_z","aIdx","_s","sIdx","area","k","allCollapsed","next","key","event","result","UMB_MODAL_MANAGER_CONTEXT","UMB_MEDIA_PICKER_MODAL","modal","saved","saveAreaTemplate","seenKeys","areaName","areaKey","normalizeToKebabCase","elements","ar","hasRules","rules","allRules","saveAreaRules","updatedTransform","existingRules","totalPages","selectedPages","UMB_PAGE_PICKER_MODAL","url","token","triggerSampleExtraction","d","rolePart","sectionId","allTransformSections","included","updateSectionInclusion","elementId","targets","mapping","dest","container","getAllBlockContainers","block","prop","p","field","f","localAreaIndex","globalIdx","section","inferSectionPattern","idx","updatedAreas","updatedTemplate","areaRules","matchingArea","sections","group","partSuffix","sourceKey","existingMappings","newMapping","t","existingIndex","updatedMappings","updatedMap","saveMapConfig","mappingIndex","remainingDests","_","suffixes","hasMappings","collapseKey","isCollapsed","sectionLabel","isGrouped","unsafeHTML","markdownToHtml","e","text","element","role","textType","badgeLabel","sectionKey","areaIndex","isIncluded","el","heading","elementCount","hasChildren","collapsed","isClicked","isMatching","matchCount","conditionSummary","c","isTeaching","rulesAreaKey","composedSections","useComposed","sectionCount","patternLabel","areaRulesObj","ruleCount","sum","g","areas","pageKey","areaCount","aSum","hasAreas","hasExtraction","savedPages","hasSavedPageSelection","selectedCount","pagesLabel","fileName","extractedDate","includedSections","parts","fullMarkdown","renderedHtml","color","isHeading","headingLevel","label","description","UmbTextStyles","css","__decorateClass","state","customElement","UpDocWorkflowSourceViewElement_default"],"mappings":"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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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"}