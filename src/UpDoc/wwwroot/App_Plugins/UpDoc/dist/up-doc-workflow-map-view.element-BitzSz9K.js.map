{"version":3,"file":"up-doc-workflow-map-view.element-BitzSz9K.js","sources":["../src/up-doc-workflow-map-view.element.ts"],"sourcesContent":["import type { DocumentTypeConfig, SectionMapping, MappingDestination, RichExtractionResult } from './workflow.types.js';\r\nimport { fetchWorkflowByName, fetchSampleExtraction, saveMapConfig } from './workflow.service.js';\r\nimport { getDestinationTabs, resolveDestinationTab, resolveBlockLabel } from './destination-utils.js';\r\nimport { html, customElement, css, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\n\r\n@customElement('up-doc-workflow-map-view')\r\nexport class UpDocWorkflowMapViewElement extends UmbLitElement {\r\n\t@state() private _config: DocumentTypeConfig | null = null;\r\n\t@state() private _extraction: RichExtractionResult | null = null;\r\n\t@state() private _loading = true;\r\n\t@state() private _error: string | null = null;\r\n\t#workflowName = '';\r\n\t#token = '';\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.consumeContext(UMB_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\t\t\tthis.observe((context as any).unique, (unique: string | null) => {\r\n\t\t\t\tif (unique) {\r\n\t\t\t\t\tthis.#workflowName = decodeURIComponent(unique);\r\n\t\t\t\t\tthis.#loadData();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #loadData() {\r\n\t\tthis._loading = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tthis.#token = await authContext.getLatestToken();\r\n\t\t\tthis._config = await fetchWorkflowByName(this.#workflowName, this.#token);\r\n\r\n\t\t\tif (!this._config) {\r\n\t\t\t\tthis._error = `Workflow \"${this.#workflowName}\" not found`;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._extraction = await fetchSampleExtraction(this.#workflowName, this.#token);\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Failed to load workflow';\r\n\t\t\tconsole.error('Failed to load workflow config:', err);\r\n\t\t} finally {\r\n\t\t\tthis._loading = false;\r\n\t\t}\r\n\t}\r\n\r\n\t#resolveDestinationLabel(dest: MappingDestination): string {\r\n\t\tif (!this._config) return dest.target;\r\n\r\n\t\t// If blockKey present, find the specific block\r\n\t\tif (dest.blockKey && this._config.destination.blockGrids) {\r\n\t\t\tfor (const grid of this._config.destination.blockGrids) {\r\n\t\t\t\tconst block = grid.blocks.find((b) => b.key === dest.blockKey);\r\n\t\t\t\tif (block) {\r\n\t\t\t\t\tconst prop = block.properties?.find((p) => p.alias === dest.target);\r\n\t\t\t\t\treturn `${block.label} > ${prop?.label || dest.target}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Top-level field\r\n\t\tfor (const field of this._config.destination.fields) {\r\n\t\t\tif (field.alias === dest.target) return field.label;\r\n\t\t}\r\n\r\n\t\t// Fall back: first block match (backwards compat for old mappings without blockKey)\r\n\t\tfor (const grid of this._config.destination.blockGrids ?? []) {\r\n\t\t\tfor (const block of grid.blocks) {\r\n\t\t\t\tfor (const prop of block.properties ?? []) {\r\n\t\t\t\t\tif (prop.alias === dest.target) {\r\n\t\t\t\t\t\treturn `${block.label} > ${prop.label || prop.alias}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn dest.target;\r\n\t}\r\n\r\n\t#resolveSourceText(sourceId: string): string {\r\n\t\tif (!this._extraction) return sourceId;\r\n\r\n\t\tconst element = this._extraction.elements.find((e) => e.id === sourceId);\r\n\t\tif (!element) return sourceId;\r\n\r\n\t\tconst text = element.text.length > 60 ? element.text.substring(0, 60) + '...' : element.text;\r\n\t\treturn text;\r\n\t}\r\n\r\n\tasync #deleteMapping(index: number) {\r\n\t\tif (!this._config) return;\r\n\r\n\t\tconst updatedMap = {\r\n\t\t\t...this._config.map,\r\n\t\t\tmappings: this._config.map.mappings.filter((_, i) => i !== index),\r\n\t\t};\r\n\r\n\t\tconst result = await saveMapConfig(this.#workflowName, updatedMap, this.#token);\r\n\t\tif (result) {\r\n\t\t\tthis._config = { ...this._config, map: updatedMap };\r\n\t\t}\r\n\t}\r\n\r\n\t#renderEmptyState() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t<uui-icon name=\"icon-nodes\" class=\"empty-icon\"></uui-icon>\r\n\t\t\t\t<p class=\"empty-title\">No mappings yet</p>\r\n\t\t\t\t<p class=\"empty-message\">Use the Source tab to map extracted content to destination fields.</p>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderMappingRow(mapping: SectionMapping, index: number) {\r\n\t\treturn html`\r\n\t\t\t<uui-table-row>\r\n\t\t\t\t<uui-table-cell class=\"source-cell\">\r\n\t\t\t\t\t<span class=\"source-id\">${mapping.source}</span>\r\n\t\t\t\t\t<span class=\"source-text\">${this.#resolveSourceText(mapping.source)}</span>\r\n\t\t\t\t</uui-table-cell>\r\n\t\t\t\t<uui-table-cell class=\"arrow-cell\">\r\n\t\t\t\t\t<uui-icon name=\"icon-arrow-right\"></uui-icon>\r\n\t\t\t\t</uui-table-cell>\r\n\t\t\t\t<uui-table-cell class=\"destination-cell\">\r\n\t\t\t\t\t${mapping.destinations.map(\r\n\t\t\t\t\t\t(dest) => html`\r\n\t\t\t\t\t\t\t<span class=\"destination-target\">${this.#resolveDestinationLabel(dest)}</span>\r\n\t\t\t\t\t\t\t${dest.transforms?.length\r\n\t\t\t\t\t\t\t\t? html`<span class=\"transform-badge\">${dest.transforms.map((t) => t.type).join(', ')}</span>`\r\n\t\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-table-cell>\r\n\t\t\t\t<uui-table-cell class=\"actions-cell\">\r\n\t\t\t\t\t${!mapping.enabled ? html`<uui-tag look=\"secondary\" class=\"disabled-badge\">Disabled</uui-tag>` : nothing}\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\t\tcolor=\"danger\"\r\n\t\t\t\t\t\tlabel=\"Delete\"\r\n\t\t\t\t\t\t@click=${() => this.#deleteMapping(index)}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</uui-table-cell>\r\n\t\t\t</uui-table-row>\r\n\t\t`;\r\n\t}\r\n\r\n\t/**\r\n\t * Groups mappings by their destination tab and block.\r\n\t * Uses the first destination in each mapping to determine the group.\r\n\t */\r\n\t#groupMappingsByDestination(): Array<{\r\n\t\ttabId: string;\r\n\t\ttabLabel: string;\r\n\t\tblockKey?: string;\r\n\t\tblockLabel?: string;\r\n\t\tmappings: Array<{ mapping: SectionMapping; index: number }>;\r\n\t}> {\r\n\t\tif (!this._config?.destination) return [];\r\n\r\n\t\tconst destination = this._config.destination;\r\n\t\tconst allTabs = getDestinationTabs(destination);\r\n\r\n\t\t// Composite key: \"tabId\" for top-level, \"tabId:blockKey\" for blocks\r\n\t\tconst groupMap = new Map<string, {\r\n\t\t\ttabId: string;\r\n\t\t\ttabLabel: string;\r\n\t\t\tblockKey?: string;\r\n\t\t\tblockLabel?: string;\r\n\t\t\tmappings: Array<{ mapping: SectionMapping; index: number }>;\r\n\t\t}>();\r\n\r\n\t\tfor (let index = 0; index < this._config.map.mappings.length; index++) {\r\n\t\t\tconst mapping = this._config.map.mappings[index];\r\n\t\t\tconst firstDest = mapping.destinations[0];\r\n\t\t\tif (!firstDest) continue;\r\n\r\n\t\t\tconst tabId = resolveDestinationTab(firstDest, destination) ?? 'unmapped';\r\n\t\t\tconst tabLabel = allTabs.find((t) => t.id === tabId)?.label ?? 'Unmapped';\r\n\t\t\tconst blockKey = firstDest.blockKey;\r\n\t\t\tconst blockLabel = blockKey ? resolveBlockLabel(blockKey, destination) : undefined;\r\n\r\n\t\t\tconst groupKey = blockKey ? `${tabId}:${blockKey}` : tabId;\r\n\r\n\t\t\tif (!groupMap.has(groupKey)) {\r\n\t\t\t\tgroupMap.set(groupKey, {\r\n\t\t\t\t\ttabId,\r\n\t\t\t\t\ttabLabel,\r\n\t\t\t\t\tblockKey: blockKey ?? undefined,\r\n\t\t\t\t\tblockLabel: blockLabel ?? undefined,\r\n\t\t\t\t\tmappings: [],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tgroupMap.get(groupKey)!.mappings.push({ mapping, index });\r\n\t\t}\r\n\r\n\t\t// Order groups: by tab order, then blocks by their order in destination.json\r\n\t\tconst result: typeof groupMap extends Map<string, infer V> ? V[] : never = [];\r\n\t\tconst blockOrder = new Map<string, number>();\r\n\t\tlet blockIdx = 0;\r\n\t\tfor (const grid of destination.blockGrids ?? []) {\r\n\t\t\tfor (const block of grid.blocks) {\r\n\t\t\t\tblockOrder.set(block.key, blockIdx++);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add groups in tab order\r\n\t\tfor (const tab of allTabs) {\r\n\t\t\t// Non-block groups for this tab\r\n\t\t\tconst nonBlockGroup = groupMap.get(tab.id);\r\n\t\t\tif (nonBlockGroup) {\r\n\t\t\t\tresult.push(nonBlockGroup);\r\n\t\t\t}\r\n\r\n\t\t\t// Block groups for this tab, ordered by block position\r\n\t\t\tconst blockGroups = Array.from(groupMap.entries())\r\n\t\t\t\t.filter(([key, group]) => group.tabId === tab.id && group.blockKey)\r\n\t\t\t\t.sort(([, a], [, b]) => {\r\n\t\t\t\t\tconst orderA = blockOrder.get(a.blockKey!) ?? 999;\r\n\t\t\t\t\tconst orderB = blockOrder.get(b.blockKey!) ?? 999;\r\n\t\t\t\t\treturn orderA - orderB;\r\n\t\t\t\t})\r\n\t\t\t\t.map(([, group]) => group);\r\n\r\n\t\t\tresult.push(...blockGroups);\r\n\t\t}\r\n\r\n\t\t// Add unmapped group at the end\r\n\t\tconst unmapped = groupMap.get('unmapped');\r\n\t\tif (unmapped) {\r\n\t\t\tresult.push(unmapped);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t#renderMappingGroup(group: {\r\n\t\ttabLabel: string;\r\n\t\tblockLabel?: string;\r\n\t\tmappings: Array<{ mapping: SectionMapping; index: number }>;\r\n\t}) {\r\n\t\tconst label = group.blockLabel\r\n\t\t\t? `${group.tabLabel} \\u2014 ${group.blockLabel}`\r\n\t\t\t: group.tabLabel;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"mapping-group\">\r\n\t\t\t\t<div class=\"mapping-group-header\">\r\n\t\t\t\t\t<span class=\"mapping-group-label\">${label}</span>\r\n\t\t\t\t\t<span class=\"mapping-group-count\">${group.mappings.length}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<uui-table>\r\n\t\t\t\t\t<uui-table-head>\r\n\t\t\t\t\t\t<uui-table-head-cell>Source</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell style=\"width: 40px;\"></uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Destination</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell style=\"width: 100px;\"></uui-table-head-cell>\r\n\t\t\t\t\t</uui-table-head>\r\n\t\t\t\t\t${group.mappings.map(({ mapping, index }) =>\r\n\t\t\t\t\t\tthis.#renderMappingRow(mapping, index)\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-table>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderMappingsTable() {\r\n\t\tif (!this._config) return nothing;\r\n\r\n\t\tconst mappings = this._config.map.mappings;\r\n\t\tif (mappings.length === 0) return this.#renderEmptyState();\r\n\r\n\t\tconst groups = this.#groupMappingsByDestination();\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"mappings-header\">\r\n\t\t\t\t<span class=\"mapping-count\">${mappings.length} mapping${mappings.length !== 1 ? 's' : ''}</span>\r\n\t\t\t</div>\r\n\t\t\t${groups.map((group) => this.#renderMappingGroup(group))}\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<div class=\"loading\"><uui-loader-bar></uui-loader-bar></div>`;\r\n\t\t}\r\n\r\n\t\tif (this._error) {\r\n\t\t\treturn html`<p style=\"color: var(--uui-color-danger);\">${this._error}</p>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t${this.#renderMappingsTable()}\r\n\t\t\t\t</uui-box>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.loading {\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tpadding: var(--uui-size-layout-3) var(--uui-size-layout-1);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-icon {\r\n\t\t\t\tfont-size: 3rem;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t\topacity: 0.4;\r\n\t\t\t}\r\n\r\n\t\t\t.empty-title {\r\n\t\t\t\tfont-size: var(--uui-type-h5-size);\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin: 0 0 var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-message {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t}\r\n\r\n\t\t\t.mappings-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.mapping-count {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.mapping-group {\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-5);\r\n\t\t\t}\r\n\r\n\t\t\t.mapping-group:last-child {\r\n\t\t\t\tmargin-bottom: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.mapping-group-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.mapping-group-label {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.mapping-group-count {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tbackground: var(--uui-color-surface);\r\n\t\t\t\tpadding: 1px 8px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.source-cell {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: 2px;\r\n\t\t\t}\r\n\r\n\t\t\t.source-id {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.source-text {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\r\n\t\t\t.arrow-cell {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.destination-cell {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: 4px;\r\n\t\t\t}\r\n\r\n\t\t\t.destination-target {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.transform-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tpadding: 2px 8px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\twidth: fit-content;\r\n\t\t\t}\r\n\r\n\t\t\t.disabled-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t}\r\n\r\n\t\t\t.actions-cell {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocWorkflowMapViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-workflow-map-view': UpDocWorkflowMapViewElement;\r\n\t}\r\n}\r\n"],"names":["_workflowName","_token","_UpDocWorkflowMapViewElement_instances","loadData_fn","resolveDestinationLabel_fn","resolveSourceText_fn","deleteMapping_fn","renderEmptyState_fn","renderMappingRow_fn","groupMappingsByDestination_fn","renderMappingGroup_fn","renderMappingsTable_fn","UpDocWorkflowMapViewElement","UmbLitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","context","unique","__privateSet","__privateMethod","html","authContext","UMB_AUTH_CONTEXT","fetchWorkflowByName","__privateGet","fetchSampleExtraction","err","dest","grid","block","b","prop","p","field","sourceId","element","e","index","updatedMap","_","i","saveMapConfig","mapping","t","nothing","destination","allTabs","getDestinationTabs","groupMap","firstDest","tabId","resolveDestinationTab","tabLabel","blockKey","blockLabel","resolveBlockLabel","groupKey","result","blockOrder","blockIdx","tab","nonBlockGroup","blockGroups","key","group","a","orderA","orderB","unmapped","label","mappings","groups","UmbTextStyles","css","__decorateClass","state","customElement","UpDocWorkflowMapViewElement_default"],"mappings":"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"}