{"version":3,"file":"up-doc-workflow-map-view.element-B_3LiOpB.js","sources":["../src/up-doc-workflow-map-view.element.ts"],"sourcesContent":["import type { DocumentTypeConfig, SectionMapping, DestinationField, BlockProperty, RichExtractionResult, ExtractionElement } from './workflow.types.js';\r\nimport { fetchWorkflowByName, fetchSampleExtraction, saveMapConfig } from './workflow.service.js';\r\nimport { html, customElement, css, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\n\r\n@customElement('up-doc-workflow-map-view')\r\nexport class UpDocWorkflowMapViewElement extends UmbLitElement {\r\n\t@state() private _config: DocumentTypeConfig | null = null;\r\n\t@state() private _extraction: RichExtractionResult | null = null;\r\n\t@state() private _loading = true;\r\n\t@state() private _error: string | null = null;\r\n\t#workflowName = '';\r\n\t#token = '';\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.consumeContext(UMB_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\t\t\tthis.observe((context as any).unique, (unique: string | null) => {\r\n\t\t\t\tif (unique) {\r\n\t\t\t\t\tthis.#workflowName = decodeURIComponent(unique);\r\n\t\t\t\t\tthis.#loadData();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #loadData() {\r\n\t\tthis._loading = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tthis.#token = await authContext.getLatestToken();\r\n\t\t\tthis._config = await fetchWorkflowByName(this.#workflowName, this.#token);\r\n\r\n\t\t\tif (!this._config) {\r\n\t\t\t\tthis._error = `Workflow \"${this.#workflowName}\" not found`;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._extraction = await fetchSampleExtraction(this.#workflowName, this.#token);\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Failed to load workflow';\r\n\t\t\tconsole.error('Failed to load workflow config:', err);\r\n\t\t} finally {\r\n\t\t\tthis._loading = false;\r\n\t\t}\r\n\t}\r\n\r\n\t#resolveDestinationLabel(target: string): string {\r\n\t\tif (!this._config) return target;\r\n\r\n\t\t// Check top-level fields\r\n\t\tfor (const field of this._config.destination.fields) {\r\n\t\t\tif (field.alias === target) return field.label;\r\n\t\t}\r\n\r\n\t\t// Check block properties\r\n\t\tfor (const grid of this._config.destination.blockGrids ?? []) {\r\n\t\t\tfor (const block of grid.blocks) {\r\n\t\t\t\tfor (const prop of block.properties ?? []) {\r\n\t\t\t\t\tif (prop.alias === target) {\r\n\t\t\t\t\t\treturn `${block.label} > ${prop.label || prop.alias}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn target;\r\n\t}\r\n\r\n\t#resolveSourceText(sourceId: string): string {\r\n\t\tif (!this._extraction) return sourceId;\r\n\r\n\t\tconst element = this._extraction.elements.find((e) => e.id === sourceId);\r\n\t\tif (!element) return sourceId;\r\n\r\n\t\tconst text = element.text.length > 60 ? element.text.substring(0, 60) + '...' : element.text;\r\n\t\treturn text;\r\n\t}\r\n\r\n\tasync #deleteMapping(index: number) {\r\n\t\tif (!this._config) return;\r\n\r\n\t\tconst updatedMap = {\r\n\t\t\t...this._config.map,\r\n\t\t\tmappings: this._config.map.mappings.filter((_, i) => i !== index),\r\n\t\t};\r\n\r\n\t\tconst result = await saveMapConfig(this.#workflowName, updatedMap, this.#token);\r\n\t\tif (result) {\r\n\t\t\tthis._config = { ...this._config, map: updatedMap };\r\n\t\t}\r\n\t}\r\n\r\n\t#renderEmptyState() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"empty-state\">\r\n\t\t\t\t<uui-icon name=\"icon-nodes\" class=\"empty-icon\"></uui-icon>\r\n\t\t\t\t<p class=\"empty-title\">No mappings yet</p>\r\n\t\t\t\t<p class=\"empty-message\">Use the Source tab to map extracted content to destination fields.</p>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderMappingRow(mapping: SectionMapping, index: number) {\r\n\t\treturn html`\r\n\t\t\t<uui-table-row>\r\n\t\t\t\t<uui-table-cell class=\"source-cell\">\r\n\t\t\t\t\t<span class=\"source-id\">${mapping.source}</span>\r\n\t\t\t\t\t<span class=\"source-text\">${this.#resolveSourceText(mapping.source)}</span>\r\n\t\t\t\t</uui-table-cell>\r\n\t\t\t\t<uui-table-cell class=\"arrow-cell\">\r\n\t\t\t\t\t<uui-icon name=\"icon-arrow-right\"></uui-icon>\r\n\t\t\t\t</uui-table-cell>\r\n\t\t\t\t<uui-table-cell class=\"destination-cell\">\r\n\t\t\t\t\t${mapping.destinations.map(\r\n\t\t\t\t\t\t(dest) => html`\r\n\t\t\t\t\t\t\t<span class=\"destination-target\">${this.#resolveDestinationLabel(dest.target)}</span>\r\n\t\t\t\t\t\t\t${dest.transforms?.length\r\n\t\t\t\t\t\t\t\t? html`<span class=\"transform-badge\">${dest.transforms.map((t) => t.type).join(', ')}</span>`\r\n\t\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-table-cell>\r\n\t\t\t\t<uui-table-cell class=\"actions-cell\">\r\n\t\t\t\t\t${!mapping.enabled ? html`<uui-tag look=\"secondary\" class=\"disabled-badge\">Disabled</uui-tag>` : nothing}\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\t\tcolor=\"danger\"\r\n\t\t\t\t\t\tlabel=\"Delete\"\r\n\t\t\t\t\t\t@click=${() => this.#deleteMapping(index)}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</uui-table-cell>\r\n\t\t\t</uui-table-row>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderMappingsTable() {\r\n\t\tif (!this._config) return nothing;\r\n\r\n\t\tconst mappings = this._config.map.mappings;\r\n\t\tif (mappings.length === 0) return this.#renderEmptyState();\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"mappings-header\">\r\n\t\t\t\t<span class=\"mapping-count\">${mappings.length} mapping${mappings.length !== 1 ? 's' : ''}</span>\r\n\t\t\t</div>\r\n\t\t\t<uui-table>\r\n\t\t\t\t<uui-table-head>\r\n\t\t\t\t\t<uui-table-head-cell>Source</uui-table-head-cell>\r\n\t\t\t\t\t<uui-table-head-cell style=\"width: 40px;\"></uui-table-head-cell>\r\n\t\t\t\t\t<uui-table-head-cell>Destination</uui-table-head-cell>\r\n\t\t\t\t\t<uui-table-head-cell style=\"width: 100px;\"></uui-table-head-cell>\r\n\t\t\t\t</uui-table-head>\r\n\t\t\t\t${mappings.map((mapping, index) => this.#renderMappingRow(mapping, index))}\r\n\t\t\t</uui-table>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<div class=\"loading\"><uui-loader-bar></uui-loader-bar></div>`;\r\n\t\t}\r\n\r\n\t\tif (this._error) {\r\n\t\t\treturn html`<p style=\"color: var(--uui-color-danger);\">${this._error}</p>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t${this.#renderMappingsTable()}\r\n\t\t\t\t</uui-box>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.loading {\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-state {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tpadding: var(--uui-size-layout-3) var(--uui-size-layout-1);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-icon {\r\n\t\t\t\tfont-size: 3rem;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t\topacity: 0.4;\r\n\t\t\t}\r\n\r\n\t\t\t.empty-title {\r\n\t\t\t\tfont-size: var(--uui-type-h5-size);\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin: 0 0 var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-message {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t}\r\n\r\n\t\t\t.mappings-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.mapping-count {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.source-cell {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: 2px;\r\n\t\t\t}\r\n\r\n\t\t\t.source-id {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.source-text {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t}\r\n\r\n\t\t\t.arrow-cell {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.destination-cell {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: 4px;\r\n\t\t\t}\r\n\r\n\t\t\t.destination-target {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.transform-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tpadding: 2px 8px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\twidth: fit-content;\r\n\t\t\t}\r\n\r\n\t\t\t.disabled-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t}\r\n\r\n\t\t\t.actions-cell {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocWorkflowMapViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-workflow-map-view': UpDocWorkflowMapViewElement;\r\n\t}\r\n}\r\n"],"names":["_workflowName","_token","_UpDocWorkflowMapViewElement_instances","loadData_fn","resolveDestinationLabel_fn","resolveSourceText_fn","deleteMapping_fn","renderEmptyState_fn","renderMappingRow_fn","renderMappingsTable_fn","UpDocWorkflowMapViewElement","UmbLitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","context","unique","__privateSet","__privateMethod","html","authContext","UMB_AUTH_CONTEXT","fetchWorkflowByName","__privateGet","fetchSampleExtraction","err","target","field","grid","block","prop","sourceId","element","e","index","updatedMap","_","i","saveMapConfig","mapping","dest","_a","t","nothing","mappings","UmbTextStyles","css","__decorateClass","state","customElement","UpDocWorkflowMapViewElement_default"],"mappings":"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"}