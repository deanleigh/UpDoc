{"version":3,"file":"destination-utils-DUfOJy5W.js","sources":["../src/destination-utils.ts"],"sourcesContent":["import type { DestinationBlockGrid, DestinationConfig, MappingDestination } from './workflow.types.js';\r\n\r\nexport interface DestinationTab {\r\n\tid: string;\r\n\tlabel: string;\r\n}\r\n\r\n/**\r\n * Returns all block containers (grids + lists) from a destination config.\r\n * Use this instead of iterating blockGrids and blockLists separately.\r\n */\r\nexport function getAllBlockContainers(destination: DestinationConfig): DestinationBlockGrid[] {\r\n\treturn [...(destination.blockGrids ?? []), ...(destination.blockLists ?? [])];\r\n}\r\n\r\n/**\r\n * Extracts the tab structure from a destination config.\r\n * Returns tabs in document order, with additional tabs for block containers.\r\n */\r\nexport function getDestinationTabs(destination: DestinationConfig): DestinationTab[] {\r\n\tconst tabs: DestinationTab[] = [];\r\n\tconst tabNames = new Set(destination.fields.map((f) => f.tab).filter(Boolean));\r\n\r\n\tfor (const tabName of tabNames) {\r\n\t\ttabs.push({\r\n\t\t\tid: tabName!.toLowerCase().replace(/\\s+/g, '-'),\r\n\t\t\tlabel: tabName!,\r\n\t\t});\r\n\t}\r\n\r\n\t// Add tabs from block containers (grids default to \"Page Content\", lists use their tab)\r\n\tfor (const container of getAllBlockContainers(destination)) {\r\n\t\tconst containerTab = container.tab ?? 'Page Content';\r\n\t\tif (!tabNames.has(containerTab)) {\r\n\t\t\ttabNames.add(containerTab);\r\n\t\t\ttabs.push({\r\n\t\t\t\tid: containerTab.toLowerCase().replace(/\\s+/g, '-'),\r\n\t\t\t\tlabel: containerTab,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\treturn tabs;\r\n}\r\n\r\n/**\r\n * Resolves which destination tab a mapping destination belongs to.\r\n * Block properties resolve to their container's tab (or \"page-content\" for grids).\r\n * Top-level fields resolve to their field's tab (kebab-case ID).\r\n * Returns null if the destination can't be matched.\r\n */\r\nexport function resolveDestinationTab(\r\n\tdest: MappingDestination,\r\n\tdestination: DestinationConfig,\r\n): string | null {\r\n\tif (dest.blockKey) {\r\n\t\tfor (const container of getAllBlockContainers(destination)) {\r\n\t\t\tif (container.blocks.find((b) => b.key === dest.blockKey)) {\r\n\t\t\t\tconst tab = container.tab ?? 'Page Content';\r\n\t\t\t\treturn tab.toLowerCase().replace(/\\s+/g, '-');\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 'page-content';\r\n\t}\r\n\r\n\tconst field = destination.fields.find((f) => f.alias === dest.target);\r\n\tif (field?.tab) {\r\n\t\treturn field.tab.toLowerCase().replace(/\\s+/g, '-');\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n/**\r\n * Finds the block's display label given its key.\r\n * Searches both block grids and block lists.\r\n */\r\nexport function resolveBlockLabel(\r\n\tblockKey: string,\r\n\tdestination: DestinationConfig,\r\n): string | null {\r\n\tfor (const container of getAllBlockContainers(destination)) {\r\n\t\tconst block = container.blocks.find((b) => b.key === blockKey);\r\n\t\tif (block) return block.label;\r\n\t}\r\n\treturn null;\r\n}\r\n"],"names":["getAllBlockContainers","destination","getDestinationTabs","tabs","tabNames","f","tabName","container","containerTab","resolveDestinationTab","dest","b","field","resolveBlockLabel","blockKey","block"],"mappings":"AAWO,SAASA,EAAsBC,GAAwD;AAC7F,SAAO,CAAC,GAAIA,EAAY,cAAc,CAAA,GAAK,GAAIA,EAAY,cAAc,EAAG;AAC7E;AAMO,SAASC,EAAmBD,GAAkD;AACpF,QAAME,IAAyB,CAAA,GACzBC,IAAW,IAAI,IAAIH,EAAY,OAAO,IAAI,CAACI,MAAMA,EAAE,GAAG,EAAE,OAAO,OAAO,CAAC;AAE7E,aAAWC,KAAWF;AACrB,IAAAD,EAAK,KAAK;AAAA,MACT,IAAIG,EAAS,YAAA,EAAc,QAAQ,QAAQ,GAAG;AAAA,MAC9C,OAAOA;AAAA,IAAA,CACP;AAIF,aAAWC,KAAaP,EAAsBC,CAAW,GAAG;AAC3D,UAAMO,IAAeD,EAAU,OAAO;AACtC,IAAKH,EAAS,IAAII,CAAY,MAC7BJ,EAAS,IAAII,CAAY,GACzBL,EAAK,KAAK;AAAA,MACT,IAAIK,EAAa,YAAA,EAAc,QAAQ,QAAQ,GAAG;AAAA,MAClD,OAAOA;AAAA,IAAA,CACP;AAAA,EAEH;AAEA,SAAOL;AACR;AAQO,SAASM,EACfC,GACAT,GACgB;AAChB,MAAIS,EAAK,UAAU;AAClB,eAAWH,KAAaP,EAAsBC,CAAW;AACxD,UAAIM,EAAU,OAAO,KAAK,CAACI,MAAMA,EAAE,QAAQD,EAAK,QAAQ;AAEvD,gBADYH,EAAU,OAAO,gBAClB,YAAA,EAAc,QAAQ,QAAQ,GAAG;AAG9C,WAAO;AAAA,EACR;AAEA,QAAMK,IAAQX,EAAY,OAAO,KAAK,CAACI,MAAMA,EAAE,UAAUK,EAAK,MAAM;AACpE,SAAIE,GAAO,MACHA,EAAM,IAAI,YAAA,EAAc,QAAQ,QAAQ,GAAG,IAG5C;AACR;AAMO,SAASC,EACfC,GACAb,GACgB;AAChB,aAAWM,KAAaP,EAAsBC,CAAW,GAAG;AAC3D,UAAMc,IAAQR,EAAU,OAAO,KAAK,CAACI,MAAMA,EAAE,QAAQG,CAAQ;AAC7D,QAAIC,UAAcA,EAAM;AAAA,EACzB;AACA,SAAO;AACR;"}