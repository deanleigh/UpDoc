{"version":3,"file":"up-doc-workflows-view.element-BxJYpHM6.js","sources":["../src/create-workflow-sidebar.token.ts","../src/up-doc-workflows-view.element.ts"],"sourcesContent":["import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface CreateWorkflowSidebarData {\r\n\tdocumentTypeUnique: string;\r\n\tdocumentTypeName: string;\r\n\tdocumentTypeAlias: string;\r\n\tblueprintUnique: string;\r\n\tblueprintName: string;\r\n}\r\n\r\nexport interface CreateWorkflowSidebarValue {\r\n\tname: string;\r\n\tsourceType: string;\r\n\tmediaUnique: string | null;\r\n\tsourceUrl: string | null;\r\n\tdocumentTypeAlias: string;\r\n\tblueprintId: string;\r\n\tblueprintName: string;\r\n}\r\n\r\nexport const UMB_CREATE_WORKFLOW_SIDEBAR = new UmbModalToken<CreateWorkflowSidebarData, CreateWorkflowSidebarValue>(\r\n\t'UpDoc.CreateWorkflowSidebar',\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'sidebar',\r\n\t\t\tsize: 'small',\r\n\t\t},\r\n\t},\r\n);\r\n","import { html, css, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_MODAL_MANAGER_CONTEXT, UMB_CONFIRM_MODAL, umbOpenModal } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_BLUEPRINT_PICKER_MODAL } from './blueprint-picker-modal.token.js';\r\nimport type { DocumentTypeOption } from './blueprint-picker-modal.token.js';\r\nimport { UMB_CREATE_WORKFLOW_SIDEBAR } from './create-workflow-sidebar.token.js';\r\nimport { clearConfigCache, triggerSampleExtraction } from './workflow.service.js';\r\n\r\ninterface WorkflowSummary {\r\n\tname: string;\r\n\tdocumentTypeAlias: string;\r\n\tblueprintId: string | null;\r\n\tblueprintName: string | null;\r\n\tsourceTypes: string[];\r\n\tmappingCount: number;\r\n\tisComplete: boolean;\r\n\tvalidationWarnings: string[];\r\n}\r\n\r\n@customElement('up-doc-workflows-view')\r\nexport class UpDocWorkflowsViewElement extends UmbLitElement {\r\n\t@state() private _workflows: WorkflowSummary[] = [];\r\n\t@state() private _loading = true;\r\n\t@state() private _error: string | null = null;\r\n\r\n\toverride async connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tawait this.#loadWorkflows();\r\n\t}\r\n\r\n\tasync #loadWorkflows() {\r\n\t\tthis._loading = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t\tconst response = await fetch('/umbraco/management/api/v1/updoc/workflows', {\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\tif (!response.ok) {\r\n\t\t\t\tthrow new Error(`Failed to load workflows: ${response.statusText}`);\r\n\t\t\t}\r\n\r\n\t\t\tthis._workflows = await response.json();\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Unknown error';\r\n\t\t\tconsole.error('Failed to load workflows:', err);\r\n\t\t} finally {\r\n\t\t\tthis._loading = false;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #handleCreateWorkflow() {\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t\t// Step 1: Fetch document types and their blueprints\r\n\t\t\tconst docTypesResponse = await fetch('/umbraco/management/api/v1/updoc/document-types', {\r\n\t\t\t\theaders: { Authorization: `Bearer ${token}` },\r\n\t\t\t});\r\n\r\n\t\t\tif (!docTypesResponse.ok) {\r\n\t\t\t\tthrow new Error('Failed to load document types');\r\n\t\t\t}\r\n\r\n\t\t\tconst docTypes: Array<{ alias: string; name: string; icon: string; id: string }> =\r\n\t\t\t\tawait docTypesResponse.json();\r\n\r\n\t\t\t// Step 2: Build DocumentTypeOption[] for the blueprint picker\r\n\t\t\tconst documentTypeOptions: DocumentTypeOption[] = [];\r\n\r\n\t\t\tfor (const dt of docTypes) {\r\n\t\t\t\tconst bpResponse = await fetch(\r\n\t\t\t\t\t`/umbraco/management/api/v1/updoc/document-types/${encodeURIComponent(dt.alias)}/blueprints`,\r\n\t\t\t\t\t{ headers: { Authorization: `Bearer ${token}` } },\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!bpResponse.ok) continue;\r\n\r\n\t\t\t\tconst blueprints: Array<{ id: string; name: string }> = await bpResponse.json();\r\n\t\t\t\tif (blueprints.length > 0) {\r\n\t\t\t\t\tdocumentTypeOptions.push({\r\n\t\t\t\t\t\tdocumentTypeUnique: dt.id,\r\n\t\t\t\t\t\tdocumentTypeName: dt.name,\r\n\t\t\t\t\t\tdocumentTypeIcon: dt.icon ?? null,\r\n\t\t\t\t\t\tblueprints: blueprints.map((bp) => ({\r\n\t\t\t\t\t\t\tblueprintUnique: bp.id,\r\n\t\t\t\t\t\t\tblueprintName: bp.name,\r\n\t\t\t\t\t\t})),\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!documentTypeOptions.length) {\r\n\t\t\t\tthis._error = 'No document types with blueprints found. Create a Document Blueprint first.';\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Step 3: Open blueprint picker dialog\r\n\t\t\tlet blueprintSelection;\r\n\t\t\ttry {\r\n\t\t\t\tblueprintSelection = await umbOpenModal(this, UMB_BLUEPRINT_PICKER_MODAL, {\r\n\t\t\t\t\tdata: { documentTypes: documentTypeOptions },\r\n\t\t\t\t});\r\n\t\t\t} catch {\r\n\t\t\t\treturn; // Cancelled\r\n\t\t\t}\r\n\r\n\t\t\tconst { blueprintUnique, documentTypeUnique } = blueprintSelection;\r\n\t\t\tconst selectedDocType = documentTypeOptions.find((dt) => dt.documentTypeUnique === documentTypeUnique);\r\n\t\t\tconst selectedBlueprint = selectedDocType?.blueprints.find((bp) => bp.blueprintUnique === blueprintUnique);\r\n\r\n\t\t\t// Find the alias for the selected document type\r\n\t\t\tconst selectedDocTypeApi = docTypes.find((dt) => dt.id === documentTypeUnique);\r\n\r\n\t\t\t// Step 4: Open Create Workflow sidebar\r\n\t\t\tlet sidebarResult;\r\n\t\t\ttry {\r\n\t\t\t\tsidebarResult = await umbOpenModal(this, UMB_CREATE_WORKFLOW_SIDEBAR, {\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tdocumentTypeUnique,\r\n\t\t\t\t\t\tdocumentTypeName: selectedDocType?.documentTypeName ?? '',\r\n\t\t\t\t\t\tdocumentTypeAlias: selectedDocTypeApi?.alias ?? '',\r\n\t\t\t\t\t\tblueprintUnique,\r\n\t\t\t\t\t\tblueprintName: selectedBlueprint?.blueprintName ?? '',\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t} catch {\r\n\t\t\t\treturn; // Cancelled\r\n\t\t\t}\r\n\r\n\t\t\t// Step 5: POST to create the workflow\r\n\t\t\tconst response = await fetch('/umbraco/management/api/v1/updoc/workflows', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\tname: sidebarResult.name,\r\n\t\t\t\t\tdocumentTypeAlias: sidebarResult.documentTypeAlias,\r\n\t\t\t\t\tsourceType: sidebarResult.sourceType,\r\n\t\t\t\t\tblueprintId: sidebarResult.blueprintId,\r\n\t\t\t\t\tblueprintName: sidebarResult.blueprintName,\r\n\t\t\t\t}),\r\n\t\t\t});\r\n\r\n\t\t\tif (!response.ok) {\r\n\t\t\t\tconst error = await response.json();\r\n\t\t\t\tthrow new Error(error.error || `Failed to create workflow: ${response.statusText}`);\r\n\t\t\t}\r\n\r\n\t\t\t// Step 6: If a sample PDF was selected, trigger extraction\r\n\t\t\tif (sidebarResult.mediaUnique) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tawait triggerSampleExtraction(sidebarResult.name, sidebarResult.mediaUnique, token);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.warn('Sample extraction during workflow creation failed:', err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Refresh the list\r\n\t\t\tawait this.#loadWorkflows();\r\n\t\t} catch (err) {\r\n\t\t\tif (err instanceof Error) {\r\n\t\t\t\tthis._error = err.message;\r\n\t\t\t\tconsole.error('Failed to create workflow:', err);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t#handleViewWorkflow(workflow: WorkflowSummary) {\r\n\t\tconst encodedName = encodeURIComponent(workflow.name);\r\n\t\twindow.history.pushState({}, '', `section/settings/workspace/updoc-workflow/edit/${encodedName}`);\r\n\t\twindow.dispatchEvent(new PopStateEvent('popstate'));\r\n\t}\r\n\r\n\tasync #handleDeleteWorkflow(workflow: WorkflowSummary) {\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\r\n\t\ttry {\r\n\t\t\tawait modalManager.open(this, UMB_CONFIRM_MODAL, {\r\n\t\t\t\tdata: {\r\n\t\t\t\t\theadline: `Delete \"${workflow.name}\"?`,\r\n\t\t\t\t\tcontent: html`<p>This will permanently delete the workflow folder and all its configuration files (destination, map, and source configs).</p>\r\n\t\t\t\t\t\t<p>This action cannot be undone.</p>`,\r\n\t\t\t\t\tconfirmLabel: 'Delete',\r\n\t\t\t\t\tcolor: 'danger',\r\n\t\t\t\t},\r\n\t\t\t}).onSubmit();\r\n\t\t} catch {\r\n\t\t\t// Cancelled\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\r\n\t\t\tconst response = await fetch(`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflow.name)}`, {\r\n\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\tif (!response.ok) {\r\n\t\t\t\tconst error = await response.json();\r\n\t\t\t\tthrow new Error(error.error || `Failed to delete workflow: ${response.statusText}`);\r\n\t\t\t}\r\n\r\n\t\t\t// Clear the client-side cache so the condition re-evaluates\r\n\t\t\tclearConfigCache();\r\n\r\n\t\t\t// Refresh the list\r\n\t\t\tawait this.#loadWorkflows();\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Unknown error';\r\n\t\t\tconsole.error('Failed to delete workflow:', err);\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<uui-loader-bar></uui-loader-bar>`;\r\n\t\t}\r\n\r\n\t\tif (this._error) {\r\n\t\t\treturn html`\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t<p style=\"color: var(--uui-color-danger);\">Error: ${this._error}</p>\r\n\t\t\t\t\t<uui-button look=\"secondary\" @click=${() => this.#loadWorkflows()}>Retry</uui-button>\r\n\t\t\t\t</uui-box>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tif (this._workflows.length === 0) {\r\n\t\t\treturn this.#renderEmptyState();\r\n\t\t}\r\n\r\n\t\treturn this.#renderWorkflowList();\r\n\t}\r\n\r\n\t#formatSourceTypes(sourceTypes: string[]): string {\r\n\t\tif (!sourceTypes.length) return '—';\r\n\t\tconst labels: Record<string, string> = { pdf: 'PDF', markdown: 'Markdown', web: 'Web', doc: 'Word' };\r\n\t\treturn sourceTypes.map((t) => labels[t] ?? t).join(', ');\r\n\t}\r\n\r\n\t#renderEmptyState() {\r\n\t\treturn html`\r\n\t\t\t<uui-box headline=\"No workflows configured\">\r\n\t\t\t\t<p>\r\n\t\t\t\t\tWorkflows define how content is extracted from external sources (PDFs, web pages, documents)\r\n\t\t\t\t\tand mapped to Umbraco document properties.\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>\r\n\t\t\t\t\tCreate a workflow to enable the <strong>\"Create from Source\"</strong> action\r\n\t\t\t\t\tfor a document type.\r\n\t\t\t\t</p>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\tlabel=\"Create Workflow\"\r\n\t\t\t\t\t@click=${this.#handleCreateWorkflow}></uui-button>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderWorkflowList() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"header\">\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\tlabel=\"Create Workflow\"\r\n\t\t\t\t\t@click=${this.#handleCreateWorkflow}></uui-button>\r\n\t\t\t</div>\r\n\t\t\t<uui-box>\r\n\t\t\t\t<uui-table>\r\n\t\t\t\t\t<uui-table-head>\r\n\t\t\t\t\t\t<uui-table-head-cell>Workflow</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Document Type</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Blueprint</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Source</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Mappings</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell>Status</uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell style=\"width: 1px;\"></uui-table-head-cell>\r\n\t\t\t\t\t</uui-table-head>\r\n\t\t\t\t\t${this._workflows.map(\r\n\t\t\t\t\t\t(w) => html`\r\n\t\t\t\t\t\t\t<uui-table-row class=\"clickable-row\" @click=${() => this.#handleViewWorkflow(w)}>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${w.name}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${w.documentTypeAlias}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${w.blueprintName ?? w.blueprintId ?? '—'}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${this.#formatSourceTypes(w.sourceTypes)}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${w.mappingCount}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>\r\n\t\t\t\t\t\t\t\t\t<uui-tag\r\n\t\t\t\t\t\t\t\t\t\tlook=${w.isComplete ? 'primary' : 'secondary'}\r\n\t\t\t\t\t\t\t\t\t\tcolor=${w.isComplete ? 'positive' : 'warning'}>\r\n\t\t\t\t\t\t\t\t\t\t${w.isComplete ? 'Ready' : 'Incomplete'}\r\n\t\t\t\t\t\t\t\t\t</uui-tag>\r\n\t\t\t\t\t\t\t\t</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>\r\n\t\t\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\t\t\tlook=\"default\"\r\n\t\t\t\t\t\t\t\t\t\tcolor=\"danger\"\r\n\t\t\t\t\t\t\t\t\t\tlabel=\"Delete\"\r\n\t\t\t\t\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\t\t\t\t\t@click=${(e: Event) => { e.stopPropagation(); this.#handleDeleteWorkflow(w); }}>\r\n\t\t\t\t\t\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t\t\t</uui-table-cell>\r\n\t\t\t\t\t\t\t</uui-table-row>\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-table>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.clickable-row {\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.clickable-row:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UpDocWorkflowsViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-workflows-view': UpDocWorkflowsViewElement;\r\n\t}\r\n}\r\n"],"names":["UMB_CREATE_WORKFLOW_SIDEBAR","UmbModalToken","_UpDocWorkflowsViewElement_instances","loadWorkflows_fn","handleCreateWorkflow_fn","handleViewWorkflow_fn","handleDeleteWorkflow_fn","formatSourceTypes_fn","renderEmptyState_fn","renderWorkflowList_fn","UpDocWorkflowsViewElement","UmbLitElement","__privateAdd","__privateMethod","html","token","UMB_AUTH_CONTEXT","response","err","docTypesResponse","docTypes","documentTypeOptions","dt","bpResponse","blueprints","bp","blueprintSelection","umbOpenModal","UMB_BLUEPRINT_PICKER_MODAL","blueprintUnique","documentTypeUnique","selectedDocType","selectedBlueprint","selectedDocTypeApi","sidebarResult","error","triggerSampleExtraction","workflow","encodedName","modalManager","UMB_MODAL_MANAGER_CONTEXT","UMB_CONFIRM_MODAL","clearConfigCache","sourceTypes","labels","t","w","e","UmbTextStyles","css","__decorateClass","state","customElement","UpDocWorkflowsViewElement_default"],"mappings":"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"}