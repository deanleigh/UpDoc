{"version":3,"file":"up-doc-workflow-source-views.element-Dk5jDSSF.js","sources":["../src/up-doc-workflow-source-views.element.ts"],"sourcesContent":["import type { DocumentTypeConfig, SourceConfig, SourceSection } from './workflow.types.js';\r\nimport { fetchWorkflowByName } from './workflow.service.js';\r\nimport { html, css, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\n\r\n/**\r\n * Base class for source type workspace views.\r\n * Subclassed per source type (Pdf, Markdown, etc.)\r\n */\r\nclass UpDocWorkflowSourceViewBase extends UmbLitElement {\r\n\tprotected sourceType = '';\r\n\r\n\t@state() private _sourceConfig: SourceConfig | null = null;\r\n\t@state() private _loading = true;\r\n\t@state() private _error: string | null = null;\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.consumeContext(UMB_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\t\t\tthis.observe((context as any).unique, (unique: string | null) => {\r\n\t\t\t\tif (unique) {\r\n\t\t\t\t\tthis.#loadConfig(decodeURIComponent(unique));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #loadConfig(workflowName: string) {\r\n\t\tthis._loading = true;\r\n\t\tthis._error = null;\r\n\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tconst token = await authContext.getLatestToken();\r\n\t\t\tconst config: DocumentTypeConfig | null = await fetchWorkflowByName(workflowName, token);\r\n\r\n\t\t\tif (!config) {\r\n\t\t\t\tthis._error = `Workflow \"${workflowName}\" not found`;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._sourceConfig = config.sources[this.sourceType] ?? null;\r\n\t\t} catch (err) {\r\n\t\t\tthis._error = err instanceof Error ? err.message : 'Failed to load workflow';\r\n\t\t\tconsole.error('Failed to load workflow config:', err);\r\n\t\t} finally {\r\n\t\t\tthis._loading = false;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderSourceSection(section: SourceSection) {\r\n\t\treturn html`\r\n\t\t\t<div class=\"section-item\">\r\n\t\t\t\t<div class=\"section-header\">\r\n\t\t\t\t\t<span class=\"section-label\">${section.label}</span>\r\n\t\t\t\t\t<span class=\"section-strategy\">${section.strategy}</span>\r\n\t\t\t\t\t${section.required ? html`<uui-tag look=\"primary\" color=\"danger\" class=\"field-badge\">Required</uui-tag>` : nothing}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"section-meta\">\r\n\t\t\t\t\t<span class=\"field-alias\">${section.key}</span>\r\n\t\t\t\t\t<span class=\"section-output\">${section.outputFormat}</span>\r\n\t\t\t\t\t${section.pages ? html`<span class=\"section-pages\">pages: ${Array.isArray(section.pages) ? section.pages.join(', ') : section.pages}</span>` : nothing}\r\n\t\t\t\t</div>\r\n\t\t\t\t${section.description ? html`<p class=\"section-description\">${section.description}</p>` : nothing}\r\n\t\t\t\t${section.strategyParams ? this.#renderStrategyParams(section.strategyParams) : nothing}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderStrategyParams(params: Record<string, unknown>) {\r\n\t\tconst entries = Object.entries(params).filter(([, v]) => v !== undefined && v !== null);\r\n\t\tif (entries.length === 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"strategy-params\">\r\n\t\t\t\t${entries.map(\r\n\t\t\t\t\t([key, value]) => html`\r\n\t\t\t\t\t\t<span class=\"param\">\r\n\t\t\t\t\t\t\t<span class=\"param-key\">${key}:</span>\r\n\t\t\t\t\t\t\t<span class=\"param-value\">${Array.isArray(value) ? value.join(', ') : String(value)}</span>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t`\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<div class=\"loading\"><uui-loader-bar></uui-loader-bar></div>`;\r\n\t\t}\r\n\r\n\t\tif (this._error) {\r\n\t\t\treturn html`<p style=\"color: var(--uui-color-danger);\">${this._error}</p>`;\r\n\t\t}\r\n\r\n\t\tif (!this._sourceConfig) {\r\n\t\t\treturn html`<p class=\"empty-message\">No ${this.sourceType} source configured for this workflow.</p>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t${this._sourceConfig.globals?.columnDetection\r\n\t\t\t\t? html`\r\n\t\t\t\t\t<div class=\"source-globals\">\r\n\t\t\t\t\t\t<span class=\"globals-label\">Column Detection:</span>\r\n\t\t\t\t\t\t<span>${this._sourceConfig.globals.columnDetection.enabled ? 'Enabled' : 'Disabled'}\r\n\t\t\t\t\t\t\t${this._sourceConfig.globals.columnDetection.enabled\r\n\t\t\t\t\t\t\t\t? `(threshold: ${(this._sourceConfig.globals.columnDetection.thresholdPercent * 100).toFixed(0)}%)`\r\n\t\t\t\t\t\t\t\t: ''}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t`\r\n\t\t\t\t: nothing}\r\n\t\t\t<div class=\"section-list\">\r\n\t\t\t\t${this._sourceConfig.sections.map((section) => this.#renderSourceSection(section))}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.loading {\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.empty-message {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t}\r\n\r\n\t\t\t.field-badge {\r\n\t\t\t\tfont-size: 11px;\r\n\t\t\t}\r\n\r\n\t\t\t.source-globals {\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.globals-label {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.section-list {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t.section-item {\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t.section-item:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t.section-header {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.section-label {\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.section-strategy {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tpadding: 2px 8px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t.section-meta {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tmargin-top: var(--uui-size-space-1);\r\n\t\t\t}\r\n\r\n\t\t\t.field-alias {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t}\r\n\r\n\t\t\t.section-output {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.section-pages {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.section-description {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tmargin: var(--uui-size-space-1) 0 0 0;\r\n\t\t\t}\r\n\r\n\t\t\t.strategy-params {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t\tmargin-top: var(--uui-size-space-2);\r\n\t\t\t\tpadding: var(--uui-size-space-2);\r\n\t\t\t\tbackground: var(--uui-color-surface-alt);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tfont-size: 12px;\r\n\t\t\t\tfont-family: monospace;\r\n\t\t\t}\r\n\r\n\t\t\t.param {\r\n\t\t\t\tdisplay: inline-flex;\r\n\t\t\t\tgap: 4px;\r\n\t\t\t}\r\n\r\n\t\t\t.param-key {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\t.param-value {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t\tword-break: break-all;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\n@customElement('up-doc-workflow-pdf-view')\r\nexport class UpDocWorkflowPdfViewElement extends UpDocWorkflowSourceViewBase {\r\n\toverride sourceType = 'pdf';\r\n}\r\n\r\n@customElement('up-doc-workflow-markdown-view')\r\nexport class UpDocWorkflowMarkdownViewElement extends UpDocWorkflowSourceViewBase {\r\n\toverride sourceType = 'markdown';\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'up-doc-workflow-pdf-view': UpDocWorkflowPdfViewElement;\r\n\t\t'up-doc-workflow-markdown-view': UpDocWorkflowMarkdownViewElement;\r\n\t}\r\n}\r\n"],"names":["_UpDocWorkflowSourceViewBase","UmbLitElement","__privateAdd","_UpDocWorkflowSourceViewBase_instances","UMB_WORKSPACE_CONTEXT","context","unique","__privateMethod","loadConfig_fn","html","_a","nothing","section","renderSourceSection_fn","workflowName","token","UMB_AUTH_CONTEXT","config","fetchWorkflowByName","err","renderStrategyParams_fn","params","entries","v","key","value","UmbTextStyles","css","UpDocWorkflowSourceViewBase","__decorateClass","state","UpDocWorkflowPdfViewElement","customElement","UpDocWorkflowMarkdownViewElement"],"mappings":"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"}