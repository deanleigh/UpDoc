{"version":3,"file":"workflow.service-CCTLt2Zy.js","sources":["../src/workflow.service.ts"],"sourcesContent":["import type { DocumentTypeConfig, ExtractSectionsResponse, MapConfig, RichExtractionResult, SectionRuleSet, AreaRules, TransformResult, AreaDetectionResult, AreaTemplate, InferSectionPatternResponse } from './workflow.types.js';\r\n\r\nconst configCache = new Map<string, DocumentTypeConfig>();\r\n\r\nexport interface ActiveWorkflows {\r\n\tdocumentTypeAliases: string[];\r\n\tblueprintIds: string[];\r\n}\r\n\r\nlet activeWorkflowsCache: ActiveWorkflows | null = null;\r\nlet activeWorkflowsPromise: Promise<ActiveWorkflows> | null = null;\r\n\r\n/**\r\n * Fetches the list of document type aliases and blueprint IDs\r\n * that have complete workflows configured. Cached globally.\r\n */\r\nexport async function fetchActiveWorkflows(token: string): Promise<ActiveWorkflows> {\r\n\tif (activeWorkflowsCache) return activeWorkflowsCache;\r\n\r\n\tif (!activeWorkflowsPromise) {\r\n\t\tactiveWorkflowsPromise = (async () => {\r\n\t\t\ttry {\r\n\t\t\t\tconst response = await fetch('/umbraco/management/api/v1/updoc/workflows/active', {\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (response.ok) {\r\n\t\t\t\t\tactiveWorkflowsCache = await response.json();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tactiveWorkflowsCache = { documentTypeAliases: [], blueprintIds: [] };\r\n\t\t\t\t}\r\n\t\t\t} catch {\r\n\t\t\t\tactiveWorkflowsCache = { documentTypeAliases: [], blueprintIds: [] };\r\n\t\t\t}\r\n\t\t\tactiveWorkflowsPromise = null;\r\n\t\t\treturn activeWorkflowsCache!;\r\n\t\t})();\r\n\t}\r\n\r\n\treturn activeWorkflowsPromise;\r\n}\r\n\r\n/**\r\n * Fetches the document type config for a given blueprint ID.\r\n * The config contains source.json, destination.json, and map.json data.\r\n */\r\nexport async function fetchConfig(blueprintId: string, token: string): Promise<DocumentTypeConfig | null> {\r\n\tconst cached = configCache.get(blueprintId);\r\n\tif (cached) return cached;\r\n\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/config/${blueprintId}`,\r\n\t\t{\r\n\t\t\tmethod: 'GET',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconsole.warn(`No config found for blueprint ${blueprintId}`);\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst config: DocumentTypeConfig = await response.json();\r\n\tconfigCache.set(blueprintId, config);\r\n\treturn config;\r\n}\r\n\r\n/**\r\n * Extracts sections from a source document using the config for the given blueprint.\r\n * Returns extracted sections and the full config for property mapping.\r\n */\r\nexport async function extractSections(\r\n\tmediaKey: string,\r\n\tblueprintId: string,\r\n\ttoken: string,\r\n\tsourceType: string = 'pdf'\r\n): Promise<ExtractSectionsResponse | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/extract-sections?mediaKey=${mediaKey}&blueprintId=${blueprintId}&sourceType=${sourceType}`,\r\n\t\t{\r\n\t\t\tmethod: 'GET',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Extract sections failed:', error);\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// API returns { sections, config } - pass through directly\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Fetches the full config for a workflow by its folder name.\r\n * Returns source, destination, and map configs.\r\n */\r\nexport async function fetchWorkflowByName(name: string, token: string): Promise<DocumentTypeConfig | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(name)}`,\r\n\t\t{\r\n\t\t\tmethod: 'GET',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconsole.warn(`No workflow found with name \"${name}\"`);\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Fetches the sample extraction for a workflow, if it exists.\r\n */\r\nexport async function fetchSampleExtraction(\r\n\tworkflowName: string,\r\n\ttoken: string\r\n): Promise<RichExtractionResult | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/sample-extraction`,\r\n\t\t{\r\n\t\t\tmethod: 'GET',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) return null;\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Triggers a sample extraction for a workflow from a media item (PDF).\r\n * The extraction is saved to sample-extraction.json in the workflow folder.\r\n */\r\nexport async function triggerSampleExtraction(\r\n\tworkflowName: string,\r\n\tmediaKey: string,\r\n\ttoken: string\r\n): Promise<RichExtractionResult | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/sample-extraction`,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({ mediaKey }),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Sample extraction failed:', error);\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Runs a standalone rich extraction from a media item (PDF) without saving to a workflow.\r\n * Used for validation/preview before the workflow folder exists.\r\n */\r\nexport async function extractRich(\r\n\tmediaKey: string,\r\n\ttoken: string\r\n): Promise<RichExtractionResult | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/extract-rich?mediaKey=${mediaKey}`,\r\n\t\t{\r\n\t\t\tmethod: 'GET',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) return null;\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Fetches the area detection result for a workflow, if it exists.\r\n */\r\nexport async function fetchAreaDetection(\r\n\tworkflowName: string,\r\n\ttoken: string\r\n): Promise<AreaDetectionResult | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/area-detection`,\r\n\t\t{\r\n\t\t\tmethod: 'GET',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) return null;\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Triggers area detection for a workflow from a media item (PDF).\r\n * The result is saved to area-detection.json in the workflow folder.\r\n */\r\nexport async function triggerAreaDetection(\r\n\tworkflowName: string,\r\n\tmediaKey: string,\r\n\ttoken: string\r\n): Promise<AreaDetectionResult | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/area-detection`,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({ mediaKey }),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Area detection failed:', error);\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Fetches the transform result for a workflow, if it exists.\r\n */\r\nexport async function fetchTransformResult(\r\n\tworkflowName: string,\r\n\ttoken: string\r\n): Promise<TransformResult | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/transform`,\r\n\t\t{\r\n\t\t\tmethod: 'GET',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) return null;\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Triggers area detection + transform for a workflow from a media item (PDF).\r\n * The result is saved to transform.json (and area-detection.json) in the workflow folder.\r\n */\r\nexport async function triggerTransform(\r\n\tworkflowName: string,\r\n\tmediaKey: string,\r\n\ttoken: string\r\n): Promise<TransformResult | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/transform`,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({ mediaKey }),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Transform failed:', error);\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Runs area detection + transform on a media item without saving to disk.\r\n * Returns a TransformResult with include/exclude state from the stored transform.\r\n */\r\nexport async function transformAdhoc(\r\n\tworkflowName: string,\r\n\tmediaKey: string,\r\n\ttoken: string\r\n): Promise<TransformResult | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/transform-adhoc`,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({ mediaKey }),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) return null;\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Updates the include/exclude state for a single section in transform.json.\r\n */\r\nexport async function updateSectionInclusion(\r\n\tworkflowName: string,\r\n\tsectionId: string,\r\n\tincluded: boolean,\r\n\ttoken: string\r\n): Promise<TransformResult | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/transform/sections/${encodeURIComponent(sectionId)}/included`,\r\n\t\t{\r\n\t\t\tmethod: 'PATCH',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({ included }),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) return null;\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Saves the map config for a workflow.\r\n */\r\nexport async function saveMapConfig(\r\n\tworkflowName: string,\r\n\tconfig: MapConfig,\r\n\ttoken: string\r\n): Promise<MapConfig | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/map`,\r\n\t\t{\r\n\t\t\tmethod: 'PUT',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify(config),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Save map config failed:', error);\r\n\t\treturn null;\r\n\t}\r\n\r\n\tclearConfigCache();\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Saves page selection for a workflow. Pass null or empty array for \"all pages\".\r\n */\r\nexport async function savePageSelection(\r\n\tworkflowName: string,\r\n\tpages: number[] | null,\r\n\ttoken: string\r\n): Promise<boolean> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/pages`,\r\n\t\t{\r\n\t\t\tmethod: 'PUT',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({ pages }),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Save page selection failed:', error);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tclearConfigCache();\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * Fetches the source config for a workflow.\r\n */\r\nexport async function fetchSourceConfig(\r\n\tworkflowName: string,\r\n\ttoken: string\r\n): Promise<import('./workflow.types.js').SourceConfig | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/source`,\r\n\t\t{\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) return null;\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Fetches the area template for a workflow, if it exists.\r\n */\r\nexport async function fetchAreaTemplate(\r\n\tworkflowName: string,\r\n\ttoken: string\r\n): Promise<AreaTemplate | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/area-template`,\r\n\t\t{\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) return null;\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Saves an area template for a workflow.\r\n */\r\nexport async function saveAreaTemplate(\r\n\tworkflowName: string,\r\n\ttemplate: AreaTemplate,\r\n\ttoken: string\r\n): Promise<AreaTemplate | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/area-template`,\r\n\t\t{\r\n\t\t\tmethod: 'PUT',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify(template),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Save area template failed:', error);\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Fetches the PDF file bytes for a workflow's source document.\r\n * Returns a Blob that can be used with PDF.js.\r\n */\r\nexport async function fetchPdfBlob(\r\n\tworkflowName: string,\r\n\ttoken: string\r\n): Promise<Blob | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/pdf`,\r\n\t\t{\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) return null;\r\n\treturn response.blob();\r\n}\r\n\r\n/**\r\n * Saves section rules for a workflow. Patches source.json's sectionRules key.\r\n */\r\nexport async function saveSectionRules(\r\n\tworkflowName: string,\r\n\tsectionRules: Record<string, SectionRuleSet>,\r\n\ttoken: string\r\n): Promise<Record<string, SectionRuleSet> | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/section-rules`,\r\n\t\t{\r\n\t\t\tmethod: 'PUT',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify(sectionRules),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Save section rules failed:', error);\r\n\t\treturn null;\r\n\t}\r\n\r\n\tclearConfigCache();\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Saves area rules for a workflow. Patches source.json's areaRules key.\r\n */\r\nexport async function saveAreaRules(\r\n\tworkflowName: string,\r\n\tareaRules: Record<string, AreaRules>,\r\n\ttoken: string\r\n): Promise<Record<string, AreaRules> | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/area-rules`,\r\n\t\t{\r\n\t\t\tmethod: 'PUT',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify(areaRules),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Save area rules failed:', error);\r\n\t\treturn null;\r\n\t}\r\n\r\n\tclearConfigCache();\r\n\treturn response.json();\r\n}\r\n\r\n/**\r\n * Infers a section pattern from a clicked element.\r\n * The backend examines the element's metadata and finds minimum distinguishing conditions.\r\n */\r\nexport async function inferSectionPattern(\r\n\tworkflowName: string,\r\n\tareaIndex: number,\r\n\telementId: string,\r\n\ttoken: string\r\n): Promise<InferSectionPatternResponse | null> {\r\n\tconst response = await fetch(\r\n\t\t`/umbraco/management/api/v1/updoc/workflows/${encodeURIComponent(workflowName)}/infer-section-pattern`,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({ areaIndex, elementId }),\r\n\t\t}\r\n\t);\r\n\r\n\tif (!response.ok) {\r\n\t\tconst error = await response.json();\r\n\t\tconsole.error('Infer section pattern failed:', error);\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn response.json();\r\n}\r\n\r\nexport function clearConfigCache(): void {\r\n\tconfigCache.clear();\r\n\tactiveWorkflowsCache = null;\r\n\tactiveWorkflowsPromise = null;\r\n}\r\n"],"names":["configCache","activeWorkflowsCache","activeWorkflowsPromise","fetchActiveWorkflows","token","response","fetchConfig","blueprintId","cached","config","fetchWorkflowByName","name","fetchSampleExtraction","workflowName","triggerSampleExtraction","mediaKey","error","extractRich","fetchAreaDetection","fetchTransformResult","triggerTransform","transformAdhoc","updateSectionInclusion","sectionId","included","saveMapConfig","clearConfigCache","savePageSelection","pages","fetchSourceConfig","fetchAreaTemplate","saveAreaTemplate","template","fetchPdfBlob","saveAreaRules","areaRules","inferSectionPattern","areaIndex","elementId"],"mappings":"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"}